2025-10-29 13:09:46,094 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_100946.log)
2025-10-29 13:09:46,094 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_100946.log)
2025-10-29 13:09:46,095 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_100946.log
2025-10-29 13:09:46,113 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-29 13:09:46,123 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-29 13:09:46,123 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-29 13:09:46,123 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-29 13:09:46,123 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-29 13:09:46,123 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-29 13:09:46,123 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-29 13:09:46,125 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-29 13:09:46,125 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-29 13:09:46,125 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-29 13:09:46,125 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-29 13:09:46,125 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-29 13:09:46,125 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-29 13:09:46,126 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-29 13:09:46,126 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-29 13:09:46,126 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-29 13:09:46,126 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-29 13:09:46,126 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-29 13:09:46,127 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-29 13:09:46,127 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-29 13:09:46,127 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-29 13:09:46,127 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-29 13:09:46,127 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=20)
2025-10-29 13:09:46,127 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=20, call=None)
2025-10-29 13:09:46,128 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-29 13:09:46,128 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=20)
2025-10-29 13:09:46,128 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "keep", "current_turn": 20, "day": 5, "final_summary": "Defeat - turn_limit_exceeded | Morale: 46, Order: 38, Resources: 39 | Glitch level: 32, Major events: 5 | Last major event: turn 15 | Notable characters: Rhea is loyal but impulsive; Boris is cautious and calculating.", "finalized": true, "flags": ["major_injected_event", "world_state_has_changed", "major_wall_alert", "has_discovered_flickering_light", "has_seen_flickering_lig...
2025-10-29 13:09:46,128 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 38, 'morale': 46, 'resources': 39, 'knowledge': 73, 'corruption': 10, 'glitch': 32, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}
2025-10-29 13:09:46,128 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 38, 'morale': 46, 'resources': 39, 'knowledge': 73, 'corruption': 10, 'glitch': 32, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}
2025-10-29 13:09:46,128 [INFO] fortress_director.utils.glitch_manager: Game finalized, skipping glitch resolution
2025-10-29 13:09:46,128 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=0, triggered_loss=False
2025-10-29 13:09:46,130 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 38, 'morale': 46, 'resources': 39, 'knowledge': 73, 'corruption': 10, 'glitch': 32, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}
2025-10-29 13:09:46,130 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=32, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-29 13:09:46,130 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 31, 'cause': 'turn_recovery'}
2025-10-29 13:09:46,130 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 32 to 31 (cause=turn_recovery)
2025-10-29 13:09:46,130 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 38, 'morale': 46, 'resources': 39, 'knowledge': 73, 'corruption': 10, 'glitch': 31, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}
2025-10-29 13:09:46,130 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=0, triggered_loss=False
2025-10-29 13:09:46,130 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 38, 'morale': 46, 'resources': 39, 'knowledge': 73, 'corruption': 10, 'glitch': 31, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}
2025-10-29 13:09:46,130 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-29 13:09:46,131 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 20 | Day 5 | Time dawn
Location: keep
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Nighttime rain with distant drumbeats", "sensory_details": "The air is heavy and moist, carrying the sharp tang of wet stone mixed with a metallic taste from Rhea's armor. The rhythmic patter of raindrops on battlement creates an unsettling yet oddly comforting backdrop to our vigil."}
Recent events: As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...; The rain continues to fall as you stand guard with Rhea at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...; As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a... Recent motifs: communication, unknown_action
Recent major events: none
Relationship summary: Rhea trusts the player deeply
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 38, "morale": 46, "resources": 39, "knowledge": 73, "corruption": 10, "glitch": 31, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 5, "major_event_last_turn": 14}
2025-10-29 13:09:46,131 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 20 in room keep
2025-10-29 13:09:46,131 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 20 | Day 5 | Time dawn\nLocation: keep\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Nighttime rain with distant drumbeats\", \"sensory_details\": \"The air is heavy and moist, carrying the sharp tang of wet stone mixed with a metallic taste from Rhea's armor. The rhythmic patter of raindrops on battlement creates an unsettling yet oddly comforting backdrop to our vigil.\"}\nRecent events: As the rain continues to fall, you and Rhea stand guard at the entrance of Lornha...
2025-10-29 13:09:46,131 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-29 13:09:46,131 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 20 | Day 5 | Time dawn\nLocation: keep\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Nighttime rain with distant drumbeats", "sensory_details": "The air is heavy and moist, carrying the sharp tang of wet stone mixed with a metallic taste from Rhea\'s armor. The rhythmic patter of raindrops on battlement creates an unsettling yet oddly comforting backdrop to our vigil."}\nRecent events: As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...; The rain continues to fall as you stand guard with Rhea at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...; As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a... Recent motifs: communication, unknown_action\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 38, "morale": 46, "resources": 39, "knowledge": 73, "corruption": 10, "glitch": 31, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 5, "major_event_last_turn": 14}', 'room': 'keep', 'time': 'dawn'}
2025-10-29 13:09:56,337 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Dawn breaks, rain ceases; distant drumbeats fade.', 'sensory_details': "The air lightens with the touch of sunlight piercing through dissipating clouds, revealing a cool and damp stone floor. The sharp tang of wetness mingles with Rhea's armor as if to remind us that we are still within this realm."}
2025-10-29 13:09:56,337 [WARNING] fortress_director.agents.world_agent: Time inconsistency: dawn but found ['morning'] indicators
2025-10-29 13:09:56,337 [WARNING] fortress_director.agents.world_agent: Time inconsistency detected, retrying...
2025-10-29 13:10:03,103 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Dawn breaks, rain ceases; distant drumbeats fade.', 'sensory_details': "The air lightens with a cool breeze as the last droplets evaporate from stone and metal alike. The sharp tang of wetness gives way to earthy scents carried by winds through open windows, while Rhea's armor gleams faintly in the newfound daylight."}
2025-10-29 13:10:03,103 [WARNING] fortress_director.agents.world_agent: Time inconsistency: dawn but found ['morning', 'afternoon'] indicators
2025-10-29 13:10:03,103 [WARNING] fortress_director.agents.world_agent: Time inconsistency detected, retrying...
2025-10-29 13:10:03,104 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Dawn breaks, rain ceases distant drumbeats fade.', 'sensory_details': "The air lightens with a cool breeze as the last droplets evaporate from stone and metal alike. The sharp tang of wetness gives way to earthy scents carried by winds through open windows, while Rhea's armor gleams faintly in the newfound daylight."}
2025-10-29 13:10:03,104 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-29 13:10:03,104 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn breaks, rain ceases distant drumbeats fade.", "sensory_details": "The air lightens with a cool breeze as the last droplets evaporate from stone and metal alike. The sharp tang of wetness gives way to earthy scents carried by winds through open windows, while Rhea's armor gleams faintly in the newfound daylight."}
2025-10-29 13:10:03,104 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 20 | Day 5 | Time dawn\nLocation: keep\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Nighttime rain with distant drumbeats\", \"sensory_details\": \"The air is heavy and moist, carrying the sharp tang of wet stone mixed with a metallic taste from Rhea's armor. The rhythmic patter of raindrops on battlement creates an unsettling yet oddly comforting backdrop to our vigil.\"}\nRecent events: As the rain continues to fall, you and Rhea stand guard at the entrance of Lornha...
2025-10-29 13:10:03,104 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-29 13:10:03,104 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 20 | Day 5 | Time dawn\nLocation: keep\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Nighttime rain with distant drumbeats", "sensory_details": "The air is heavy and moist, carrying the sharp tang of wet stone mixed with a metallic taste from Rhea\'s armor. The rhythmic patter of raindrops on battlement creates an unsettling yet oddly comforting backdrop to our vigil."}\nRecent events: As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...; The rain continues to fall as you stand guard with Rhea at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...; As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a... Recent motifs: communication, unknown_action\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 38, "morale": 46, "resources": 39, "knowledge": 73, "corruption": 10, "glitch": 31, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 5, "major_event_last_turn": 14}', 'day': 5, 'time': 'dawn', 'room': 'keep', 'recent_events': 'As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...; The rain continues to fall as you stand guard with Rhea at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...; As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...', 'world_constraint_from_prev_turn': '{"atmosphere": "Nighttime rain with distant drumbeats", "sensory_details": "The air is heavy and moist, carrying the sharp tang of wet stone mixed with a metallic taste from Rhea\'s armor. The rhythmic patter of raindrops on battlement creates an unsettling yet oddly comforting backdrop to our vigil."}', 'recent_motifs': 'communication, unknown_action', 'lore_continuity_weight': 5, 'memory_layers': ['Turn 17: Investigate the movement you see in the distance. -> The morning breeze carries a hint of rain as you stand guard with Rhea at the entrance of Lornhaven....', 'Turn 18: Investigate the source of the flickering light. -> As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds...', 'Memory summary: Turn 16: Investigate the movement you see in the distance. -> The wind picks up, the grit stinging your face as you stand with Rhea at the entrance of Lornhaven. ... | Turn 17: Investigate the movemen...', 'Turn 19: Investigate the source of the flickering light. -> The rain continues to fall as you stand guard with Rhea at the entrance of Lornhaven. The low clouds...', 'Turn 20: Investigate the source of the flickering light. -> As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds...'], 'judge_verdict': '{"consistent": true, "reason": "The content is consistent with established world, lore, and character logic. The rain continues to fall as the player stands guard at Lornhaven, observing a flickering light in the distance.", "coherence": 100, "integrity": 100, "tone_alignment": 100, "penalty_applied": "none", "penalty_magnitude": {}, "feedback": {}}', 'judge_feedback': {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The rain continues to fall as the player stands guard at Lornhaven, observing a flickering light in the distance.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}}
2025-10-29 13:10:40,789 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': 'As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a faint figure emerges from the darkness, moving towards the keep. The air grows tense as the mystery figure approaches.', 'options': [{'id': 'investigate_mystery_figure', 'text': 'Investigate the approaching figure.', 'action_type': 'interact'}, {'id': 'warn_Rhea', 'text': 'Warn Rhea about the approaching figure.', 'action_type': 'communicate'}, {'id': 'wait_and_observe', 'text': 'Remain vigilant and observe the approaching figure from a distance.', 'action_type': 'passive'}], 'major_event': True, 'safe_functions': ["spawn_item('torch', 'lornhaven_gate')"]}
2025-10-29 13:10:40,789 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': 'As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a faint figure emerges from the darkness, moving towards the keep. The air grows tense as the mystery figure approaches.', 'options': [{'id': 'investigate_mystery_figure', 'text': 'Investigate the approaching figure.', 'action_type': 'interact'}, {'id': 'warn_Rhea', 'text': 'Warn Rhea about the approaching figure.', 'action_type': 'communicate'}, {'id': 'wait_and_observe', 'text': 'Remain vigilant and observe the approaching figure from a distance.', 'action_type': 'passive'}], 'major_event': True, 'safe_functions': ["spawn_item('torch', 'lornhaven_gate')"]}
2025-10-29 13:10:40,789 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-29 13:10:40,789 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": true, "options": [{"action_type": "interact", "id": "investigate_mystery_figure", "text": "Investigate the approaching figure."}, {"action_type": "communicate", "id": "warn_Rhea", "text": "Warn Rhea about the approaching figure."}, {"action_type": "passive", "id": "wait_and_observe", "text": "Remain vigilant and observe the approaching figure from a distance."}], "safe_functions": ["spawn_item('torch', 'lornhaven_gate')", "change_weather"], "scene": "As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over th...
2025-10-29 13:10:40,789 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-29 13:10:47,976 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene setting matches the established atmosphere and tone of the game.'}
2025-10-29 13:10:47,977 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene setting matches the established atmosphere and tone of the game.'}
2025-10-29 13:10:47,977 [INFO] fortress_director.orchestrator.orchestrator: Added motif-based option: diplomacy_approach (motif active)
2025-10-29 13:10:47,977 [INFO] fortress_director.orchestrator.orchestrator: Added time-sensitive option: strategic_planning (turn=20)
2025-10-29 13:10:47,977 [INFO] fortress_director.orchestrator.orchestrator: Added time-sensitive option: emergency_measures (turn=20)
2025-10-29 13:10:47,978 [INFO] fortress_director.orchestrator.orchestrator: Added NPC fallback: move_npc('Boris', 'keep')
2025-10-29 13:10:47,978 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-29 13:10:47,978 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'investigate_mystery_figure', 'text': 'Investigate the approaching figure.', 'action_type': 'interact'}
2025-10-29 13:10:47,979 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "interact", "id": "investigate_mystery_figure", "text": "Investigate the approaching figure."}
2025-10-29 13:10:47,979 [INFO] fortress_director.orchestrator.orchestrator: Added motif: social_interaction
2025-10-29 13:10:47,979 [INFO] fortress_director.orchestrator.orchestrator: Applying dynamic metrics for action_type 'interact': {'morale': 2, 'knowledge': 1}
2025-10-29 13:10:47,979 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=46, delta=2, limits=(0, 100) (cause=action_interact)
2025-10-29 13:10:47,979 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 2, 'value': 48, 'cause': 'action_interact'}
2025-10-29 13:10:47,979 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 46 to 48 (cause=action_interact)
2025-10-29 13:10:47,979 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'knowledge': current=73, delta=1, limits=(0, 100) (cause=action_interact)
2025-10-29 13:10:47,979 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'knowledge', 'delta': 1, 'value': 74, 'cause': 'action_interact'}
2025-10-29 13:10:47,979 [INFO] fortress_director.utils.metrics_manager: Metric 'knowledge' updated from 73 to 74 (cause=action_interact)
2025-10-29 13:10:47,980 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after dynamic changes: {'order': 38, 'morale': 48, 'resources': 39, 'knowledge': 74, 'corruption': 10, 'glitch': 31, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}
2025-10-29 13:10:47,980 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 20 | Day 5 | Time dawn\nLocation: keep\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Nighttime rain with distant drumbeats\", \"sensory_details\": \"The air is heavy and moist, carrying the sharp tang of wet stone mixed with a metallic taste from Rhea's armor. The rhythmic patter of raindrops on battlement creates an unsettling yet oddly comforting backdrop to our vigil.\"}\nRecent events: As the rain continues to fall, you and Rhea stand guard at the entrance of Lornha...
2025-10-29 13:10:47,980 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-29 13:10:47,980 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 20 | Day 5 | Time dawn\nLocation: keep\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Nighttime rain with distant drumbeats", "sensory_details": "The air is heavy and moist, carrying the sharp tang of wet stone mixed with a metallic taste from Rhea\'s armor. The rhythmic patter of raindrops on battlement creates an unsettling yet oddly comforting backdrop to our vigil."}\nRecent events: As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...; The rain continues to fall as you stand guard with Rhea at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...; As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a... Recent motifs: communication, unknown_action\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 38, "morale": 46, "resources": 39, "knowledge": 73, "corruption": 10, "glitch": 31, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 5, "major_event_last_turn": 14}', 'scene_short': 'As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a faint figure emerges from the darkness, moving towards the keep. The air grows tense as the mystery figure approaches.', 'player_choice': 'Investigate the approaching figure.', 'atmosphere': 'Dawn breaks, rain ceases distant drumbeats fade.', 'sensory_details': "The air lightens with a cool breeze as the last droplets evaporate from stone and metal alike. The sharp tang of wetness gives way to earthy scents carried by winds through open windows, while Rhea's armor gleams faintly in the newfound daylight.", 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player deeply', 'player_inventory_brief': 'oil lamp, patched shield', 'memory_layers': ['Turn 17: Investigate the movement you see in the distance. -> The morning breeze carries a hint of rain as you stand guard with Rhea at the entrance of Lornhaven....', 'Turn 18: Investigate the source of the flickering light. -> As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds...', 'Memory summary: Turn 16: Investigate the movement you see in the distance. -> The wind picks up, the grit stinging your face as you stand with Rhea at the entrance of Lornhaven. ... | Turn 17: Investigate the movemen...', 'Turn 19: Investigate the source of the flickering light. -> The rain continues to fall as you stand guard with Rhea at the entrance of Lornhaven. The low clouds...', 'Turn 20: Investigate the source of the flickering light. -> As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds...'], 'recent_events': 'As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...; The rain continues to fall as you stand guard with Rhea at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...; As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...', 'last_major_event': 'As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a faint figure emerges from the darkness, moving towards the keep. The air grows tense as the mystery figure approaches.'}
2025-10-29 13:10:47,980 [INFO] fortress_director.agents.character_agent: Enforced behaviour variation for Rhea (count=3)
2025-10-29 13:10:57,516 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Rhea', 'intent': 'observe', 'action': 'wait', 'speech': 'The rain continues to fall, casting long shadows on the cool stone floor. The wind picks up, stinging my face with its sharp tang.'}
2025-10-29 13:10:57,516 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Rhea', 'intent': 'observe', 'action': 'wait', 'speech': 'The rain continues to fall, casting long shadows on the cool stone floor. The wind picks up, stinging my face with its sharp tang.', 'effects': {}, 'safe_functions': []}]
2025-10-29 13:10:57,516 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-29 13:10:57,516 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "wait", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "The rain continues to fall, casting long shadows on the cool stone floor. The wind picks up, stinging my face with its sharp tang."}]
2025-10-29 13:10:57,516 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-29 13:10:57,517 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-29 13:10:57,517 [DEBUG] fortress_director.orchestrator.orchestrator: Major event effect applied: {"applied_flag": "major_wall_alert", "applied_to": "Rhea", "status_change": {"duration": 3, "status": "tense_watch", "target": "Rhea"}}
2025-10-29 13:10:57,517 [INFO] fortress_director.orchestrator.orchestrator: Major event involves Mystery Figure, progressing from keep to gate
2025-10-29 13:10:57,518 [INFO] fortress_director.codeaware.function_registry: Validating function call: move_room
2025-10-29 13:10:57,518 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=20)
2025-10-29 13:10:57,518 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=20, call=move_room)
2025-10-29 13:10:57,518 [INFO] fortress_director.codeaware.function_registry: Getting registered function: move_room
2025-10-29 13:10:57,519 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'move_room'...
2025-10-29 13:10:57,519 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=20)
2025-10-29 13:10:57,520 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=20)
2025-10-29 13:10:57,520 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_room' executed successfully.
2025-10-29 13:10:57,520 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_room' executed (checkpoint turn=20)
2025-10-29 13:10:57,521 [INFO] fortress_director.orchestrator.orchestrator: Room progressed to gate after major event
2025-10-29 13:10:57,521 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-29 13:10:57,521 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "wait", "effects": {"flag_set": ["major_wall_alert"], "status_change": {"duration": 3, "status": "tense_watch", "target": "Rhea"}, "trust_delta": 0}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "The rain continues to fall, casting long shadows on the cool stone floor. The wind picks up, stinging my face with its sharp tang."}]
2025-10-29 13:10:57,521 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-29 13:10:57,521 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 20, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['major_injected_event', 'world_state_has_changed', 'major_wall_alert', 'has_discovered_flickering_light', 'has_seen_flickering_light'], 'memory_layers': ['Turn 17: Investigate the movement you see in the distance. -> The morning breeze carries a hint of rain as you stand guard with Rhea at the entrance of Lornhaven....', 'Turn 18: Investigate the source of the flickering light. -> As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds...', 'Memory summary: Turn 16: Investigate the movement you see in the distance. -> The wind picks up, the grit stinging your face as you stand with Rhea at the entrance of Lornhaven. ... | Turn 17: Investigate the movemen...', 'Turn 19: Investigate the source of the flickering light. -> The rain continues to fall as you stand guard with Rhea at the entrance of Lornhaven. The low clouds...', 'Turn 20: Investigate the source of the flickering light. -> As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds...'], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 20, 'day': 5, 'time': 'dawn', 'current_room': 'keep', 'recent_events': ['As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...', 'The rain continues to fall as you stand guard with Rhea at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...', 'As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...'], 'recent_motifs': ['communication', 'unknown_action', 'social_interaction'], 'world_constraint_from_prev_turn': {'atmosphere': 'Nighttime rain with distant drumbeats', 'sensory_details': "The air is heavy and moist, carrying the sharp tang of wet stone mixed with a metallic taste from Rhea's armor. The rhythmic patter of raindrops on battlement creates an unsettling yet oddly comforting backdrop to our vigil."}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player deeply', 'metrics': {'order': 38, 'morale': 48, 'resources': 39, 'knowledge': 74, 'corruption': 10, 'glitch': 31, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}, 'npc_trust': {'Rhea': 3}, 'previous_judge_verdict': {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene setting matches the established atmosphere and tone of the game.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['exploration', 'exploration', 'communication', 'exploration', 'exploration', 'exploration', 'physical', 'exploration', 'exploration', 'exploration'], 'status_effects': [], 'world_constraint': {'atmosphere': 'A faint drizzle begins to fall.', 'sensory_details': 'Tiny raindrops patter on the stone, cooling the air.'}, 'safe_function_injected': True, 'major_events_triggered': 5, 'major_event_last_turn': 15, 'npc_locations': {'Boris': 'battlements'}, 'finalized': True, 'final_summary': 'Defeat - turn_limit_exceeded | Morale: 46, Order: 38, Resources: 39 | Glitch level: 32, Major events: 5 | Last major event: turn 15 | Notable characters: Rhea is loyal but impulsive; Boris is cautious and calculating.'}
2025-10-29 13:10:57,521 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'observe', 'action': 'wait', 'speech': 'The rain continues to fall, casting long shadows on the cool stone floor. The wind picks up, stinging my face with its sharp tang.', 'effects': {'flag_set': ['major_wall_alert'], 'status_change': {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}, 'trust_delta': 0}, 'safe_functions': []}]
2025-10-29 13:10:57,521 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 20 | Day 5 | Time dawn
Location: keep
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Nighttime rain with distant drumbeats", "sensory_details": "The air is heavy and moist, carrying the sharp tang of wet stone mixed with a metallic taste from Rhea's armor. The rhythmic patter of raindrops on battlement creates an unsettling yet oddly comforting backdrop to our vigil."}
Recent events: As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...; The rain continues to fall as you stand guard with Rhea at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...; As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a... Recent motifs: communication, unknown_action
Recent major events: none
Relationship summary: Rhea trusts the player deeply
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 38, "morale": 46, "resources": 39, "knowledge": 73, "corruption": 10, "glitch": 31, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 5, "major_event_last_turn": 14}, scene: As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a faint figure emerges from the darkness, moving towards the keep. The air grows tense as the mystery figure approaches., player_choice: {'id': 'investigate_mystery_figure', 'text': 'Investigate the approaching figure.', 'action_type': 'interact'}
2025-10-29 13:10:57,521 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-29 13:10:57,521 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'observe', 'action': 'wait', 'speech': 'The rain continues to fall, casting long shadows on the cool stone floor. The wind picks up, stinging my face with its sharp tang.', 'effects': {'flag_set': ['major_wall_alert'], 'status_change': {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}, 'trust_delta': 0}, 'safe_functions': []}
2025-10-29 13:10:57,523 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-29 13:10:57,523 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-29 13:11:04,174 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the established atmosphere and events in the game.'}
2025-10-29 13:11:04,174 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the established atmosphere and events in the game.'}
2025-10-29 13:11:04,174 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the established atmosphere and events in the game.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-29 13:11:04,174 [INFO] fortress_director.rules.rules_engine: Tier two validation passed with penalties: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-29 13:11:04,176 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {'flag_set': ['major_wall_alert'], 'status_change': {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}, 'trust_delta': 0}
2025-10-29 13:11:04,176 [INFO] fortress_director.rules.rules_engine: Trust updated for Rhea: 3 -> 3 (delta: 0)
2025-10-29 13:11:04,176 [INFO] fortress_director.rules.rules_engine: Relationship summary updated: Rhea trusts the player deeply
2025-10-29 13:11:04,176 [INFO] fortress_director.rules.rules_engine: Judge penalties applied: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-29 13:11:04,176 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-29 13:11:04,176 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 20, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['major_injected_event', 'world_state_has_changed', 'major_wall_alert', 'has_discovered_flickering_light', 'has_seen_flickering_light'], 'memory_layers': ['Turn 17: Investigate the movement you see in the distance. -> The morning breeze carries a hint of rain as you stand guard with Rhea at the entrance of Lornhaven....', 'Turn 18: Investigate the source of the flickering light. -> As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds...', 'Memory summary: Turn 16: Investigate the movement you see in the distance. -> The wind picks up, the grit stinging your face as you stand with Rhea at the entrance of Lornhaven. ... | Turn 17: Investigate the movemen...', 'Turn 19: Investigate the source of the flickering light. -> The rain continues to fall as you stand guard with Rhea at the entrance of Lornhaven. The low clouds...', 'Turn 20: Investigate the source of the flickering light. -> As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds...'], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 20, 'day': 5, 'time': 'dawn', 'current_room': 'keep', 'recent_events': ['As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...', 'The rain continues to fall as you stand guard with Rhea at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...', 'As the rain continues to fall, you and Rhea stand guard at the entrance of Lornhaven. The low clouds cast long shadows over the cool stone floor, and the wind picks up, stinging your face. Suddenly, a...'], 'recent_motifs': ['communication', 'unknown_action', 'social_interaction'], 'world_constraint_from_prev_turn': {'atmosphere': 'Nighttime rain with distant drumbeats', 'sensory_details': "The air is heavy and moist, carrying the sharp tang of wet stone mixed with a metallic taste from Rhea's armor. The rhythmic patter of raindrops on battlement creates an unsettling yet oddly comforting backdrop to our vigil."}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player deeply', 'metrics': {'order': 38, 'morale': 48, 'resources': 39, 'knowledge': 74, 'corruption': 10, 'glitch': 31, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 6, 'major_event_last_turn': 20}, 'npc_trust': {'Rhea': 3}, 'previous_judge_verdict': {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene setting matches the established atmosphere and tone of the game.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['exploration', 'communication', 'exploration', 'exploration', 'exploration', 'physical', 'exploration', 'exploration', 'exploration', 'interact'], 'status_effects': [{'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}], 'world_constraint': {'atmosphere': 'A faint drizzle begins to fall.', 'sensory_details': 'Tiny raindrops patter on the stone, cooling the air.'}, 'safe_function_injected': True, 'major_events_triggered': 5, 'major_event_last_turn': 15, 'npc_locations': {'Boris': 'battlements'}, 'finalized': True, 'final_summary': 'Defeat - turn_limit_exceeded | Morale: 46, Order: 38, Resources: 39 | Glitch level: 32, Major events: 5 | Last major event: turn 15 | Notable characters: Rhea is loyal but impulsive; Boris is cautious and calculating.'}
2025-10-29 13:11:04,176 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=21)
2025-10-29 13:11:04,177 [INFO] fortress_director.orchestrator.orchestrator: Applying 1 autonomous actions
2025-10-29 13:11:04,177 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=38, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-10-29 13:11:04,177 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': 1, 'value': 39, 'cause': 'autonomous_Rhea'}
2025-10-29 13:11:04,177 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 38 to 39 (cause=autonomous_Rhea)
2025-10-29 13:11:04,177 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-29 13:11:04,178 [WARNING] fortress_director.orchestrator.orchestrator: Major event limit 6 reached
2025-10-29 13:11:04,178 [INFO] fortress_director.orchestrator.orchestrator: Advanced time to morning
2025-10-29 13:11:04,178 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: [{'target': 'Rhea', 'status': 'tense_watch', 'duration': 2}]
2025-10-29 13:11:04,178 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-10-29 13:11:04,178 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "keep", "current_turn": 21, "day": 5, "final_summary": "Defeat - turn_limit_exceeded | Morale: 46, Order: 38, Resources: 39 | Glitch level: 32, Major events: 5 | Last major event: turn 15 | Notable characters: Rhea is loyal but impulsive; Boris is cautious and calculating.", "finalized": true, "flags": ["major_injected_event", "world_state_has_changed", "major_wall_alert", "has_discovered_flickering_light", "has_seen_flickering_lig...
2025-10-29 13:11:04,180 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=21)
2025-10-29 13:11:04,180 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-29 13:11:04,180 [WARNING] fortress_director.orchestrator.orchestrator: Failed to parse safe function call 'change_weather': Unsupported safe function expression
2025-10-29 13:11:04,180 [INFO] fortress_director.codeaware.function_registry: Validating function call: spawn_item
2025-10-29 13:11:04,181 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=21)
2025-10-29 13:11:04,181 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=21, call=spawn_item)
2025-10-29 13:11:04,181 [INFO] fortress_director.codeaware.function_registry: Getting registered function: spawn_item
2025-10-29 13:11:04,181 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'spawn_item'...
2025-10-29 13:11:04,182 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=21)
2025-10-29 13:11:04,183 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=21)
2025-10-29 13:11:04,183 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed successfully.
2025-10-29 13:11:04,183 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed (checkpoint turn=21)
2025-10-29 13:11:04,183 [INFO] fortress_director.codeaware.function_registry: Validating function call: move_npc
2025-10-29 13:11:04,184 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=21)
2025-10-29 13:11:04,184 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=21, call=move_npc)
2025-10-29 13:11:04,184 [INFO] fortress_director.codeaware.function_registry: Getting registered function: move_npc
2025-10-29 13:11:04,184 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'move_npc'...
2025-10-29 13:11:04,184 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=21)
2025-10-29 13:11:04,185 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=21)
2025-10-29 13:11:04,185 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_npc' executed successfully.
2025-10-29 13:11:04,185 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_npc' executed (checkpoint turn=21)
2025-10-29 13:11:04,186 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-29 13:11:04,187 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=21)
2025-10-29 13:11:04,187 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=21)
2025-10-29 13:11:04,187 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 38, 'morale': 48, 'resources': 39, 'knowledge': 74, 'corruption': 10, 'glitch': 31, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 6, 'major_event_last_turn': 20}
2025-10-29 13:11:04,187 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 38, 'morale': 48, 'resources': 39, 'knowledge': 74, 'corruption': 10, 'glitch': 31, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 6, 'major_event_last_turn': 20}
2025-10-29 13:11:04,187 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'loss', 'reason': 'turn_limit_exceeded', 'description': '20 tur limit aşıldı!'}
2025-10-29 13:11:04,188 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=21)
2025-10-29 13:11:04,188 [INFO] fortress_director.orchestrator.orchestrator: Game finalized, state persisted.
2025-10-29 13:11:04,188 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-29 13:11:04,189 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 20 | Day 5 | Time dawn\nLocation: keep\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Nighttime rain with distant drumbeats\", \"sensory_details\": \"The air is heavy and moist, carrying the sharp tang of wet stone mixed with a metallic taste from Rhea's armor. The rhythmic patter of raindrops on battlement creates an unsettling yet oddly comforting backdrop to our vigil.\"}\nRecent events: As the rain continues to fall, you and Rhea stand guard at the entrance of Lornha...
2025-10-29 13:11:04,189 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-29 13:11:04,189 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
