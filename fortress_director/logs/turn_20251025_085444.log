2025-10-25 11:54:44,027 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251025_085444.log)
2025-10-25 11:54:44,027 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251025_085444.log)
2025-10-25 11:54:44,027 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251025_085444.log
2025-10-25 11:54:44,031 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-25 11:54:44,031 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-25 11:54:44,031 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-25 11:54:44,031 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-25 11:54:44,031 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-25 11:54:44,031 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-25 11:54:44,031 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-25 11:54:44,031 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-25 11:54:44,034 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-25 11:54:44,034 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-25 11:54:44,034 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-25 11:54:44,035 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-25 11:54:44,035 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-25 11:54:44,035 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-25 11:54:44,035 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-25 11:54:44,035 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-25 11:54:44,035 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-25 11:54:44,035 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-25 11:54:44,035 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-25 11:54:44,035 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-25 11:54:44,035 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-25 11:54:44,035 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-25 11:54:44,035 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=26)
2025-10-25 11:54:44,035 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=26, call=None)
2025-10-25 11:54:44,037 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-25 11:54:44,037 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=26)
2025-10-25 11:54:44,037 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 26, "day": 1, "flags": ["atmosphere_dawn_break", "atmosphere", "major_flag_set", "major_wall_alert", "sensory_details", "interact_with_player", "has_torch", "calm_weather", "end"], "inventory": [], "items": {"lornhaven_entrance": ["torch"], "lornhaven_wall": ["torch"], "mystery_figure": ["flint and steel"], "shieldbearer_inventory": ["oil lamp"]}, "lore": {}, "memory_layers": [], "metrics": {"corruption"...
2025-10-25 11:54:44,037 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 32, 'morale': 38, 'resources': 16, 'knowledge': 25, 'corruption': 10, 'glitch': 93, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 17, 'major_event_last_turn': 25}
2025-10-25 11:54:44,037 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 32, 'morale': 38, 'resources': 16, 'knowledge': 25, 'corruption': 10, 'glitch': 93, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 17, 'major_event_last_turn': 25}
2025-10-25 11:54:44,037 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=27, seed=12345, current_glitch=93)
2025-10-25 11:54:44,037 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 32, 'morale': 38, 'resources': 16, 'knowledge': 25, 'corruption': 10, 'glitch': 93, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 17, 'major_event_last_turn': 25}
2025-10-25 11:54:44,037 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=93, delta=1, limits=(0, 100) (cause=glitch:cosmetic_noise)
2025-10-25 11:54:44,039 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 94, 'cause': 'glitch:cosmetic_noise'}
2025-10-25 11:54:44,039 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 93 to 94 (cause=glitch:cosmetic_noise)
2025-10-25 11:54:44,039 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=3, triggered_loss=False
2025-10-25 11:54:44,039 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 32, 'morale': 38, 'resources': 16, 'knowledge': 25, 'corruption': 10, 'glitch': 94, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 17, 'major_event_last_turn': 25}
2025-10-25 11:54:44,039 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Minor static ripples along the parapets.']
2025-10-25 11:54:44,039 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=3, triggered_loss=False
2025-10-25 11:54:44,039 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 32, 'morale': 38, 'resources': 16, 'knowledge': 25, 'corruption': 10, 'glitch': 94, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 17, 'major_event_last_turn': 25}
2025-10-25 11:54:44,039 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=94, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-25 11:54:44,039 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 93, 'cause': 'turn_recovery'}
2025-10-25 11:54:44,040 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 94 to 93 (cause=turn_recovery)
2025-10-25 11:54:44,040 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 32, 'morale': 38, 'resources': 16, 'knowledge': 25, 'corruption': 10, 'glitch': 93, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 17, 'major_event_last_turn': 25}
2025-10-25 11:54:44,040 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-25 11:54:44,040 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 26 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "calm", "sensory_details": "The weather shifts subtly."}
Recent events: The Shieldbearer, still holding her oil lamp, hesitates as the Mystery Figure's glowing hand reaches towards her. The wind dies down and the entrance is bathed in an eerie glow. As the Shieldbearer takes a step forward, she feels a strange connection with the Mystery Figure. Suddenly, the Mystery Figure's eyes flicker again, this time showing a hint of warmth. The Shieldbearer can feel her heart slowing down as she reaches out to touch the Mystery Figure's hand.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. The Shieldbearer jumps back in surprise, her heart racing. As the wind dies down once more, the Mystery Figure reaches out a glowing hand towards the Shieldbearer again. This time, she hesitates for a moment before taking a step forward, her eyes wide with fear and curiosity. The Mystery Figure's touch is warm and comforting, calming her racing heart. She can feel a strange energy pulsing between them, but it doesn't feel threatening. Instead, it feels like a connection, a bond that she can't quite explain. Suddenly, the Mystery Figure's eyes flicker again, this time showing a hint of warmth. The Shieldbearer can feel her heart slowing down as she reaches out to touch the Mystery Figure's hand.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. The Shieldbearer hesitates for a moment before taking a step forward, her eyes wide with fear and curiosity. As she reaches out to touch the Mystery Figure's hand, a strange energy pulsates between them, creating a bond that neither can explain. Suddenly, the Mystery Figure's eyes flicker again, this time showing a hint of warmth. The Shieldbearer feels her heart slowing down as she touches the Mystery Figure's hand.
Recent motifs: end, end, end
Recent major events: yes, yes, yes
Relationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 32, "morale": 38, "resources": 16, "knowledge": 25, "corruption": 10, "glitch": 93, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 17, "major_event_last_turn": 25}
2025-10-25 11:54:44,040 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 26 in room entrance
2025-10-25 11:54:44,040 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 26 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"calm\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, hesitates as the Mystery Figure's glowing hand reaches towards her. The wind dies down and the entrance is bathed in an eerie glow. As the Shieldbearer takes a step forward, she feels a strange connection with the Mystery Figure. Suddenly, the Mystery Figure's ...
2025-10-25 11:54:44,040 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-25 11:54:44,040 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 26 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "calm", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, hesitates as the Mystery Figure\'s glowing hand reaches towards her. The wind dies down and the entrance is bathed in an eerie glow. As the Shieldbearer takes a step forward, she feels a strange connection with the Mystery Figure. Suddenly, the Mystery Figure\'s eyes flicker again, this time showing a hint of warmth. The Shieldbearer can feel her heart slowing down as she reaches out to touch the Mystery Figure\'s hand.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. The Shieldbearer jumps back in surprise, her heart racing. As the wind dies down once more, the Mystery Figure reaches out a glowing hand towards the Shieldbearer again. This time, she hesitates for a moment before taking a step forward, her eyes wide with fear and curiosity. The Mystery Figure\'s touch is warm and comforting, calming her racing heart. She can feel a strange energy pulsing between them, but it doesn\'t feel threatening. Instead, it feels like a connection, a bond that she can\'t quite explain. Suddenly, the Mystery Figure\'s eyes flicker again, this time showing a hint of warmth. The Shieldbearer can feel her heart slowing down as she reaches out to touch the Mystery Figure\'s hand.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. The Shieldbearer hesitates for a moment before taking a step forward, her eyes wide with fear and curiosity. As she reaches out to touch the Mystery Figure\'s hand, a strange energy pulsates between them, creating a bond that neither can explain. Suddenly, the Mystery Figure\'s eyes flicker again, this time showing a hint of warmth. The Shieldbearer feels her heart slowing down as she touches the Mystery Figure\'s hand.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 32, "morale": 38, "resources": 16, "knowledge": 25, "corruption": 10, "glitch": 93, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 17, "major_event_last_turn": 25}', 'room': 'entrance'}
2025-10-25 11:54:53,631 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Calm, with a subtle shift in weather', 'sensory_details': 'The air is still and cool to the touch; distant echoes of wind whisper through cracks as shadows dance on stone walls.'}
2025-10-25 11:54:53,631 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Calm, with a subtle shift in weather', 'sensory_details': 'The air is still and cool to the touch distant echoes of wind whisper through cracks as shadows dance on stone walls.'}
2025-10-25 11:54:53,631 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-25 11:54:53,631 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Calm, with a subtle shift in weather", "sensory_details": "The air is still and cool to the touch distant echoes of wind whisper through cracks as shadows dance on stone walls."}
2025-10-25 11:54:53,631 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 26 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"calm\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, hesitates as the Mystery Figure's glowing hand reaches towards her. The wind dies down and the entrance is bathed in an eerie glow. As the Shieldbearer takes a step forward, she feels a strange connection with the Mystery Figure. Suddenly, the Mystery Figure's ...
2025-10-25 11:54:53,631 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-25 11:54:53,631 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 26 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "calm", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, hesitates as the Mystery Figure\'s glowing hand reaches towards her. The wind dies down and the entrance is bathed in an eerie glow. As the Shieldbearer takes a step forward, she feels a strange connection with the Mystery Figure. Suddenly, the Mystery Figure\'s eyes flicker again, this time showing a hint of warmth. The Shieldbearer can feel her heart slowing down as she reaches out to touch the Mystery Figure\'s hand.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. The Shieldbearer jumps back in surprise, her heart racing. As the wind dies down once more, the Mystery Figure reaches out a glowing hand towards the Shieldbearer again. This time, she hesitates for a moment before taking a step forward, her eyes wide with fear and curiosity. The Mystery Figure\'s touch is warm and comforting, calming her racing heart. She can feel a strange energy pulsing between them, but it doesn\'t feel threatening. Instead, it feels like a connection, a bond that she can\'t quite explain. Suddenly, the Mystery Figure\'s eyes flicker again, this time showing a hint of warmth. The Shieldbearer can feel her heart slowing down as she reaches out to touch the Mystery Figure\'s hand.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. The Shieldbearer hesitates for a moment before taking a step forward, her eyes wide with fear and curiosity. As she reaches out to touch the Mystery Figure\'s hand, a strange energy pulsates between them, creating a bond that neither can explain. Suddenly, the Mystery Figure\'s eyes flicker again, this time showing a hint of warmth. The Shieldbearer feels her heart slowing down as she touches the Mystery Figure\'s hand.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 32, "morale": 38, "resources": 16, "knowledge": 25, "corruption": 10, "glitch": 93, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 17, "major_event_last_turn": 25}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, still holding her oil lamp, hesitates as the Mystery Figure's glowing hand reaches towards her. The wind dies down and the entrance is bathed in an eerie glow. As the Shieldbearer takes a step forward, she feels a strange connection with the Mystery Figure. Suddenly, the Mystery Figure's eyes flicker again, this time showing a hint of warmth. The Shieldbearer can feel her heart slowing down as she reaches out to touch the Mystery Figure's hand.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. The Shieldbearer jumps back in surprise, her heart racing. As the wind dies down once more, the Mystery Figure reaches out a glowing hand towards the Shieldbearer again. This time, she hesitates for a moment before taking a step forward, her eyes wide with fear and curiosity. The Mystery Figure's touch is warm and comforting, calming her racing heart. She can feel a strange energy pulsing between them, but it doesn't feel threatening. Instead, it feels like a connection, a bond that she can't quite explain. Suddenly, the Mystery Figure's eyes flicker again, this time showing a hint of warmth. The Shieldbearer can feel her heart slowing down as she reaches out to touch the Mystery Figure's hand.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. The Shieldbearer hesitates for a moment before taking a step forward, her eyes wide with fear and curiosity. As she reaches out to touch the Mystery Figure's hand, a strange energy pulsates between them, creating a bond that neither can explain. Suddenly, the Mystery Figure's eyes flicker again, this time showing a hint of warmth. The Shieldbearer feels her heart slowing down as she touches the Mystery Figure's hand.", 'world_constraint_from_prev_turn': '{"atmosphere": "calm", "sensory_details": "The weather shifts subtly."}', 'recent_motifs': 'end, end, end, end, end', 'lore_continuity_weight': 17, 'memory_layers': []}
2025-10-25 11:55:54,231 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, still holding her oil lamp, hesitates as the Mystery Figure's glowing hand reaches towards her once more. The wind dies down and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As the Shieldbearer takes a step forward, she feels a strange connection with the Mystery Figure. Suddenly, the Mystery Figure's eyes flicker again, this time showing a hint of warmth. The Shieldbearer can feel her heart slowing down as she reaches out to touch the Mystery Figure's hand. As their hands meet, a surge of energy pulses between them, creating a bond that neither can explain. The Shieldbearer feels a sense of peace wash over her, and for the first time since the siege began, she feels hopeful.", 'options': [{'id': '1', 'text': 'Embrace the Mystery Figure, strengthening your bond.', 'action_type': 'character_interaction'}, {'id': '2', 'text': 'Pull away, maintaining a safe distance.', 'action_type': 'character_interaction'}, {'id': '3', 'text': 'Ask the Mystery Figure about the siege and its origins.', 'action_type': 'dialogue'}], 'major_event': True, 'safe_functions': ["change_weather('calm')", "spawn_item('torch', 'lornhaven_wall')"]}
2025-10-25 11:55:54,231 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, still holding her oil lamp, hesitates as the Mystery Figure's glowing hand reaches towards her once more. The wind dies down and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As the Shieldbearer takes a step forward, she feels a strange connection with the Mystery Figure. Suddenly, the Mystery Figure's eyes flicker again, this time showing a hint of warmth. The Shieldbearer can feel her heart slowing down as she reaches out to touch the Mystery Figure's hand. As their hands meet, a surge of energy pulses between them, creating a bond that neither can explain. The Shieldbearer feels a sense of peace wash over her, and for the first time since the siege began, she feels hopeful.", 'options': [{'id': '1', 'text': 'Embrace the Mystery Figure, strengthening your bond.', 'action_type': 'character_interaction'}, {'id': '2', 'text': 'Pull away, maintaining a safe distance.', 'action_type': 'character_interaction'}, {'id': '3', 'text': 'Ask the Mystery Figure about the siege and its origins.', 'action_type': 'dialogue'}], 'major_event': True, 'safe_functions': ["change_weather('calm')", "spawn_item('torch', 'lornhaven_wall')"]}
2025-10-25 11:55:54,231 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-25 11:55:54,231 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": true, "options": [{"action_type": "character_interaction", "id": "1", "text": "Embrace the Mystery Figure, strengthening your bond."}, {"action_type": "character_interaction", "id": "2", "text": "Pull away, maintaining a safe distance."}, {"action_type": "dialogue", "id": "3", "text": "Ask the Mystery Figure about the siege and its origins."}], "safe_functions": ["change_weather('calm')", "spawn_item('torch', 'lornhaven_wall')"], "scene": "The Shieldbearer, still holding her oil lamp, hesitates as the Mystery Figure's glowing hand reaches towards her once more. The wind dies...
2025-10-25 11:55:54,231 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-25 11:55:54,232 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'end', 'text': 'The campaign concludes.', 'action_type': 'end'}
2025-10-25 11:55:54,232 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "end", "id": "end", "text": "The campaign concludes."}
2025-10-25 11:55:54,232 [DEBUG] fortress_director.orchestrator.orchestrator: No dynamic metrics for action_type 'end'
2025-10-25 11:55:54,232 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 26 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"calm\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, hesitates as the Mystery Figure's glowing hand reaches towards her. The wind dies down and the entrance is bathed in an eerie glow. As the Shieldbearer takes a step forward, she feels a strange connection with the Mystery Figure. Suddenly, the Mystery Figure's ...
2025-10-25 11:55:54,232 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-25 11:55:54,232 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 26 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "calm", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, hesitates as the Mystery Figure\'s glowing hand reaches towards her. The wind dies down and the entrance is bathed in an eerie glow. As the Shieldbearer takes a step forward, she feels a strange connection with the Mystery Figure. Suddenly, the Mystery Figure\'s eyes flicker again, this time showing a hint of warmth. The Shieldbearer can feel her heart slowing down as she reaches out to touch the Mystery Figure\'s hand.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. The Shieldbearer jumps back in surprise, her heart racing. As the wind dies down once more, the Mystery Figure reaches out a glowing hand towards the Shieldbearer again. This time, she hesitates for a moment before taking a step forward, her eyes wide with fear and curiosity. The Mystery Figure\'s touch is warm and comforting, calming her racing heart. She can feel a strange energy pulsing between them, but it doesn\'t feel threatening. Instead, it feels like a connection, a bond that she can\'t quite explain. Suddenly, the Mystery Figure\'s eyes flicker again, this time showing a hint of warmth. The Shieldbearer can feel her heart slowing down as she reaches out to touch the Mystery Figure\'s hand.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. The Shieldbearer hesitates for a moment before taking a step forward, her eyes wide with fear and curiosity. As she reaches out to touch the Mystery Figure\'s hand, a strange energy pulsates between them, creating a bond that neither can explain. Suddenly, the Mystery Figure\'s eyes flicker again, this time showing a hint of warmth. The Shieldbearer feels her heart slowing down as she touches the Mystery Figure\'s hand.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 32, "morale": 38, "resources": 16, "knowledge": 25, "corruption": 10, "glitch": 93, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 17, "major_event_last_turn": 25}', 'scene_short': "The Shieldbearer, still holding her oil lamp, hesitates as the Mystery Figure's glowing hand reaches towards her once more. The wind dies down and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As the Shieldbearer takes a step forward, she feels a strange connection with the Mystery Figure. Suddenly, the Mystery Figure's eyes flicker again, this time showing a hint of warmth. The Shieldbearer can feel her heart slowing down as she reaches out to touch the Mystery Figure's hand. As their hands meet, a surge of energy pulses between them, creating a bond that neither can explain. The Shieldbearer feels a sense of peace wash over her, and for the first time since the siege began, she feels hopeful.", 'player_choice': 'The campaign concludes.', 'atmosphere': 'Calm, with a subtle shift in weather', 'sensory_details': 'The air is still and cool to the touch distant echoes of wind whisper through cracks as shadows dance on stone walls.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea is neutral toward the player; Shieldbearer is neutral toward the player', 'player_inventory_brief': 'oil lamp, patched shield'}
2025-10-25 11:56:03,527 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Shieldbearer', 'intent': 'Hesitate', 'action': "Touch the Mystery Figure's hand", 'speech': "I feel a strange connection with you. I can't help but reach out to touch your hand.", 'effects': {'trust_delta': 10, 'flag_set': ['mystery_figure'], 'item_change': None, 'status_change': {'health': 100}}}
2025-10-25 11:56:03,527 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Shieldbearer', 'intent': 'Hesitate', 'action': "Touch the Mystery Figure's hand", 'speech': "I feel a strange connection with you. I can't help but reach out to touch your hand.", 'effects': {'flag_set': ['mystery_figure']}}]
2025-10-25 11:56:03,527 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-25 11:56:03,528 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "Touch the Mystery Figure's hand", "effects": {"flag_set": ["mystery_figure"]}, "intent": "Hesitate", "name": "Shieldbearer", "speech": "I feel a strange connection with you. I can't help but reach out to touch your hand."}]
2025-10-25 11:56:03,528 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-25 11:56:03,528 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-25 11:56:03,528 [DEBUG] fortress_director.orchestrator.orchestrator: Major event effect applied: {"applied_flag": "major_wall_alert", "applied_to": "Shieldbearer", "status_change": {"duration": 3, "status": "tense_watch", "target": "Shieldbearer"}}
2025-10-25 11:56:03,528 [ERROR] fortress_director.orchestrator.orchestrator: Exception during turn: name '_get_next_room' is not defined
Traceback (most recent call last):
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\orchestrator\orchestrator.py", line 517, in run_turn
    next_room = _get_next_room(current_room)
                ^^^^^^^^^^^^^^
NameError: name '_get_next_room' is not defined
2025-10-25 11:56:03,534 [INFO] fortress_director.codeaware.rollback_system: Rollback requested (reason=Turn execution failed: NameError)
2025-10-25 11:56:03,535 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=26)
2025-10-25 11:56:03,536 [INFO] fortress_director.codeaware.rollback_system: Rollback applied (turn=26, reason=Turn execution failed: NameError)
2025-10-25 11:56:03,536 [INFO] fortress_director.orchestrator.orchestrator: Rollback performed after exception.
