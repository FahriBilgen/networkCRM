2025-10-30 00:43:24,152 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_214324.log)
2025-10-30 00:43:24,152 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_214324.log)
2025-10-30 00:43:24,153 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_214324.log
2025-10-30 00:43:24,175 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-30 00:43:24,187 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-30 00:43:24,187 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-30 00:43:24,187 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-30 00:43:24,187 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-30 00:43:24,188 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-30 00:43:24,188 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-30 00:43:24,188 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-30 00:43:24,188 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-30 00:43:24,188 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-30 00:43:24,189 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-30 00:43:24,189 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-30 00:43:24,189 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-30 00:43:24,189 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-30 00:43:24,190 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-30 00:43:24,190 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-30 00:43:24,190 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-30 00:43:24,190 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-30 00:43:24,190 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-30 00:43:24,190 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-30 00:43:24,192 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-30 00:43:24,192 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-30 00:43:24,192 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=1)
2025-10-30 00:43:24,192 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=1, call=None)
2025-10-30 00:43:24,192 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-30 00:43:24,193 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=1)
2025-10-30 00:43:24,193 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 1, "day": 1, "flags": [], "inventory": [], "lore": {}, "memory_layers": [], "memory_long": [], "memory_short": ["Turn 1: Approach the Shieldbearer and ask about the drums you hear. -> The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The l..."], "metrics": {"corruption": 10, "glitch": 12, "knowledge": 47, "major_event_last_turn": null, "major_events_triggered"...
2025-10-30 00:43:24,193 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 51, 'morale': 52, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:43:24,193 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 51, 'morale': 52, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:43:24,193 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=2, seed=12345, current_glitch=12)
2025-10-30 00:43:24,193 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 51, 'morale': 52, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:43:24,194 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=12, delta=4, limits=(0, 100) (cause=glitch:overload)
2025-10-30 00:43:24,194 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 4, 'value': 16, 'cause': 'glitch:overload'}
2025-10-30 00:43:24,194 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 12 to 16 (cause=glitch:overload)
2025-10-30 00:43:24,194 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=99, triggered_loss=False
2025-10-30 00:43:24,194 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 51, 'morale': 52, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 16, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:43:24,194 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Glitch cascade overwhelms containment protocols.']
2025-10-30 00:43:24,194 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=99, triggered_loss=False
2025-10-30 00:43:24,194 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 51, 'morale': 52, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 16, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:43:24,194 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=16, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-30 00:43:24,194 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 15, 'cause': 'turn_recovery'}
2025-10-30 00:43:24,194 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 16 to 15 (cause=turn_recovery)
2025-10-30 00:43:24,195 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 51, 'morale': 52, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:43:24,195 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=99, triggered_loss=False
2025-10-30 00:43:24,195 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 51, 'morale': 52, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:43:24,195 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-30 00:43:24,195 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 1 | Day 1 | Time morning
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn hin clouds cloak the battlements, a time of subtle light.", "sensory_details": "The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone."}
Recent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon... Recent motifs: communication
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 52, "resources": 41, "knowledge": 47, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-30 00:43:24,195 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 1 in room entrance
2025-10-30 00:43:24,196 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin clouds cloak the battlements, a time of subtle light.\", \"sensory_details\": \"The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone.\"}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landsc...
2025-10-30 00:43:24,196 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-30 00:43:24,196 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn hin clouds cloak the battlements, a time of subtle light.", "sensory_details": "The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone."}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 52, "resources": 41, "knowledge": 47, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'morning', 'previous_atmosphere': 'Dawn hin clouds cloak the battlements, a time of subtle light.', 'previous_sensory_details': 'The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone.'}
2025-10-30 00:43:33,020 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Morning mist veils battlements, a time of soft light.', 'sensory_details': 'The air carries the sharp tang of metal and earth; one can feel the cool breeze against skin as distant drums beat rhythmically.'}
2025-10-30 00:43:33,020 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Morning mist veils battlements, a time of soft light.', 'sensory_details': 'The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically.'}
2025-10-30 00:43:33,021 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-30 00:43:33,021 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Morning mist veils battlements, a time of soft light.", "sensory_details": "The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically."}
2025-10-30 00:43:40,766 [INFO] fortress_director.agents.creativity_agent: CreativityAgent LLM rewrite applied.
2025-10-30 00:43:40,766 [INFO] fortress_director.orchestrator.orchestrator: CreativityAgent modified context: {'WORLD_CONTEXT': 'Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn hin clouds cloak the battlements, a time of subtle light.", "sensory_details": "The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone."}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 52, "resources": 41, "knowledge": 47, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'morning', 'previous_atmosphere': 'Dawn hin clouds cloak the battlements, a time of subtle light.', 'previous_sensory_details': 'The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone.', 'creativity_layer': 'Sure, here is the rewritten prompt:\n\nThe shimmering, iridescent patterns that once adorned the palace walls now seem eerily fractured and torn, revealing a glimpse of the hidden horrors beneath the opulent surface.', 'motif_injected': None}
2025-10-30 00:43:40,766 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 00:43:47,598 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The rewritten prompt does not contradict established lore, tone, or world logic. It introduces a new motif and maintains the consistency of the existing content.'}
2025-10-30 00:43:47,598 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The rewritten prompt does not contradict established lore, tone, or world logic. It introduces a new motif and maintains the consistency of the existing content.'}
2025-10-30 00:43:47,598 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin clouds cloak the battlements, a time of subtle light.\", \"sensory_details\": \"The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone.\"}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pa...
2025-10-30 00:43:47,598 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-30 00:43:47,598 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': {'WORLD_CONTEXT': 'Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn hin clouds cloak the battlements, a time of subtle light.", "sensory_details": "The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone."}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 52, "resources": 41, "knowledge": 47, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'morning', 'previous_atmosphere': 'Dawn hin clouds cloak the battlements, a time of subtle light.', 'previous_sensory_details': 'The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone.', 'creativity_layer': 'Sure, here is the rewritten prompt:\n\nThe shimmering, iridescent patterns that once adorned the palace walls now seem eerily fractured and torn, revealing a glimpse of the hidden horrors beneath the opulent surface.', 'motif_injected': None}, 'day': 1, 'time': 'morning', 'room': 'entrance', 'recent_events': 'The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon...', 'world_constraint_from_prev_turn': '{"atmosphere": "Dawn hin clouds cloak the battlements, a time of subtle light.", "sensory_details": "The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone."}', 'recent_motifs': 'none', 'lore_continuity_weight': 0, 'memory_layers': ['Turn 1: Approach the Shieldbearer and ask about the drums you hear. -> The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The l...'], 'judge_verdict': '{"consistent": true, "reason": "The content is consistent with established world, lore, and character logic. The scene accurately reflects the Shieldbearer\'s state of exhaustion and the atmospheric conditions.", "coherence": 100, "integrity": 100, "tone_alignment": 100, "penalty_applied": "none", "penalty_magnitude": {}, "feedback": {}}', 'judge_feedback': {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene accurately reflects the Shieldbearer's state of exhaustion and the atmospheric conditions.", 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'continuity_weight': 0.0, 'skip_major': False}
2025-10-30 00:44:20,703 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. 'What brings you here so early?' he asks.", 'options': [{'id': 'ask_about_drums', 'text': 'Ask him about the drums you hear in the distance.', 'action_type': 'dialog'}, {'id': 'offer_help', 'text': 'Offer to take over his watch for a while, allowing him some rest.', 'action_type': 'dialog'}, {'id': 'investigate_drums', 'text': 'Suggest investigating the source of the drums to determine their purpose.', 'action_type': 'action'}], 'major_event': False, 'safe_functions': []}
2025-10-30 00:44:20,703 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. 'What brings you here so early?' he asks.", 'options': [{'id': 'ask_about_drums', 'text': 'Ask him about the drums you hear in the distance.', 'action_type': 'dialog'}, {'id': 'offer_help', 'text': 'Offer to take over his watch for a while, allowing him some rest.', 'action_type': 'dialog'}, {'id': 'investigate_drums', 'text': 'Suggest investigating the source of the drums to determine their purpose.', 'action_type': 'action'}], 'major_event': False, 'safe_functions': []}
2025-10-30 00:44:20,703 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-30 00:44:20,703 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialog", "id": "ask_about_drums", "text": "Ask him about the drums you hear in the distance."}, {"action_type": "dialog", "id": "offer_help", "text": "Offer to take over his watch for a while, allowing him some rest."}, {"action_type": "action", "id": "investigate_drums", "text": "Suggest investigating the source of the drums to determine their purpose."}], "safe_functions": [], "scene": "The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion ...
2025-10-30 00:44:20,703 [INFO] fortress_director.orchestrator.orchestrator: Using previous judge verdict (turn 1)
2025-10-30 00:44:20,703 [INFO] fortress_director.orchestrator.orchestrator: Added motif-based option: diplomacy_approach (motif active)
2025-10-30 00:44:20,703 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-30 00:44:20,703 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'ask_about_drums', 'text': 'Ask him about the drums you hear in the distance.', 'action_type': 'dialog'}
2025-10-30 00:44:20,703 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialog", "id": "ask_about_drums", "text": "Ask him about the drums you hear in the distance."}
2025-10-30 00:44:20,705 [DEBUG] fortress_director.orchestrator.orchestrator: No dynamic metrics for action_type 'dialog'
2025-10-30 00:44:20,705 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin clouds cloak the battlements, a time of subtle light.\", \"sensory_details\": \"The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone.\"}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landsc...
2025-10-30 00:44:20,705 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-30 00:44:20,705 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn hin clouds cloak the battlements, a time of subtle light.", "sensory_details": "The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone."}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 52, "resources": 41, "knowledge": 47, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': "The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. 'What brings you here so early?' he asks.", 'player_choice': 'Ask him about the drums you hear in the distance.', 'atmosphere': 'Morning mist veils battlements, a time of soft light.', 'sensory_details': 'The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player; Boris weighs every trade.', 'player_inventory_brief': 'oil lamp, patched shield', 'memory_layers': ['Turn 1: Approach the Shieldbearer and ask about the drums you hear. -> The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The l...'], 'recent_events': 'The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon...', 'last_major_event': False}
2025-10-30 00:44:31,440 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Rhea', 'intent': 'observe', 'action': 'scan_horizon', 'speech': "The morning mist hangs heavy over the battlements, casting an eerie pallor on the landscape. The drums beat rhythmically in the distance, a stark reminder of the day's relentless pace.", 'effects': {'trust_delta': 10, 'flag_set': ['recent_events'], 'item_change': None, 'status_change': None}}
2025-10-30 00:44:31,440 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Rhea', 'intent': 'observe', 'action': 'scan_horizon', 'speech': "The morning mist hangs heavy over the battlements, casting an eerie pallor on the landscape. The drums beat rhythmically in the distance, a stark reminder of the day's relentless pace.", 'effects': {'trust_delta': 1, 'flag_set': ['recent_events']}, 'safe_functions': []}]
2025-10-30 00:44:31,440 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-30 00:44:31,440 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "scan_horizon", "effects": {"flag_set": ["recent_events"], "trust_delta": 1}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "The morning mist hangs heavy over the battlements, casting an eerie pallor on the landscape. The drums beat rhythmically in the distance, a stark reminder of the day's relentless pace."}]
2025-10-30 00:44:31,440 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-30 00:44:31,441 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-30 00:44:31,441 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-30 00:44:31,441 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "scan_horizon", "effects": {"flag_set": ["recent_events"], "trust_delta": 1}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "The morning mist hangs heavy over the battlements, casting an eerie pallor on the landscape. The drums beat rhythmically in the distance, a stark reminder of the day's relentless pace."}]
2025-10-30 00:44:31,441 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-30 00:44:31,442 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 1, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': [], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 1, 'day': 1, 'time': 'morning', 'current_room': 'entrance', 'recent_events': ['The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon...'], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'Dawn hin clouds cloak the battlements, a time of subtle light.', 'sensory_details': 'The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 51, 'morale': 52, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}, 'previous_judge_verdict': {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene accurately reflects the Shieldbearer's state of exhaustion and the atmospheric conditions.", 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['dialogue'], 'summary_text': 'The day passes quietly.', 'memory_short': ['Turn 1: Approach the Shieldbearer and ask about the drums you hear. -> The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The l...'], 'memory_long': [], 'status_effects': []}
2025-10-30 00:44:31,442 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'observe', 'action': 'scan_horizon', 'speech': "The morning mist hangs heavy over the battlements, casting an eerie pallor on the landscape. The drums beat rhythmically in the distance, a stark reminder of the day's relentless pace.", 'effects': {'trust_delta': 1, 'flag_set': ['recent_events']}, 'safe_functions': []}]
2025-10-30 00:44:31,442 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 1 | Day 1 | Time morning
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn hin clouds cloak the battlements, a time of subtle light.", "sensory_details": "The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone."}
Recent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon... Recent motifs: communication
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 52, "resources": 41, "knowledge": 47, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. 'What brings you here so early?' he asks., player_choice: {'id': 'ask_about_drums', 'text': 'Ask him about the drums you hear in the distance.', 'action_type': 'dialog'}
2025-10-30 00:44:31,442 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-30 00:44:31,442 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'observe', 'action': 'scan_horizon', 'speech': "The morning mist hangs heavy over the battlements, casting an eerie pallor on the landscape. The drums beat rhythmically in the distance, a stark reminder of the day's relentless pace.", 'effects': {'trust_delta': 1, 'flag_set': ['recent_events']}, 'safe_functions': []}
2025-10-30 00:44:31,442 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-30 00:44:31,443 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 00:44:38,223 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene and player choice are appropriate for their role as a defender observing the horizon.'}
2025-10-30 00:44:38,223 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene and player choice are appropriate for their role as a defender observing the horizon.'}
2025-10-30 00:44:38,223 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene and player choice are appropriate for their role as a defender observing the horizon.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-30 00:44:38,223 [INFO] fortress_director.rules.rules_engine: Tier two validation passed with penalties: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-30 00:44:38,223 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {'trust_delta': 1, 'flag_set': ['recent_events']}
2025-10-30 00:44:38,223 [INFO] fortress_director.rules.rules_engine: Trust updated for Rhea: 0 -> 1 (delta: 1)
2025-10-30 00:44:38,224 [INFO] fortress_director.rules.rules_engine: Relationship summary updated: Rhea trusts the player
2025-10-30 00:44:38,224 [INFO] fortress_director.rules.rules_engine: Judge penalties applied: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-30 00:44:38,224 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-30 00:44:38,224 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 1, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['recent_events'], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 1, 'day': 1, 'time': 'morning', 'current_room': 'entrance', 'recent_events': ['The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon...'], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'Dawn hin clouds cloak the battlements, a time of subtle light.', 'sensory_details': 'The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player', 'metrics': {'order': 51, 'morale': 52, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {'Rhea': 1}, 'previous_judge_verdict': {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene accurately reflects the Shieldbearer's state of exhaustion and the atmospheric conditions.", 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['dialogue', 'dialog'], 'summary_text': 'The day passes quietly.', 'memory_short': ['Turn 1: Approach the Shieldbearer and ask about the drums you hear. -> The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The l...'], 'memory_long': [], 'status_effects': []}
2025-10-30 00:44:38,225 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=2)
2025-10-30 00:44:38,225 [INFO] fortress_director.orchestrator.orchestrator: Applying 2 autonomous actions
2025-10-30 00:44:38,225 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=51, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-10-30 00:44:38,225 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': 1, 'value': 52, 'cause': 'autonomous_Rhea'}
2025-10-30 00:44:38,225 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 51 to 52 (cause=autonomous_Rhea)
2025-10-30 00:44:38,226 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=52, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-10-30 00:44:38,226 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 53, 'cause': 'autonomous_Rhea'}
2025-10-30 00:44:38,226 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 52 to 53 (cause=autonomous_Rhea)
2025-10-30 00:44:38,226 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'resources': current=41, delta=1, limits=(0, 120) (cause=autonomous_Boris)
2025-10-30 00:44:38,226 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'resources', 'delta': 1, 'value': 42, 'cause': 'autonomous_Boris'}
2025-10-30 00:44:38,226 [INFO] fortress_director.utils.metrics_manager: Metric 'resources' updated from 41 to 42 (cause=autonomous_Boris)
2025-10-30 00:44:38,226 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=53, delta=1, limits=(0, 100) (cause=autonomous_Boris)
2025-10-30 00:44:38,226 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 54, 'cause': 'autonomous_Boris'}
2025-10-30 00:44:38,226 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 53 to 54 (cause=autonomous_Boris)
2025-10-30 00:44:38,227 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-30 00:44:38,227 [INFO] fortress_director.orchestrator.orchestrator: Advanced time to afternoon
2025-10-30 00:44:38,227 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: []
2025-10-30 00:44:38,227 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-10-30 00:44:38,227 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 2, "day": 1, "flags": ["recent_events"], "inventory": [], "lore": {}, "memory_layers": [], "memory_long": [], "memory_short": ["Turn 1: Approach the Shieldbearer and ask about the drums you hear. -> The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The l...", "Turn 2: Ask him about the drums you hear in the distance. -> The Shieldbearer, his gaze still fixed o...
2025-10-30 00:44:38,228 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-30 00:44:38,228 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-30 00:44:38,228 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-30 00:44:38,229 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-30 00:44:38,229 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-30 00:44:38,229 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-30 00:44:38,230 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 52, 'morale': 54, 'resources': 42, 'knowledge': 47, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:44:38,230 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 52, 'morale': 54, 'resources': 42, 'knowledge': 47, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:44:38,230 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'conditions_not_met', 'description': 'Oyun devam ediyor...'}
2025-10-30 00:44:38,230 [INFO] fortress_director.orchestrator.orchestrator: Turn summary: The day passes quietly.
2025-10-30 00:44:38,231 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-30 00:44:38,231 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin clouds cloak the battlements, a time of subtle light.\", \"sensory_details\": \"The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone.\"}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landsc...
2025-10-30 00:44:38,231 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-30 00:44:38,231 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
