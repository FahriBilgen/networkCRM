2025-10-26 02:14:01,996 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251025_231401.log)
2025-10-26 02:14:01,996 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251025_231401.log)
2025-10-26 02:14:01,996 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251025_231401.log
2025-10-26 02:14:02,011 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-26 02:14:02,011 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-26 02:14:02,011 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-26 02:14:02,011 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-26 02:14:02,012 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-26 02:14:02,012 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-26 02:14:02,012 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-26 02:14:02,012 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-26 02:14:02,012 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-26 02:14:02,012 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-26 02:14:02,012 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-26 02:14:02,012 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-26 02:14:02,012 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-26 02:14:02,013 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-26 02:14:02,013 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-26 02:14:02,013 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-26 02:14:02,013 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-26 02:14:02,013 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-26 02:14:02,013 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-26 02:14:02,013 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-26 02:14:02,014 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-26 02:14:02,014 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-26 02:14:02,014 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:14:02,014 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=36, call=None)
2025-10-26 02:14:02,014 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-26 02:14:02,014 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:14:02,014 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 36, "day": 1, "flags": ["atmosphere_dawn_break", "atmosphere", "major_flag_set", "major_wall_alert", "sensory_details", "interact_with_player", "has_torch", "calm_weather", "end", "end_game_triggered", "end_turn"], "inventory": [], "items": {"lornhaven_entrance": ["torch"], "lornhaven_wall": ["torch"], "mystery_figure": ["flint and steel"], "shieldbearer_inventory": ["oil lamp"]}, "lore": {}, "memory_lay...
2025-10-26 02:14:02,015 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:14:02,015 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:14:02,015 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=37, seed=12345, current_glitch=99)
2025-10-26 02:14:02,015 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:14:02,016 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=99, delta=10, limits=(0, 100) (cause=glitch:momentum_overload)
2025-10-26 02:14:02,016 [DEBUG] fortress_director.utils.metrics_manager: Clamped metric value from 109 to 100 within bounds (0, 100)
2025-10-26 02:14:02,016 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 100, 'cause': 'glitch:momentum_overload'}
2025-10-26 02:14:02,016 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 99 to 100 (cause=glitch:momentum_overload)
2025-10-26 02:14:02,016 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=3, triggered_loss=True
2025-10-26 02:14:02,016 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:14:02,016 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Glitch momentum overload triggers early cascade.']
2025-10-26 02:14:02,016 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=3, triggered_loss=True
2025-10-26 02:14:02,016 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:14:02,017 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=100, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-26 02:14:02,017 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 99, 'cause': 'turn_recovery'}
2025-10-26 02:14:02,017 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 100 to 99 (cause=turn_recovery)
2025-10-26 02:14:02,017 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:14:02,017 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-26 02:14:02,017 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 36 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}
Recent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.
Recent motifs: end, end, end
Recent major events: yes, yes, yes
Relationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}
2025-10-26 02:14:02,017 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 36 in room entrance
2025-10-26 02:14:02,017 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:14:02,017 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-26 02:14:02,017 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'room': 'entrance'}
2025-10-26 02:14:11,987 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Calm, clear dawn with a subtle shift in weather.', 'sensory_details': 'The crisp morning air carries the scent of dew on grass; light filters through parting clouds casting soft shadows. The sound of distant birdsong complements the gentle rustling leaves as an oil lamp flickers, providing a warm glow.'}
2025-10-26 02:14:11,987 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Calm, clear dawn with a subtle shift in weather.', 'sensory_details': 'The crisp morning air carries the scent of dew on grass light filters through parting clouds casting soft shadows. The sound of distant birdsong complements the gentle rustling leaves as an oil lamp flickers, providing a warm glow.'}
2025-10-26 02:14:11,987 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-26 02:14:11,987 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Calm, clear dawn with a subtle shift in weather.", "sensory_details": "The crisp morning air carries the scent of dew on grass light filters through parting clouds casting soft shadows. The sound of distant birdsong complements the gentle rustling leaves as an oil lamp flickers, providing a warm glow."}
2025-10-26 02:14:11,987 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:14:11,987 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-26 02:14:11,988 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'world_constraint_from_prev_turn': '{"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}', 'recent_motifs': 'end, end, end, end, end', 'lore_continuity_weight': 22, 'memory_layers': []}
2025-10-26 02:14:44,009 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about their origins.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stay with the Shieldbearer, keeping watch over the entrance.', 'action_type': 'stay'}, {'id': '3', 'text': 'Follow the Mystery Figure into the unknown.', 'action_type': 'follow'}], 'major_event': True, 'safe_functions': ["change_weather('overcast')"]}
2025-10-26 02:14:44,009 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about their origins.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stay with the Shieldbearer, keeping watch over the entrance.', 'action_type': 'stay'}, {'id': '3', 'text': 'Follow the Mystery Figure into the unknown.', 'action_type': 'follow'}], 'major_event': True, 'safe_functions': ["change_weather('overcast')"]}
2025-10-26 02:14:44,009 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-26 02:14:44,009 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": true, "options": [{"action_type": "dialogue", "id": "1", "text": "Approach the Mystery Figure and ask about their origins."}, {"action_type": "stay", "id": "2", "text": "Stay with the Shieldbearer, keeping watch over the entrance."}, {"action_type": "follow", "id": "3", "text": "Follow the Mystery Figure into the unknown."}], "safe_functions": ["change_weather('overcast')"], "scene": "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Fig...
2025-10-26 02:14:44,009 [INFO] fortress_director.orchestrator.orchestrator: Added NPC fallback: move_npc('Boris', 'entrance')
2025-10-26 02:14:44,009 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-26 02:14:44,010 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'end', 'text': 'The campaign concludes.', 'action_type': 'end'}
2025-10-26 02:14:44,010 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "end", "id": "end", "text": "The campaign concludes."}
2025-10-26 02:14:44,010 [INFO] fortress_director.orchestrator.orchestrator: End flag detected, terminating turn early
2025-10-26 02:14:44,012 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-26 02:14:44,012 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-26 02:14:44,013 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-26 02:14:44,013 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-26 02:14:44,013 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-26 02:14:44,013 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-26 02:14:44,013 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-26 02:14:44,014 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-26 02:14:44,014 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-26 02:14:44,014 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-26 02:14:44,014 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-26 02:14:44,014 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-26 02:14:44,015 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-26 02:14:44,015 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-26 02:14:44,015 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-26 02:14:44,015 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-26 02:14:44,015 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-26 02:14:44,015 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-26 02:14:44,016 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-26 02:14:44,016 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-26 02:14:44,016 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-26 02:14:44,016 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-26 02:14:44,016 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:14:44,017 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=36, call=None)
2025-10-26 02:14:44,017 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-26 02:14:44,017 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:14:44,017 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 36, "day": 1, "flags": ["atmosphere_dawn_break", "atmosphere", "major_flag_set", "major_wall_alert", "sensory_details", "interact_with_player", "has_torch", "calm_weather", "end", "end_game_triggered", "end_turn"], "inventory": [], "items": {"lornhaven_entrance": ["torch"], "lornhaven_wall": ["torch"], "mystery_figure": ["flint and steel"], "shieldbearer_inventory": ["oil lamp"]}, "lore": {}, "memory_lay...
2025-10-26 02:14:44,017 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:14:44,017 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:14:44,017 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=37, seed=12345, current_glitch=99)
2025-10-26 02:14:44,017 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:14:44,017 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=99, delta=10, limits=(0, 100) (cause=glitch:momentum_overload)
2025-10-26 02:14:44,017 [DEBUG] fortress_director.utils.metrics_manager: Clamped metric value from 109 to 100 within bounds (0, 100)
2025-10-26 02:14:44,019 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 100, 'cause': 'glitch:momentum_overload'}
2025-10-26 02:14:44,019 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 99 to 100 (cause=glitch:momentum_overload)
2025-10-26 02:14:44,019 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=3, triggered_loss=True
2025-10-26 02:14:44,019 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:14:44,019 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Glitch momentum overload triggers early cascade.']
2025-10-26 02:14:44,019 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=3, triggered_loss=True
2025-10-26 02:14:44,019 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:14:44,019 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=100, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-26 02:14:44,019 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 99, 'cause': 'turn_recovery'}
2025-10-26 02:14:44,019 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 100 to 99 (cause=turn_recovery)
2025-10-26 02:14:44,020 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:14:44,020 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-26 02:14:44,020 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 36 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}
Recent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.
Recent motifs: end, end, end
Recent major events: yes, yes, yes
Relationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}
2025-10-26 02:14:44,020 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 36 in room entrance
2025-10-26 02:14:44,020 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:14:44,020 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-26 02:14:44,020 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'room': 'entrance'}
2025-10-26 02:14:51,787 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Calm, clear dawn with a subtle shift in weather.', 'sensory_details': 'The cool morning air carries the faint scent of dew on grass as it brushes against skin; sunlight filters through wisps of fog that cling to ancient stone walls. A gentle breeze whispers secrets, rustling leaves and carrying distant echoes from a world awakening.'}
2025-10-26 02:14:51,787 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Calm, clear dawn with a subtle shift in weather.', 'sensory_details': 'The cool morning air carries the faint scent of dew on grass as it brushes against skin sunlight filters through wisps of fog that cling to ancient stone walls. A gentle breeze whispers secrets, rustling leaves and carrying distant echoes from a world awakening.'}
2025-10-26 02:14:51,787 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-26 02:14:51,787 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Calm, clear dawn with a subtle shift in weather.", "sensory_details": "The cool morning air carries the faint scent of dew on grass as it brushes against skin sunlight filters through wisps of fog that cling to ancient stone walls. A gentle breeze whispers secrets, rustling leaves and carrying distant echoes from a world awakening."}
2025-10-26 02:14:51,787 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:14:51,787 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-26 02:14:51,788 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'world_constraint_from_prev_turn': '{"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}', 'recent_motifs': 'end, end, end, end, end', 'lore_continuity_weight': 22, 'memory_layers': []}
2025-10-26 02:15:21,373 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about their purpose.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stand back and observe the Mystery Figure silently.', 'action_type': 'observation'}, {'id': '3', 'text': "Reach out to touch the Mystery Figure's hand again, feeling the warmth envelop you both.", 'action_type': 'interaction'}], 'major_event': False, 'safe_functions': []}
2025-10-26 02:15:21,373 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about their purpose.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stand back and observe the Mystery Figure silently.', 'action_type': 'observation'}, {'id': '3', 'text': "Reach out to touch the Mystery Figure's hand again, feeling the warmth envelop you both.", 'action_type': 'interaction'}], 'major_event': False, 'safe_functions': []}
2025-10-26 02:15:21,373 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-26 02:15:21,374 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialogue", "id": "1", "text": "Approach the Mystery Figure and ask about their purpose."}, {"action_type": "observation", "id": "2", "text": "Stand back and observe the Mystery Figure silently."}, {"action_type": "interaction", "id": "3", "text": "Reach out to touch the Mystery Figure's hand again, feeling the warmth envelop you both."}], "safe_functions": [], "scene": "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating...
2025-10-26 02:15:21,374 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-26 02:15:21,374 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'end', 'text': 'The campaign concludes.', 'action_type': 'end'}
2025-10-26 02:15:21,374 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "end", "id": "end", "text": "The campaign concludes."}
2025-10-26 02:15:21,374 [INFO] fortress_director.orchestrator.orchestrator: End flag detected, terminating turn early
2025-10-26 02:15:21,376 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-26 02:15:21,376 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-26 02:15:21,376 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-26 02:15:21,376 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-26 02:15:21,376 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-26 02:15:21,376 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-26 02:15:21,376 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-26 02:15:21,377 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-26 02:15:21,377 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-26 02:15:21,377 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-26 02:15:21,377 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-26 02:15:21,377 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-26 02:15:21,377 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-26 02:15:21,377 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-26 02:15:21,377 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-26 02:15:21,378 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-26 02:15:21,378 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-26 02:15:21,378 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-26 02:15:21,378 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-26 02:15:21,378 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-26 02:15:21,378 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-26 02:15:21,378 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-26 02:15:21,379 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:15:21,379 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=36, call=None)
2025-10-26 02:15:21,379 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-26 02:15:21,379 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:15:21,379 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 36, "day": 1, "flags": ["atmosphere_dawn_break", "atmosphere", "major_flag_set", "major_wall_alert", "sensory_details", "interact_with_player", "has_torch", "calm_weather", "end", "end_game_triggered", "end_turn"], "inventory": [], "items": {"lornhaven_entrance": ["torch"], "lornhaven_wall": ["torch"], "mystery_figure": ["flint and steel"], "shieldbearer_inventory": ["oil lamp"]}, "lore": {}, "memory_lay...
2025-10-26 02:15:21,379 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:15:21,379 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:15:21,379 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=37, seed=12345, current_glitch=99)
2025-10-26 02:15:21,379 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:15:21,380 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=99, delta=10, limits=(0, 100) (cause=glitch:momentum_overload)
2025-10-26 02:15:21,380 [DEBUG] fortress_director.utils.metrics_manager: Clamped metric value from 109 to 100 within bounds (0, 100)
2025-10-26 02:15:21,380 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 100, 'cause': 'glitch:momentum_overload'}
2025-10-26 02:15:21,380 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 99 to 100 (cause=glitch:momentum_overload)
2025-10-26 02:15:21,380 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=3, triggered_loss=True
2025-10-26 02:15:21,380 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:15:21,380 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Glitch momentum overload triggers early cascade.']
2025-10-26 02:15:21,380 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=3, triggered_loss=True
2025-10-26 02:15:21,380 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:15:21,381 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=100, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-26 02:15:21,381 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 99, 'cause': 'turn_recovery'}
2025-10-26 02:15:21,381 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 100 to 99 (cause=turn_recovery)
2025-10-26 02:15:21,381 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:15:21,381 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-26 02:15:21,381 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 36 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}
Recent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.
Recent motifs: end, end, end
Recent major events: yes, yes, yes
Relationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}
2025-10-26 02:15:21,381 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 36 in room entrance
2025-10-26 02:15:21,381 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:15:21,381 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-26 02:15:21,382 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'room': 'entrance'}
2025-10-26 02:15:29,775 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Calm, clear dawn with a subtle shift in weather.', 'sensory_details': "The air is crisp and cool against the skin; faint whispers of wind rustling through dry leaves create an ambient hum that complements the serene silence. The golden light from Rhea's eyes casts dancing shadows, adding a touch of magic to this moment."}
2025-10-26 02:15:29,775 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Calm, clear dawn with a subtle shift in weather.', 'sensory_details': "The air is crisp and cool against the skin faint whispers of wind rustling through dry leaves create an ambient hum that complements the serene silence. The golden light from Rhea's eyes casts dancing shadows, adding a touch of magic to this moment."}
2025-10-26 02:15:29,775 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-26 02:15:29,775 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Calm, clear dawn with a subtle shift in weather.", "sensory_details": "The air is crisp and cool against the skin faint whispers of wind rustling through dry leaves create an ambient hum that complements the serene silence. The golden light from Rhea's eyes casts dancing shadows, adding a touch of magic to this moment."}
2025-10-26 02:15:29,775 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:15:29,775 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-26 02:15:29,775 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'world_constraint_from_prev_turn': '{"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}', 'recent_motifs': 'end, end, end, end, end', 'lore_continuity_weight': 22, 'memory_layers': []}
2025-10-26 02:15:59,888 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about their purpose.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stay where you are, observing the Mystery Figure from a distance.', 'action_type': 'wait'}, {'id': '3', 'text': "Reach out to touch the Mystery Figure's hand again, feeling the warmth envelop you both.", 'action_type': 'interaction'}], 'major_event': False, 'safe_functions': []}
2025-10-26 02:15:59,888 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about their purpose.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stay where you are, observing the Mystery Figure from a distance.', 'action_type': 'wait'}, {'id': '3', 'text': "Reach out to touch the Mystery Figure's hand again, feeling the warmth envelop you both.", 'action_type': 'interaction'}], 'major_event': False, 'safe_functions': []}
2025-10-26 02:15:59,888 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-26 02:15:59,888 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialogue", "id": "1", "text": "Approach the Mystery Figure and ask about their purpose."}, {"action_type": "wait", "id": "2", "text": "Stay where you are, observing the Mystery Figure from a distance."}, {"action_type": "interaction", "id": "3", "text": "Reach out to touch the Mystery Figure's hand again, feeling the warmth envelop you both."}], "safe_functions": [], "scene": "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow em...
2025-10-26 02:15:59,888 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-26 02:15:59,888 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'end', 'text': 'The campaign concludes.', 'action_type': 'end'}
2025-10-26 02:15:59,888 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "end", "id": "end", "text": "The campaign concludes."}
2025-10-26 02:15:59,888 [INFO] fortress_director.orchestrator.orchestrator: End flag detected, terminating turn early
2025-10-26 02:15:59,890 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-26 02:15:59,890 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-26 02:15:59,890 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-26 02:15:59,892 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-26 02:15:59,892 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-26 02:15:59,892 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-26 02:15:59,892 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-26 02:15:59,892 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-26 02:15:59,892 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-26 02:15:59,892 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-26 02:15:59,892 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-26 02:15:59,892 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-26 02:15:59,892 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-26 02:15:59,892 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-26 02:15:59,892 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-26 02:15:59,893 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-26 02:15:59,893 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-26 02:15:59,893 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-26 02:15:59,893 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-26 02:15:59,893 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-26 02:15:59,893 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-26 02:15:59,893 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-26 02:15:59,894 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:15:59,894 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=36, call=None)
2025-10-26 02:15:59,894 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-26 02:15:59,894 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:15:59,894 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 36, "day": 1, "flags": ["atmosphere_dawn_break", "atmosphere", "major_flag_set", "major_wall_alert", "sensory_details", "interact_with_player", "has_torch", "calm_weather", "end", "end_game_triggered", "end_turn"], "inventory": [], "items": {"lornhaven_entrance": ["torch"], "lornhaven_wall": ["torch"], "mystery_figure": ["flint and steel"], "shieldbearer_inventory": ["oil lamp"]}, "lore": {}, "memory_lay...
2025-10-26 02:15:59,894 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:15:59,894 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:15:59,894 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=37, seed=12345, current_glitch=99)
2025-10-26 02:15:59,894 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:15:59,894 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=99, delta=10, limits=(0, 100) (cause=glitch:momentum_overload)
2025-10-26 02:15:59,894 [DEBUG] fortress_director.utils.metrics_manager: Clamped metric value from 109 to 100 within bounds (0, 100)
2025-10-26 02:15:59,895 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 100, 'cause': 'glitch:momentum_overload'}
2025-10-26 02:15:59,895 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 99 to 100 (cause=glitch:momentum_overload)
2025-10-26 02:15:59,895 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=3, triggered_loss=True
2025-10-26 02:15:59,895 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:15:59,895 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Glitch momentum overload triggers early cascade.']
2025-10-26 02:15:59,895 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=3, triggered_loss=True
2025-10-26 02:15:59,895 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:15:59,895 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=100, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-26 02:15:59,895 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 99, 'cause': 'turn_recovery'}
2025-10-26 02:15:59,895 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 100 to 99 (cause=turn_recovery)
2025-10-26 02:15:59,896 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:15:59,896 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-26 02:15:59,896 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 36 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}
Recent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.
Recent motifs: end, end, end
Recent major events: yes, yes, yes
Relationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}
2025-10-26 02:15:59,896 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 36 in room entrance
2025-10-26 02:15:59,896 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:15:59,896 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-26 02:15:59,896 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'room': 'entrance'}
2025-10-26 02:16:06,769 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Calm, clear morning with a gentle breeze', 'sensory_details': 'The air is fresh and cool to the touch; distant birdsong fills the silence as sunlight filters through wisps of fog.'}
2025-10-26 02:16:06,769 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Calm, clear morning with a gentle breeze', 'sensory_details': 'The air is fresh and cool to the touch distant birdsong fills the silence as sunlight filters through wisps of fog.'}
2025-10-26 02:16:06,770 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-26 02:16:06,770 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Calm, clear morning with a gentle breeze", "sensory_details": "The air is fresh and cool to the touch distant birdsong fills the silence as sunlight filters through wisps of fog."}
2025-10-26 02:16:06,770 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:16:06,770 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-26 02:16:06,770 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'world_constraint_from_prev_turn': '{"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}', 'recent_motifs': 'end, end, end, end, end', 'lore_continuity_weight': 22, 'memory_layers': []}
2025-10-26 02:16:35,999 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about the source of the warmth.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stand back and observe, waiting for further signs from the Mystery Figure.', 'action_type': 'wait'}, {'id': '3', 'text': 'Speak to the Shieldbearer about the strange occurrence.', 'action_type': 'dialogue'}], 'major_event': False, 'safe_functions': []}
2025-10-26 02:16:35,999 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about the source of the warmth.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stand back and observe, waiting for further signs from the Mystery Figure.', 'action_type': 'wait'}, {'id': '3', 'text': 'Speak to the Shieldbearer about the strange occurrence.', 'action_type': 'dialogue'}], 'major_event': False, 'safe_functions': []}
2025-10-26 02:16:35,999 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-26 02:16:35,999 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialogue", "id": "1", "text": "Approach the Mystery Figure and ask about the source of the warmth."}, {"action_type": "wait", "id": "2", "text": "Stand back and observe, waiting for further signs from the Mystery Figure."}, {"action_type": "dialogue", "id": "3", "text": "Speak to the Shieldbearer about the strange occurrence."}], "safe_functions": [], "scene": "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the...
2025-10-26 02:16:35,999 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-26 02:16:35,999 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'end', 'text': 'The campaign concludes.', 'action_type': 'end'}
2025-10-26 02:16:35,999 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "end", "id": "end", "text": "The campaign concludes."}
2025-10-26 02:16:35,999 [INFO] fortress_director.orchestrator.orchestrator: End flag detected, terminating turn early
2025-10-26 02:16:35,999 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-26 02:16:35,999 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-26 02:16:35,999 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-26 02:16:35,999 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-26 02:16:35,999 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-26 02:16:35,999 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-26 02:16:35,999 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-26 02:16:35,999 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-26 02:16:35,999 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-26 02:16:35,999 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-26 02:16:35,999 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-26 02:16:35,999 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-26 02:16:35,999 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-26 02:16:35,999 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-26 02:16:36,004 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-26 02:16:36,004 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-26 02:16:36,004 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-26 02:16:36,004 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-26 02:16:36,004 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-26 02:16:36,004 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-26 02:16:36,004 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-26 02:16:36,005 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-26 02:16:36,005 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:16:36,005 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=36, call=None)
2025-10-26 02:16:36,005 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-26 02:16:36,005 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:16:36,005 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 36, "day": 1, "flags": ["atmosphere_dawn_break", "atmosphere", "major_flag_set", "major_wall_alert", "sensory_details", "interact_with_player", "has_torch", "calm_weather", "end", "end_game_triggered", "end_turn"], "inventory": [], "items": {"lornhaven_entrance": ["torch"], "lornhaven_wall": ["torch"], "mystery_figure": ["flint and steel"], "shieldbearer_inventory": ["oil lamp"]}, "lore": {}, "memory_lay...
2025-10-26 02:16:36,005 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:16:36,005 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:16:36,005 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=37, seed=12345, current_glitch=99)
2025-10-26 02:16:36,005 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:16:36,005 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=99, delta=10, limits=(0, 100) (cause=glitch:momentum_overload)
2025-10-26 02:16:36,006 [DEBUG] fortress_director.utils.metrics_manager: Clamped metric value from 109 to 100 within bounds (0, 100)
2025-10-26 02:16:36,006 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 100, 'cause': 'glitch:momentum_overload'}
2025-10-26 02:16:36,006 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 99 to 100 (cause=glitch:momentum_overload)
2025-10-26 02:16:36,006 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=3, triggered_loss=True
2025-10-26 02:16:36,006 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:16:36,006 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Glitch momentum overload triggers early cascade.']
2025-10-26 02:16:36,006 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=3, triggered_loss=True
2025-10-26 02:16:36,006 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:16:36,006 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=100, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-26 02:16:36,006 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 99, 'cause': 'turn_recovery'}
2025-10-26 02:16:36,006 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 100 to 99 (cause=turn_recovery)
2025-10-26 02:16:36,007 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:16:36,007 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-26 02:16:36,007 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 36 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}
Recent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.
Recent motifs: end, end, end
Recent major events: yes, yes, yes
Relationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}
2025-10-26 02:16:36,007 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 36 in room entrance
2025-10-26 02:16:36,007 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:16:36,007 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-26 02:16:36,007 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'room': 'entrance'}
2025-10-26 02:16:44,103 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Calm and serene, with a subtle shift in weather.', 'sensory_details': "The clear air carries the faint scent of rain on dry earth; soft whispers echo as leaves rustle gently. A cool breeze brushes against skin while shadows dance across stone walls under the flickering light from The Shieldbearer's oil lamp."}
2025-10-26 02:16:44,103 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Calm and serene, with a subtle shift in weather.', 'sensory_details': "The clear air carries the faint scent of rain on dry earth soft whispers echo as leaves rustle gently. A cool breeze brushes against skin while shadows dance across stone walls under the flickering light from The Shieldbearer's oil lamp."}
2025-10-26 02:16:44,103 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-26 02:16:44,103 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Calm and serene, with a subtle shift in weather.", "sensory_details": "The clear air carries the faint scent of rain on dry earth soft whispers echo as leaves rustle gently. A cool breeze brushes against skin while shadows dance across stone walls under the flickering light from The Shieldbearer's oil lamp."}
2025-10-26 02:16:44,103 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:16:44,104 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-26 02:16:44,104 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'world_constraint_from_prev_turn': '{"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}', 'recent_motifs': 'end, end, end, end, end', 'lore_continuity_weight': 22, 'memory_layers': []}
2025-10-26 02:17:14,708 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': "Reach out to touch the Mystery Figure's hand again, deepening your connection.", 'action_type': 'interaction'}, {'id': '2', 'text': 'Step back, maintaining a safe distance while observing the Mystery Figure.', 'action_type': 'observation'}, {'id': '3', 'text': 'Speak up, asking the Mystery Figure about their intentions and purpose.', 'action_type': 'dialogue'}], 'major_event': True, 'safe_functions': ["change_weather('overcast')"]}
2025-10-26 02:17:14,708 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': "Reach out to touch the Mystery Figure's hand again, deepening your connection.", 'action_type': 'interaction'}, {'id': '2', 'text': 'Step back, maintaining a safe distance while observing the Mystery Figure.', 'action_type': 'observation'}, {'id': '3', 'text': 'Speak up, asking the Mystery Figure about their intentions and purpose.', 'action_type': 'dialogue'}], 'major_event': True, 'safe_functions': ["change_weather('overcast')"]}
2025-10-26 02:17:14,708 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-26 02:17:14,708 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": true, "options": [{"action_type": "interaction", "id": "1", "text": "Reach out to touch the Mystery Figure's hand again, deepening your connection."}, {"action_type": "observation", "id": "2", "text": "Step back, maintaining a safe distance while observing the Mystery Figure."}, {"action_type": "dialogue", "id": "3", "text": "Speak up, asking the Mystery Figure about their intentions and purpose."}], "safe_functions": ["change_weather('overcast')"], "scene": "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. Th...
2025-10-26 02:17:14,708 [INFO] fortress_director.orchestrator.orchestrator: Added NPC fallback: move_npc('Boris', 'entrance')
2025-10-26 02:17:14,709 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-26 02:17:14,709 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'end', 'text': 'The campaign concludes.', 'action_type': 'end'}
2025-10-26 02:17:14,709 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "end", "id": "end", "text": "The campaign concludes."}
2025-10-26 02:17:14,709 [INFO] fortress_director.orchestrator.orchestrator: End flag detected, terminating turn early
2025-10-26 02:17:14,710 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-26 02:17:14,711 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-26 02:17:14,711 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-26 02:17:14,711 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-26 02:17:14,711 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-26 02:17:14,711 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-26 02:17:14,711 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-26 02:17:14,711 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-26 02:17:14,711 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-26 02:17:14,712 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-26 02:17:14,712 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-26 02:17:14,712 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-26 02:17:14,712 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-26 02:17:14,712 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-26 02:17:14,712 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-26 02:17:14,712 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-26 02:17:14,712 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-26 02:17:14,713 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-26 02:17:14,713 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-26 02:17:14,713 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-26 02:17:14,713 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-26 02:17:14,713 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-26 02:17:14,713 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:17:14,713 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=36, call=None)
2025-10-26 02:17:14,713 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-26 02:17:14,714 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:17:14,714 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 36, "day": 1, "flags": ["atmosphere_dawn_break", "atmosphere", "major_flag_set", "major_wall_alert", "sensory_details", "interact_with_player", "has_torch", "calm_weather", "end", "end_game_triggered", "end_turn"], "inventory": [], "items": {"lornhaven_entrance": ["torch"], "lornhaven_wall": ["torch"], "mystery_figure": ["flint and steel"], "shieldbearer_inventory": ["oil lamp"]}, "lore": {}, "memory_lay...
2025-10-26 02:17:14,714 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:17:14,714 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:17:14,714 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=37, seed=12345, current_glitch=99)
2025-10-26 02:17:14,714 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:17:14,714 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=99, delta=10, limits=(0, 100) (cause=glitch:momentum_overload)
2025-10-26 02:17:14,714 [DEBUG] fortress_director.utils.metrics_manager: Clamped metric value from 109 to 100 within bounds (0, 100)
2025-10-26 02:17:14,714 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 100, 'cause': 'glitch:momentum_overload'}
2025-10-26 02:17:14,714 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 99 to 100 (cause=glitch:momentum_overload)
2025-10-26 02:17:14,714 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=3, triggered_loss=True
2025-10-26 02:17:14,715 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:17:14,715 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Glitch momentum overload triggers early cascade.']
2025-10-26 02:17:14,715 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=3, triggered_loss=True
2025-10-26 02:17:14,715 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:17:14,715 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=100, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-26 02:17:14,715 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 99, 'cause': 'turn_recovery'}
2025-10-26 02:17:14,715 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 100 to 99 (cause=turn_recovery)
2025-10-26 02:17:14,715 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:17:14,715 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-26 02:17:14,715 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 36 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}
Recent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.
Recent motifs: end, end, end
Recent major events: yes, yes, yes
Relationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}
2025-10-26 02:17:14,715 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 36 in room entrance
2025-10-26 02:17:14,716 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:17:14,716 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-26 02:17:14,716 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'room': 'entrance'}
2025-10-26 02:17:21,787 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Calm, clear morning with a gentle breeze', 'sensory_details': 'The crisp air carries the scent of dew on grass; sunlight filters through leaves creating dappled patterns.'}
2025-10-26 02:17:21,787 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Calm, clear morning with a gentle breeze', 'sensory_details': 'The crisp air carries the scent of dew on grass sunlight filters through leaves creating dappled patterns.'}
2025-10-26 02:17:21,787 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-26 02:17:21,787 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Calm, clear morning with a gentle breeze", "sensory_details": "The crisp air carries the scent of dew on grass sunlight filters through leaves creating dappled patterns."}
2025-10-26 02:17:21,787 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:17:21,787 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-26 02:17:21,787 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'world_constraint_from_prev_turn': '{"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}', 'recent_motifs': 'end, end, end, end, end', 'lore_continuity_weight': 22, 'memory_layers': []}
2025-10-26 02:17:51,833 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about the source of their power.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stay back, unsure of what to make of this strange encounter.', 'action_type': 'wait'}, {'id': '3', 'text': "Reach out and touch the Mystery Figure's hand again, feeling the warmth envelop you both.", 'action_type': 'interaction'}], 'major_event': False, 'safe_functions': []}
2025-10-26 02:17:51,833 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about the source of their power.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stay back, unsure of what to make of this strange encounter.', 'action_type': 'wait'}, {'id': '3', 'text': "Reach out and touch the Mystery Figure's hand again, feeling the warmth envelop you both.", 'action_type': 'interaction'}], 'major_event': False, 'safe_functions': []}
2025-10-26 02:17:51,833 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-26 02:17:51,833 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialogue", "id": "1", "text": "Approach the Mystery Figure and ask about the source of their power."}, {"action_type": "wait", "id": "2", "text": "Stay back, unsure of what to make of this strange encounter."}, {"action_type": "interaction", "id": "3", "text": "Reach out and touch the Mystery Figure's hand again, feeling the warmth envelop you both."}], "safe_functions": [], "scene": "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie...
2025-10-26 02:17:51,834 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-26 02:17:51,834 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'end', 'text': 'The campaign concludes.', 'action_type': 'end'}
2025-10-26 02:17:51,834 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "end", "id": "end", "text": "The campaign concludes."}
2025-10-26 02:17:51,834 [INFO] fortress_director.orchestrator.orchestrator: End flag detected, terminating turn early
2025-10-26 02:17:51,835 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-26 02:17:51,837 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-26 02:17:51,837 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-26 02:17:51,837 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-26 02:17:51,837 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-26 02:17:51,837 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-26 02:17:51,837 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-26 02:17:51,837 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-26 02:17:51,837 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-26 02:17:51,838 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-26 02:17:51,838 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-26 02:17:51,838 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-26 02:17:51,838 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-26 02:17:51,838 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-26 02:17:51,838 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-26 02:17:51,838 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-26 02:17:51,838 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-26 02:17:51,838 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-26 02:17:51,839 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-26 02:17:51,839 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-26 02:17:51,839 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-26 02:17:51,839 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-26 02:17:51,839 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:17:51,839 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=36, call=None)
2025-10-26 02:17:51,839 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-26 02:17:51,840 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:17:51,840 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 36, "day": 1, "flags": ["atmosphere_dawn_break", "atmosphere", "major_flag_set", "major_wall_alert", "sensory_details", "interact_with_player", "has_torch", "calm_weather", "end", "end_game_triggered", "end_turn"], "inventory": [], "items": {"lornhaven_entrance": ["torch"], "lornhaven_wall": ["torch"], "mystery_figure": ["flint and steel"], "shieldbearer_inventory": ["oil lamp"]}, "lore": {}, "memory_lay...
2025-10-26 02:17:51,840 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:17:51,840 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:17:51,840 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=37, seed=12345, current_glitch=99)
2025-10-26 02:17:51,840 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:17:51,840 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=99, delta=10, limits=(0, 100) (cause=glitch:momentum_overload)
2025-10-26 02:17:51,840 [DEBUG] fortress_director.utils.metrics_manager: Clamped metric value from 109 to 100 within bounds (0, 100)
2025-10-26 02:17:51,840 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 100, 'cause': 'glitch:momentum_overload'}
2025-10-26 02:17:51,840 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 99 to 100 (cause=glitch:momentum_overload)
2025-10-26 02:17:51,840 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=3, triggered_loss=True
2025-10-26 02:17:51,840 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:17:51,840 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Glitch momentum overload triggers early cascade.']
2025-10-26 02:17:51,841 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=3, triggered_loss=True
2025-10-26 02:17:51,841 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:17:51,841 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=100, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-26 02:17:51,841 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 99, 'cause': 'turn_recovery'}
2025-10-26 02:17:51,841 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 100 to 99 (cause=turn_recovery)
2025-10-26 02:17:51,841 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:17:51,841 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-26 02:17:51,841 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 36 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}
Recent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.
Recent motifs: end, end, end
Recent major events: yes, yes, yes
Relationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}
2025-10-26 02:17:51,841 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 36 in room entrance
2025-10-26 02:17:51,841 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:17:51,842 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-26 02:17:51,842 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'room': 'entrance'}
2025-10-26 02:17:58,974 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Calm and serene, with a subtle shift in weather.', 'sensory_details': 'The clear air carries the faint scent of rain; cool breezes whisper through as shadows dance on stone walls.'}
2025-10-26 02:17:58,974 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Calm and serene, with a subtle shift in weather.', 'sensory_details': 'The clear air carries the faint scent of rain cool breezes whisper through as shadows dance on stone walls.'}
2025-10-26 02:17:58,974 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-26 02:17:58,974 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Calm and serene, with a subtle shift in weather.", "sensory_details": "The clear air carries the faint scent of rain cool breezes whisper through as shadows dance on stone walls."}
2025-10-26 02:17:58,974 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:17:58,974 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-26 02:17:58,974 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'world_constraint_from_prev_turn': '{"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}', 'recent_motifs': 'end, end, end, end, end', 'lore_continuity_weight': 22, 'memory_layers': []}
2025-10-26 02:18:28,797 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about the source of the warmth.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Retreat to your post, focusing on guarding the entrance.', 'action_type': 'movement'}, {'id': '3', 'text': "Reach out and touch the Mystery Figure's hand again, feeling the warmth once more.", 'action_type': 'interaction'}], 'major_event': False, 'safe_functions': []}
2025-10-26 02:18:28,797 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about the source of the warmth.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Retreat to your post, focusing on guarding the entrance.', 'action_type': 'movement'}, {'id': '3', 'text': "Reach out and touch the Mystery Figure's hand again, feeling the warmth once more.", 'action_type': 'interaction'}], 'major_event': False, 'safe_functions': []}
2025-10-26 02:18:28,797 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-26 02:18:28,797 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialogue", "id": "1", "text": "Approach the Mystery Figure and ask about the source of the warmth."}, {"action_type": "movement", "id": "2", "text": "Retreat to your post, focusing on guarding the entrance."}, {"action_type": "interaction", "id": "3", "text": "Reach out and touch the Mystery Figure's hand again, feeling the warmth once more."}], "safe_functions": [], "scene": "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow em...
2025-10-26 02:18:28,797 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-26 02:18:28,797 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'end', 'text': 'The campaign concludes.', 'action_type': 'end'}
2025-10-26 02:18:28,797 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "end", "id": "end", "text": "The campaign concludes."}
2025-10-26 02:18:28,797 [INFO] fortress_director.orchestrator.orchestrator: End flag detected, terminating turn early
2025-10-26 02:18:28,799 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-26 02:18:28,799 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-26 02:18:28,799 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-26 02:18:28,799 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-26 02:18:28,799 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-26 02:18:28,801 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-26 02:18:28,801 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-26 02:18:28,801 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-26 02:18:28,801 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-26 02:18:28,801 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-26 02:18:28,801 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-26 02:18:28,802 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-26 02:18:28,802 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-26 02:18:28,802 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-26 02:18:28,802 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-26 02:18:28,802 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-26 02:18:28,802 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-26 02:18:28,802 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-26 02:18:28,802 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-26 02:18:28,802 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-26 02:18:28,802 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-26 02:18:28,802 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-26 02:18:28,802 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:18:28,802 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=36, call=None)
2025-10-26 02:18:28,802 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-26 02:18:28,802 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:18:28,802 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 36, "day": 1, "flags": ["atmosphere_dawn_break", "atmosphere", "major_flag_set", "major_wall_alert", "sensory_details", "interact_with_player", "has_torch", "calm_weather", "end", "end_game_triggered", "end_turn"], "inventory": [], "items": {"lornhaven_entrance": ["torch"], "lornhaven_wall": ["torch"], "mystery_figure": ["flint and steel"], "shieldbearer_inventory": ["oil lamp"]}, "lore": {}, "memory_lay...
2025-10-26 02:18:28,802 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:18:28,802 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:18:28,802 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=37, seed=12345, current_glitch=99)
2025-10-26 02:18:28,802 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:18:28,802 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=99, delta=10, limits=(0, 100) (cause=glitch:momentum_overload)
2025-10-26 02:18:28,802 [DEBUG] fortress_director.utils.metrics_manager: Clamped metric value from 109 to 100 within bounds (0, 100)
2025-10-26 02:18:28,802 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 100, 'cause': 'glitch:momentum_overload'}
2025-10-26 02:18:28,802 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 99 to 100 (cause=glitch:momentum_overload)
2025-10-26 02:18:28,804 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=3, triggered_loss=True
2025-10-26 02:18:28,804 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:18:28,804 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Glitch momentum overload triggers early cascade.']
2025-10-26 02:18:28,804 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=3, triggered_loss=True
2025-10-26 02:18:28,804 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:18:28,804 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=100, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-26 02:18:28,804 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 99, 'cause': 'turn_recovery'}
2025-10-26 02:18:28,804 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 100 to 99 (cause=turn_recovery)
2025-10-26 02:18:28,804 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:18:28,804 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-26 02:18:28,805 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 36 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}
Recent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.
Recent motifs: end, end, end
Recent major events: yes, yes, yes
Relationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}
2025-10-26 02:18:28,805 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 36 in room entrance
2025-10-26 02:18:28,805 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:18:28,805 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-26 02:18:28,805 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'room': 'entrance'}
2025-10-26 02:18:36,617 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Calm, clear dawn with a subtle shift in weather.', 'sensory_details': 'The cool morning air carries the faint scent of dew on grass as sunlight filters through dissipating clouds, casting soft golden hues across the entrance. The sound of distant birdsong mingles with the gentle rustling of leaves.'}
2025-10-26 02:18:36,617 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Calm, clear dawn with a subtle shift in weather.', 'sensory_details': 'The cool morning air carries the faint scent of dew on grass as sunlight filters through dissipating clouds, casting soft golden hues across the entrance. The sound of distant birdsong mingles with the gentle rustling of leaves.'}
2025-10-26 02:18:36,618 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-26 02:18:36,618 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Calm, clear dawn with a subtle shift in weather.", "sensory_details": "The cool morning air carries the faint scent of dew on grass as sunlight filters through dissipating clouds, casting soft golden hues across the entrance. The sound of distant birdsong mingles with the gentle rustling of leaves."}
2025-10-26 02:18:36,618 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:18:36,618 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-26 02:18:36,618 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'world_constraint_from_prev_turn': '{"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}', 'recent_motifs': 'end, end, end, end, end', 'lore_continuity_weight': 22, 'memory_layers': []}
2025-10-26 02:19:07,393 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about the source of the warmth.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Step back, keeping a safe distance from the Mystery Figure.', 'action_type': 'movement'}, {'id': '3', 'text': "Reach out and touch the Mystery Figure's hand again, feeling the warmth envelop you both once more.", 'action_type': 'interaction'}], 'major_event': False, 'safe_functions': []}
2025-10-26 02:19:07,393 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about the source of the warmth.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Step back, keeping a safe distance from the Mystery Figure.', 'action_type': 'movement'}, {'id': '3', 'text': "Reach out and touch the Mystery Figure's hand again, feeling the warmth envelop you both once more.", 'action_type': 'interaction'}], 'major_event': False, 'safe_functions': []}
2025-10-26 02:19:07,393 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-26 02:19:07,393 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialogue", "id": "1", "text": "Approach the Mystery Figure and ask about the source of the warmth."}, {"action_type": "movement", "id": "2", "text": "Step back, keeping a safe distance from the Mystery Figure."}, {"action_type": "interaction", "id": "3", "text": "Reach out and touch the Mystery Figure's hand again, feeling the warmth envelop you both once more."}], "safe_functions": [], "scene": "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more a...
2025-10-26 02:19:07,393 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-26 02:19:07,394 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'end', 'text': 'The campaign concludes.', 'action_type': 'end'}
2025-10-26 02:19:07,394 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "end", "id": "end", "text": "The campaign concludes."}
2025-10-26 02:19:07,394 [INFO] fortress_director.orchestrator.orchestrator: End flag detected, terminating turn early
2025-10-26 02:19:07,396 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-26 02:19:07,396 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-26 02:19:07,396 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-26 02:19:07,396 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-26 02:19:07,396 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-26 02:19:07,396 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-26 02:19:07,397 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-26 02:19:07,397 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-26 02:19:07,397 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-26 02:19:07,397 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-26 02:19:07,397 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-26 02:19:07,397 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-26 02:19:07,397 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-26 02:19:07,397 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-26 02:19:07,397 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-26 02:19:07,397 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-26 02:19:07,398 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-26 02:19:07,398 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-26 02:19:07,398 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-26 02:19:07,398 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-26 02:19:07,398 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-26 02:19:07,398 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-26 02:19:07,398 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:19:07,398 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=36, call=None)
2025-10-26 02:19:07,398 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-26 02:19:07,399 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:19:07,399 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 36, "day": 1, "flags": ["atmosphere_dawn_break", "atmosphere", "major_flag_set", "major_wall_alert", "sensory_details", "interact_with_player", "has_torch", "calm_weather", "end", "end_game_triggered", "end_turn"], "inventory": [], "items": {"lornhaven_entrance": ["torch"], "lornhaven_wall": ["torch"], "mystery_figure": ["flint and steel"], "shieldbearer_inventory": ["oil lamp"]}, "lore": {}, "memory_lay...
2025-10-26 02:19:07,399 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:19:07,399 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:19:07,399 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=37, seed=12345, current_glitch=99)
2025-10-26 02:19:07,399 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:19:07,399 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=99, delta=10, limits=(0, 100) (cause=glitch:momentum_overload)
2025-10-26 02:19:07,399 [DEBUG] fortress_director.utils.metrics_manager: Clamped metric value from 109 to 100 within bounds (0, 100)
2025-10-26 02:19:07,399 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 100, 'cause': 'glitch:momentum_overload'}
2025-10-26 02:19:07,399 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 99 to 100 (cause=glitch:momentum_overload)
2025-10-26 02:19:07,399 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=3, triggered_loss=True
2025-10-26 02:19:07,400 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:19:07,400 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Glitch momentum overload triggers early cascade.']
2025-10-26 02:19:07,400 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=3, triggered_loss=True
2025-10-26 02:19:07,400 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:19:07,400 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=100, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-26 02:19:07,400 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 99, 'cause': 'turn_recovery'}
2025-10-26 02:19:07,400 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 100 to 99 (cause=turn_recovery)
2025-10-26 02:19:07,400 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:19:07,400 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-26 02:19:07,400 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 36 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}
Recent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.
Recent motifs: end, end, end
Recent major events: yes, yes, yes
Relationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}
2025-10-26 02:19:07,400 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 36 in room entrance
2025-10-26 02:19:07,400 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:19:07,400 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-26 02:19:07,401 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'room': 'entrance'}
2025-10-26 02:19:14,423 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Calm, clear morning with a gentle breeze', 'sensory_details': 'The air is fresh and cool to the touch; distant birdsong fills the silence as sunlight filters through leaves.'}
2025-10-26 02:19:14,423 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Calm, clear morning with a gentle breeze', 'sensory_details': 'The air is fresh and cool to the touch distant birdsong fills the silence as sunlight filters through leaves.'}
2025-10-26 02:19:14,423 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-26 02:19:14,423 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Calm, clear morning with a gentle breeze", "sensory_details": "The air is fresh and cool to the touch distant birdsong fills the silence as sunlight filters through leaves."}
2025-10-26 02:19:14,423 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:19:14,423 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-26 02:19:14,423 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'world_constraint_from_prev_turn': '{"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}', 'recent_motifs': 'end, end, end, end, end', 'lore_continuity_weight': 22, 'memory_layers': []}
2025-10-26 02:19:46,478 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about their purpose.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stay where you are, observing the Mystery Figure from a distance.', 'action_type': 'wait'}, {'id': '3', 'text': "Walk away, feeling uneasy about the Mystery Figure's presence.", 'action_type': 'move', 'safe_functions': ["move_npc('The Shieldbearer', 'lornhaven_wall')"]}], 'major_event': True, 'safe_functions': ["change_weather('cloudy')"]}
2025-10-26 02:19:46,478 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about their purpose.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stay where you are, observing the Mystery Figure from a distance.', 'action_type': 'wait'}, {'id': '3', 'text': "Walk away, feeling uneasy about the Mystery Figure's presence.", 'action_type': 'move', 'safe_functions': ["move_npc('The Shieldbearer', 'lornhaven_wall')"]}], 'major_event': True, 'safe_functions': ["change_weather('cloudy')"]}
2025-10-26 02:19:46,478 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-26 02:19:46,478 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": true, "options": [{"action_type": "dialogue", "id": "1", "text": "Approach the Mystery Figure and ask about their purpose."}, {"action_type": "wait", "id": "2", "text": "Stay where you are, observing the Mystery Figure from a distance."}, {"action_type": "move", "id": "3", "safe_functions": ["move_npc('The Shieldbearer', 'lornhaven_wall')"], "text": "Walk away, feeling uneasy about the Mystery Figure's presence."}], "safe_functions": ["change_weather('cloudy')"], "scene": "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the cal...
2025-10-26 02:19:46,478 [INFO] fortress_director.orchestrator.orchestrator: Added NPC fallback: move_npc('Boris', 'entrance')
2025-10-26 02:19:46,478 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-26 02:19:46,478 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'end', 'text': 'The campaign concludes.', 'action_type': 'end'}
2025-10-26 02:19:46,478 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "end", "id": "end", "text": "The campaign concludes."}
2025-10-26 02:19:46,478 [INFO] fortress_director.orchestrator.orchestrator: End flag detected, terminating turn early
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-26 02:19:46,478 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-26 02:19:46,478 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-26 02:19:46,478 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-26 02:19:46,485 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:19:46,485 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=36, call=None)
2025-10-26 02:19:46,486 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-26 02:19:46,486 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=36)
2025-10-26 02:19:46,486 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 36, "day": 1, "flags": ["atmosphere_dawn_break", "atmosphere", "major_flag_set", "major_wall_alert", "sensory_details", "interact_with_player", "has_torch", "calm_weather", "end", "end_game_triggered", "end_turn"], "inventory": [], "items": {"lornhaven_entrance": ["torch"], "lornhaven_wall": ["torch"], "mystery_figure": ["flint and steel"], "shieldbearer_inventory": ["oil lamp"]}, "lore": {}, "memory_lay...
2025-10-26 02:19:46,486 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:19:46,486 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:19:46,486 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=37, seed=12345, current_glitch=99)
2025-10-26 02:19:46,486 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:19:46,486 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=99, delta=10, limits=(0, 100) (cause=glitch:momentum_overload)
2025-10-26 02:19:46,486 [DEBUG] fortress_director.utils.metrics_manager: Clamped metric value from 109 to 100 within bounds (0, 100)
2025-10-26 02:19:46,486 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 100, 'cause': 'glitch:momentum_overload'}
2025-10-26 02:19:46,486 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 99 to 100 (cause=glitch:momentum_overload)
2025-10-26 02:19:46,487 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=3, triggered_loss=True
2025-10-26 02:19:46,487 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:19:46,487 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Glitch momentum overload triggers early cascade.']
2025-10-26 02:19:46,487 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=3, triggered_loss=True
2025-10-26 02:19:46,487 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 100, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:19:46,487 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=100, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-26 02:19:46,487 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 99, 'cause': 'turn_recovery'}
2025-10-26 02:19:46,487 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 100 to 99 (cause=turn_recovery)
2025-10-26 02:19:46,487 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 26, 'morale': 34, 'resources': 10, 'knowledge': 20, 'corruption': 10, 'glitch': 99, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 22, 'major_event_last_turn': 34}
2025-10-26 02:19:46,487 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-26 02:19:46,488 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 36 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}
Recent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.
Recent motifs: end, end, end
Recent major events: yes, yes, yes
Relationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}
2025-10-26 02:19:46,488 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 36 in room entrance
2025-10-26 02:19:46,488 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:19:46,488 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-26 02:19:46,488 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'room': 'entrance'}
2025-10-26 02:19:53,060 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Calm, clear morning with a gentle breeze', 'sensory_details': 'The crisp air carries the scent of dew on grass; sunlight filters through leaves creating dappled patterns.'}
2025-10-26 02:19:53,060 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Calm, clear morning with a gentle breeze', 'sensory_details': 'The crisp air carries the scent of dew on grass sunlight filters through leaves creating dappled patterns.'}
2025-10-26 02:19:53,060 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-26 02:19:53,060 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Calm, clear morning with a gentle breeze", "sensory_details": "The crisp air carries the scent of dew on grass sunlight filters through leaves creating dappled patterns."}
2025-10-26 02:19:53,060 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"clear\", \"sensory_details\": \"The weather shifts subtly.\"}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery ...
2025-10-26 02:19:53,060 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-26 02:19:53,061 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 36 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}\nRecent events: The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure\'s eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure\'s hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.\nRecent motifs: end, end, end\nRecent major events: yes, yes, yes\nRelationship summary: Rhea is neutral toward the player; Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 26, "morale": 34, "resources": 10, "knowledge": 20, "corruption": 10, "glitch": 99, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 22, "major_event_last_turn": 34}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.; The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'world_constraint_from_prev_turn': '{"atmosphere": "clear", "sensory_details": "The weather shifts subtly."}', 'recent_motifs': 'end, end, end, end, end', 'lore_continuity_weight': 22, 'memory_layers': []}
2025-10-26 02:20:22,447 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about their origins.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stay back and observe the Mystery Figure from a distance.', 'action_type': 'exploration'}, {'id': '3', 'text': 'Share a personal story with the Mystery Figure.', 'action_type': 'dialogue'}], 'major_event': True, 'safe_functions': ["change_weather('overcast')"]}
2025-10-26 02:20:22,447 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the Mystery Figure's eyes illuminates the entrance, casting eerie shadows on the walls. As she reaches out to touch the Mystery Figure's hand again, a surge of warmth envelopes them both, strengthening their bond. The Shieldbearer feels her heart beating steadily as they stand there, lost in the moment.", 'options': [{'id': '1', 'text': 'Approach the Mystery Figure and ask about their origins.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stay back and observe the Mystery Figure from a distance.', 'action_type': 'exploration'}, {'id': '3', 'text': 'Share a personal story with the Mystery Figure.', 'action_type': 'dialogue'}], 'major_event': True, 'safe_functions': ["change_weather('overcast')"]}
2025-10-26 02:20:22,447 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-26 02:20:22,447 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": true, "options": [{"action_type": "dialogue", "id": "1", "text": "Approach the Mystery Figure and ask about their origins."}, {"action_type": "exploration", "id": "2", "text": "Stay back and observe the Mystery Figure from a distance."}, {"action_type": "dialogue", "id": "3", "text": "Share a personal story with the Mystery Figure."}], "safe_functions": ["change_weather('overcast')"], "scene": "The Shieldbearer, still holding her oil lamp, gazes at the Mystery Figure as they both stand in the calm entrance. The wind dies down once more and the eerie glow emanating from the M...
2025-10-26 02:20:22,447 [INFO] fortress_director.orchestrator.orchestrator: Added NPC fallback: move_npc('Boris', 'entrance')
2025-10-26 02:20:22,448 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-26 02:20:22,448 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'end', 'text': 'The campaign concludes.', 'action_type': 'end'}
2025-10-26 02:20:22,448 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "end", "id": "end", "text": "The campaign concludes."}
2025-10-26 02:20:22,448 [INFO] fortress_director.orchestrator.orchestrator: End flag detected, terminating turn early
