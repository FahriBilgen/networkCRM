2025-10-30 01:14:48,222 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_221448.log)
2025-10-30 01:14:48,222 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_221448.log)
2025-10-30 01:14:48,222 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_221448.log
2025-10-30 01:14:48,244 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-30 01:14:48,254 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-30 01:14:48,254 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-30 01:14:48,254 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-30 01:14:48,256 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-30 01:14:48,256 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-30 01:14:48,256 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-30 01:14:48,256 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-30 01:14:48,256 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-30 01:14:48,256 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-30 01:14:48,256 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-30 01:14:48,256 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-30 01:14:48,256 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-30 01:14:48,258 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-30 01:14:48,258 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-30 01:14:48,258 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-30 01:14:48,258 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-30 01:14:48,258 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-30 01:14:48,258 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-30 01:14:48,258 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-30 01:14:48,258 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-30 01:14:48,258 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-30 01:14:48,258 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=10)
2025-10-30 01:14:48,258 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=10, call=None)
2025-10-30 01:14:48,258 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-30 01:14:48,258 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=10)
2025-10-30 01:14:48,258 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "courtyard", "current_turn": 10, "day": 3, "flags": ["recent_events", "has_heard_drums", "atmosphere", "world_map_night_dark"], "inventory": [], "lore": {}, "memory_layers": [], "memory_long": [], "memory_short": ["Turn 7: Ask him if he knows anything about the drums. -> The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you ap...", "Turn 8: You ask him if he knows anything about the drums...
2025-10-30 01:14:48,258 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 56, 'morale': 66, 'resources': 39, 'knowledge': 51, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:14:48,258 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 56, 'morale': 66, 'resources': 39, 'knowledge': 51, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:14:48,258 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=11, seed=12345, current_glitch=26)
2025-10-30 01:14:48,258 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 56, 'morale': 66, 'resources': 39, 'knowledge': 51, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:14:48,258 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=26, delta=1, limits=(0, 100) (cause=glitch:cosmetic_noise)
2025-10-30 01:14:48,258 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 27, 'cause': 'glitch:cosmetic_noise'}
2025-10-30 01:14:48,262 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 26 to 27 (cause=glitch:cosmetic_noise)
2025-10-30 01:14:48,262 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=66, delta=-1, limits=(0, 100) (cause=glitch:unease)
2025-10-30 01:14:48,262 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': -1, 'value': 65, 'cause': 'glitch:unease'}
2025-10-30 01:14:48,262 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 66 to 65 (cause=glitch:unease)
2025-10-30 01:14:48,262 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=5, triggered_loss=False
2025-10-30 01:14:48,262 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 56, 'morale': 65, 'resources': 39, 'knowledge': 51, 'corruption': 10, 'glitch': 27, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:14:48,262 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Minor static ripples along the parapets.']
2025-10-30 01:14:48,262 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=5, triggered_loss=False
2025-10-30 01:14:48,262 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 56, 'morale': 65, 'resources': 39, 'knowledge': 51, 'corruption': 10, 'glitch': 27, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:14:48,262 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=27, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-30 01:14:48,262 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 26, 'cause': 'turn_recovery'}
2025-10-30 01:14:48,262 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 27 to 26 (cause=turn_recovery)
2025-10-30 01:14:48,262 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 56, 'morale': 65, 'resources': 39, 'knowledge': 51, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:14:48,262 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=5, triggered_loss=False
2025-10-30 01:14:48,262 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 56, 'morale': 65, 'resources': 39, 'knowledge': 51, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:14:48,262 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-30 01:14:48,264 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 10 | Day 3 | Time dawn
Location: courtyard
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Night h, courtyard under a blanket of stars", "sensory_details": "The cool night breeze whispers through the leaves while distant laughter and fading echoes fill the air."}
Recent events: Sure, here's the rewritten prompt:

> The intricate patterns etched onto the crumbling facade of the ancient temple hinted at a dark secret waiting to be unveiled.; Sure, here is the rewritten prompt, with a sense of novelty and surprise:

I'm searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:

**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th... Recent motifs: communication
Recent major events: none
Relationship summary: Rhea trusts the player deeply
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 56, "morale": 65, "resources": 39, "knowledge": 51, "corruption": 10, "glitch": 26, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-30 01:14:48,264 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 10 in room courtyard
2025-10-30 01:14:48,264 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 10 | Day 3 | Time dawn\nLocation: courtyard\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Night h, courtyard under a blanket of stars\", \"sensory_details\": \"The cool night breeze whispers through the leaves while distant laughter and fading echoes fill the air.\"}\nRecent events: Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the ancient temple hinted at a dark secret waiting to be unveiled.; Sure, here is the rewri...
2025-10-30 01:14:48,264 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-30 01:14:48,264 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 10 | Day 3 | Time dawn\nLocation: courtyard\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Night h, courtyard under a blanket of stars", "sensory_details": "The cool night breeze whispers through the leaves while distant laughter and fading echoes fill the air."}\nRecent events: Sure, here\'s the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the ancient temple hinted at a dark secret waiting to be unveiled.; Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI\'m searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 56, "morale": 65, "resources": 39, "knowledge": 51, "corruption": 10, "glitch": 26, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'courtyard', 'time': 'dawn', 'previous_atmosphere': 'Night h, courtyard under a blanket of stars', 'previous_sensory_details': 'The cool night breeze whispers through the leaves while distant laughter and fading echoes fill the air.'}
2025-10-30 01:14:54,897 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Dawn'th in a courtyard, under starlit sky", 'sensory_details': 'The cool breeze caresses skin as the first light touches stone and earth.'}
2025-10-30 01:14:54,897 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Dawn h in a courtyard, under starlit sky', 'sensory_details': 'The cool breeze caresses skin as the first light touches stone and earth.'}
2025-10-30 01:14:54,898 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-30 01:14:54,898 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn h in a courtyard, under starlit sky", "sensory_details": "The cool breeze caresses skin as the first light touches stone and earth."}
2025-10-30 01:14:54,898 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 10 | Day 3 | Time dawn\nLocation: courtyard\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Night h, courtyard under a blanket of stars\", \"sensory_details\": \"The cool night breeze whispers through the leaves while distant laughter and fading echoes fill the air.\"}\nRecent events: Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the ancient temple hinted at a dark secret waiting to be unveiled.; Sure, here is the rewri...
2025-10-30 01:14:54,898 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-30 01:14:54,900 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 10 | Day 3 | Time dawn\nLocation: courtyard\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Night h, courtyard under a blanket of stars", "sensory_details": "The cool night breeze whispers through the leaves while distant laughter and fading echoes fill the air."}\nRecent events: Sure, here\'s the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the ancient temple hinted at a dark secret waiting to be unveiled.; Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI\'m searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 56, "morale": 65, "resources": 39, "knowledge": 51, "corruption": 10, "glitch": 26, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 3, 'time': 'dawn', 'room': 'courtyard', 'recent_events': "Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the ancient temple hinted at a dark secret waiting to be unveiled.; Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th...", 'world_constraint_from_prev_turn': '{"atmosphere": "Night h, courtyard under a blanket of stars", "sensory_details": "The cool night breeze whispers through the leaves while distant laughter and fading echoes fill the air."}', 'recent_motifs': 'communication', 'lore_continuity_weight': 0, 'memory_layers': ['Turn 7: Ask him if he knows anything about the drums. -> The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you ap...', "Turn 8: You ask him if he knows anything about the drums. -> Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the...", "Turn 9: Ask him if he knows anything about the drums. -> Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidde...", 'Memory summary: Turn 7: Ask him if he knows anything about the drums. -> The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you ap... | Turn 8: You ask him if he knows anyth...', 'Turn 10: Ask the Shieldbearer if he knows anything about the drums. -> Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that...'], 'judge_verdict': '{"consistent": true, "reason": "The content is consistent with established world, lore, and character logic. The rewritten prompt introduces a new scenario involving a hidden treasure and drums, which adds novelty and surprise.", "coherence": 100, "integrity": 100, "tone_alignment": 100, "penalty_applied": "none", "penalty_magnitude": {}, "feedback": {}}', 'judge_feedback': {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The rewritten prompt introduces a new scenario involving a hidden treasure and drums, which adds novelty and surprise.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'continuity_weight': 0.0, 'skip_major': False}
2025-10-30 01:15:31,095 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': 'The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade.', 'options': [{'id': 'ask_about_temple', 'text': "Ask the Shieldbearer if he knows anything about the temple's secrets.", 'action_type': 'dialogue'}, {'id': 'search_temple', 'text': 'Search the temple for hidden clues or treasures.', 'action_type': 'exploration'}, {'id': 'use_oil_lamp', 'text': 'Light your oil lamp and examine the patterns more closely.', 'action_type': 'item_use'}, {'id': 'observe_environment', 'text': 'Observe the surroundings, looking for any unusual occurrences or signs of recent activity.', 'action_type': 'observation'}], 'major_event': False, 'safe_functions': []}
2025-10-30 01:15:31,095 [INFO] fortress_director.agents.event_agent: Forcing incident flag for turn 3
2025-10-30 01:15:31,095 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': 'The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made!', 'options': [{'id': 'ask_about_temple', 'text': "Ask the Shieldbearer if he knows anything about the temple's secrets.", 'action_type': 'dialogue'}, {'id': 'search_temple', 'text': 'Search the temple for hidden clues or treasures.', 'action_type': 'exploration'}, {'id': 'use_oil_lamp', 'text': 'Light your oil lamp and examine the patterns more closely.', 'action_type': 'item_use'}, {'id': 'observe_environment', 'text': 'Observe the surroundings, looking for any unusual occurrences or signs of recent activity.', 'action_type': 'observation'}], 'major_event': True, 'safe_functions': []}
2025-10-30 01:15:31,095 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-30 01:15:31,095 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": true, "options": [{"action_type": "dialogue", "id": "ask_about_temple", "text": "Ask the Shieldbearer if he knows anything about the temple's secrets."}, {"action_type": "exploration", "id": "search_temple", "text": "Search the temple for hidden clues or treasures."}, {"action_type": "item_use", "id": "use_oil_lamp", "text": "Light your oil lamp and examine the patterns more closely."}, {"action_type": "observation", "id": "observe_environment", "text": "Observe the surroundings, looking for any unusual occurrences or signs of recent activity."}], "safe_functions": [], "scen...
2025-10-30 01:15:37,962 [INFO] fortress_director.agents.creativity_agent: CreativityAgent LLM event rewrite applied.
2025-10-30 01:15:37,963 [INFO] fortress_director.orchestrator.orchestrator: CreativityAgent enriched event: {'scene': "Sure, here's the rewritten prompt:\n\n**A single, shimmering teardrop hangs from the precipice of a towering waterfall, its edges shimmering with an otherworldly glow.**", 'options': [{'id': 'ask_about_temple', 'text': "Ask the Shieldbearer if he knows anything about the temple's secrets.", 'action_type': 'dialogue'}, {'id': 'search_temple', 'text': 'Search the temple for hidden clues or treasures.', 'action_type': 'exploration'}, {'id': 'use_oil_lamp', 'text': 'Light your oil lamp and examine the patterns more closely.', 'action_type': 'item_use'}, {'id': 'observe_environment', 'text': 'Observe the surroundings, looking for any unusual occurrences or signs of recent activity.', 'action_type': 'observation'}], 'major_event': True, 'safe_functions': [], 'motif_injected': None}
2025-10-30 01:15:37,963 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 01:15:45,174 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': False, 'reason': "The rewritten prompt introduces a new motif, 'whispering secrets', which contradicts the established world and lore. The original prompt focused on the Shieldbearer's role as a defender in a night scene, while the rewritten prompt adds a supernatural element of whispers and echoes."}
2025-10-30 01:15:45,174 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': False, 'reason': "The rewritten prompt introduces a new motif, 'whispering secrets', which contradicts the established world and lore. The original prompt focused on the Shieldbearer's role as a defender in a night scene, while the rewritten prompt adds a supernatural element of whispers and echoes."}
2025-10-30 01:15:45,174 [WARNING] fortress_director.orchestrator.orchestrator: CreativityAgent output rejected by JudgeAgent (coherence=100.0)
2025-10-30 01:15:45,174 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 01:15:48,398 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene described by the player matches the description of a discovery made in the temple.'}
2025-10-30 01:15:48,398 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene described by the player matches the description of a discovery made in the temple.'}
2025-10-30 01:15:48,399 [INFO] fortress_director.orchestrator.orchestrator: Added trust-based option: ask_rhea_personal_help (trust=5)
2025-10-30 01:15:48,399 [INFO] fortress_director.orchestrator.orchestrator: Added motif-based option: diplomacy_approach (motif active)
2025-10-30 01:15:48,399 [INFO] fortress_director.orchestrator.orchestrator: Added time-sensitive option: strategic_planning (turn=10)
2025-10-30 01:15:48,399 [INFO] fortress_director.orchestrator.orchestrator: Added NPC fallback: move_npc('Boris', 'courtyard')
2025-10-30 01:15:48,400 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-30 01:15:48,400 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'ask_about_temple', 'text': "Ask the Shieldbearer if he knows anything about the temple's secrets.", 'action_type': 'dialogue'}
2025-10-30 01:15:48,400 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialogue", "id": "ask_about_temple", "text": "Ask the Shieldbearer if he knows anything about the temple's secrets."}
2025-10-30 01:15:48,400 [INFO] fortress_director.orchestrator.orchestrator: Applying dynamic metrics for action_type 'dialogue': {'morale': 1, 'knowledge': 2}
2025-10-30 01:15:48,400 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=65, delta=1, limits=(0, 100) (cause=action_dialogue)
2025-10-30 01:15:48,400 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 66, 'cause': 'action_dialogue'}
2025-10-30 01:15:48,400 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 65 to 66 (cause=action_dialogue)
2025-10-30 01:15:48,401 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'knowledge': current=51, delta=2, limits=(0, 100) (cause=action_dialogue)
2025-10-30 01:15:48,401 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'knowledge', 'delta': 2, 'value': 53, 'cause': 'action_dialogue'}
2025-10-30 01:15:48,401 [INFO] fortress_director.utils.metrics_manager: Metric 'knowledge' updated from 51 to 53 (cause=action_dialogue)
2025-10-30 01:15:48,401 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after dynamic changes: {'order': 56, 'morale': 66, 'resources': 39, 'knowledge': 53, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:15:48,401 [INFO] fortress_director.orchestrator.orchestrator: Action consequence: Your words strengthen village bonds and reveal useful information.
2025-10-30 01:15:48,401 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 10 | Day 3 | Time dawn\nLocation: courtyard\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Night h, courtyard under a blanket of stars\", \"sensory_details\": \"The cool night breeze whispers through the leaves while distant laughter and fading echoes fill the air.\"}\nRecent events: Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the ancient temple hinted at a dark secret waiting to be unveiled.; Sure, here is the rewri...
2025-10-30 01:15:48,401 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-30 01:15:48,401 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 10 | Day 3 | Time dawn\nLocation: courtyard\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Night h, courtyard under a blanket of stars", "sensory_details": "The cool night breeze whispers through the leaves while distant laughter and fading echoes fill the air."}\nRecent events: Sure, here\'s the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the ancient temple hinted at a dark secret waiting to be unveiled.; Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI\'m searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 56, "morale": 65, "resources": 39, "knowledge": 51, "corruption": 10, "glitch": 26, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': 'The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made!', 'player_choice': "Ask the Shieldbearer if he knows anything about the temple's secrets.", 'atmosphere': 'Dawn h in a courtyard, under starlit sky', 'sensory_details': 'The cool breeze caresses skin as the first light touches stone and earth.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player deeply', 'player_inventory_brief': 'oil lamp, patched shield', 'memory_layers': ['Turn 7: Ask him if he knows anything about the drums. -> The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you ap...', "Turn 8: You ask him if he knows anything about the drums. -> Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the...", "Turn 9: Ask him if he knows anything about the drums. -> Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidde...", 'Memory summary: Turn 7: Ask him if he knows anything about the drums. -> The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you ap... | Turn 8: You ask him if he knows anyth...', 'Turn 10: Ask the Shieldbearer if he knows anything about the drums. -> Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that...'], 'recent_events': "Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the ancient temple hinted at a dark secret waiting to be unveiled.; Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th...", 'last_major_event': 'The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made!'}
2025-10-30 01:16:00,371 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Rhea', 'intent': 'observe', 'action': 'look closer at the temple', 'speech': "I scan the temple's facade, searching for any signs of hidden secrets. The intricate patterns etched onto the crumbling facade suggest a dark past, and I can't resist the urge to explore further.", 'effects': {'trust_delta': 100, 'flag_set': ['mystery_temple_found'], 'item_change': None, 'status_change': {'health': 100}}}
2025-10-30 01:16:00,371 [INFO] fortress_director.agents.character_agent: Normalized output (list): [{'name': 'Rhea', 'intent': 'observe', 'action': 'look closer at the temple', 'speech': "I scan the temple's facade, searching for any signs of hidden secrets. The intricate patterns etched onto the crumbling facade suggest a dark past, and I can't resist the urge to explore further.", 'effects': {'trust_delta': 1, 'flag_set': ['mystery_temple_found']}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': '(assist autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': '(command autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': '(plan autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'inquire', 'action': 'Autonomously performs inquire action.', 'speech': '(inquire autonomous)', 'effects': {}, 'safe_functions': []}]
2025-10-30 01:16:00,371 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-30 01:16:00,371 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "look closer at the temple", "effects": {"flag_set": ["mystery_temple_found"], "trust_delta": 1}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "I scan the temple's facade, searching for any signs of hidden secrets. The intricate patterns etched onto the crumbling facade suggest a dark past, and I can't resist the urge to explore further."}, {"action": "Autonomously performs assist action.", "effects": {}, "intent": "assist", "name": "Rhea", "safe_functions": [], "speech": "(assist autonomous)"}, {"action": "Autonomously performs command action.", "effects...
2025-10-30 01:16:00,371 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-30 01:16:00,371 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-30 01:16:00,371 [DEBUG] fortress_director.orchestrator.orchestrator: Major event effect applied: {"applied_flag": "major_wall_alert", "applied_to": "Rhea", "status_change": {"duration": 3, "status": "tense_watch", "target": "Rhea"}}
2025-10-30 01:16:00,371 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-30 01:16:00,371 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "look closer at the temple", "effects": {"flag_set": ["mystery_temple_found", "major_wall_alert"], "status_change": {"duration": 3, "status": "tense_watch", "target": "Rhea"}, "trust_delta": 1}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "I scan the temple's facade, searching for any signs of hidden secrets. The intricate patterns etched onto the crumbling facade suggest a dark past, and I can't resist the urge to explore further."}, {"action": "Autonomously performs assist action.", "effects": {}, "intent": "assist", "name": "Rhea", "safe_functions": [...
2025-10-30 01:16:00,371 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-30 01:16:00,371 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 10, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['recent_events', 'has_heard_drums', 'atmosphere', 'world_map_night_dark'], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 10, 'day': 3, 'time': 'dawn', 'current_room': 'courtyard', 'recent_events': ["Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the ancient temple hinted at a dark secret waiting to be unveiled.", "Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidden treasure that whispers secrets in the dead of night.", 'Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th...'], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'Night h, courtyard under a blanket of stars', 'sensory_details': 'The cool night breeze whispers through the leaves while distant laughter and fading echoes fill the air.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player deeply', 'metrics': {'order': 56, 'morale': 66, 'resources': 39, 'knowledge': 53, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {'Rhea': 5}, 'previous_judge_verdict': {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene described by the player matches the description of a discovery made in the temple.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['dialogue', 'dialog', 'dialog', 'dialog', 'dialogue', 'dialog', 'communication', 'communication', 'dialogue', 'dialogue'], 'summary_text': 'The day passes quietly.', 'memory_short': ['Turn 7: Ask him if he knows anything about the drums. -> The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you ap...', "Turn 8: You ask him if he knows anything about the drums. -> Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the...", "Turn 9: Ask him if he knows anything about the drums. -> Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidde...", 'Memory summary: Turn 7: Ask him if he knows anything about the drums. -> The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you ap... | Turn 8: You ask him if he knows anyth...', 'Turn 10: Ask the Shieldbearer if he knows anything about the drums. -> Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that...'], 'memory_long': [], 'status_effects': []}
2025-10-30 01:16:00,371 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'observe', 'action': 'look closer at the temple', 'speech': "I scan the temple's facade, searching for any signs of hidden secrets. The intricate patterns etched onto the crumbling facade suggest a dark past, and I can't resist the urge to explore further.", 'effects': {'trust_delta': 1, 'flag_set': ['mystery_temple_found', 'major_wall_alert'], 'status_change': {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': '(assist autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': '(command autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': '(plan autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'inquire', 'action': 'Autonomously performs inquire action.', 'speech': '(inquire autonomous)', 'effects': {}, 'safe_functions': []}]
2025-10-30 01:16:00,371 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 10 | Day 3 | Time dawn
Location: courtyard
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Night h, courtyard under a blanket of stars", "sensory_details": "The cool night breeze whispers through the leaves while distant laughter and fading echoes fill the air."}
Recent events: Sure, here's the rewritten prompt:

> The intricate patterns etched onto the crumbling facade of the ancient temple hinted at a dark secret waiting to be unveiled.; Sure, here is the rewritten prompt, with a sense of novelty and surprise:

I'm searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:

**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th... Recent motifs: communication
Recent major events: none
Relationship summary: Rhea trusts the player deeply
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 56, "morale": 65, "resources": 39, "knowledge": 51, "corruption": 10, "glitch": 26, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made!, player_choice: {'id': 'ask_about_temple', 'text': "Ask the Shieldbearer if he knows anything about the temple's secrets.", 'action_type': 'dialogue'}
2025-10-30 01:16:00,371 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-30 01:16:00,371 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'observe', 'action': 'look closer at the temple', 'speech': "I scan the temple's facade, searching for any signs of hidden secrets. The intricate patterns etched onto the crumbling facade suggest a dark past, and I can't resist the urge to explore further.", 'effects': {'trust_delta': 1, 'flag_set': ['mystery_temple_found', 'major_wall_alert'], 'status_change': {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}}, 'safe_functions': []}
2025-10-30 01:16:00,371 [DEBUG] fortress_director.rules.rules_engine: Validating character event 1: {'name': 'Rhea', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': '(assist autonomous)', 'effects': {}, 'safe_functions': []}
2025-10-30 01:16:00,371 [DEBUG] fortress_director.rules.rules_engine: Validating character event 2: {'name': 'Boris', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': '(command autonomous)', 'effects': {}, 'safe_functions': []}
2025-10-30 01:16:00,371 [DEBUG] fortress_director.rules.rules_engine: Validating character event 3: {'name': 'Rhea', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': '(plan autonomous)', 'effects': {}, 'safe_functions': []}
2025-10-30 01:16:00,371 [DEBUG] fortress_director.rules.rules_engine: Validating character event 4: {'name': 'Boris', 'intent': 'inquire', 'action': 'Autonomously performs inquire action.', 'speech': '(inquire autonomous)', 'effects': {}, 'safe_functions': []}
2025-10-30 01:16:00,371 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-30 01:16:00,371 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 01:16:07,398 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene described by the player choice matches the description of the Shieldbearer observing the temple's facade in the night."}
2025-10-30 01:16:07,398 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene described by the player choice matches the description of the Shieldbearer observing the temple's facade in the night."}
2025-10-30 01:16:07,398 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene described by the player choice matches the description of the Shieldbearer observing the temple's facade in the night.", 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-30 01:16:07,398 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 01:16:10,389 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are logical given the context.'}
2025-10-30 01:16:10,389 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are logical given the context.'}
2025-10-30 01:16:10,389 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are logical given the context.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-30 01:16:10,389 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 01:16:13,572 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the context of a shieldbearer observing an ancient temple.'}
2025-10-30 01:16:13,572 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the context of a shieldbearer observing an ancient temple.'}
2025-10-30 01:16:13,572 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Boris: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the context of a shieldbearer observing an ancient temple.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-30 01:16:13,572 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 01:16:16,798 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are in line with the narrative.'}
2025-10-30 01:16:16,798 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are in line with the narrative.'}
2025-10-30 01:16:16,798 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are in line with the narrative.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-30 01:16:16,798 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 01:16:19,972 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are logical given the context.'}
2025-10-30 01:16:19,972 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are logical given the context.'}
2025-10-30 01:16:19,972 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Boris: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are logical given the context.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-30 01:16:19,972 [INFO] fortress_director.rules.rules_engine: Tier two validation passed with penalties: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-30 01:16:19,972 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {'trust_delta': 1, 'flag_set': ['mystery_temple_found', 'major_wall_alert'], 'status_change': {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}}
2025-10-30 01:16:19,972 [INFO] fortress_director.rules.rules_engine: Trust updated for Rhea: 5 -> 5 (delta: 1)
2025-10-30 01:16:19,972 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-10-30 01:16:19,972 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Boris: {}
2025-10-30 01:16:19,972 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-10-30 01:16:19,972 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Boris: {}
2025-10-30 01:16:19,975 [INFO] fortress_director.rules.rules_engine: Choice impact applied: knowledge +1 (action_type=dialogue)
2025-10-30 01:16:19,975 [INFO] fortress_director.rules.rules_engine: Major event: glitch increased by 2
2025-10-30 01:16:19,975 [INFO] fortress_director.rules.rules_engine: Relationship summary updated: Rhea trusts the player deeply
2025-10-30 01:16:19,975 [INFO] fortress_director.rules.rules_engine: Judge penalties applied: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-30 01:16:19,975 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-30 01:16:19,975 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 10, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['recent_events', 'has_heard_drums', 'atmosphere', 'world_map_night_dark', 'mystery_temple_found', 'major_wall_alert'], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 10, 'day': 3, 'time': 'dawn', 'current_room': 'courtyard', 'recent_events': ["Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the ancient temple hinted at a dark secret waiting to be unveiled.", "Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidden treasure that whispers secrets in the dead of night.", 'Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th...'], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'Night h, courtyard under a blanket of stars', 'sensory_details': 'The cool night breeze whispers through the leaves while distant laughter and fading echoes fill the air.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player deeply', 'metrics': {'order': 56, 'morale': 66, 'resources': 39, 'knowledge': 54, 'corruption': 10, 'glitch': 28, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 1, 'major_event_last_turn': 10}, 'npc_trust': {'Rhea': 5}, 'previous_judge_verdict': {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene described by the player matches the description of a discovery made in the temple.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['dialog', 'dialog', 'dialog', 'dialogue', 'dialog', 'communication', 'communication', 'dialogue', 'dialogue', 'dialogue'], 'summary_text': 'A major event shakes the village. Glitch level rises.', 'memory_short': ['Turn 7: Ask him if he knows anything about the drums. -> The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you ap...', "Turn 8: You ask him if he knows anything about the drums. -> Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the...", "Turn 9: Ask him if he knows anything about the drums. -> Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidde...", 'Memory summary: Turn 7: Ask him if he knows anything about the drums. -> The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you ap... | Turn 8: You ask him if he knows anyth...', 'Turn 10: Ask the Shieldbearer if he knows anything about the drums. -> Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that...'], 'memory_long': [], 'status_effects': [{'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}]}
2025-10-30 01:16:19,975 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=11)
2025-10-30 01:16:19,977 [INFO] fortress_director.orchestrator.orchestrator: Applying 2 autonomous actions
2025-10-30 01:16:19,977 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=56, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-10-30 01:16:19,977 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': 1, 'value': 57, 'cause': 'autonomous_Rhea'}
2025-10-30 01:16:19,977 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 56 to 57 (cause=autonomous_Rhea)
2025-10-30 01:16:19,977 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=66, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-10-30 01:16:19,977 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 67, 'cause': 'autonomous_Rhea'}
2025-10-30 01:16:19,977 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 66 to 67 (cause=autonomous_Rhea)
2025-10-30 01:16:19,977 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'resources': current=39, delta=1, limits=(0, 120) (cause=autonomous_Boris)
2025-10-30 01:16:19,977 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'resources', 'delta': 1, 'value': 40, 'cause': 'autonomous_Boris'}
2025-10-30 01:16:19,977 [INFO] fortress_director.utils.metrics_manager: Metric 'resources' updated from 39 to 40 (cause=autonomous_Boris)
2025-10-30 01:16:19,977 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=67, delta=1, limits=(0, 100) (cause=autonomous_Boris)
2025-10-30 01:16:19,977 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 68, 'cause': 'autonomous_Boris'}
2025-10-30 01:16:19,977 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 67 to 68 (cause=autonomous_Boris)
2025-10-30 01:16:19,977 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-30 01:16:19,977 [INFO] fortress_director.orchestrator.orchestrator: Advanced time to morning
2025-10-30 01:16:19,977 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: [{'target': 'Rhea', 'status': 'tense_watch', 'duration': 2}]
2025-10-30 01:16:19,977 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-10-30 01:16:19,977 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "courtyard", "current_turn": 11, "day": 3, "flags": ["recent_events", "has_heard_drums", "atmosphere", "world_map_night_dark", "mystery_temple_found", "major_wall_alert"], "inventory": [], "lore": {}, "major_event_last_turn": 11, "major_events_triggered": 1, "memory_layers": [], "memory_long": ["Turn 11: Major event triggered (major_wall_alert)"], "memory_short": ["Turn 8: You ask him if he knows anything about the drums. -> Sure, ...
2025-10-30 01:16:19,980 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=11)
2025-10-30 01:16:19,980 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-30 01:16:19,980 [INFO] fortress_director.codeaware.function_registry: Validating function call: move_npc
2025-10-30 01:16:19,981 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=11)
2025-10-30 01:16:19,981 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=11, call=move_npc)
2025-10-30 01:16:19,981 [INFO] fortress_director.codeaware.function_registry: Getting registered function: move_npc
2025-10-30 01:16:19,981 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'move_npc'...
2025-10-30 01:16:19,981 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=11)
2025-10-30 01:16:19,983 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=11)
2025-10-30 01:16:19,983 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_npc' executed successfully.
2025-10-30 01:16:19,983 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_npc' executed (checkpoint turn=11)
2025-10-30 01:16:19,984 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-30 01:16:19,984 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=11)
2025-10-30 01:16:19,986 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=11)
2025-10-30 01:16:19,986 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=11)
2025-10-30 01:16:19,986 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 57, 'morale': 68, 'resources': 40, 'knowledge': 53, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:16:19,986 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 57, 'morale': 68, 'resources': 40, 'knowledge': 53, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:16:19,986 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'conditions_not_met', 'description': 'Oyun devam ediyor...'}
2025-10-30 01:16:19,987 [INFO] fortress_director.orchestrator.orchestrator: Turn summary: A major event shakes the village. Glitch level rises.
2025-10-30 01:16:19,987 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-30 01:16:19,987 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 10 | Day 3 | Time dawn\nLocation: courtyard\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Night h, courtyard under a blanket of stars\", \"sensory_details\": \"The cool night breeze whispers through the leaves while distant laughter and fading echoes fill the air.\"}\nRecent events: Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the ancient temple hinted at a dark secret waiting to be unveiled.; Sure, here is the rewri...
2025-10-30 01:16:19,987 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-30 01:16:19,987 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
