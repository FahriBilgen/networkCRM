2025-10-30 00:41:45,855 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_214145.log)
2025-10-30 00:41:45,855 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_214145.log)
2025-10-30 00:41:45,855 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_214145.log
2025-10-30 00:41:45,860 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-30 00:41:45,870 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-30 00:41:45,871 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-30 00:41:45,871 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-30 00:41:45,871 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-30 00:41:45,871 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-30 00:41:45,872 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-30 00:41:45,872 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-30 00:41:45,872 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-30 00:41:45,872 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-30 00:41:45,873 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-30 00:41:45,873 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-30 00:41:45,873 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-30 00:41:45,873 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-30 00:41:45,874 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-30 00:41:45,874 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-30 00:41:45,874 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-30 00:41:45,874 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-30 00:41:45,875 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-30 00:41:45,875 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-30 00:41:45,875 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-30 00:41:45,875 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-30 00:41:45,876 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=0)
2025-10-30 00:41:45,876 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=None)
2025-10-30 00:41:45,876 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-30 00:41:45,876 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=0)
2025-10-30 00:41:45,876 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 0, "day": 1, "flags": [], "inventory": [], "lore": {}, "memory_layers": [], "metrics": {"corruption": 10, "glitch": 12, "knowledge": 45, "major_event_last_turn": null, "major_events_triggered": 0, "major_flag_set": false, "morale": 50, "order": 50, "resources": 40, "risk_applied_total": 0}, "npc_fragments": {}, "npc_trust": {}, "player": {"inventory": ["oil lamp", "patched shield"], "name": "The Shieldbe...
2025-10-30 00:41:45,876 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:41:45,876 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:41:45,877 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=1, seed=12345, current_glitch=12)
2025-10-30 00:41:45,877 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:41:45,877 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=12, delta=1, limits=(0, 100) (cause=glitch:cosmetic_noise)
2025-10-30 00:41:45,877 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 13, 'cause': 'glitch:cosmetic_noise'}
2025-10-30 00:41:45,877 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 12 to 13 (cause=glitch:cosmetic_noise)
2025-10-30 00:41:45,877 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=50, delta=-1, limits=(0, 100) (cause=glitch:unease)
2025-10-30 00:41:45,877 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': -1, 'value': 49, 'cause': 'glitch:unease'}
2025-10-30 00:41:45,877 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 50 to 49 (cause=glitch:unease)
2025-10-30 00:41:45,878 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=7, triggered_loss=False
2025-10-30 00:41:45,878 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 50, 'morale': 49, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 13, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:41:45,878 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Minor static ripples along the parapets.']
2025-10-30 00:41:45,878 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=7, triggered_loss=False
2025-10-30 00:41:45,878 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 50, 'morale': 49, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 13, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:41:45,878 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=13, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-30 00:41:45,878 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 12, 'cause': 'turn_recovery'}
2025-10-30 00:41:45,878 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 13 to 12 (cause=turn_recovery)
2025-10-30 00:41:45,879 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 50, 'morale': 49, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:41:45,879 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=7, triggered_loss=False
2025-10-30 00:41:45,879 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 50, 'morale': 49, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:41:45,879 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-30 00:41:45,879 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 0 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}
Recent events: none
Recent motifs: none
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 50, "morale": 49, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-30 00:41:45,880 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 0 in room entrance
2025-10-30 00:41:45,880 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {\"order\": 50, \"morale\": 49, \"r...
2025-10-30 00:41:45,880 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-30 00:41:45,880 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 50, "morale": 49, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'dawn', 'previous_atmosphere': 'low clouds hug the battlements', 'previous_sensory_details': 'Drums thud beyond the walls while the wind carries grit.'}
2025-10-30 00:41:54,958 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Dawn'thin clouds cloak the battlements, a time of subtle light.", 'sensory_details': 'The air is cool and crisp; one can hear distant drums echoing while grit scrapes against stone.'}
2025-10-30 00:41:54,959 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Dawn hin clouds cloak the battlements, a time of subtle light.', 'sensory_details': 'The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone.'}
2025-10-30 00:41:54,959 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-30 00:41:54,959 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn hin clouds cloak the battlements, a time of subtle light.", "sensory_details": "The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone."}
2025-10-30 00:42:01,612 [INFO] fortress_director.agents.creativity_agent: CreativityAgent LLM rewrite applied.
2025-10-30 00:42:01,613 [INFO] fortress_director.orchestrator.orchestrator: CreativityAgent modified context: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 50, "morale": 49, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'dawn', 'previous_atmosphere': 'low clouds hug the battlements', 'previous_sensory_details': 'Drums thud beyond the walls while the wind carries grit.', 'creativity_layer': "Sure, here's the rewritten prompt:\n\nI'm trapped in a labyrinth of mirrors, my reflection mocking me with secrets I long to uncover.", 'motif_injected': None}
2025-10-30 00:42:01,613 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 00:42:08,308 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The prompt does not introduce any new mysteries or motifs that contradict known facts.'}
2025-10-30 00:42:08,308 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The prompt does not introduce any new mysteries or motifs that contradict known facts.'}
2025-10-30 00:42:08,308 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {\"order\": 50, \...
2025-10-30 00:42:08,308 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-30 00:42:08,309 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 50, "morale": 49, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'dawn', 'previous_atmosphere': 'low clouds hug the battlements', 'previous_sensory_details': 'Drums thud beyond the walls while the wind carries grit.', 'creativity_layer': "Sure, here's the rewritten prompt:\n\nI'm trapped in a labyrinth of mirrors, my reflection mocking me with secrets I long to uncover.", 'motif_injected': None}, 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': 'none', 'world_constraint_from_prev_turn': '{"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}', 'recent_motifs': 'none', 'lore_continuity_weight': 0, 'memory_layers': [], 'judge_verdict': '{}', 'judge_feedback': {}, 'continuity_weight': 0.0, 'skip_major': False}
2025-10-30 00:42:41,278 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': 'The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyond the walls continue their relentless thudding, punctuated by the occasional gust of wind carrying grit.', 'options': [{'id': '1', 'text': 'Approach the Shieldbearer and ask about the drums you hear.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Ignite your oil lamp to illuminate the entrance further.', 'action_type': 'item_use'}, {'id': '3', 'text': 'Take a moment to study the battlements, searching for any weaknesses.', 'action_type': 'exploration'}], 'major_event': False, 'safe_functions': []}
2025-10-30 00:42:41,278 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': 'The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyond the walls continue their relentless thudding, punctuated by the occasional gust of wind carrying grit.', 'options': [{'id': '1', 'text': 'Approach the Shieldbearer and ask about the drums you hear.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Ignite your oil lamp to illuminate the entrance further.', 'action_type': 'item_use'}, {'id': '3', 'text': 'Take a moment to study the battlements, searching for any weaknesses.', 'action_type': 'exploration'}], 'major_event': False, 'safe_functions': []}
2025-10-30 00:42:41,278 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-30 00:42:41,278 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialogue", "id": "1", "text": "Approach the Shieldbearer and ask about the drums you hear."}, {"action_type": "item_use", "id": "2", "text": "Ignite your oil lamp to illuminate the entrance further."}, {"action_type": "exploration", "id": "3", "text": "Take a moment to study the battlements, searching for any weaknesses."}], "safe_functions": [], "scene": "The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. T...
2025-10-30 00:42:41,278 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 00:42:47,918 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene accurately reflects the Shieldbearer's state of exhaustion and the atmospheric conditions."}
2025-10-30 00:42:47,918 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene accurately reflects the Shieldbearer's state of exhaustion and the atmospheric conditions."}
2025-10-30 00:42:47,918 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-30 00:42:47,918 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': '1', 'text': 'Approach the Shieldbearer and ask about the drums you hear.', 'action_type': 'dialogue'}
2025-10-30 00:42:47,918 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialogue", "id": "1", "text": "Approach the Shieldbearer and ask about the drums you hear."}
2025-10-30 00:42:47,919 [INFO] fortress_director.orchestrator.orchestrator: Added motif: communication
2025-10-30 00:42:47,919 [INFO] fortress_director.orchestrator.orchestrator: Applying dynamic metrics for action_type 'dialogue': {'morale': 1, 'knowledge': 2}
2025-10-30 00:42:47,919 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=49, delta=1, limits=(0, 100) (cause=action_dialogue)
2025-10-30 00:42:47,919 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 50, 'cause': 'action_dialogue'}
2025-10-30 00:42:47,919 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 49 to 50 (cause=action_dialogue)
2025-10-30 00:42:47,919 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'knowledge': current=45, delta=2, limits=(0, 100) (cause=action_dialogue)
2025-10-30 00:42:47,919 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'knowledge', 'delta': 2, 'value': 47, 'cause': 'action_dialogue'}
2025-10-30 00:42:47,920 [INFO] fortress_director.utils.metrics_manager: Metric 'knowledge' updated from 45 to 47 (cause=action_dialogue)
2025-10-30 00:42:47,920 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after dynamic changes: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:42:47,920 [INFO] fortress_director.orchestrator.orchestrator: Action consequence: Your words strengthen village bonds and reveal useful information.
2025-10-30 00:42:47,920 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {\"order\": 50, \"morale\": 49, \"r...
2025-10-30 00:42:47,920 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-30 00:42:47,921 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 50, "morale": 49, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': 'The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyond the walls continue their relentless thudding, punctuated by the occasional gust of wind carrying grit.', 'player_choice': 'Approach the Shieldbearer and ask about the drums you hear.', 'atmosphere': 'Dawn hin clouds cloak the battlements, a time of subtle light.', 'sensory_details': 'The air is cool and crisp one can hear distant drums echoing while grit scrapes against stone.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player; Boris weighs every trade.', 'player_inventory_brief': 'oil lamp, patched shield', 'memory_layers': [], 'recent_events': 'none', 'last_major_event': False}
2025-10-30 00:42:56,202 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'The wind whispers through the clouds, carrying the echoes of distant drums. A sense of anticipation hangs in the air.'}
2025-10-30 00:42:56,202 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'The wind whispers through the clouds, carrying the echoes of distant drums. A sense of anticipation hangs in the air.', 'effects': {}, 'safe_functions': []}]
2025-10-30 00:42:56,203 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-30 00:42:56,203 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "stand_vigilance", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "The wind whispers through the clouds, carrying the echoes of distant drums. A sense of anticipation hangs in the air."}]
2025-10-30 00:42:56,203 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-30 00:42:56,203 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-30 00:42:56,203 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-30 00:42:56,203 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "stand_vigilance", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "The wind whispers through the clouds, carrying the echoes of distant drums. A sense of anticipation hangs in the air."}]
2025-10-30 00:42:56,203 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-30 00:42:56,203 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 0, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': [], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 0, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': [], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'low clouds hug the battlements', 'sensory_details': 'Drums thud beyond the walls while the wind carries grit.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}, 'previous_judge_verdict': {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene accurately reflects the Shieldbearer's state of exhaustion and the atmospheric conditions.", 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}}
2025-10-30 00:42:56,203 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'The wind whispers through the clouds, carrying the echoes of distant drums. A sense of anticipation hangs in the air.', 'effects': {}, 'safe_functions': []}]
2025-10-30 00:42:56,203 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 0 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}
Recent events: none
Recent motifs: none
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 50, "morale": 49, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyond the walls continue their relentless thudding, punctuated by the occasional gust of wind carrying grit., player_choice: {'id': '1', 'text': 'Approach the Shieldbearer and ask about the drums you hear.', 'action_type': 'dialogue'}
2025-10-30 00:42:56,203 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-30 00:42:56,203 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'The wind whispers through the clouds, carrying the echoes of distant drums. A sense of anticipation hangs in the air.', 'effects': {}, 'safe_functions': []}
2025-10-30 00:42:56,203 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-30 00:42:56,203 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 00:43:02,975 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for the context of a defender observing the drums.'}
2025-10-30 00:43:02,976 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for the context of a defender observing the drums.'}
2025-10-30 00:43:02,976 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for the context of a defender observing the drums.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-30 00:43:02,976 [INFO] fortress_director.rules.rules_engine: Tier two validation passed with penalties: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-30 00:43:02,977 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-10-30 00:43:02,977 [INFO] fortress_director.rules.rules_engine: Choice impact applied: knowledge +1 (action_type=dialogue)
2025-10-30 00:43:02,977 [INFO] fortress_director.rules.rules_engine: Judge penalties applied: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-30 00:43:02,977 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-30 00:43:02,977 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 0, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': [], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 0, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': [], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'low clouds hug the battlements', 'sensory_details': 'Drums thud beyond the walls while the wind carries grit.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 48, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}, 'previous_judge_verdict': {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene accurately reflects the Shieldbearer's state of exhaustion and the atmospheric conditions.", 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['dialogue'], 'summary_text': 'The day passes quietly.'}
2025-10-30 00:43:02,978 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=1)
2025-10-30 00:43:02,978 [INFO] fortress_director.orchestrator.orchestrator: Applying 2 autonomous actions
2025-10-30 00:43:02,978 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=50, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-10-30 00:43:02,978 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': 1, 'value': 51, 'cause': 'autonomous_Rhea'}
2025-10-30 00:43:02,978 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 50 to 51 (cause=autonomous_Rhea)
2025-10-30 00:43:02,979 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=50, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-10-30 00:43:02,979 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 51, 'cause': 'autonomous_Rhea'}
2025-10-30 00:43:02,979 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 50 to 51 (cause=autonomous_Rhea)
2025-10-30 00:43:02,979 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'resources': current=40, delta=1, limits=(0, 120) (cause=autonomous_Boris)
2025-10-30 00:43:02,979 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'resources', 'delta': 1, 'value': 41, 'cause': 'autonomous_Boris'}
2025-10-30 00:43:02,979 [INFO] fortress_director.utils.metrics_manager: Metric 'resources' updated from 40 to 41 (cause=autonomous_Boris)
2025-10-30 00:43:02,979 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=51, delta=1, limits=(0, 100) (cause=autonomous_Boris)
2025-10-30 00:43:02,979 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 52, 'cause': 'autonomous_Boris'}
2025-10-30 00:43:02,979 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 51 to 52 (cause=autonomous_Boris)
2025-10-30 00:43:02,980 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-30 00:43:02,980 [INFO] fortress_director.orchestrator.orchestrator: Advanced time to morning
2025-10-30 00:43:02,980 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: []
2025-10-30 00:43:02,980 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-10-30 00:43:02,980 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 1, "day": 1, "flags": [], "inventory": [], "lore": {}, "memory_layers": [], "memory_long": [], "memory_short": ["Turn 1: Approach the Shieldbearer and ask about the drums you hear. -> The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The l..."], "metrics": {"corruption": 10, "glitch": 12, "knowledge": 48, "major_event_last_turn": null, "major_events_triggered"...
2025-10-30 00:43:02,981 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=1)
2025-10-30 00:43:02,981 [INFO] fortress_director.orchestrator.orchestrator: Injected test safe function to trigger rollback: spawn_item('undefined')
2025-10-30 00:43:02,981 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-30 00:43:02,981 [WARNING] fortress_director.orchestrator.orchestrator: Failed to parse safe function call 'spawn_item('undefined')': spawn_item requires item_id and target
2025-10-30 00:43:02,981 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-30 00:43:02,982 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=1)
2025-10-30 00:43:02,982 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=1)
2025-10-30 00:43:02,982 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=1)
2025-10-30 00:43:02,982 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 51, 'morale': 52, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:43:02,983 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 51, 'morale': 52, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:43:02,983 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'conditions_not_met', 'description': 'Oyun devam ediyor...'}
2025-10-30 00:43:02,983 [INFO] fortress_director.orchestrator.orchestrator: Turn summary: The day passes quietly.
2025-10-30 00:43:02,983 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-30 00:43:02,985 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {\"order\": 50, \"morale\": 49, \"r...
2025-10-30 00:43:02,985 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-30 00:43:02,985 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
