2025-10-29 14:14:53,285 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_111453.log)
2025-10-29 14:14:53,285 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_111453.log)
2025-10-29 14:14:53,285 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_111453.log
2025-10-29 14:14:53,304 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-29 14:14:53,314 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-29 14:14:53,314 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-29 14:14:53,314 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-29 14:14:53,314 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-29 14:14:53,314 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-29 14:14:53,314 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-29 14:14:53,314 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-29 14:14:53,314 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-29 14:14:53,314 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-29 14:14:53,314 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-29 14:14:53,315 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-29 14:14:53,315 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-29 14:14:53,315 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-29 14:14:53,315 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-29 14:14:53,315 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-29 14:14:53,315 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-29 14:14:53,315 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-29 14:14:53,315 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-29 14:14:53,315 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-29 14:14:53,316 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-29 14:14:53,316 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-29 14:14:53,316 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=21)
2025-10-29 14:14:53,316 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=21, call=None)
2025-10-29 14:14:53,316 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-29 14:14:53,316 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=21)
2025-10-29 14:14:53,316 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "keep", "current_turn": 21, "day": 5, "final_summary": "Defeat - turn_limit_exceeded | Morale: 57, Order: 40, Resources: 24 | Glitch level: 49, Major events: 5 | Last major event: turn 15 | Notable characters: Rhea is loyal but impulsive; Boris is cautious and calculating.", "finalized": true, "flags": ["major_injected_event", "atmosphere_change", "major_wall_alert", "atmosphere", "mystery_figure", "character_movement_detected", "f...
2025-10-29 14:14:53,316 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 40, 'morale': 56, 'resources': 24, 'knowledge': 55, 'corruption': 10, 'glitch': 48, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}
2025-10-29 14:14:53,316 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 40, 'morale': 56, 'resources': 24, 'knowledge': 55, 'corruption': 10, 'glitch': 48, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}
2025-10-29 14:14:53,317 [INFO] fortress_director.utils.glitch_manager: Game finalized, skipping glitch resolution
2025-10-29 14:14:53,317 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=0, triggered_loss=False
2025-10-29 14:14:53,317 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 40, 'morale': 56, 'resources': 24, 'knowledge': 55, 'corruption': 10, 'glitch': 48, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}
2025-10-29 14:14:53,317 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=48, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-29 14:14:53,317 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 47, 'cause': 'turn_recovery'}
2025-10-29 14:14:53,317 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 48 to 47 (cause=turn_recovery)
2025-10-29 14:14:53,317 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 40, 'morale': 56, 'resources': 24, 'knowledge': 55, 'corruption': 10, 'glitch': 47, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}
2025-10-29 14:14:53,317 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=0, triggered_loss=False
2025-10-29 14:14:53,317 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 40, 'morale': 56, 'resources': 24, 'knowledge': 55, 'corruption': 10, 'glitch': 47, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}
2025-10-29 14:14:53,318 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-29 14:14:53,318 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 21 | Day 5 | Time morning
Location: keep
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn's light gently warms Lornhaven, a serene calm overcourtyard.", "sensory_details": "The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude."}
Recent events: The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven, serene calm over the courtyard. The crisp air carries the distant clank...; The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven's battlements, where the cool stone underfoot contrasts with the warmth ...; The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing closer. The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks... Recent motifs: communication, social_interaction, unknown_action
Recent major events: none
Relationship summary: Rhea trusts the player deeply
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 40, "morale": 56, "resources": 24, "knowledge": 55, "corruption": 10, "glitch": 47, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 5, "major_event_last_turn": 14}
2025-10-29 14:14:53,318 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 21 in room keep
2025-10-29 14:14:53,318 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 21 | Day 5 | Time morning\nLocation: keep\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn's light gently warms Lornhaven, a serene calm overcourtyard.\", \"sensory_details\": \"The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude.\"}\nRecent events: The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lo...
2025-10-29 14:14:53,318 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-29 14:14:53,318 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 21 | Day 5 | Time morning\nLocation: keep\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn\'s light gently warms Lornhaven, a serene calm overcourtyard.", "sensory_details": "The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude."}\nRecent events: The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven, serene calm over the courtyard. The crisp air carries the distant clank...; The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven\'s battlements, where the cool stone underfoot contrasts with the warmth ...; The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing closer. The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks... Recent motifs: communication, social_interaction, unknown_action\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 40, "morale": 56, "resources": 24, "knowledge": 55, "corruption": 10, "glitch": 47, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 5, "major_event_last_turn": 14}', 'room': 'keep', 'time': 'morning'}
2025-10-29 14:15:00,693 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Morning light warms Lornhaven'th serene courtyard.", 'sensory_details': 'The cool stone underfoot contrasts with the warm sunlight, while distant armor clinks and boots rustle softly against a backdrop of quietude.'}
2025-10-29 14:15:00,694 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Morning light warms Lornhaven h serene courtyard.', 'sensory_details': 'The cool stone underfoot contrasts with the warm sunlight, while distant armor clinks and boots rustle softly against a backdrop of quietude.'}
2025-10-29 14:15:00,694 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-29 14:15:00,694 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Morning light warms Lornhaven h serene courtyard.", "sensory_details": "The cool stone underfoot contrasts with the warm sunlight, while distant armor clinks and boots rustle softly against a backdrop of quietude."}
2025-10-29 14:15:00,694 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 21 | Day 5 | Time morning\nLocation: keep\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn's light gently warms Lornhaven, a serene calm overcourtyard.\", \"sensory_details\": \"The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude.\"}\nRecent events: The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lo...
2025-10-29 14:15:00,694 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-29 14:15:00,694 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 21 | Day 5 | Time morning\nLocation: keep\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn\'s light gently warms Lornhaven, a serene calm overcourtyard.", "sensory_details": "The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude."}\nRecent events: The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven, serene calm over the courtyard. The crisp air carries the distant clank...; The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven\'s battlements, where the cool stone underfoot contrasts with the warmth ...; The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing closer. The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks... Recent motifs: communication, social_interaction, unknown_action\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 40, "morale": 56, "resources": 24, "knowledge": 55, "corruption": 10, "glitch": 47, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 5, "major_event_last_turn": 14}', 'day': 5, 'time': 'morning', 'room': 'keep', 'recent_events': "The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven, serene calm over the courtyard. The crisp air carries the distant clank...; The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven's battlements, where the cool stone underfoot contrasts with the warmth ...; The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing closer. The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks...", 'world_constraint_from_prev_turn': '{"atmosphere": "Dawn\'s light gently warms Lornhaven, a serene calm overcourtyard.", "sensory_details": "The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude."}', 'recent_motifs': 'communication, social_interaction, unknown_action', 'lore_continuity_weight': 5, 'memory_layers': ['Memory summary: Turn 16: Ask Rhea about the movement she just noticed. -> The Shieldbearer, standing watch on the battlements, notices a flicker of movement in the distance. ... | Turn 17: Ask Rhea what she has seen ...', 'Turn 19: Investigate the figure in the distance. -> The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts...', 'Turn 20: Investigate the figure in the distance. -> The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts...', 'Turn 21: Investigate the figure as it draws nearer, ready to defend if necessary. -> The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing clos...', 'Memory summary: Turn 19: Investigate the figure in the distance. -> The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts... | Turn 20: Investigate the figure in the dis...'], 'judge_verdict': '{"consistent": true, "reason": "The content is consistent with the established world, lore, and character logic. The scene described by the player matches the typical setting for a night watch in Lornhaven.", "coherence": 100, "integrity": 100, "tone_alignment": 100, "penalty_applied": "none", "penalty_magnitude": {}, "feedback": {}}', 'judge_feedback': {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene described by the player matches the typical setting for a night watch in Lornhaven.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'skip_major': False}
2025-10-29 14:15:28,068 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': 'The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing closer. The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude.', 'options': [{'id': 'investigate_figure', 'text': 'Investigate the figure as it draws nearer, ready to defend if necessary.', 'action_type': 'interactive'}, {'id': 'signal_for_backup', 'text': 'Signal for backup, preparing for potential danger.', 'action_type': 'interactive'}, {'id': 'remain_vigilant', 'text': 'Remain vigilant and continue watching the horizon.', 'action_type': 'passive'}], 'major_event': False, 'safe_functions': []}
2025-10-29 14:15:28,068 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': 'The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing closer. The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude.', 'options': [{'id': 'investigate_figure', 'text': 'Investigate the figure as it draws nearer, ready to defend if necessary.', 'action_type': 'interactive'}, {'id': 'signal_for_backup', 'text': 'Signal for backup, preparing for potential danger.', 'action_type': 'interactive'}, {'id': 'remain_vigilant', 'text': 'Remain vigilant and continue watching the horizon.', 'action_type': 'passive'}], 'major_event': False, 'safe_functions': []}
2025-10-29 14:15:28,068 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-29 14:15:28,068 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "interactive", "id": "investigate_figure", "text": "Investigate the figure as it draws nearer, ready to defend if necessary."}, {"action_type": "interactive", "id": "signal_for_backup", "text": "Signal for backup, preparing for potential danger."}, {"action_type": "passive", "id": "remain_vigilant", "text": "Remain vigilant and continue watching the horizon."}], "safe_functions": [], "scene": "The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing closer. The cool stone underfoot contrasts with the w...
2025-10-29 14:15:28,069 [INFO] fortress_director.orchestrator.orchestrator: Using previous judge verdict (turn 21)
2025-10-29 14:15:28,069 [INFO] fortress_director.orchestrator.orchestrator: Added trust-based option: ask_rhea_personal_help (trust=5)
2025-10-29 14:15:28,069 [INFO] fortress_director.orchestrator.orchestrator: Added motif-based option: diplomacy_approach (motif active)
2025-10-29 14:15:28,069 [INFO] fortress_director.orchestrator.orchestrator: Added time-sensitive option: strategic_planning (turn=21)
2025-10-29 14:15:28,069 [INFO] fortress_director.orchestrator.orchestrator: Added time-sensitive option: emergency_measures (turn=21)
2025-10-29 14:15:28,069 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-29 14:15:28,069 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'investigate_figure', 'text': 'Investigate the figure as it draws nearer, ready to defend if necessary.', 'action_type': 'interactive'}
2025-10-29 14:15:28,070 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "interactive", "id": "investigate_figure", "text": "Investigate the figure as it draws nearer, ready to defend if necessary."}
2025-10-29 14:15:28,070 [DEBUG] fortress_director.orchestrator.orchestrator: No dynamic metrics for action_type 'interactive'
2025-10-29 14:15:28,070 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 21 | Day 5 | Time morning\nLocation: keep\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn's light gently warms Lornhaven, a serene calm overcourtyard.\", \"sensory_details\": \"The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude.\"}\nRecent events: The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lo...
2025-10-29 14:15:28,070 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-29 14:15:28,070 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 21 | Day 5 | Time morning\nLocation: keep\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn\'s light gently warms Lornhaven, a serene calm overcourtyard.", "sensory_details": "The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude."}\nRecent events: The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven, serene calm over the courtyard. The crisp air carries the distant clank...; The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven\'s battlements, where the cool stone underfoot contrasts with the warmth ...; The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing closer. The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks... Recent motifs: communication, social_interaction, unknown_action\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 40, "morale": 56, "resources": 24, "knowledge": 55, "corruption": 10, "glitch": 47, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 5, "major_event_last_turn": 14}', 'scene_short': 'The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing closer. The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude.', 'player_choice': 'Investigate the figure as it draws nearer, ready to defend if necessary.', 'atmosphere': 'Morning light warms Lornhaven h serene courtyard.', 'sensory_details': 'The cool stone underfoot contrasts with the warm sunlight, while distant armor clinks and boots rustle softly against a backdrop of quietude.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player deeply', 'player_inventory_brief': 'oil lamp, patched shield', 'memory_layers': ['Memory summary: Turn 16: Ask Rhea about the movement she just noticed. -> The Shieldbearer, standing watch on the battlements, notices a flicker of movement in the distance. ... | Turn 17: Ask Rhea what she has seen ...', 'Turn 19: Investigate the figure in the distance. -> The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts...', 'Turn 20: Investigate the figure in the distance. -> The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts...', 'Turn 21: Investigate the figure as it draws nearer, ready to defend if necessary. -> The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing clos...', 'Memory summary: Turn 19: Investigate the figure in the distance. -> The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts... | Turn 20: Investigate the figure in the dis...'], 'recent_events': "The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven, serene calm over the courtyard. The crisp air carries the distant clank...; The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven's battlements, where the cool stone underfoot contrasts with the warmth ...; The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing closer. The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks...", 'last_major_event': False}
2025-10-29 14:15:38,697 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Rhea', 'intent': 'observe', 'action': 'wait_for_light', 'speech': 'I stand vigilant, ready to defend if necessary.', 'effects': {'trust_delta': 100, 'flag_set': ['keep_watching'], 'item_change': None, 'status_change': None}}
2025-10-29 14:15:38,697 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Rhea', 'intent': 'observe', 'action': 'wait_for_light', 'speech': 'I stand vigilant, ready to defend if necessary.', 'effects': {'trust_delta': 1, 'flag_set': ['keep_watching']}, 'safe_functions': []}]
2025-10-29 14:15:38,698 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-29 14:15:38,698 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "wait_for_light", "effects": {"flag_set": ["keep_watching"], "trust_delta": 1}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "I stand vigilant, ready to defend if necessary."}]
2025-10-29 14:15:38,698 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-29 14:15:38,698 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-29 14:15:38,698 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-29 14:15:38,698 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "wait_for_light", "effects": {"flag_set": ["keep_watching"], "trust_delta": 1}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "I stand vigilant, ready to defend if necessary."}]
2025-10-29 14:15:38,698 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-29 14:15:38,698 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 21, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['major_injected_event', 'atmosphere_change', 'major_wall_alert', 'atmosphere', 'mystery_figure', 'character_movement_detected', 'force_major_event'], 'memory_layers': ['Memory summary: Turn 16: Ask Rhea about the movement she just noticed. -> The Shieldbearer, standing watch on the battlements, notices a flicker of movement in the distance. ... | Turn 17: Ask Rhea what she has seen ...', 'Turn 19: Investigate the figure in the distance. -> The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts...', 'Turn 20: Investigate the figure in the distance. -> The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts...', 'Turn 21: Investigate the figure as it draws nearer, ready to defend if necessary. -> The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing clos...', 'Memory summary: Turn 19: Investigate the figure in the distance. -> The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts... | Turn 20: Investigate the figure in the dis...'], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 21, 'day': 5, 'time': 'morning', 'current_room': 'keep', 'recent_events': ['The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven, serene calm over the courtyard. The crisp air carries the distant clank...', "The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven's battlements, where the cool stone underfoot contrasts with the warmth ...", 'The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing closer. The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks...'], 'recent_motifs': ['communication', 'social_interaction', 'unknown_action'], 'world_constraint_from_prev_turn': {'atmosphere': "Dawn's light gently warms Lornhaven, a serene calm overcourtyard.", 'sensory_details': 'The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player deeply', 'metrics': {'order': 40, 'morale': 56, 'resources': 24, 'knowledge': 55, 'corruption': 10, 'glitch': 47, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}, 'npc_trust': {'Rhea': 5}, 'previous_judge_verdict': {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene described by the player matches the typical setting for a night watch in Lornhaven.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['social_interaction', 'communication', 'communication', 'communication', 'communication', 'communication', 'communication', 'exploration', 'exploration', 'physical'], 'summary_text': 'A major event shakes the village.', 'status_effects': [], 'world_constraint': {'atmosphere': 'A faint drizzle begins to fall.', 'sensory_details': 'Tiny raindrops patter on the stone, cooling the air.'}, 'safe_function_injected': True, 'major_events_triggered': 5, 'major_event_last_turn': 15, 'npc_locations': {'Boris': 'battlements'}, 'finalized': True, 'final_summary': 'Defeat - turn_limit_exceeded | Morale: 57, Order: 40, Resources: 24 | Glitch level: 49, Major events: 5 | Last major event: turn 15 | Notable characters: Rhea is loyal but impulsive; Boris is cautious and calculating.'}
2025-10-29 14:15:38,700 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'observe', 'action': 'wait_for_light', 'speech': 'I stand vigilant, ready to defend if necessary.', 'effects': {'trust_delta': 1, 'flag_set': ['keep_watching']}, 'safe_functions': []}]
2025-10-29 14:15:38,700 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 21 | Day 5 | Time morning
Location: keep
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn's light gently warms Lornhaven, a serene calm overcourtyard.", "sensory_details": "The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude."}
Recent events: The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven, serene calm over the courtyard. The crisp air carries the distant clank...; The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven's battlements, where the cool stone underfoot contrasts with the warmth ...; The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing closer. The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks... Recent motifs: communication, social_interaction, unknown_action
Recent major events: none
Relationship summary: Rhea trusts the player deeply
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 40, "morale": 56, "resources": 24, "knowledge": 55, "corruption": 10, "glitch": 47, "risk_applied_total": 0, "major_flag_set": true, "major_events_triggered": 5, "major_event_last_turn": 14}, scene: The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing closer. The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude., player_choice: {'id': 'investigate_figure', 'text': 'Investigate the figure as it draws nearer, ready to defend if necessary.', 'action_type': 'interactive'}
2025-10-29 14:15:38,700 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-29 14:15:38,700 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'observe', 'action': 'wait_for_light', 'speech': 'I stand vigilant, ready to defend if necessary.', 'effects': {'trust_delta': 1, 'flag_set': ['keep_watching']}, 'safe_functions': []}
2025-10-29 14:15:38,700 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-29 14:15:38,700 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-29 14:15:45,363 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the established atmosphere and events in Lornhaven.'}
2025-10-29 14:15:45,363 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the established atmosphere and events in Lornhaven.'}
2025-10-29 14:15:45,363 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the established atmosphere and events in Lornhaven.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-29 14:15:45,363 [INFO] fortress_director.rules.rules_engine: Tier two validation passed with penalties: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-29 14:15:45,363 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {'trust_delta': 1, 'flag_set': ['keep_watching']}
2025-10-29 14:15:45,363 [INFO] fortress_director.rules.rules_engine: Trust updated for Rhea: 5 -> 5 (delta: 1)
2025-10-29 14:15:45,363 [INFO] fortress_director.rules.rules_engine: Relationship summary updated: Rhea trusts the player deeply
2025-10-29 14:15:45,363 [INFO] fortress_director.rules.rules_engine: Judge penalties applied: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-29 14:15:45,363 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-29 14:15:45,363 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 21, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['major_injected_event', 'atmosphere_change', 'major_wall_alert', 'atmosphere', 'mystery_figure', 'character_movement_detected', 'force_major_event', 'keep_watching'], 'memory_layers': ['Memory summary: Turn 16: Ask Rhea about the movement she just noticed. -> The Shieldbearer, standing watch on the battlements, notices a flicker of movement in the distance. ... | Turn 17: Ask Rhea what she has seen ...', 'Turn 19: Investigate the figure in the distance. -> The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts...', 'Turn 20: Investigate the figure in the distance. -> The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts...', 'Turn 21: Investigate the figure as it draws nearer, ready to defend if necessary. -> The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing clos...', 'Memory summary: Turn 19: Investigate the figure in the distance. -> The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts... | Turn 20: Investigate the figure in the dis...'], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 21, 'day': 5, 'time': 'morning', 'current_room': 'keep', 'recent_events': ['The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven, serene calm over the courtyard. The crisp air carries the distant clank...', "The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lornhaven's battlements, where the cool stone underfoot contrasts with the warmth ...", 'The Shieldbearer, standing watch on the battlements, notices the figure in the distance growing closer. The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks...'], 'recent_motifs': ['communication', 'social_interaction', 'unknown_action'], 'world_constraint_from_prev_turn': {'atmosphere': "Dawn's light gently warms Lornhaven, a serene calm overcourtyard.", 'sensory_details': 'The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player deeply', 'metrics': {'order': 40, 'morale': 56, 'resources': 24, 'knowledge': 55, 'corruption': 10, 'glitch': 47, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}, 'npc_trust': {'Rhea': 5}, 'previous_judge_verdict': {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene described by the player matches the typical setting for a night watch in Lornhaven.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['communication', 'communication', 'communication', 'communication', 'communication', 'communication', 'exploration', 'exploration', 'physical', 'interactive'], 'summary_text': 'A major event shakes the village.', 'status_effects': [], 'world_constraint': {'atmosphere': 'A faint drizzle begins to fall.', 'sensory_details': 'Tiny raindrops patter on the stone, cooling the air.'}, 'safe_function_injected': True, 'major_events_triggered': 5, 'major_event_last_turn': 15, 'npc_locations': {'Boris': 'battlements'}, 'finalized': True, 'final_summary': 'Defeat - turn_limit_exceeded | Morale: 57, Order: 40, Resources: 24 | Glitch level: 49, Major events: 5 | Last major event: turn 15 | Notable characters: Rhea is loyal but impulsive; Boris is cautious and calculating.'}
2025-10-29 14:15:45,363 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=22)
2025-10-29 14:15:45,363 [INFO] fortress_director.orchestrator.orchestrator: Applying 1 autonomous actions
2025-10-29 14:15:45,363 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'resources': current=24, delta=1, limits=(0, 120) (cause=autonomous_Boris)
2025-10-29 14:15:45,363 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'resources', 'delta': 1, 'value': 25, 'cause': 'autonomous_Boris'}
2025-10-29 14:15:45,363 [INFO] fortress_director.utils.metrics_manager: Metric 'resources' updated from 24 to 25 (cause=autonomous_Boris)
2025-10-29 14:15:45,363 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-29 14:15:45,363 [INFO] fortress_director.orchestrator.orchestrator: Advanced time to afternoon
2025-10-29 14:15:45,363 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: []
2025-10-29 14:15:45,363 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-10-29 14:15:45,363 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "keep", "current_turn": 22, "day": 5, "final_summary": "Defeat - turn_limit_exceeded | Morale: 57, Order: 40, Resources: 24 | Glitch level: 49, Major events: 5 | Last major event: turn 15 | Notable characters: Rhea is loyal but impulsive; Boris is cautious and calculating.", "finalized": true, "flags": ["major_injected_event", "atmosphere_change", "major_wall_alert", "atmosphere", "mystery_figure", "character_movement_detected", "f...
2025-10-29 14:15:45,363 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=22)
2025-10-29 14:15:45,363 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-29 14:15:45,363 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-29 14:15:45,363 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=22)
2025-10-29 14:15:45,363 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=22)
2025-10-29 14:15:45,363 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 40, 'morale': 56, 'resources': 24, 'knowledge': 55, 'corruption': 10, 'glitch': 47, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}
2025-10-29 14:15:45,363 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 40, 'morale': 56, 'resources': 24, 'knowledge': 55, 'corruption': 10, 'glitch': 47, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 5, 'major_event_last_turn': 14}
2025-10-29 14:15:45,363 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'loss', 'reason': 'turn_limit_exceeded', 'description': '20 tur limit aşıldı!'}
2025-10-29 14:15:45,363 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=22)
2025-10-29 14:15:45,363 [INFO] fortress_director.orchestrator.orchestrator: Game finalized, state persisted.
2025-10-29 14:15:45,363 [INFO] fortress_director.orchestrator.orchestrator: Turn summary: A major event shakes the village.
2025-10-29 14:15:45,363 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-29 14:15:45,371 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 21 | Day 5 | Time morning\nLocation: keep\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn's light gently warms Lornhaven, a serene calm overcourtyard.\", \"sensory_details\": \"The cool stone underfoot contrasts with the warmth of sunlight fading away. Distant armor clinks and boots rustle softly against the backdrop of quietude.\"}\nRecent events: The Shieldbearer, standing watch on the battlements, notices a figure in the distance. The sun casts a warm glow over Lo...
2025-10-29 14:15:45,371 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-29 14:15:45,371 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
