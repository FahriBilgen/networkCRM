2025-10-27 23:04:29,936 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251027_200429.log)
2025-10-27 23:04:29,937 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251027_200429.log)
2025-10-27 23:04:29,937 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251027_200429.log
2025-10-27 23:04:29,939 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-27 23:04:29,940 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-27 23:04:29,940 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-27 23:04:29,940 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-27 23:04:29,940 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-27 23:04:29,940 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-27 23:04:29,940 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-27 23:04:29,940 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-27 23:04:29,940 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-27 23:04:29,941 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-27 23:04:29,941 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-27 23:04:29,941 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-27 23:04:29,941 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-27 23:04:29,941 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-27 23:04:29,941 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-27 23:04:29,941 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-27 23:04:29,941 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-27 23:04:29,942 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-27 23:04:29,942 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-27 23:04:29,942 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-27 23:04:29,942 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-27 23:04:29,942 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-27 23:04:29,942 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=10)
2025-10-27 23:04:29,942 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=10, call=None)
2025-10-27 23:04:29,942 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-27 23:04:29,944 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=10)
2025-10-27 23:04:29,944 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 10, "day": 1, "finalized": true, "flags": ["low_clouds_present", "atmosphere", "Dawn'thin Rain", "Dawn's Whispers"], "inventory": [], "lore": {}, "memory_layers": ["Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've...", "Turn 8: Ask the Shieldbearer if she needs assistance. -> The Shi...
2025-10-27 23:04:29,944 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 18, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:04:29,944 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 18, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:04:29,944 [INFO] fortress_director.utils.glitch_manager: Game finalized, skipping glitch resolution
2025-10-27 23:04:29,944 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=0, triggered_loss=False
2025-10-27 23:04:29,944 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 18, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:04:29,944 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=18, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-27 23:04:29,944 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 17, 'cause': 'turn_recovery'}
2025-10-27 23:04:29,944 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 18 to 17 (cause=turn_recovery)
2025-10-27 23:04:29,944 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 17, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:04:29,945 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-27 23:04:29,945 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 10 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}
Recent events: The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...
Recent motifs: none
Recent major events: none
Relationship summary: Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 17, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-27 23:04:29,945 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 10 in room entrance
2025-10-27 23:04:29,945 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 10 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn'thin rain, heavy clouds hang\", \"sensory_details\": \"Cool mist clings to stone drums beat steady rhythm\"}\nRecent events: The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the dis...
2025-10-27 23:04:29,945 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-27 23:04:29,945 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 10 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}\nRecent events: The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...\nRecent motifs: none\nRecent major events: none\nRelationship summary: Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 17, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance'}
2025-10-27 23:04:36,676 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm'}
2025-10-27 23:04:36,677 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm'}
2025-10-27 23:04:36,677 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-27 23:04:36,677 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}
2025-10-27 23:04:36,677 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 10 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn'thin rain, heavy clouds hang\", \"sensory_details\": \"Cool mist clings to stone drums beat steady rhythm\"}\nRecent events: The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the dis...
2025-10-27 23:04:36,677 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-27 23:04:36,677 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 10 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}\nRecent events: The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...\nRecent motifs: none\nRecent major events: none\nRelationship summary: Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 17, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...", 'world_constraint_from_prev_turn': '{"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}', 'recent_motifs': 'none', 'lore_continuity_weight': 0, 'memory_layers': ["Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've...", "Turn 8: Ask the Shieldbearer if she needs assistance. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've...", "Turn 9: You ask the Shieldbearer about the distant drums. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Memory summary: Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've... | Turn 8: Ask the Shieldb...", "Turn 10: You ask the Shieldbearer about her duty here at the entrance to Lornhaven. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b..."]}
2025-10-27 23:05:05,881 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As you draw closer, you notice that her shield bears the crest of House Lorn. She looks up from her vigil and regards you with a weary but determined expression.", 'options': [{'id': '1', 'text': 'Ask the Shieldbearer about the drums in the distance.', 'action_type': 'dialog'}, {'id': '2', 'text': 'Offer to take a shift from her watch.', 'action_type': 'dialog'}, {'id': '3', 'text': 'Inspect the crest on her shield.', 'action_type': 'interact'}], 'major_event': False, 'safe_functions': []}
2025-10-27 23:05:05,881 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As you draw closer, you notice that her shield bears the crest of House Lorn. She looks up from her vigil and regards you with a weary but determined expression.", 'options': [{'id': '1', 'text': 'Ask the Shieldbearer about the drums in the distance.', 'action_type': 'dialog'}, {'id': '2', 'text': 'Offer to take a shift from her watch.', 'action_type': 'dialog'}, {'id': '3', 'text': 'Inspect the crest on her shield.', 'action_type': 'interact'}], 'major_event': False, 'safe_functions': []}
2025-10-27 23:05:05,881 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-27 23:05:05,881 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialog", "id": "1", "text": "Ask the Shieldbearer about the drums in the distance."}, {"action_type": "dialog", "id": "2", "text": "Offer to take a shift from her watch."}, {"action_type": "interact", "id": "3", "text": "Inspect the crest on her shield."}], "safe_functions": [], "scene": "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As you draw closer, you notice that her shield bea...
2025-10-27 23:05:05,881 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-27 23:05:05,881 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'end', 'text': 'The campaign concludes.', 'action_type': 'end'}
2025-10-27 23:05:05,881 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "end", "id": "end", "text": "The campaign concludes."}
2025-10-27 23:05:05,882 [INFO] fortress_director.orchestrator.orchestrator: End flag detected, terminating turn early
