2025-11-01 23:48:59,411 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\planner_run_fix.log)
2025-11-01 23:48:59,411 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\planner_run_fix.log)
2025-11-01 23:48:59,411 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\planner_run_fix.log
2025-11-01 23:48:59,424 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-11-01 23:48:59,433 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-11-01 23:48:59,433 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-11-01 23:48:59,433 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-11-01 23:48:59,433 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Registering safe function: set_flag
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Safe function 'set_flag' registered successfully.
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Registering safe function: clear_flag
2025-11-01 23:48:59,434 [INFO] fortress_director.codeaware.function_registry: Safe function 'clear_flag' registered successfully.
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Registering safe function: set_trust
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Safe function 'set_trust' registered successfully.
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_trust
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_trust' registered successfully.
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Registering safe function: add_item_to_npc
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Safe function 'add_item_to_npc' registered successfully.
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Registering safe function: remove_item_from_npc
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Safe function 'remove_item_from_npc' registered successfully.
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Registering safe function: add_status
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Safe function 'add_status' registered successfully.
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Registering safe function: remove_status
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Safe function 'remove_status' registered successfully.
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_npc
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_npc' registered successfully.
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Registering safe function: despawn_npc
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Safe function 'despawn_npc' registered successfully.
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_and_take_item
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_and_take_item' registered successfully.
2025-11-01 23:48:59,435 [INFO] fortress_director.codeaware.function_registry: Registering safe function: patrol_and_report
2025-11-01 23:48:59,436 [INFO] fortress_director.codeaware.function_registry: Safe function 'patrol_and_report' registered successfully.
2025-11-01 23:48:59,436 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-11-01 23:48:59,436 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-11-01 23:48:59,436 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=4)
2025-11-01 23:48:59,436 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=4, call=None)
2025-11-01 23:48:59,436 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-11-01 23:48:59,436 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=4)
2025-11-01 23:48:59,436 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"_glitch_buffer": 0, "active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 4, "day": 1, "flags": [], "inventory": [], "lore": {}, "memory_layers": [], "memory_long": [], "memory_short": ["Turn 1: Ask the Shieldbearer about the current situation -> is the rewritten prompt: I hear whispers of a hidden room deep within the castle grounds, guarded by...", "Turn 2: Ask the Shieldbearer about the hidden room and its rumored treasure. -> is the rewritten prompt: *...
2025-11-01 23:48:59,436 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 54, 'morale': 61, 'resources': 41, 'knowledge': 51, 'corruption': 10, 'glitch': 20, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-01 23:48:59,436 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 54, 'morale': 61, 'resources': 41, 'knowledge': 51, 'corruption': 10, 'glitch': 20, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-01 23:48:59,436 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=5, seed=12345, current_glitch=20)
2025-11-01 23:48:59,436 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 54, 'morale': 61, 'resources': 41, 'knowledge': 51, 'corruption': 10, 'glitch': 20, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-01 23:48:59,436 [DEBUG] fortress_director.utils.metrics_manager: Applying bulk metric change: metric=order, delta=-2, cause=glitch:medium_anomaly
2025-11-01 23:48:59,437 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=54, delta=-2, limits=(0, 100) (cause=glitch:medium_anomaly)
2025-11-01 23:48:59,437 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': -2, 'value': 52, 'cause': 'glitch:medium_anomaly'}
2025-11-01 23:48:59,437 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 54 to 52 (cause=glitch:medium_anomaly)
2025-11-01 23:48:59,437 [DEBUG] fortress_director.utils.metrics_manager: Applying bulk metric change: metric=morale, delta=-1, cause=glitch:medium_anomaly
2025-11-01 23:48:59,437 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=61, delta=-1, limits=(0, 100) (cause=glitch:medium_anomaly)
2025-11-01 23:48:59,437 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': -1, 'value': 60, 'cause': 'glitch:medium_anomaly'}
2025-11-01 23:48:59,437 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 61 to 60 (cause=glitch:medium_anomaly)
2025-11-01 23:48:59,437 [DEBUG] fortress_director.utils.metrics_manager: Applying bulk metric change: metric=glitch, delta=2, cause=glitch:medium_anomaly
2025-11-01 23:48:59,437 [DEBUG] fortress_director.utils.metrics_manager: Glitch smoothing: requested delta=2, buffer=0, applied=2, leftover=0
2025-11-01 23:48:59,437 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=20, delta=2, limits=(0, 100) (cause=glitch:medium_anomaly)
2025-11-01 23:48:59,437 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 2, 'value': 22, 'cause': 'glitch:medium_anomaly'}
2025-11-01 23:48:59,437 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 20 to 22 (cause=glitch:medium_anomaly)
2025-11-01 23:48:59,437 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=32, triggered_loss=False
2025-11-01 23:48:59,437 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 52, 'morale': 60, 'resources': 41, 'knowledge': 51, 'corruption': 10, 'glitch': 22, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-01 23:48:59,437 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Pathfinding errors unsettle the patrol routes.']
2025-11-01 23:48:59,437 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=32, triggered_loss=False
2025-11-01 23:48:59,437 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 52, 'morale': 60, 'resources': 41, 'knowledge': 51, 'corruption': 10, 'glitch': 22, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-01 23:48:59,437 [DEBUG] fortress_director.utils.metrics_manager: Glitch smoothing: requested delta=-1, buffer=0, applied=-1, leftover=0
2025-11-01 23:48:59,437 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=22, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-11-01 23:48:59,437 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 21, 'cause': 'turn_recovery'}
2025-11-01 23:48:59,437 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 22 to 21 (cause=turn_recovery)
2025-11-01 23:48:59,437 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 52, 'morale': 60, 'resources': 41, 'knowledge': 51, 'corruption': 10, 'glitch': 21, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-01 23:48:59,437 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=32, triggered_loss=False
2025-11-01 23:48:59,439 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 52, 'morale': 60, 'resources': 41, 'knowledge': 51, 'corruption': 10, 'glitch': 21, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-01 23:48:59,440 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-11-01 23:48:59,440 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 4 | Day 1 | Time night
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Evening twilight, a serene calm oversees.", "sensory_details": "The air carries the briny tang of sea spray cool breezes rustle through damp grass."}
Recent events: The eerie stillness sent shivers down the spines of the loca...; In ... Recent motifs: communication
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 52, "morale": 60, "resources": 41, "knowledge": 51, "corruption": 10, "glitch": 21, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-11-01 23:48:59,440 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 4 in room entrance
2025-11-01 23:48:59,440 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 4 | Day 1 | Time night\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Evening twilight, a serene calm oversees.\", \"sensory_details\": \"The air carries the briny tang of sea spray cool breezes rustle through damp grass.\"}\nRecent events: The eerie stillness sent shivers down the spines of the loca...; In ... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character sum...
2025-11-01 23:48:59,440 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-11-01 23:48:59,441 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 4 | Day 1 | Time night\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Evening twilight, a serene calm oversees.", "sensory_details": "The air carries the briny tang of sea spray cool breezes rustle through damp grass."}\nRecent events: The eerie stillness sent shivers down the spines of the loca...; In ... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 52, "morale": 60, "resources": 41, "knowledge": 51, "corruption": 10, "glitch": 21, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'night', 'previous_atmosphere': 'Evening twilight, a serene calm oversees.', 'previous_sensory_details': 'The air carries the briny tang of sea spray cool breezes rustle through damp grass.'}
2025-11-01 23:49:04,278 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Nightfall'th, a tranquil hush blankets overseas.", 'sensory_details': 'The air is cool and moist with the scent of seaweed; grass feels damp underfoot as distant waves whisper against jagged rocks.'}
2025-11-01 23:49:04,278 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Nightfall h, a tranquil hush blankets overseas.', 'sensory_details': 'The air is cool and moist with the scent of seaweed grass feels damp underfoot as distant waves whisper against jagged rocks.'}
2025-11-01 23:49:04,278 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-11-01 23:49:04,278 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Nightfall h, a tranquil hush blankets overseas.", "sensory_details": "The air is cool and moist with the scent of seaweed grass feels damp underfoot as distant waves whisper against jagged rocks."}
2025-11-01 23:49:04,278 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 4 | Day 1 | Time night\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Evening twilight, a serene calm oversees.\", \"sensory_details\": \"The air carries the briny tang of sea spray cool breezes rustle through damp grass.\"}\nRecent events: The eerie stillness sent shivers down the spines of the loca...; In ... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character sum...
2025-11-01 23:49:04,278 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-11-01 23:49:04,279 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 4 | Day 1 | Time night\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Evening twilight, a serene calm oversees.", "sensory_details": "The air carries the briny tang of sea spray cool breezes rustle through damp grass."}\nRecent events: The eerie stillness sent shivers down the spines of the loca...; In ... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 52, "morale": 60, "resources": 41, "knowledge": 51, "corruption": 10, "glitch": 21, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 1, 'time': 'night', 'room': 'entrance', 'turn_index': 4, 'recent_events': 'The eerie stillness sent shivers down the spines of the loca...; In ...', 'world_constraint_from_prev_turn': '{"atmosphere": "Evening twilight, a serene calm oversees.", "sensory_details": "The air carries the briny tang of sea spray cool breezes rustle through damp grass."}', 'recent_motifs': 'communication', 'lore_continuity_weight': 0, 'memory_layers': ['Turn 1: Ask the Shieldbearer about the current situation -> is the rewritten prompt: I hear whispers of a hidden room deep within the castle grounds, guarded by...', "Turn 2: Ask the Shieldbearer about the hidden room and its rumored treasure. -> is the rewritten prompt: **The city' bustling streets were eerily quiet, the silence punctuated by t...", 'Turn 3: You ask the Shieldbearer about the rumored hidden room deep within the castle grounds. -> is the rewritten prompt in a slightly different way: **Imagine a world where the boundaries between ...', 'Memory summary: Turn 1: Ask the Shieldbearer about the current situation -> is the rewritten prompt: I hear whispers of a hidden room deep within the castle grounds, guarded by... | Turn 2: Ask the Shieldbearer about...', 'Turn 4: You ask the Shieldbearer about the rumored hidden room deep within the castle grounds. -> is the rewritten prompt: The shimmering, iridescent veins of the forest floor caught the sunlight li...'], 'judge_verdict': '{"consistent": true, "reason": "The content is consistent with established world, lore, and character logic. It does not contradict any known facts or principles."}', 'judge_feedback': {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. It does not contradict any known facts or principles.'}, 'continuity_weight': 0.0, 'skip_major': False, 'allow_major': False, 'flags': []}
2025-11-01 23:49:04,279 [INFO] fortress_director.agents.event_agent: Injecting forced novelty/rare incident for turn 4
2025-11-01 23:49:41,832 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': 'The Shieldbearer stands guard at the entrance, his oil lamp casting a warm glow on the damp ground. The cool sea breeze rustles through the grass as the evening twilight envelops the castle grounds.', 'options': [{'id': 'ask_about_hidden_room', 'text': 'You ask the Shieldbearer about the hidden room deep within the castle grounds.', 'action_type': 'dialogue'}, {'id': 'search_for_clues', 'text': 'You search the area around the entrance for any clues or signs of the hidden room.', 'action_type': 'exploration'}, {'id': 'offer_assistance', 'text': 'You offer to help guard the entrance while the Shieldbearer investigates the rumored hidden room.', 'action_type': 'assistance'}, {'id': 'trade_for_information', 'text': 'You approach Boris, who is nearby, and propose a trade for information about the hidden room.', 'action_type': 'diplomacy'}], 'major_event': False, 'safe_functions': [{'name': 'change_weather', 'kwargs': {'atmosphere': 'clear_night', 'sensory_details': 'stars twinkle overhead'}}]}
2025-11-01 23:49:41,833 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': 'The Shieldbearer stands guard at the entrance, his oil lamp casting a warm glow on the damp ground. The cool sea breeze rustles through the grass as the evening twilight envelops the castle grounds.', 'options': [{'id': 'ask_about_hidden_room', 'text': 'You ask the Shieldbearer about the hidden room deep within the castle grounds.', 'action_type': 'dialogue'}, {'id': 'search_for_clues', 'text': 'You search the area around the entrance for any clues or signs of the hidden room.', 'action_type': 'exploration'}, {'id': 'offer_assistance', 'text': 'You offer to help guard the entrance while the Shieldbearer investigates the rumored hidden room.', 'action_type': 'assistance'}, {'id': 'trade_for_information', 'text': 'You approach Boris, who is nearby, and propose a trade for information about the hidden room.', 'action_type': 'diplomacy'}], 'major_event': False, 'safe_functions': [{'name': 'change_weather', 'kwargs': {'atmosphere': 'clear_night', 'sensory_details': 'stars twinkle overhead'}}]}
2025-11-01 23:49:41,833 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-11-01 23:49:41,833 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialogue", "id": "ask_about_hidden_room", "text": "You ask the Shieldbearer about the hidden room deep within the castle grounds."}, {"action_type": "exploration", "id": "search_for_clues", "text": "You search the area around the entrance for any clues or signs of the hidden room."}, {"action_type": "assistance", "id": "offer_assistance", "text": "You offer to help guard the entrance while the Shieldbearer investigates the rumored hidden room."}, {"action_type": "diplomacy", "id": "trade_for_information", "text": "You approach Boris, who i...
2025-11-01 23:49:41,833 [INFO] fortress_director.agents.creativity_agent: CreativityAgent.enrich_event called (turn=4)
2025-11-01 23:49:41,833 [DEBUG] fortress_director.agents.creativity_agent: CreativityAgent LLM prompt_vars: {'scene': 'The Shieldbearer stands guard at the entrance, his oil lamp casting a warm glow on the damp ground. The cool sea breeze rustles through the grass as the evening twilight envelops the castle grounds.', 'options': "[{'id': 'ask_about_hidden_room', 'text': 'You ask the Shieldbearer about the hidden room deep within the castle grounds.', 'action_type': 'dialogue'}, {'id': 'search_for_clues', 'text': 'You search the area around the entrance for any clues or signs of the hidden room.', 'action_type': 'exploration'}, {'id': 'offer_assistance', 'text': 'You offer to help guard the entrance while the Shieldbearer investigates the rumored hidden room.', 'action_type': 'assistance'}, {'id': 'trade_for_information', 'text': 'You approach Boris, who is nearby, and propose a trade for information about the hidden room.', 'action_type': 'diplomacy'}]", 'turn': 4}
2025-11-01 23:49:47,999 [INFO] fortress_director.agents.creativity_agent: CreativityAgent LLM event rewrite applied.
2025-11-01 23:49:48,000 [INFO] fortress_director.orchestrator.orchestrator: CreativityAgent enriched event: {'scene': "'s the rewritten prompt:\n\n**Imagine a world where shadows have sentience and can manifest as a shimmering network of shifting shapes.**", 'options': [{'id': 'ask_about_hidden_room', 'text': 'You ask the Shieldbearer about the hidden room deep within the castle grounds.', 'action_type': 'dialogue'}, {'id': 'search_for_clues', 'text': 'You search the area around the entrance for any clues or signs of the hidden room.', 'action_type': 'exploration'}, {'id': 'offer_assistance', 'text': 'You offer to help guard the entrance while the Shieldbearer investigates the rumored hidden room.', 'action_type': 'assistance'}, {'id': 'trade_for_information', 'text': 'You approach Boris, who is nearby, and propose a trade for information about the hidden room.', 'action_type': 'diplomacy'}], 'major_event': False, 'safe_functions': [{'name': 'change_weather', 'kwargs': {'atmosphere': 'clear_night', 'sensory_details': 'stars twinkle overhead'}}], 'motif_injected': None}
2025-11-01 23:49:48,000 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-11-01 23:49:54,194 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene fits within the context of a world where shadows have sentience and can manifest as a shimmering network of shifting shapes.'}
2025-11-01 23:49:54,194 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene fits within the context of a world where shadows have sentience and can manifest as a shimmering network of shifting shapes.'}
2025-11-01 23:49:54,195 [DEBUG] fortress_director.agents.judge_agent: Judge stochastic disagreement roll=0.243 vs prob=0.034 (rep=0, atmos=0, motif=False)
2025-11-01 23:49:54,195 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-11-01 23:49:57,084 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene fits within the context of a world where shadows have sentience and can manifest as a shimmering network of shifting shapes.'}
2025-11-01 23:49:57,084 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene fits within the context of a world where shadows have sentience and can manifest as a shimmering network of shifting shapes.'}
2025-11-01 23:49:57,084 [INFO] fortress_director.orchestrator.orchestrator: Added motif-based option: diplomacy_approach (motif active)
2025-11-01 23:49:57,084 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-11-01 23:49:57,084 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'ask_about_hidden_room', 'text': 'You ask the Shieldbearer about the hidden room deep within the castle grounds.', 'action_type': 'dialogue'}
2025-11-01 23:49:57,084 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialogue", "id": "ask_about_hidden_room", "text": "You ask the Shieldbearer about the hidden room deep within the castle grounds."}
2025-11-01 23:49:57,084 [INFO] fortress_director.orchestrator.orchestrator: Applying dynamic metrics for action_type 'dialogue': {'morale': 1, 'knowledge': 2}
2025-11-01 23:49:57,084 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=60, delta=1, limits=(0, 100) (cause=action_dialogue)
2025-11-01 23:49:57,084 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 61, 'cause': 'action_dialogue'}
2025-11-01 23:49:57,084 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 60 to 61 (cause=action_dialogue)
2025-11-01 23:49:57,084 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'knowledge': current=51, delta=2, limits=(0, 100) (cause=action_dialogue)
2025-11-01 23:49:57,084 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'knowledge', 'delta': 2, 'value': 53, 'cause': 'action_dialogue'}
2025-11-01 23:49:57,084 [INFO] fortress_director.utils.metrics_manager: Metric 'knowledge' updated from 51 to 53 (cause=action_dialogue)
2025-11-01 23:49:57,085 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after dynamic changes: {'order': 52, 'morale': 61, 'resources': 41, 'knowledge': 53, 'corruption': 10, 'glitch': 21, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-01 23:49:57,085 [INFO] fortress_director.orchestrator.orchestrator: Action consequence: Your words strengthen village bonds and reveal useful information.
2025-11-01 23:49:57,085 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 4 | Day 1 | Time night\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Evening twilight, a serene calm oversees.\", \"sensory_details\": \"The air carries the briny tang of sea spray cool breezes rustle through damp grass.\"}\nRecent events: The eerie stillness sent shivers down the spines of the loca...; In ... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character sum...
2025-11-01 23:49:57,085 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-11-01 23:49:57,085 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 4 | Day 1 | Time night\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Evening twilight, a serene calm oversees.", "sensory_details": "The air carries the briny tang of sea spray cool breezes rustle through damp grass."}\nRecent events: The eerie stillness sent shivers down the spines of the loca...; In ... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 52, "morale": 60, "resources": 41, "knowledge": 51, "corruption": 10, "glitch": 21, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': "' the rewritten prompt: Imagine a world where shadows have sentience and can manifest as a shimmering network of shifting shapes.", 'player_choice': 'You ask the Shieldbearer about the hidden room deep within the castle grounds.', 'atmosphere': 'Nightfall h, a tranquil hush blankets overseas.', 'sensory_details': 'The air is cool and moist with the scent of seaweed grass feels damp underfoot as distant waves whisper against jagged rocks.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player; Boris weighs every trade.', 'player_inventory_brief': 'oil lamp, patched shield', 'memory_layers': ['Turn 1: Ask the Shieldbearer about the current situation -> is the rewritten prompt: I hear whispers of a hidden room deep within the castle grounds, guarded by...', "Turn 2: Ask the Shieldbearer about the hidden room and its rumored treasure. -> is the rewritten prompt: **The city' bustling streets were eerily quiet, the silence punctuated by t...", 'Turn 3: You ask the Shieldbearer about the rumored hidden room deep within the castle grounds. -> is the rewritten prompt in a slightly different way: **Imagine a world where the boundaries between ...', 'Memory summary: Turn 1: Ask the Shieldbearer about the current situation -> is the rewritten prompt: I hear whispers of a hidden room deep within the castle grounds, guarded by... | Turn 2: Ask the Shieldbearer about...', 'Turn 4: You ask the Shieldbearer about the rumored hidden room deep within the castle grounds. -> is the rewritten prompt: The shimmering, iridescent veins of the forest floor caught the sunlight li...'], 'recent_events': 'The eerie stillness sent shivers down the spines of the loca...; In ...', 'last_major_event': False}
2025-11-01 23:50:04,161 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'I stand vigilant, listening for any signs of movement or activity. The stillness is unsettling, a quiet hum beneath the usual symphony of night.'}
2025-11-01 23:50:04,161 [INFO] fortress_director.agents.character_agent: Normalized output (list): [{'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'I stand vigilant, listening for any signs of movement or activity. The stillness is unsettling, a quiet hum beneath the usual symphony of night.', 'effects': {}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': '(assist autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': '(command autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': '(plan autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'inquire', 'action': 'Autonomously performs inquire action.', 'speech': '(inquire autonomous)', 'effects': {}, 'safe_functions': []}]
2025-11-01 23:50:04,161 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-11-01 23:50:04,162 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "stand_vigilance", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "I stand vigilant, listening for any signs of movement or activity. The stillness is unsettling, a quiet hum beneath the usual symphony of night."}, {"action": "Autonomously performs assist action.", "effects": {}, "intent": "assist", "name": "Rhea", "safe_functions": [], "speech": "(assist autonomous)"}, {"action": "Autonomously performs command action.", "effects": {}, "intent": "command", "name": "Boris", "safe_functions": [], "speech": "(command autonomous)"}, {"action": "A...
2025-11-01 23:50:04,162 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-11-01 23:50:04,162 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-11-01 23:50:04,162 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-11-01 23:50:04,162 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "stand_vigilance", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "I stand vigilant, listening for any signs of movement or activity. The stillness is unsettling, a quiet hum beneath the usual symphony of night."}, {"action": "Autonomously performs assist action.", "effects": {}, "intent": "assist", "name": "Rhea", "safe_functions": [], "speech": "(assist autonomous)"}, {"action": "Autonomously performs command action.", "effects": {}, "intent": "command", "name": "Boris", "safe_functions": [], "speech": "(command autonomous)"}, {"action": "A...
2025-11-01 23:50:04,162 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-11-01 23:50:04,162 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 4, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': [], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 4, 'day': 1, 'time': 'night', 'current_room': 'entrance', 'recent_events': ["is the rewritten prompt: **The city' bustling streets were eerily quiet, the silence punctuated by the occasional drone of a passing truck. The eerie stillness sent shivers down the spines of the loca...", 'is the rewritten prompt in a slightly different way: **Imagine a world where the boundaries between reality and illusion blur, and objects can shift and morph in ways that defy the laws of nature. In ...', "is the rewritten prompt: The shimmering, iridescent veins of the forest floor caught the sunlight like a thousand tiny mirrors, reflecting a kaleidoscope of colors that danced in the wind' whispers."], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'Evening twilight, a serene calm oversees.', 'sensory_details': 'The air carries the briny tang of sea spray cool breezes rustle through damp grass.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 52, 'morale': 61, 'resources': 41, 'knowledge': 53, 'corruption': 10, 'glitch': 21, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}, '_glitch_buffer': 0, 'previous_judge_verdict': {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene fits within the context of a world where shadows have sentience and can manifest as a shimmering network of shifting shapes.'}, 'player_choice_history': ['dialogue', 'dialogue', 'dialogue', 'dialogue'], 'summary_text': 'Calm returns as the sun arcs overhead.', 'memory_short': ['Turn 1: Ask the Shieldbearer about the current situation -> is the rewritten prompt: I hear whispers of a hidden room deep within the castle grounds, guarded by...', "Turn 2: Ask the Shieldbearer about the hidden room and its rumored treasure. -> is the rewritten prompt: **The city' bustling streets were eerily quiet, the silence punctuated by t...", 'Turn 3: You ask the Shieldbearer about the rumored hidden room deep within the castle grounds. -> is the rewritten prompt in a slightly different way: **Imagine a world where the boundaries between ...', 'Memory summary: Turn 1: Ask the Shieldbearer about the current situation -> is the rewritten prompt: I hear whispers of a hidden room deep within the castle grounds, guarded by... | Turn 2: Ask the Shieldbearer about...', 'Turn 4: You ask the Shieldbearer about the rumored hidden room deep within the castle grounds. -> is the rewritten prompt: The shimmering, iridescent veins of the forest floor caught the sunlight li...'], 'memory_long': [], 'status_effects': []}
2025-11-01 23:50:04,162 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'I stand vigilant, listening for any signs of movement or activity. The stillness is unsettling, a quiet hum beneath the usual symphony of night.', 'effects': {}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': '(assist autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': '(command autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': '(plan autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'inquire', 'action': 'Autonomously performs inquire action.', 'speech': '(inquire autonomous)', 'effects': {}, 'safe_functions': []}]
2025-11-01 23:50:04,163 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 4 | Day 1 | Time night
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Evening twilight, a serene calm oversees.", "sensory_details": "The air carries the briny tang of sea spray cool breezes rustle through damp grass."}
Recent events: The eerie stillness sent shivers down the spines of the loca...; In ... Recent motifs: communication
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 52, "morale": 60, "resources": 41, "knowledge": 51, "corruption": 10, "glitch": 21, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: ' the rewritten prompt: Imagine a world where shadows have sentience and can manifest as a shimmering network of shifting shapes., player_choice: {'id': 'ask_about_hidden_room', 'text': 'You ask the Shieldbearer about the hidden room deep within the castle grounds.', 'action_type': 'dialogue'}
2025-11-01 23:50:04,163 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-11-01 23:50:04,163 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'I stand vigilant, listening for any signs of movement or activity. The stillness is unsettling, a quiet hum beneath the usual symphony of night.', 'effects': {}, 'safe_functions': []}
2025-11-01 23:50:04,163 [DEBUG] fortress_director.rules.rules_engine: Validating character event 1: {'name': 'Rhea', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': '(assist autonomous)', 'effects': {}, 'safe_functions': []}
2025-11-01 23:50:04,163 [DEBUG] fortress_director.rules.rules_engine: Validating character event 2: {'name': 'Boris', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': '(command autonomous)', 'effects': {}, 'safe_functions': []}
2025-11-01 23:50:04,163 [DEBUG] fortress_director.rules.rules_engine: Validating character event 3: {'name': 'Rhea', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': '(plan autonomous)', 'effects': {}, 'safe_functions': []}
2025-11-01 23:50:04,163 [DEBUG] fortress_director.rules.rules_engine: Validating character event 4: {'name': 'Boris', 'intent': 'inquire', 'action': 'Autonomously performs inquire action.', 'speech': '(inquire autonomous)', 'effects': {}, 'safe_functions': []}
2025-11-01 23:50:04,163 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-11-01 23:50:04,163 [DEBUG] fortress_director.agents.judge_agent: Judge stochastic disagreement roll=0.815 vs prob=0.034 (rep=0, atmos=0, motif=False)
2025-11-01 23:50:04,163 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-11-01 23:50:09,511 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for their role as a defender.'}
2025-11-01 23:50:09,511 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for their role as a defender.'}
2025-11-01 23:50:09,511 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for their role as a defender.'}
2025-11-01 23:50:09,511 [DEBUG] fortress_director.agents.judge_agent: Judge stochastic disagreement roll=0.935 vs prob=0.034 (rep=0, atmos=0, motif=False)
2025-11-01 23:50:09,511 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-11-01 23:50:12,258 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene and player choice are in line with the established world's atmosphere and tone."}
2025-11-01 23:50:12,258 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene and player choice are in line with the established world's atmosphere and tone."}
2025-11-01 23:50:12,258 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene and player choice are in line with the established world's atmosphere and tone."}
2025-11-01 23:50:12,258 [DEBUG] fortress_director.agents.judge_agent: Judge stochastic disagreement roll=0.462 vs prob=0.034 (rep=0, atmos=0, motif=False)
2025-11-01 23:50:12,258 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-11-01 23:50:15,003 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for their role as a defender.'}
2025-11-01 23:50:15,003 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for their role as a defender.'}
2025-11-01 23:50:15,003 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Boris: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for their role as a defender.'}
2025-11-01 23:50:15,003 [DEBUG] fortress_director.agents.judge_agent: Judge stochastic disagreement roll=0.745 vs prob=0.034 (rep=0, atmos=0, motif=False)
2025-11-01 23:50:15,003 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-11-01 23:50:17,952 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for their role as a defender of the castle.'}
2025-11-01 23:50:17,952 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for their role as a defender of the castle.'}
2025-11-01 23:50:17,952 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for their role as a defender of the castle.'}
2025-11-01 23:50:17,952 [DEBUG] fortress_director.agents.judge_agent: Judge stochastic disagreement roll=0.793 vs prob=0.034 (rep=0, atmos=0, motif=False)
2025-11-01 23:50:17,952 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-11-01 23:50:20,933 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene and player choice are in line with the established world's atmosphere and tone."}
2025-11-01 23:50:20,933 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene and player choice are in line with the established world's atmosphere and tone."}
2025-11-01 23:50:20,933 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Boris: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene and player choice are in line with the established world's atmosphere and tone."}
2025-11-01 23:50:20,933 [INFO] fortress_director.rules.rules_engine: Tier two validation passed with penalties: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-11-01 23:50:20,933 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-11-01 23:50:20,933 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-11-01 23:50:20,933 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Boris: {}
2025-11-01 23:50:20,933 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-11-01 23:50:20,933 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Boris: {}
2025-11-01 23:50:20,933 [INFO] fortress_director.rules.rules_engine: Choice impact applied: knowledge +1 (action_type=dialogue)
2025-11-01 23:50:20,933 [INFO] fortress_director.rules.rules_engine: Judge penalties applied: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-11-01 23:50:20,934 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-11-01 23:50:20,934 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 4, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': [], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 4, 'day': 1, 'time': 'night', 'current_room': 'entrance', 'recent_events': ["is the rewritten prompt: **The city' bustling streets were eerily quiet, the silence punctuated by the occasional drone of a passing truck. The eerie stillness sent shivers down the spines of the loca...", 'is the rewritten prompt in a slightly different way: **Imagine a world where the boundaries between reality and illusion blur, and objects can shift and morph in ways that defy the laws of nature. In ...', "is the rewritten prompt: The shimmering, iridescent veins of the forest floor caught the sunlight like a thousand tiny mirrors, reflecting a kaleidoscope of colors that danced in the wind' whispers."], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'Evening twilight, a serene calm oversees.', 'sensory_details': 'The air carries the briny tang of sea spray cool breezes rustle through damp grass.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 52, 'morale': 61, 'resources': 41, 'knowledge': 54, 'corruption': 10, 'glitch': 21, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}, '_glitch_buffer': 0, 'previous_judge_verdict': {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene fits within the context of a world where shadows have sentience and can manifest as a shimmering network of shifting shapes.'}, 'player_choice_history': ['dialogue', 'dialogue', 'dialogue', 'dialogue', 'dialogue'], 'summary_text': 'Another uneventful watch passes by.', 'memory_short': ['Turn 1: Ask the Shieldbearer about the current situation -> is the rewritten prompt: I hear whispers of a hidden room deep within the castle grounds, guarded by...', "Turn 2: Ask the Shieldbearer about the hidden room and its rumored treasure. -> is the rewritten prompt: **The city' bustling streets were eerily quiet, the silence punctuated by t...", 'Turn 3: You ask the Shieldbearer about the rumored hidden room deep within the castle grounds. -> is the rewritten prompt in a slightly different way: **Imagine a world where the boundaries between ...', 'Memory summary: Turn 1: Ask the Shieldbearer about the current situation -> is the rewritten prompt: I hear whispers of a hidden room deep within the castle grounds, guarded by... | Turn 2: Ask the Shieldbearer about...', 'Turn 4: You ask the Shieldbearer about the rumored hidden room deep within the castle grounds. -> is the rewritten prompt: The shimmering, iridescent veins of the forest floor caught the sunlight li...'], 'memory_long': [], 'status_effects': []}
2025-11-01 23:50:20,934 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=5)
2025-11-01 23:50:20,934 [INFO] fortress_director.orchestrator.orchestrator: Applying 1 autonomous actions
2025-11-01 23:50:20,934 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=52, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-11-01 23:50:20,934 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': 1, 'value': 53, 'cause': 'autonomous_Rhea'}
2025-11-01 23:50:20,934 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 52 to 53 (cause=autonomous_Rhea)
2025-11-01 23:50:20,934 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=61, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-11-01 23:50:20,934 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 62, 'cause': 'autonomous_Rhea'}
2025-11-01 23:50:20,934 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 61 to 62 (cause=autonomous_Rhea)
2025-11-01 23:50:20,935 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-11-01 23:50:20,935 [INFO] fortress_director.orchestrator.orchestrator: Advanced to Day 2, Dawn
2025-11-01 23:50:20,935 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: []
2025-11-01 23:50:20,935 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-11-01 23:50:20,935 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"_glitch_buffer": 0, "active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 5, "day": 2, "flags": [], "inventory": [], "lore": {}, "memory_layers": [], "memory_long": [], "memory_short": ["Turn 2: Ask the Shieldbearer about the hidden room and its rumored treasure. -> is the rewritten prompt: **The city' bustling streets were eerily quiet, the silence punctuated by t...", "Turn 3: You ask the Shieldbearer about the rumored hidden room deep within the castle ...
2025-11-01 23:50:20,937 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-01 23:50:20,937 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-11-01 23:50:20,937 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-01 23:50:20,937 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-01 23:50:20,937 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-01 23:50:20,938 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-01 23:50:20,938 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-01 23:50:20,938 [INFO] fortress_director.codeaware.function_validator: Validating function call payload: {'name': 'change_weather', 'kwargs': {'atmosphere': 'clear_night', 'sensory_details': 'stars twinkle overhead'}}
2025-11-01 23:50:20,938 [DEBUG] fortress_director.codeaware.function_validator: Coercing function call from payload: {'name': 'change_weather', 'kwargs': {'atmosphere': 'clear_night', 'sensory_details': 'stars twinkle overhead'}}
2025-11-01 23:50:20,938 [DEBUG] fortress_director.codeaware.function_validator: Coerced FunctionCall: FunctionCall(name='change_weather', args=(), kwargs={'atmosphere': 'clear_night', 'sensory_details': 'stars twinkle overhead'}, metadata={})
2025-11-01 23:50:20,938 [DEBUG] fortress_director.codeaware.function_validator: Coerced call: FunctionCall(name='change_weather', args=(), kwargs={'atmosphere': 'clear_night', 'sensory_details': 'stars twinkle overhead'}, metadata={})
2025-11-01 23:50:20,938 [DEBUG] fortress_director.codeaware.function_validator: Enforcing rate limits for function: change_weather
2025-11-01 23:50:20,938 [INFO] fortress_director.codeaware.function_registry: Validating function call: change_weather
2025-11-01 23:50:20,938 [DEBUG] fortress_director.codeaware.function_validator: Recorded success for function: change_weather (total_calls=1, per_function=1)
2025-11-01 23:50:20,938 [INFO] fortress_director.codeaware.function_validator: Function call 'change_weather' validated successfully.
2025-11-01 23:50:20,938 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-01 23:50:20,939 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=5, call=change_weather)
2025-11-01 23:50:20,939 [INFO] fortress_director.codeaware.function_registry: Getting registered function: change_weather
2025-11-01 23:50:20,939 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'change_weather'...
2025-11-01 23:50:20,939 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-01 23:50:20,940 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-01 23:50:20,940 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed successfully.
2025-11-01 23:50:20,940 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed (checkpoint turn=5)
2025-11-01 23:50:20,941 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-11-01 23:50:20,941 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-01 23:50:20,941 [INFO] fortress_director.orchestrator.orchestrator: Weather changed via safe function, re-describing world...
2025-11-01 23:50:20,941 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 5 | Day 2 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Nightfall h, a tranquil hush blankets overseas.", "sensory_details": "The air is cool and moist with the scent of seaweed grass feels damp underfoot as distant waves whisper against jagged rocks."}\nRecent events: In ...; \' the rewritten prompt: Imagine a world where shadows have sentience and can manifest as a shimmering network of shifting shapes. Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 52, "morale": 61, "resources": 41, "knowledge": 54, "corruption": 10, "glitch": 21, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'dawn'}
2025-11-01 23:50:28,146 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Dawn'thresh, a serene calm envelops overseas.", 'sensory_details': 'The air carries the briny tang of seaweed grass; it clings to skin like damp velvet. Gentle waves murmur secrets against stone as light filters through dissipating darkness.'}
2025-11-01 23:50:28,146 [WARNING] fortress_director.agents.world_agent: Time inconsistency: dawn but found ['night'] indicators
2025-11-01 23:50:28,146 [WARNING] fortress_director.agents.world_agent: Time inconsistency detected, retrying...
2025-11-01 23:50:32,033 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Dawn'thresh, a serene calm envelops overseas.", 'sensory_details': 'The air carries the briny tang of seaweed grass; it clings to skin like damp velvet.'}
2025-11-01 23:50:32,033 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Dawn hresh, a serene calm envelops overseas.', 'sensory_details': 'The air carries the briny tang of seaweed grass it clings to skin like damp velvet.'}
2025-11-01 23:50:32,033 [INFO] fortress_director.orchestrator.orchestrator: World re-described after safe function.
2025-11-01 23:50:32,033 [DEBUG] fortress_director.orchestrator.orchestrator: New world output: {"atmosphere": "Dawn hresh, a serene calm envelops overseas.", "sensory_details": "The air carries the briny tang of seaweed grass it clings to skin like damp velvet."}
2025-11-01 23:50:32,034 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-01 23:50:32,034 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-01 23:50:32,034 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 53, 'morale': 62, 'resources': 41, 'knowledge': 53, 'corruption': 10, 'glitch': 21, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-01 23:50:32,034 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 53, 'morale': 62, 'resources': 41, 'knowledge': 53, 'corruption': 10, 'glitch': 21, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-01 23:50:32,034 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'conditions_not_met', 'description': 'Oyun devam ediyor...'}
2025-11-01 23:50:32,035 [INFO] fortress_director.orchestrator.orchestrator: Turn summary: Another uneventful watch passes by.
2025-11-01 23:50:32,035 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-11-01 23:50:32,035 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 4 | Day 1 | Time night\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Evening twilight, a serene calm oversees.\", \"sensory_details\": \"The air carries the briny tang of sea spray cool breezes rustle through damp grass.\"}\nRecent events: The eerie stillness sent shivers down the spines of the loca...; In ... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character sum...
2025-11-01 23:50:32,035 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-11-01 23:50:32,035 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
