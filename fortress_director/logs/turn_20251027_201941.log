2025-10-27 23:19:41,564 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251027_201941.log)
2025-10-27 23:19:41,564 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251027_201941.log)
2025-10-27 23:19:41,564 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251027_201941.log
2025-10-27 23:19:41,566 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-27 23:19:41,567 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-27 23:19:41,567 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-27 23:19:41,567 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-27 23:19:41,567 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-27 23:19:41,567 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-27 23:19:41,567 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-27 23:19:41,567 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-27 23:19:41,568 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-27 23:19:41,568 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-27 23:19:41,568 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-27 23:19:41,568 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-27 23:19:41,568 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-27 23:19:41,568 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-27 23:19:41,568 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-27 23:19:41,568 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-27 23:19:41,568 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-27 23:19:41,568 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-27 23:19:41,568 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-27 23:19:41,569 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-27 23:19:41,569 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-27 23:19:41,569 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-27 23:19:41,569 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-27 23:19:41,569 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=2, call=None)
2025-10-27 23:19:41,569 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-27 23:19:41,569 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-27 23:19:41,569 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 2, "day": 1, "finalized": true, "flags": ["low_clouds_present", "atmosphere", "Dawn'thin Rain", "Dawn's Whispers", "atmosphere_dawn_rain_heavy_clouds"], "inventory": [], "lore": {}, "memory_layers": ["Turn 8: Ask the Shieldbearer if she needs assistance. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've...", "Turn 9: You ask the Shieldbearer about the...
2025-10-27 23:19:41,569 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 17, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:19:41,570 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 17, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:19:41,570 [INFO] fortress_director.utils.glitch_manager: Game finalized, skipping glitch resolution
2025-10-27 23:19:41,570 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=0, triggered_loss=False
2025-10-27 23:19:41,570 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 17, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:19:41,570 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=17, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-27 23:19:41,570 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 16, 'cause': 'turn_recovery'}
2025-10-27 23:19:41,570 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 17 to 16 (cause=turn_recovery)
2025-10-27 23:19:41,570 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 16, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:19:41,570 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-27 23:19:41,571 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 2 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}
Recent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...
Recent motifs: none
Recent major events: none
Relationship summary: Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 16, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-27 23:19:41,571 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 2 in room entrance
2025-10-27 23:19:41,571 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 2 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn'thin rain, heavy clouds hang\", \"sensory_details\": \"Cool mist clings to stone drums beat steady rhythm\"}\nRecent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the dist...
2025-10-27 23:19:41,571 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-27 23:19:41,571 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 2 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}\nRecent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...\nRecent motifs: none\nRecent major events: none\nRelationship summary: Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 16, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance'}
2025-10-27 23:19:48,207 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm'}
2025-10-27 23:19:48,207 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm'}
2025-10-27 23:19:48,207 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-27 23:19:48,207 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}
2025-10-27 23:19:48,208 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 2 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn'thin rain, heavy clouds hang\", \"sensory_details\": \"Cool mist clings to stone drums beat steady rhythm\"}\nRecent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the dist...
2025-10-27 23:19:48,208 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-27 23:19:48,208 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 2 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}\nRecent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...\nRecent motifs: none\nRecent major events: none\nRelationship summary: Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 16, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...", 'world_constraint_from_prev_turn': '{"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}', 'recent_motifs': 'none', 'lore_continuity_weight': 0, 'memory_layers': ["Turn 8: Ask the Shieldbearer if she needs assistance. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've...", "Turn 9: You ask the Shieldbearer about the distant drums. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Memory summary: Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've... | Turn 8: Ask the Shieldb...", "Turn 10: You ask the Shieldbearer about her duty here at the entrance to Lornhaven. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Turn 2: Ask the Shieldbearer about her duty. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b..."]}
2025-10-27 23:20:19,787 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As you draw closer, you notice that her shield bears the crest of House Lorn. She looks up at you, her eyes meeting yours for the first time since you arrived.", 'options': [{'id': 'ask_about_duty', 'text': 'Ask the Shieldbearer about her duty and the state of the western wall.', 'action_type': 'dialog'}, {'id': 'offer_assistance', 'text': 'Offer to help her, suggesting that you could take a turn at watch.', 'action_type': 'dialog'}, {'id': 'inquire_about_house_lorn', 'text': 'Inquire about House Lorn and their role in the defense of the city.', 'action_type': 'dialog'}], 'major_event': False, 'safe_functions': []}
2025-10-27 23:20:19,787 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As you draw closer, you notice that her shield bears the crest of House Lorn. She looks up at you, her eyes meeting yours for the first time since you arrived.", 'options': [{'id': 'ask_about_duty', 'text': 'Ask the Shieldbearer about her duty and the state of the western wall.', 'action_type': 'dialog'}, {'id': 'offer_assistance', 'text': 'Offer to help her, suggesting that you could take a turn at watch.', 'action_type': 'dialog'}, {'id': 'inquire_about_house_lorn', 'text': 'Inquire about House Lorn and their role in the defense of the city.', 'action_type': 'dialog'}], 'major_event': False, 'safe_functions': []}
2025-10-27 23:20:19,787 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-27 23:20:19,787 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialog", "id": "ask_about_duty", "text": "Ask the Shieldbearer about her duty and the state of the western wall."}, {"action_type": "dialog", "id": "offer_assistance", "text": "Offer to help her, suggesting that you could take a turn at watch."}, {"action_type": "dialog", "id": "inquire_about_house_lorn", "text": "Inquire about House Lorn and their role in the defense of the city."}], "safe_functions": [], "scene": "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hou...
2025-10-27 23:20:19,787 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-27 23:20:19,787 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'ask_about_duty', 'text': 'Ask the Shieldbearer about her duty and the state of the western wall.', 'action_type': 'dialog'}
2025-10-27 23:20:19,788 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialog", "id": "ask_about_duty", "text": "Ask the Shieldbearer about her duty and the state of the western wall."}
2025-10-27 23:20:19,788 [DEBUG] fortress_director.orchestrator.orchestrator: No dynamic metrics for action_type 'dialog'
2025-10-27 23:20:19,788 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 2 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn'thin rain, heavy clouds hang\", \"sensory_details\": \"Cool mist clings to stone drums beat steady rhythm\"}\nRecent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the dist...
2025-10-27 23:20:19,788 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-27 23:20:19,788 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 2 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}\nRecent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...\nRecent motifs: none\nRecent major events: none\nRelationship summary: Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 16, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As you draw closer, you notice that her shield bears the crest of House Lorn. She looks up at you, her eyes meeting yours for the first time since you arrived.", 'player_choice': 'Ask the Shieldbearer about her duty and the state of the western wall.', 'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Shieldbearer is neutral toward the player', 'player_inventory_brief': 'oil lamp, patched shield'}
2025-10-27 23:20:27,310 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilantly', 'speech': "I've been standing here for hours, watching the clouds roll in.", 'effects': {'trust_delta': 100, 'flag_set': ["Dawn's Whisper"], 'item_change': None, 'status_change': {'health': 100}}}
2025-10-27 23:20:27,310 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilantly', 'speech': "I've been standing here for hours, watching the clouds roll in.", 'effects': {'flag_set': ["Dawn's Whisper"]}}]
2025-10-27 23:20:27,310 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-27 23:20:27,310 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "stand_vigilantly", "effects": {"flag_set": ["Dawn's Whisper"]}, "intent": "vigilance", "name": "Shieldbearer", "speech": "I've been standing here for hours, watching the clouds roll in."}]
2025-10-27 23:20:27,310 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-27 23:20:27,310 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-27 23:20:27,310 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-27 23:20:27,311 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "stand_vigilantly", "effects": {"flag_set": ["Dawn's Whisper"]}, "intent": "vigilance", "name": "Shieldbearer", "speech": "I've been standing here for hours, watching the clouds roll in."}]
2025-10-27 23:20:27,311 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-27 23:20:27,311 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 10, 'current_turn': 2, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_clouds_present', 'atmosphere', "Dawn'thin Rain", "Dawn's Whispers", 'atmosphere_dawn_rain_heavy_clouds'], 'memory_layers': ["Turn 8: Ask the Shieldbearer if she needs assistance. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've...", "Turn 9: You ask the Shieldbearer about the distant drums. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Memory summary: Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've... | Turn 8: Ask the Shieldb...", "Turn 10: You ask the Shieldbearer about her duty here at the entrance to Lornhaven. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Turn 2: Ask the Shieldbearer about her duty. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b..."], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 2, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': ["The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...", "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...", "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo..."], 'recent_motifs': [], 'world_constraint_from_prev_turn': {'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Shieldbearer is neutral toward the player', 'metrics': {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 16, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {'Shieldbearer': 0}, 'npc_memory': {'Rhea': {'name': 'Scout Rhea', 'location': 'scout_post', 'personality': 'loyal but impulsive', 'trust': 50, 'last_action': 'monitoring perimeter', 'mood': {'morale_delta': -0.03335205098186353}}, 'Boris': {'name': 'Merchant Boris', 'location': 'merchant_quarters', 'personality': 'cautious and calculating', 'trust': 45, 'last_action': 'inventory check', 'mood': {'morale_delta': -0.19593233221717266}}}, 'status_effects': [], 'finalized': True}
2025-10-27 23:20:27,311 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilantly', 'speech': "I've been standing here for hours, watching the clouds roll in.", 'effects': {'flag_set': ["Dawn's Whisper"]}}]
2025-10-27 23:20:27,311 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 2 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}
Recent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...
Recent motifs: none
Recent major events: none
Relationship summary: Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 16, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As you draw closer, you notice that her shield bears the crest of House Lorn. She looks up at you, her eyes meeting yours for the first time since you arrived., player_choice: {'id': 'ask_about_duty', 'text': 'Ask the Shieldbearer about her duty and the state of the western wall.', 'action_type': 'dialog'}
2025-10-27 23:20:27,311 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-27 23:20:27,311 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilantly', 'speech': "I've been standing here for hours, watching the clouds roll in.", 'effects': {'flag_set': ["Dawn's Whisper"]}}
2025-10-27 23:20:27,311 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-27 23:20:27,311 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-27 23:20:32,678 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The interaction between the Shieldbearer and the player is natural and in line with their roles.'}
2025-10-27 23:20:32,678 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The interaction between the Shieldbearer and the player is natural and in line with their roles.'}
2025-10-27 23:20:32,678 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Shieldbearer: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The interaction between the Shieldbearer and the player is natural and in line with their roles.'}
2025-10-27 23:20:32,678 [INFO] fortress_director.rules.rules_engine: Tier two validation passed.
2025-10-27 23:20:32,678 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Shieldbearer: {'flag_set': ["Dawn's Whisper"]}
2025-10-27 23:20:32,678 [INFO] fortress_director.rules.rules_engine: Relationship summary updated: Shieldbearer is neutral toward the player
2025-10-27 23:20:32,678 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-27 23:20:32,680 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 10, 'current_turn': 2, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_clouds_present', 'atmosphere', "Dawn'thin Rain", "Dawn's Whispers", 'atmosphere_dawn_rain_heavy_clouds', "Dawn's Whisper"], 'memory_layers': ["Turn 8: Ask the Shieldbearer if she needs assistance. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've...", "Turn 9: You ask the Shieldbearer about the distant drums. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Memory summary: Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've... | Turn 8: Ask the Shieldb...", "Turn 10: You ask the Shieldbearer about her duty here at the entrance to Lornhaven. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Turn 2: Ask the Shieldbearer about her duty. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b..."], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 2, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': ["The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...", "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...", "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo..."], 'recent_motifs': [], 'world_constraint_from_prev_turn': {'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Shieldbearer is neutral toward the player', 'metrics': {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 16, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {'Shieldbearer': 0}, 'npc_memory': {'Rhea': {'name': 'Scout Rhea', 'location': 'scout_post', 'personality': 'loyal but impulsive', 'trust': 50, 'last_action': 'monitoring perimeter', 'mood': {'morale_delta': -0.03335205098186353}}, 'Boris': {'name': 'Merchant Boris', 'location': 'merchant_quarters', 'personality': 'cautious and calculating', 'trust': 45, 'last_action': 'inventory check', 'mood': {'morale_delta': -0.19593233221717266}}}, 'status_effects': [], 'finalized': True}
2025-10-27 23:20:32,680 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=3)
2025-10-27 23:20:32,680 [ERROR] fortress_director.orchestrator.orchestrator: Exception during turn: 'Orchestrator' object has no attribute '_generate_autonomous_actions'
Traceback (most recent call last):
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\orchestrator\orchestrator.py", line 651, in run_turn
    autonomous_actions = self._generate_autonomous_actions(state_snapshot)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Orchestrator' object has no attribute '_generate_autonomous_actions'
2025-10-27 23:20:32,683 [INFO] fortress_director.codeaware.rollback_system: Rollback requested (reason=Turn execution failed: AttributeError)
2025-10-27 23:20:32,684 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-27 23:20:32,684 [INFO] fortress_director.codeaware.rollback_system: Rollback applied (turn=2, reason=Turn execution failed: AttributeError)
2025-10-27 23:20:32,684 [INFO] fortress_director.orchestrator.orchestrator: Rollback performed after exception.
