2025-10-30 01:18:01,595 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_221801.log)
2025-10-30 01:18:01,595 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_221801.log)
2025-10-30 01:18:01,595 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_221801.log
2025-10-30 01:18:01,623 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-30 01:18:01,628 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-30 01:18:01,628 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-30 01:18:01,628 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-30 01:18:01,628 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-30 01:18:01,632 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-30 01:18:01,632 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-30 01:18:01,632 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-30 01:18:01,632 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-30 01:18:01,633 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-30 01:18:01,633 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-30 01:18:01,633 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-30 01:18:01,633 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-30 01:18:01,633 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-30 01:18:01,633 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-30 01:18:01,633 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-30 01:18:01,633 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-30 01:18:01,633 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-30 01:18:01,633 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-30 01:18:01,633 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-30 01:18:01,633 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-30 01:18:01,633 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-30 01:18:01,635 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=11)
2025-10-30 01:18:01,635 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=11, call=None)
2025-10-30 01:18:01,635 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-30 01:18:01,635 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=11)
2025-10-30 01:18:01,635 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "courtyard", "current_turn": 11, "day": 3, "flags": ["recent_events", "has_heard_drums", "atmosphere", "world_map_night_dark", "mystery_temple_found", "major_wall_alert"], "inventory": [], "lore": {}, "major_event_last_turn": 11, "major_events_triggered": 1, "memory_layers": [], "memory_long": ["Turn 11: Major event triggered (major_wall_alert)"], "memory_short": ["Turn 8: You ask him if he knows anything about the drums. -> Sure, ...
2025-10-30 01:18:01,635 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 57, 'morale': 68, 'resources': 40, 'knowledge': 53, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:18:01,636 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 57, 'morale': 68, 'resources': 40, 'knowledge': 53, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:18:01,636 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=12, seed=12345, current_glitch=26)
2025-10-30 01:18:01,636 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 57, 'morale': 68, 'resources': 40, 'knowledge': 53, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:18:01,636 [DEBUG] fortress_director.utils.metrics_manager: Applying bulk metric change: metric=order, delta=-2, cause=glitch:medium_anomaly
2025-10-30 01:18:01,636 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=57, delta=-2, limits=(0, 100) (cause=glitch:medium_anomaly)
2025-10-30 01:18:01,636 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': -2, 'value': 55, 'cause': 'glitch:medium_anomaly'}
2025-10-30 01:18:01,636 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 57 to 55 (cause=glitch:medium_anomaly)
2025-10-30 01:18:01,636 [DEBUG] fortress_director.utils.metrics_manager: Applying bulk metric change: metric=morale, delta=-1, cause=glitch:medium_anomaly
2025-10-30 01:18:01,636 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=68, delta=-1, limits=(0, 100) (cause=glitch:medium_anomaly)
2025-10-30 01:18:01,636 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': -1, 'value': 67, 'cause': 'glitch:medium_anomaly'}
2025-10-30 01:18:01,636 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 68 to 67 (cause=glitch:medium_anomaly)
2025-10-30 01:18:01,637 [DEBUG] fortress_director.utils.metrics_manager: Applying bulk metric change: metric=glitch, delta=2, cause=glitch:medium_anomaly
2025-10-30 01:18:01,637 [DEBUG] fortress_director.utils.metrics_manager: Glitch smoothing: requested delta=2, buffer=0, applied=2, leftover=0
2025-10-30 01:18:01,637 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=26, delta=2, limits=(0, 100) (cause=glitch:medium_anomaly)
2025-10-30 01:18:01,637 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 2, 'value': 28, 'cause': 'glitch:medium_anomaly'}
2025-10-30 01:18:01,637 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 26 to 28 (cause=glitch:medium_anomaly)
2025-10-30 01:18:01,637 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=52, triggered_loss=False
2025-10-30 01:18:01,637 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 55, 'morale': 67, 'resources': 40, 'knowledge': 53, 'corruption': 10, 'glitch': 28, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:18:01,638 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Pathfinding errors unsettle the patrol routes.']
2025-10-30 01:18:01,639 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=52, triggered_loss=False
2025-10-30 01:18:01,639 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 55, 'morale': 67, 'resources': 40, 'knowledge': 53, 'corruption': 10, 'glitch': 28, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:18:01,639 [DEBUG] fortress_director.utils.metrics_manager: Glitch smoothing: requested delta=-1, buffer=0, applied=-1, leftover=0
2025-10-30 01:18:01,639 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=28, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-30 01:18:01,639 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 27, 'cause': 'turn_recovery'}
2025-10-30 01:18:01,639 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 28 to 27 (cause=turn_recovery)
2025-10-30 01:18:01,639 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 55, 'morale': 67, 'resources': 40, 'knowledge': 53, 'corruption': 10, 'glitch': 27, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:18:01,639 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=52, triggered_loss=False
2025-10-30 01:18:01,639 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 55, 'morale': 67, 'resources': 40, 'knowledge': 53, 'corruption': 10, 'glitch': 27, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:18:01,640 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-30 01:18:01,640 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 11 | Day 3 | Time morning
Location: courtyard
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn h in a courtyard, under starlit sky", "sensory_details": "The cool breeze caresses skin as the first light touches stone and earth."}
Recent events: Sure, here is the rewritten prompt, with a sense of novelty and surprise:

I'm searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:

**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th...; The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made! Recent motifs: communication
Recent major events: none
Relationship summary: Rhea trusts the player deeply
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 55, "morale": 67, "resources": 40, "knowledge": 53, "corruption": 10, "glitch": 27, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-30 01:18:01,640 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 11 in room courtyard
2025-10-30 01:18:01,640 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 11 | Day 3 | Time morning\nLocation: courtyard\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn h in a courtyard, under starlit sky\", \"sensory_details\": \"The cool breeze caresses skin as the first light touches stone and earth.\"}\nRecent events: Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:...
2025-10-30 01:18:01,640 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-30 01:18:01,640 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 11 | Day 3 | Time morning\nLocation: courtyard\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn h in a courtyard, under starlit sky", "sensory_details": "The cool breeze caresses skin as the first light touches stone and earth."}\nRecent events: Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI\'m searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th...; The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made! Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 55, "morale": 67, "resources": 40, "knowledge": 53, "corruption": 10, "glitch": 27, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'courtyard', 'time': 'morning', 'previous_atmosphere': 'Dawn h in a courtyard, under starlit sky', 'previous_sensory_details': 'The cool breeze caresses skin as the first light touches stone and earth.'}
2025-10-30 01:18:10,283 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Morning in a courtyard, starlight lingers', 'sensory_details': 'The cool breeze caresses skin as the first light touches stone and earth.'}
2025-10-30 01:18:10,283 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Morning in a courtyard, starlight lingers', 'sensory_details': 'The cool breeze caresses skin as the first light touches stone and earth.'}
2025-10-30 01:18:10,283 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-30 01:18:10,284 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Morning in a courtyard, starlight lingers", "sensory_details": "The cool breeze caresses skin as the first light touches stone and earth."}
2025-10-30 01:18:10,284 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 11 | Day 3 | Time morning\nLocation: courtyard\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn h in a courtyard, under starlit sky\", \"sensory_details\": \"The cool breeze caresses skin as the first light touches stone and earth.\"}\nRecent events: Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:...
2025-10-30 01:18:10,284 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-30 01:18:10,284 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 11 | Day 3 | Time morning\nLocation: courtyard\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn h in a courtyard, under starlit sky", "sensory_details": "The cool breeze caresses skin as the first light touches stone and earth."}\nRecent events: Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI\'m searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th...; The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made! Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 55, "morale": 67, "resources": 40, "knowledge": 53, "corruption": 10, "glitch": 27, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 3, 'time': 'morning', 'room': 'courtyard', 'recent_events': "Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th...; The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made!", 'world_constraint_from_prev_turn': '{"atmosphere": "Dawn h in a courtyard, under starlit sky", "sensory_details": "The cool breeze caresses skin as the first light touches stone and earth."}', 'recent_motifs': 'communication', 'lore_continuity_weight': 0, 'memory_layers': ["Turn 8: You ask him if he knows anything about the drums. -> Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the...", "Turn 9: Ask him if he knows anything about the drums. -> Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidde...", 'Memory summary: Turn 7: Ask him if he knows anything about the drums. -> The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you ap... | Turn 8: You ask him if he knows anyth...', 'Turn 10: Ask the Shieldbearer if he knows anything about the drums. -> Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that...', "Turn 11: Ask the Shieldbearer if he knows anything about the temple's secrets. -> The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto ..."], 'judge_verdict': '{"consistent": true, "reason": "The content is consistent with the established world, lore, and character logic. The scene described by the player matches the description of a discovery made in the temple.", "coherence": 100, "integrity": 100, "tone_alignment": 100, "penalty_applied": "none", "penalty_magnitude": {}, "feedback": {}}', 'judge_feedback': {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene described by the player matches the description of a discovery made in the temple.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'continuity_weight': 0.0, 'skip_major': True}
2025-10-30 01:18:49,667 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': 'The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made!', 'options': [{'id': 'ask_about_discovery', 'text': 'Ask the Shieldbearer about the discovery.', 'action_type': 'dialogue'}, {'id': 'examine_temple', 'text': 'Examine the temple more closely to learn about its secrets.', 'action_type': 'exploration'}, {'id': 'use_oil_lamp', 'text': 'Light your oil lamp and search for hidden inscriptions on the temple walls.', 'action_type': 'item_use'}, {'id': 'seek_help_from_Rhea', 'text': "Seek help from Rhea, who may have knowledge about the temple's secrets.", 'action_type': 'assistance'}], 'major_event': False, 'safe_functions': []}
2025-10-30 01:18:49,667 [INFO] fortress_director.agents.event_agent: Forcing incident flag for turn 3
2025-10-30 01:18:49,667 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': 'The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made! Suddenly, a discovery is made!', 'options': [{'id': 'ask_about_discovery', 'text': 'Ask the Shieldbearer about the discovery.', 'action_type': 'dialogue'}, {'id': 'examine_temple', 'text': 'Examine the temple more closely to learn about its secrets.', 'action_type': 'exploration'}, {'id': 'use_oil_lamp', 'text': 'Light your oil lamp and search for hidden inscriptions on the temple walls.', 'action_type': 'item_use'}, {'id': 'seek_help_from_Rhea', 'text': "Seek help from Rhea, who may have knowledge about the temple's secrets.", 'action_type': 'assistance'}], 'major_event': True, 'safe_functions': []}
2025-10-30 01:18:49,668 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-30 01:18:49,668 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": true, "options": [{"action_type": "dialogue", "id": "ask_about_discovery", "text": "Ask the Shieldbearer about the discovery."}, {"action_type": "exploration", "id": "examine_temple", "text": "Examine the temple more closely to learn about its secrets."}, {"action_type": "item_use", "id": "use_oil_lamp", "text": "Light your oil lamp and search for hidden inscriptions on the temple walls."}, {"action_type": "assistance", "id": "seek_help_from_Rhea", "text": "Seek help from Rhea, who may have knowledge about the temple's secrets."}], "safe_functions": [], "scene": "The Shieldb...
2025-10-30 01:18:57,936 [INFO] fortress_director.agents.creativity_agent: CreativityAgent LLM event rewrite applied.
2025-10-30 01:18:57,936 [INFO] fortress_director.orchestrator.orchestrator: CreativityAgent enriched event: {'scene': 'Sure, here is the rewritten prompt with a sense of novelty and surprise:\n\n> The shadows dance around the crumbling structure, whispering secrets that only the keenest eye can decipher.', 'options': [{'id': 'ask_about_discovery', 'text': 'Ask the Shieldbearer about the discovery.', 'action_type': 'dialogue'}, {'id': 'examine_temple', 'text': 'Examine the temple more closely to learn about its secrets.', 'action_type': 'exploration'}, {'id': 'use_oil_lamp', 'text': 'Light your oil lamp and search for hidden inscriptions on the temple walls.', 'action_type': 'item_use'}, {'id': 'seek_help_from_Rhea', 'text': "Seek help from Rhea, who may have knowledge about the temple's secrets.", 'action_type': 'assistance'}], 'major_event': True, 'safe_functions': [], 'motif_injected': None}
2025-10-30 01:18:57,937 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 01:19:04,807 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The rewritten prompt introduces a new setting, a temple in a desolate landscape, and a discovery of secrets. This does not contradict established lore or world logic.'}
2025-10-30 01:19:04,807 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The rewritten prompt introduces a new setting, a temple in a desolate landscape, and a discovery of secrets. This does not contradict established lore or world logic.'}
2025-10-30 01:19:04,807 [INFO] fortress_director.orchestrator.orchestrator: Using previous judge verdict (turn 11)
2025-10-30 01:19:04,807 [INFO] fortress_director.orchestrator.orchestrator: Added trust-based option: ask_rhea_personal_help (trust=5)
2025-10-30 01:19:04,808 [INFO] fortress_director.orchestrator.orchestrator: Added motif-based option: diplomacy_approach (motif active)
2025-10-30 01:19:04,808 [INFO] fortress_director.orchestrator.orchestrator: Added time-sensitive option: strategic_planning (turn=11)
2025-10-30 01:19:04,808 [INFO] fortress_director.orchestrator.orchestrator: Added NPC fallback: move_npc('Boris', 'courtyard')
2025-10-30 01:19:04,808 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-30 01:19:04,809 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'ask_about_discovery', 'text': 'Ask the Shieldbearer about the discovery.', 'action_type': 'dialogue'}
2025-10-30 01:19:04,809 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialogue", "id": "ask_about_discovery", "text": "Ask the Shieldbearer about the discovery."}
2025-10-30 01:19:04,809 [INFO] fortress_director.orchestrator.orchestrator: Applying dynamic metrics for action_type 'dialogue': {'morale': 1, 'knowledge': 2}
2025-10-30 01:19:04,809 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=67, delta=1, limits=(0, 100) (cause=action_dialogue)
2025-10-30 01:19:04,809 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 68, 'cause': 'action_dialogue'}
2025-10-30 01:19:04,809 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 67 to 68 (cause=action_dialogue)
2025-10-30 01:19:04,810 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'knowledge': current=53, delta=2, limits=(0, 100) (cause=action_dialogue)
2025-10-30 01:19:04,810 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'knowledge', 'delta': 2, 'value': 55, 'cause': 'action_dialogue'}
2025-10-30 01:19:04,810 [INFO] fortress_director.utils.metrics_manager: Metric 'knowledge' updated from 53 to 55 (cause=action_dialogue)
2025-10-30 01:19:04,810 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after dynamic changes: {'order': 55, 'morale': 68, 'resources': 40, 'knowledge': 55, 'corruption': 10, 'glitch': 27, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:19:04,810 [INFO] fortress_director.orchestrator.orchestrator: Action consequence: Your words strengthen village bonds and reveal useful information.
2025-10-30 01:19:04,810 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 11 | Day 3 | Time morning\nLocation: courtyard\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn h in a courtyard, under starlit sky\", \"sensory_details\": \"The cool breeze caresses skin as the first light touches stone and earth.\"}\nRecent events: Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:...
2025-10-30 01:19:04,810 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-30 01:19:04,811 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 11 | Day 3 | Time morning\nLocation: courtyard\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn h in a courtyard, under starlit sky", "sensory_details": "The cool breeze caresses skin as the first light touches stone and earth."}\nRecent events: Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI\'m searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th...; The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made! Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 55, "morale": 67, "resources": 40, "knowledge": 53, "corruption": 10, "glitch": 27, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': 'Sure, here is the rewritten prompt with a sense of novelty and surprise:\n\n> The shadows dance around the crumbling structure, whispering secrets that only the keenest eye can decipher.', 'player_choice': 'Ask the Shieldbearer about the discovery.', 'atmosphere': 'Morning in a courtyard, starlight lingers', 'sensory_details': 'The cool breeze caresses skin as the first light touches stone and earth.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player deeply', 'player_inventory_brief': 'oil lamp, patched shield', 'memory_layers': ["Turn 8: You ask him if he knows anything about the drums. -> Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the...", "Turn 9: Ask him if he knows anything about the drums. -> Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidde...", 'Memory summary: Turn 7: Ask him if he knows anything about the drums. -> The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you ap... | Turn 8: You ask him if he knows anyth...', 'Turn 10: Ask the Shieldbearer if he knows anything about the drums. -> Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that...', "Turn 11: Ask the Shieldbearer if he knows anything about the temple's secrets. -> The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto ..."], 'recent_events': "Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th...; The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made!", 'last_major_event': 'Sure, here is the rewritten prompt with a sense of novelty and surprise:\n\n> The shadows dance around the crumbling structure, whispering secrets that only the keenest eye can decipher.'}
2025-10-30 01:19:16,230 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Rhea', 'intent': 'observe', 'action': 'examine the shadows', 'speech': 'The shadows dance around the crumbling structure, whispering secrets that only the keenest eye can decipher. I feel a presence here, a whisper that I must decipher.', 'effects': {'trust_delta': 25, 'flag_set': ['atmosphere'], 'item_change': {'weapon': 'oil lamp'}, 'status_change': {'health': 100}}}
2025-10-30 01:19:16,230 [INFO] fortress_director.agents.character_agent: Normalized output (list): [{'name': 'Rhea', 'intent': 'observe', 'action': 'examine the shadows', 'speech': 'The shadows dance around the crumbling structure, whispering secrets that only the keenest eye can decipher. I feel a presence here, a whisper that I must decipher.', 'effects': {'trust_delta': 1, 'flag_set': ['atmosphere']}, 'safe_functions': [{'name': 'adjust_metric', 'args': [], 'kwargs': {'metric': 'order', 'delta': 1}, 'metadata': {'source': 'character_autoinject'}}]}, {'name': 'Rhea', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': '(assist autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': '(command autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': '(plan autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'inquire', 'action': 'Autonomously performs inquire action.', 'speech': '(inquire autonomous)', 'effects': {}, 'safe_functions': []}]
2025-10-30 01:19:16,230 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-30 01:19:16,231 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "examine the shadows", "effects": {"flag_set": ["atmosphere"], "trust_delta": 1}, "intent": "observe", "name": "Rhea", "safe_functions": [{"args": [], "kwargs": {"delta": 1, "metric": "order"}, "metadata": {"source": "character_autoinject"}, "name": "adjust_metric"}], "speech": "The shadows dance around the crumbling structure, whispering secrets that only the keenest eye can decipher. I feel a presence here, a whisper that I must decipher."}, {"action": "Autonomously performs assist action.", "effects": {}, "intent": "assist", "name": "Rhea", "safe_functions": [], "speech": "(a...
2025-10-30 01:19:16,231 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-30 01:19:16,231 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-30 01:19:16,231 [DEBUG] fortress_director.orchestrator.orchestrator: Major event effect applied: {"applied_flag": "major_wall_alert", "applied_to": "Rhea", "status_change": {"duration": 3, "status": "tense_watch", "target": "Rhea"}}
2025-10-30 01:19:16,231 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-30 01:19:16,232 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "examine the shadows", "effects": {"flag_set": ["atmosphere", "major_wall_alert"], "status_change": {"duration": 3, "status": "tense_watch", "target": "Rhea"}, "trust_delta": 1}, "intent": "observe", "name": "Rhea", "safe_functions": [{"args": [], "kwargs": {"delta": 1, "metric": "order"}, "metadata": {"source": "character_autoinject"}, "name": "adjust_metric"}], "speech": "The shadows dance around the crumbling structure, whispering secrets that only the keenest eye can decipher. I feel a presence here, a whisper that I must decipher."}, {"action": "Autonomously performs assist...
2025-10-30 01:19:16,232 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-30 01:19:16,232 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 11, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['recent_events', 'has_heard_drums', 'atmosphere', 'world_map_night_dark', 'mystery_temple_found', 'major_wall_alert'], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 11, 'day': 3, 'time': 'morning', 'current_room': 'courtyard', 'recent_events': ["Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidden treasure that whispers secrets in the dead of night.", 'Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th...', 'The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made!'], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'Dawn h in a courtyard, under starlit sky', 'sensory_details': 'The cool breeze caresses skin as the first light touches stone and earth.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player deeply', 'metrics': {'order': 55, 'morale': 68, 'resources': 40, 'knowledge': 55, 'corruption': 10, 'glitch': 27, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {'Rhea': 5}, 'previous_judge_verdict': {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene described by the player matches the description of a discovery made in the temple.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['dialog', 'dialog', 'dialog', 'dialogue', 'dialog', 'communication', 'communication', 'dialogue', 'dialogue', 'dialogue'], 'summary_text': 'A major event shakes the village. Glitch level rises.', 'memory_short': ["Turn 8: You ask him if he knows anything about the drums. -> Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the...", "Turn 9: Ask him if he knows anything about the drums. -> Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidde...", 'Memory summary: Turn 7: Ask him if he knows anything about the drums. -> The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you ap... | Turn 8: You ask him if he knows anyth...', 'Turn 10: Ask the Shieldbearer if he knows anything about the drums. -> Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that...', "Turn 11: Ask the Shieldbearer if he knows anything about the temple's secrets. -> The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto ..."], 'memory_long': ['Turn 11: Major event triggered (major_wall_alert)'], 'status_effects': [{'target': 'Rhea', 'status': 'tense_watch', 'duration': 2}], 'major_events_triggered': 1, 'major_event_last_turn': 11, '_glitch_buffer': 0}
2025-10-30 01:19:16,232 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'observe', 'action': 'examine the shadows', 'speech': 'The shadows dance around the crumbling structure, whispering secrets that only the keenest eye can decipher. I feel a presence here, a whisper that I must decipher.', 'effects': {'trust_delta': 1, 'flag_set': ['atmosphere', 'major_wall_alert'], 'status_change': {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}}, 'safe_functions': [{'name': 'adjust_metric', 'args': [], 'kwargs': {'metric': 'order', 'delta': 1}, 'metadata': {'source': 'character_autoinject'}}]}, {'name': 'Rhea', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': '(assist autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': '(command autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': '(plan autonomous)', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'inquire', 'action': 'Autonomously performs inquire action.', 'speech': '(inquire autonomous)', 'effects': {}, 'safe_functions': []}]
2025-10-30 01:19:16,232 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 11 | Day 3 | Time morning
Location: courtyard
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn h in a courtyard, under starlit sky", "sensory_details": "The cool breeze caresses skin as the first light touches stone and earth."}
Recent events: Sure, here is the rewritten prompt, with a sense of novelty and surprise:

I'm searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:

**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th...; The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made! Recent motifs: communication
Recent major events: none
Relationship summary: Rhea trusts the player deeply
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 55, "morale": 67, "resources": 40, "knowledge": 53, "corruption": 10, "glitch": 27, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: Sure, here is the rewritten prompt with a sense of novelty and surprise:

> The shadows dance around the crumbling structure, whispering secrets that only the keenest eye can decipher., player_choice: {'id': 'ask_about_discovery', 'text': 'Ask the Shieldbearer about the discovery.', 'action_type': 'dialogue'}
2025-10-30 01:19:16,232 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-30 01:19:16,232 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'observe', 'action': 'examine the shadows', 'speech': 'The shadows dance around the crumbling structure, whispering secrets that only the keenest eye can decipher. I feel a presence here, a whisper that I must decipher.', 'effects': {'trust_delta': 1, 'flag_set': ['atmosphere', 'major_wall_alert'], 'status_change': {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}}, 'safe_functions': [{'name': 'adjust_metric', 'args': [], 'kwargs': {'metric': 'order', 'delta': 1}, 'metadata': {'source': 'character_autoinject'}}]}
2025-10-30 01:19:16,232 [DEBUG] fortress_director.rules.rules_engine: Validating character event 1: {'name': 'Rhea', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': '(assist autonomous)', 'effects': {}, 'safe_functions': []}
2025-10-30 01:19:16,232 [DEBUG] fortress_director.rules.rules_engine: Validating character event 2: {'name': 'Boris', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': '(command autonomous)', 'effects': {}, 'safe_functions': []}
2025-10-30 01:19:16,233 [DEBUG] fortress_director.rules.rules_engine: Validating character event 3: {'name': 'Rhea', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': '(plan autonomous)', 'effects': {}, 'safe_functions': []}
2025-10-30 01:19:16,233 [DEBUG] fortress_director.rules.rules_engine: Validating character event 4: {'name': 'Boris', 'intent': 'inquire', 'action': 'Autonomously performs inquire action.', 'speech': '(inquire autonomous)', 'effects': {}, 'safe_functions': []}
2025-10-30 01:19:16,233 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-30 01:19:16,233 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 01:19:22,849 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene description matches the original prompt's tone and setting."}
2025-10-30 01:19:22,849 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene description matches the original prompt's tone and setting."}
2025-10-30 01:19:22,849 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene description matches the original prompt's tone and setting.", 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-30 01:19:22,849 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 01:19:27,088 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The rewritten prompt introduces a new setting, atmosphere, and content that does not contradict established lore, tone, or world logic. The scene is consistent with the established world, lore, and character summary.'}
2025-10-30 01:19:27,088 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The rewritten prompt introduces a new setting, atmosphere, and content that does not contradict established lore, tone, or world logic. The scene is consistent with the established world, lore, and character summary.'}
2025-10-30 01:19:27,088 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'The rewritten prompt introduces a new setting, atmosphere, and content that does not contradict established lore, tone, or world logic. The scene is consistent with the established world, lore, and character summary.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-30 01:19:27,088 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 01:19:30,335 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The rewritten prompt introduces a new setting, atmosphere, and sensory details that do not contradict established lore or world logic. The content is consistent with the established world, lore, and character summary.'}
2025-10-30 01:19:30,336 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The rewritten prompt introduces a new setting, atmosphere, and sensory details that do not contradict established lore or world logic. The content is consistent with the established world, lore, and character summary.'}
2025-10-30 01:19:30,336 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Boris: {'consistent': True, 'reason': 'The rewritten prompt introduces a new setting, atmosphere, and sensory details that do not contradict established lore or world logic. The content is consistent with the established world, lore, and character summary.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-30 01:19:30,336 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 01:19:33,769 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The rewritten prompt introduces a new setting, atmosphere, and sensory details that do not contradict established lore or world logic. The content is consistent with the established world, lore, and character summary.'}
2025-10-30 01:19:33,769 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The rewritten prompt introduces a new setting, atmosphere, and sensory details that do not contradict established lore or world logic. The content is consistent with the established world, lore, and character summary.'}
2025-10-30 01:19:33,769 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'The rewritten prompt introduces a new setting, atmosphere, and sensory details that do not contradict established lore or world logic. The content is consistent with the established world, lore, and character summary.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-30 01:19:33,770 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 01:19:37,230 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The rewritten prompt introduces a new setting, atmosphere, and sensory details that do not contradict established lore or world logic. The content is consistent with the established world, lore, and character summary.'}
2025-10-30 01:19:37,230 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The rewritten prompt introduces a new setting, atmosphere, and sensory details that do not contradict established lore or world logic. The content is consistent with the established world, lore, and character summary.'}
2025-10-30 01:19:37,230 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Boris: {'consistent': True, 'reason': 'The rewritten prompt introduces a new setting, atmosphere, and sensory details that do not contradict established lore or world logic. The content is consistent with the established world, lore, and character summary.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-30 01:19:37,230 [INFO] fortress_director.rules.rules_engine: Tier two validation passed with penalties: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-30 01:19:37,230 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {'trust_delta': 1, 'flag_set': ['atmosphere', 'major_wall_alert'], 'status_change': {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}}
2025-10-30 01:19:37,230 [INFO] fortress_director.rules.rules_engine: Trust updated for Rhea: 5 -> 5 (delta: 1)
2025-10-30 01:19:37,230 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-10-30 01:19:37,230 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Boris: {}
2025-10-30 01:19:37,230 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-10-30 01:19:37,230 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Boris: {}
2025-10-30 01:19:37,231 [INFO] fortress_director.rules.rules_engine: Choice impact applied: knowledge +1 (action_type=dialogue)
2025-10-30 01:19:37,231 [INFO] fortress_director.rules.rules_engine: Major event: glitch increased by 3
2025-10-30 01:19:37,231 [INFO] fortress_director.rules.rules_engine: Relationship summary updated: Rhea trusts the player deeply
2025-10-30 01:19:37,231 [INFO] fortress_director.rules.rules_engine: Judge penalties applied: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-30 01:19:37,232 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-30 01:19:37,232 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 11, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['recent_events', 'has_heard_drums', 'atmosphere', 'world_map_night_dark', 'mystery_temple_found', 'major_wall_alert'], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 11, 'day': 3, 'time': 'morning', 'current_room': 'courtyard', 'recent_events': ["Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidden treasure that whispers secrets in the dead of night.", 'Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that the wind carries across a desolate landscape, leaving the faintest echo of its words clinging to th...', 'The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto its crumbling facade. Suddenly, a discovery is made!'], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'Dawn h in a courtyard, under starlit sky', 'sensory_details': 'The cool breeze caresses skin as the first light touches stone and earth.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player deeply', 'metrics': {'order': 55, 'morale': 68, 'resources': 40, 'knowledge': 56, 'corruption': 10, 'glitch': 30, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 1, 'major_event_last_turn': 11}, 'npc_trust': {'Rhea': 5}, 'previous_judge_verdict': {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene described by the player matches the description of a discovery made in the temple.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['dialog', 'dialog', 'dialogue', 'dialog', 'communication', 'communication', 'dialogue', 'dialogue', 'dialogue', 'dialogue'], 'summary_text': 'A major event shakes the village. Glitch level rises.', 'memory_short': ["Turn 8: You ask him if he knows anything about the drums. -> Sure, here's the rewritten prompt:\n\n> The intricate patterns etched onto the crumbling facade of the...", "Turn 9: Ask him if he knows anything about the drums. -> Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidde...", 'Memory summary: Turn 7: Ask him if he knows anything about the drums. -> The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you ap... | Turn 8: You ask him if he knows anyth...', 'Turn 10: Ask the Shieldbearer if he knows anything about the drums. -> Sure, here is the rewritten prompt in a slightly different way:\n\n**Imagine a whisper of secrets that...', "Turn 11: Ask the Shieldbearer if he knows anything about the temple's secrets. -> The Shieldbearer gazes at the ancient temple, his eyes following the intricate patterns etched onto ..."], 'memory_long': ['Turn 11: Major event triggered (major_wall_alert)'], 'status_effects': [{'target': 'Rhea', 'status': 'tense_watch', 'duration': 2}, {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}], 'major_events_triggered': 1, 'major_event_last_turn': 11, '_glitch_buffer': 0}
2025-10-30 01:19:37,232 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=12)
2025-10-30 01:19:37,232 [INFO] fortress_director.orchestrator.orchestrator: Applying 1 autonomous actions
2025-10-30 01:19:37,232 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=55, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-10-30 01:19:37,232 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': 1, 'value': 56, 'cause': 'autonomous_Rhea'}
2025-10-30 01:19:37,232 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 55 to 56 (cause=autonomous_Rhea)
2025-10-30 01:19:37,233 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=68, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-10-30 01:19:37,233 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 69, 'cause': 'autonomous_Rhea'}
2025-10-30 01:19:37,233 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 68 to 69 (cause=autonomous_Rhea)
2025-10-30 01:19:37,233 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-30 01:19:37,233 [INFO] fortress_director.orchestrator.orchestrator: Advanced time to afternoon
2025-10-30 01:19:37,233 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: [{'target': 'Rhea', 'status': 'tense_watch', 'duration': 1}, {'target': 'Rhea', 'status': 'tense_watch', 'duration': 2}]
2025-10-30 01:19:37,234 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-10-30 01:19:37,234 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"_glitch_buffer": 0, "active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "courtyard", "current_turn": 12, "day": 3, "flags": ["recent_events", "has_heard_drums", "atmosphere", "world_map_night_dark", "mystery_temple_found", "major_wall_alert"], "inventory": [], "lore": {}, "major_event_last_turn": 12, "major_events_triggered": 2, "memory_layers": [], "memory_long": ["Turn 11: Major event triggered (major_wall_alert)", "Turn 12: Major event triggered (major_wall_alert)"], "memory_sho...
2025-10-30 01:19:37,235 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=12)
2025-10-30 01:19:37,235 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-30 01:19:37,235 [INFO] fortress_director.codeaware.function_registry: Validating function call: move_npc
2025-10-30 01:19:37,235 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=12)
2025-10-30 01:19:37,235 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=12, call=move_npc)
2025-10-30 01:19:37,237 [INFO] fortress_director.codeaware.function_registry: Getting registered function: move_npc
2025-10-30 01:19:37,237 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'move_npc'...
2025-10-30 01:19:37,237 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=12)
2025-10-30 01:19:37,238 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=12)
2025-10-30 01:19:37,238 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_npc' executed successfully.
2025-10-30 01:19:37,238 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_npc' executed (checkpoint turn=12)
2025-10-30 01:19:37,239 [INFO] fortress_director.codeaware.function_registry: Validating function call: adjust_metric
2025-10-30 01:19:37,239 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=12)
2025-10-30 01:19:37,239 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=12, call=adjust_metric)
2025-10-30 01:19:37,239 [INFO] fortress_director.codeaware.function_registry: Getting registered function: adjust_metric
2025-10-30 01:19:37,239 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'adjust_metric'...
2025-10-30 01:19:37,239 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=12)
2025-10-30 01:19:37,240 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 55, 'morale': 68, 'resources': 40, 'knowledge': 56, 'corruption': 10, 'glitch': 30, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 1, 'major_event_last_turn': 11}
2025-10-30 01:19:37,240 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=55, delta=1, limits=(0, 100) (cause=adjust_metric:order)
2025-10-30 01:19:37,240 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': 1, 'value': 56, 'cause': 'adjust_metric:order'}
2025-10-30 01:19:37,240 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 55 to 56 (cause=adjust_metric:order)
2025-10-30 01:19:37,240 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=12)
2025-10-30 01:19:37,242 [INFO] fortress_director.codeaware.rollback_system: Safe function 'adjust_metric' executed successfully.
2025-10-30 01:19:37,242 [INFO] fortress_director.codeaware.rollback_system: Safe function 'adjust_metric' executed (checkpoint turn=12)
2025-10-30 01:19:37,243 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-30 01:19:37,243 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=12)
2025-10-30 01:19:37,244 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=12)
2025-10-30 01:19:37,244 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=12)
2025-10-30 01:19:37,244 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 56, 'morale': 69, 'resources': 40, 'knowledge': 55, 'corruption': 10, 'glitch': 27, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:19:37,244 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 56, 'morale': 69, 'resources': 40, 'knowledge': 55, 'corruption': 10, 'glitch': 27, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 01:19:37,244 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'conditions_not_met', 'description': 'Oyun devam ediyor...'}
2025-10-30 01:19:37,245 [INFO] fortress_director.orchestrator.orchestrator: Turn summary: A major event shakes the village. Glitch level rises.
2025-10-30 01:19:37,245 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-30 01:19:37,245 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 11 | Day 3 | Time morning\nLocation: courtyard\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn h in a courtyard, under starlit sky\", \"sensory_details\": \"The cool breeze caresses skin as the first light touches stone and earth.\"}\nRecent events: Sure, here is the rewritten prompt, with a sense of novelty and surprise:\n\nI'm searching for a hidden treasure that whispers secrets in the dead of night.; Sure, here is the rewritten prompt in a slightly different way:...
2025-10-30 01:19:37,245 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-30 01:19:37,246 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
