2025-10-27 23:30:48,506 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251027_203048.log)
2025-10-27 23:30:48,506 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251027_203048.log)
2025-10-27 23:30:48,506 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251027_203048.log
2025-10-27 23:30:48,507 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-27 23:30:48,507 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-27 23:30:48,507 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-27 23:30:48,509 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-27 23:30:48,509 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-27 23:30:48,509 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-27 23:30:48,509 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-27 23:30:48,509 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-27 23:30:48,509 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-27 23:30:48,509 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-27 23:30:48,509 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-27 23:30:48,509 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-27 23:30:48,509 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-27 23:30:48,509 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-27 23:30:48,510 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-27 23:30:48,510 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-27 23:30:48,510 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-27 23:30:48,510 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-27 23:30:48,510 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-27 23:30:48,510 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-27 23:30:48,510 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=1)
2025-10-27 23:30:48,510 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start', 'player_choice_id': '1'}
2025-10-27 23:30:48,510 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=3)
2025-10-27 23:30:48,511 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=3, call=None)
2025-10-27 23:30:48,511 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-27 23:30:48,511 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=3)
2025-10-27 23:30:48,511 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 3, "day": 1, "finalized": true, "flags": ["low_clouds_present", "atmosphere", "Dawn'thin Rain", "Dawn's Whispers", "atmosphere_dawn_rain_heavy_clouds"], "inventory": [], "lore": {}, "memory_layers": ["Memory summary: Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've... | Turn 8: Ask t...
2025-10-27 23:30:48,511 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 16, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:30:48,511 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 16, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:30:48,511 [INFO] fortress_director.utils.glitch_manager: Game finalized, skipping glitch resolution
2025-10-27 23:30:48,511 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=0, triggered_loss=False
2025-10-27 23:30:48,511 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 16, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:30:48,511 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=16, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-27 23:30:48,511 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 15, 'cause': 'turn_recovery'}
2025-10-27 23:30:48,511 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 16 to 15 (cause=turn_recovery)
2025-10-27 23:30:48,511 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:30:48,513 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-27 23:30:48,513 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 3 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}
Recent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As...
Recent motifs: none
Recent major events: none
Relationship summary: Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-27 23:30:48,513 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 3 in room entrance
2025-10-27 23:30:48,513 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 3 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn'thin rain, heavy clouds hang\", \"sensory_details\": \"Cool mist clings to stone drums beat steady rhythm\"}\nRecent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the dist...
2025-10-27 23:30:48,513 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-27 23:30:48,513 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 3 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}\nRecent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, still focused on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her voice. As...\nRecent motifs: none\nRecent major events: none\nRelationship summary: Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance'}
2025-10-27 23:30:55,348 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm'}
2025-10-27 23:30:55,348 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm'}
2025-10-27 23:30:55,348 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-27 23:30:55,348 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}
2025-10-27 23:30:55,348 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 3 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn'thin rain, heavy clouds hang\", \"sensory_details\": \"Cool mist clings to stone drums beat steady rhythm\"}\nRecent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the dist...
2025-10-27 23:30:55,348 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-27 23:30:55,349 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 3 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}\nRecent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, still focused on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her voice. As...\nRecent motifs: none\nRecent major events: none\nRelationship summary: Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As...", 'world_constraint_from_prev_turn': '{"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}', 'recent_motifs': 'none', 'lore_continuity_weight': 0, 'memory_layers': ["Memory summary: Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've... | Turn 8: Ask the Shieldb...", "Turn 10: You ask the Shieldbearer about her duty here at the entrance to Lornhaven. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Turn 2: Ask the Shieldbearer about her duty. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Turn 3: Ask the Shieldbearer about the drums. -> The Shieldbearer, still focused on the distant drums, glances at you as you approach. 'I've been sta...", "Memory summary: Turn 10: You ask the Shieldbearer about her duty here at the entrance to Lornhaven. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b... | Turn 2:..."]}
2025-10-27 23:31:23,401 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As you draw closer, she speaks again, 'It's been raining for days now, and I can feel the tension building in the air.'", 'options': [{'id': '1', 'text': 'Ask the Shieldbearer about the weather.', 'action_type': 'dialog'}, {'id': '2', 'text': "Offer the Shieldbearer some of your oil lamp's light.", 'action_type': 'interaction'}, {'id': '3', 'text': 'Inquire about the tension she mentioned.', 'action_type': 'dialog'}], 'major_event': False, 'safe_functions': []}
2025-10-27 23:31:23,401 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As you draw closer, she speaks again, 'It's been raining for days now, and I can feel the tension building in the air.'", 'options': [{'id': '1', 'text': 'Ask the Shieldbearer about the weather.', 'action_type': 'dialog'}, {'id': '2', 'text': "Offer the Shieldbearer some of your oil lamp's light.", 'action_type': 'interaction'}, {'id': '3', 'text': 'Inquire about the tension she mentioned.', 'action_type': 'dialog'}], 'major_event': False, 'safe_functions': []}
2025-10-27 23:31:23,401 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-27 23:31:23,401 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialog", "id": "1", "text": "Ask the Shieldbearer about the weather."}, {"action_type": "interaction", "id": "2", "text": "Offer the Shieldbearer some of your oil lamp's light."}, {"action_type": "dialog", "id": "3", "text": "Inquire about the tension she mentioned."}], "safe_functions": [], "scene": "The Shieldbearer, still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As you draw closer, she speaks again, 'It's ...
2025-10-27 23:31:23,401 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-27 23:31:23,403 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': '1', 'text': 'Ask the Shieldbearer about the weather.', 'action_type': 'dialog'}
2025-10-27 23:31:23,403 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialog", "id": "1", "text": "Ask the Shieldbearer about the weather."}
2025-10-27 23:31:23,403 [DEBUG] fortress_director.orchestrator.orchestrator: No dynamic metrics for action_type 'dialog'
2025-10-27 23:31:23,403 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 3 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn'thin rain, heavy clouds hang\", \"sensory_details\": \"Cool mist clings to stone drums beat steady rhythm\"}\nRecent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the dist...
2025-10-27 23:31:23,403 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-27 23:31:23,403 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 3 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}\nRecent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, still focused on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her voice. As...\nRecent motifs: none\nRecent major events: none\nRelationship summary: Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': "The Shieldbearer, still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As you draw closer, she speaks again, 'It's been raining for days now, and I can feel the tension building in the air.'", 'player_choice': 'Ask the Shieldbearer about the weather.', 'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Shieldbearer is neutral toward the player', 'player_inventory_brief': 'oil lamp, patched shield'}
2025-10-27 23:31:31,517 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilance', 'speech': "I've been standing here for hours, watching the clouds roll in.", 'effects': {'trust_delta': 0, 'flag_set': ['weather_watcher_flag'], 'item_change': None, 'status_change': None}}
2025-10-27 23:31:31,517 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilance', 'speech': "I've been standing here for hours, watching the clouds roll in.", 'effects': {'trust_delta': 0, 'flag_set': ['weather_watcher_flag']}}]
2025-10-27 23:31:31,518 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-27 23:31:31,518 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "stand_vigilance", "effects": {"flag_set": ["weather_watcher_flag"], "trust_delta": 0}, "intent": "vigilance", "name": "Shieldbearer", "speech": "I've been standing here for hours, watching the clouds roll in."}]
2025-10-27 23:31:31,518 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-27 23:31:31,518 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-27 23:31:31,518 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-27 23:31:31,518 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "stand_vigilance", "effects": {"flag_set": ["weather_watcher_flag"], "trust_delta": 0}, "intent": "vigilance", "name": "Shieldbearer", "speech": "I've been standing here for hours, watching the clouds roll in."}]
2025-10-27 23:31:31,518 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-27 23:31:31,519 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 10, 'current_turn': 3, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_clouds_present', 'atmosphere', "Dawn'thin Rain", "Dawn's Whispers", 'atmosphere_dawn_rain_heavy_clouds'], 'memory_layers': ["Memory summary: Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've... | Turn 8: Ask the Shieldb...", "Turn 10: You ask the Shieldbearer about her duty here at the entrance to Lornhaven. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Turn 2: Ask the Shieldbearer about her duty. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Turn 3: Ask the Shieldbearer about the drums. -> The Shieldbearer, still focused on the distant drums, glances at you as you approach. 'I've been sta...", "Memory summary: Turn 10: You ask the Shieldbearer about her duty here at the entrance to Lornhaven. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b... | Turn 2:..."], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 3, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': ["The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...", "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...", "The Shieldbearer, still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As..."], 'recent_motifs': [], 'world_constraint_from_prev_turn': {'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Shieldbearer is neutral toward the player', 'metrics': {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {'Shieldbearer': 0}, 'npc_memory': {'Rhea': {'name': 'Scout Rhea', 'location': 'scout_post', 'personality': 'loyal but impulsive', 'trust': 50, 'last_action': 'monitoring perimeter', 'mood': {'morale_delta': -0.06670410196372706}}, 'Boris': {'name': 'Merchant Boris', 'location': 'merchant_quarters', 'personality': 'cautious and calculating', 'trust': 45, 'last_action': 'inventory check', 'mood': {'morale_delta': -0.3918646644343453}}}, 'status_effects': [], 'finalized': True}
2025-10-27 23:31:31,519 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilance', 'speech': "I've been standing here for hours, watching the clouds roll in.", 'effects': {'trust_delta': 0, 'flag_set': ['weather_watcher_flag']}}]
2025-10-27 23:31:31,519 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 3 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}
Recent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As...
Recent motifs: none
Recent major events: none
Relationship summary: Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: The Shieldbearer, still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As you draw closer, she speaks again, 'It's been raining for days now, and I can feel the tension building in the air.', player_choice: {'id': '1', 'text': 'Ask the Shieldbearer about the weather.', 'action_type': 'dialog'}
2025-10-27 23:31:31,519 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-27 23:31:31,519 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilance', 'speech': "I've been standing here for hours, watching the clouds roll in.", 'effects': {'trust_delta': 0, 'flag_set': ['weather_watcher_flag']}}
2025-10-27 23:31:31,519 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-27 23:31:31,519 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-27 23:31:37,623 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The Shieldbearer's vigilance and concern about the weather are in line with her role as a defender."}
2025-10-27 23:31:37,623 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The Shieldbearer's vigilance and concern about the weather are in line with her role as a defender."}
2025-10-27 23:31:37,624 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Shieldbearer: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The Shieldbearer's vigilance and concern about the weather are in line with her role as a defender."}
2025-10-27 23:31:37,624 [INFO] fortress_director.rules.rules_engine: Tier two validation passed.
2025-10-27 23:31:37,624 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Shieldbearer: {'trust_delta': 0, 'flag_set': ['weather_watcher_flag']}
2025-10-27 23:31:37,624 [INFO] fortress_director.rules.rules_engine: Trust updated for Shieldbearer: 0 -> 0 (delta: 0)
2025-10-27 23:31:37,624 [INFO] fortress_director.rules.rules_engine: Relationship summary updated: Shieldbearer is neutral toward the player
2025-10-27 23:31:37,624 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-27 23:31:37,624 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 10, 'current_turn': 3, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_clouds_present', 'atmosphere', "Dawn'thin Rain", "Dawn's Whispers", 'atmosphere_dawn_rain_heavy_clouds', 'weather_watcher_flag'], 'memory_layers': ["Memory summary: Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've... | Turn 8: Ask the Shieldb...", "Turn 10: You ask the Shieldbearer about her duty here at the entrance to Lornhaven. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Turn 2: Ask the Shieldbearer about her duty. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Turn 3: Ask the Shieldbearer about the drums. -> The Shieldbearer, still focused on the distant drums, glances at you as you approach. 'I've been sta...", "Memory summary: Turn 10: You ask the Shieldbearer about her duty here at the entrance to Lornhaven. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b... | Turn 2:..."], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 3, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': ["The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...", "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...", "The Shieldbearer, still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. As..."], 'recent_motifs': [], 'world_constraint_from_prev_turn': {'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Shieldbearer is neutral toward the player', 'metrics': {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {'Shieldbearer': 0}, 'npc_memory': {'Rhea': {'name': 'Scout Rhea', 'location': 'scout_post', 'personality': 'loyal but impulsive', 'trust': 50, 'last_action': 'monitoring perimeter', 'mood': {'morale_delta': -0.06670410196372706}}, 'Boris': {'name': 'Merchant Boris', 'location': 'merchant_quarters', 'personality': 'cautious and calculating', 'trust': 45, 'last_action': 'inventory check', 'mood': {'morale_delta': -0.3918646644343453}}}, 'status_effects': [], 'finalized': True}
2025-10-27 23:31:37,625 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=4)
2025-10-27 23:31:37,625 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-27 23:31:37,625 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: []
2025-10-27 23:31:37,625 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-10-27 23:31:37,625 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 4, "day": 1, "finalized": true, "flags": ["low_clouds_present", "atmosphere", "Dawn'thin Rain", "Dawn's Whispers", "atmosphere_dawn_rain_heavy_clouds", "weather_watcher_flag"], "inventory": [], "lore": {}, "memory_layers": ["Turn 10: You ask the Shieldbearer about her duty here at the entrance to Lornhaven. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I...
2025-10-27 23:31:37,626 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=4)
2025-10-27 23:31:37,626 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-27 23:31:37,626 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-27 23:31:37,626 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=4)
2025-10-27 23:31:37,626 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:31:37,626 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:31:37,626 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'conditions_not_met', 'description': 'Oyun devam ediyor...'}
2025-10-27 23:31:37,626 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-27 23:31:37,626 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 3 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn'thin rain, heavy clouds hang\", \"sensory_details\": \"Cool mist clings to stone drums beat steady rhythm\"}\nRecent events: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the dist...
2025-10-27 23:31:37,626 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-27 23:31:37,627 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
