2025-10-30 00:45:00,639 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_214500.log)
2025-10-30 00:45:00,639 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_214500.log)
2025-10-30 00:45:00,639 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251029_214500.log
2025-10-30 00:45:00,669 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-30 00:45:00,670 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-30 00:45:00,670 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-30 00:45:00,670 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-30 00:45:00,671 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-30 00:45:00,671 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-30 00:45:00,671 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-30 00:45:00,671 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-30 00:45:00,671 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-30 00:45:00,672 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-30 00:45:00,672 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-30 00:45:00,672 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-30 00:45:00,672 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-30 00:45:00,672 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-30 00:45:00,672 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-30 00:45:00,673 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-30 00:45:00,673 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-30 00:45:00,673 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-30 00:45:00,673 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-30 00:45:00,673 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-30 00:45:00,674 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-30 00:45:00,674 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-30 00:45:00,674 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-30 00:45:00,674 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=2, call=None)
2025-10-30 00:45:00,674 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-30 00:45:00,674 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-30 00:45:00,675 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 2, "day": 1, "flags": ["recent_events"], "inventory": [], "lore": {}, "memory_layers": [], "memory_long": [], "memory_short": ["Turn 1: Approach the Shieldbearer and ask about the drums you hear. -> The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The l...", "Turn 2: Ask him about the drums you hear in the distance. -> The Shieldbearer, his gaze still fixed o...
2025-10-30 00:45:00,675 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 52, 'morale': 54, 'resources': 42, 'knowledge': 47, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:45:00,675 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 52, 'morale': 54, 'resources': 42, 'knowledge': 47, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:45:00,675 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=3, seed=12345, current_glitch=15)
2025-10-30 00:45:00,675 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 52, 'morale': 54, 'resources': 42, 'knowledge': 47, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:45:00,675 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=15, delta=4, limits=(0, 100) (cause=glitch:overload)
2025-10-30 00:45:00,675 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 4, 'value': 19, 'cause': 'glitch:overload'}
2025-10-30 00:45:00,675 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 15 to 19 (cause=glitch:overload)
2025-10-30 00:45:00,676 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=99, triggered_loss=False
2025-10-30 00:45:00,676 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 52, 'morale': 54, 'resources': 42, 'knowledge': 47, 'corruption': 10, 'glitch': 19, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:45:00,676 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Glitch cascade overwhelms containment protocols.']
2025-10-30 00:45:00,676 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=99, triggered_loss=False
2025-10-30 00:45:00,676 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 52, 'morale': 54, 'resources': 42, 'knowledge': 47, 'corruption': 10, 'glitch': 19, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:45:00,676 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=19, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-30 00:45:00,676 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 18, 'cause': 'turn_recovery'}
2025-10-30 00:45:00,676 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 19 to 18 (cause=turn_recovery)
2025-10-30 00:45:00,676 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 52, 'morale': 54, 'resources': 42, 'knowledge': 47, 'corruption': 10, 'glitch': 18, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:45:00,677 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=99, triggered_loss=False
2025-10-30 00:45:00,677 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 52, 'morale': 54, 'resources': 42, 'knowledge': 47, 'corruption': 10, 'glitch': 18, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:45:00,677 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-30 00:45:00,677 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 2 | Day 1 | Time afternoon
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Morning mist veils battlements, a time of soft light.", "sensory_details": "The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically."}
Recent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon...; The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. 'What brings you here so early?'... Recent motifs: communication
Recent major events: none
Relationship summary: Rhea trusts the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 52, "morale": 54, "resources": 42, "knowledge": 47, "corruption": 10, "glitch": 18, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-30 00:45:00,677 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 2 in room entrance
2025-10-30 00:45:00,678 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 2 | Day 1 | Time afternoon\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Morning mist veils battlements, a time of soft light.\", \"sensory_details\": \"The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically.\"}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an ...
2025-10-30 00:45:00,678 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-30 00:45:00,678 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 2 | Day 1 | Time afternoon\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Morning mist veils battlements, a time of soft light.", "sensory_details": "The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically."}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon...; The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. \'What brings you here so early?\'... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 52, "morale": 54, "resources": 42, "knowledge": 47, "corruption": 10, "glitch": 18, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'afternoon', 'previous_atmosphere': 'Morning mist veils battlements, a time of soft light.', 'previous_sensory_details': 'The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically.'}
2025-10-30 00:45:09,768 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Afternoon haze envelops stone ramparts, a time of warm light.', 'sensory_details': 'The air is filled with the metallic tang and earthiness as one can feel the cool breeze against skin. Distant drums beat rhythmically.'}
2025-10-30 00:45:09,768 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Afternoon haze envelops stone ramparts, a time of warm light.', 'sensory_details': 'The air is filled with the metallic tang and earthiness as one can feel the cool breeze against skin. Distant drums beat rhythmically.'}
2025-10-30 00:45:09,769 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-30 00:45:09,769 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Afternoon haze envelops stone ramparts, a time of warm light.", "sensory_details": "The air is filled with the metallic tang and earthiness as one can feel the cool breeze against skin. Distant drums beat rhythmically."}
2025-10-30 00:45:17,062 [INFO] fortress_director.agents.creativity_agent: CreativityAgent LLM rewrite applied.
2025-10-30 00:45:17,062 [INFO] fortress_director.orchestrator.orchestrator: CreativityAgent modified context: {'WORLD_CONTEXT': 'Turn 2 | Day 1 | Time afternoon\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Morning mist veils battlements, a time of soft light.", "sensory_details": "The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically."}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon...; The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. \'What brings you here so early?\'... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 52, "morale": 54, "resources": 42, "knowledge": 47, "corruption": 10, "glitch": 18, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'afternoon', 'previous_atmosphere': 'Morning mist veils battlements, a time of soft light.', 'previous_sensory_details': 'The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically.', 'creativity_layer': 'Sure, here is the rewritten prompt in a slightly different way:\n\nI want you to imagine a world where animals have the ability to communicate through music and sound. Write a story about a group of animals who discover this ability and how it changes their lives.', 'motif_injected': None}
2025-10-30 00:45:17,062 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 00:45:24,028 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, character logic, and tone. It does not contradict any known facts or principles.'}
2025-10-30 00:45:24,028 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, character logic, and tone. It does not contradict any known facts or principles.'}
2025-10-30 00:45:24,028 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": {"WORLD_CONTEXT": "Turn 2 | Day 1 | Time afternoon\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Morning mist veils battlements, a time of soft light.\", \"sensory_details\": \"The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically.\"}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battle...
2025-10-30 00:45:24,028 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-30 00:45:24,028 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': {'WORLD_CONTEXT': 'Turn 2 | Day 1 | Time afternoon\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Morning mist veils battlements, a time of soft light.", "sensory_details": "The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically."}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon...; The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. \'What brings you here so early?\'... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 52, "morale": 54, "resources": 42, "knowledge": 47, "corruption": 10, "glitch": 18, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'afternoon', 'previous_atmosphere': 'Morning mist veils battlements, a time of soft light.', 'previous_sensory_details': 'The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically.', 'creativity_layer': 'Sure, here is the rewritten prompt in a slightly different way:\n\nI want you to imagine a world where animals have the ability to communicate through music and sound. Write a story about a group of animals who discover this ability and how it changes their lives.', 'motif_injected': None}, 'day': 1, 'time': 'afternoon', 'room': 'entrance', 'recent_events': "The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon...; The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. 'What brings you here so early?'...", 'world_constraint_from_prev_turn': '{"atmosphere": "Morning mist veils battlements, a time of soft light.", "sensory_details": "The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically."}', 'recent_motifs': 'none', 'lore_continuity_weight': 0, 'memory_layers': ['Turn 1: Approach the Shieldbearer and ask about the drums you hear. -> The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The l...', 'Turn 2: Ask him about the drums you hear in the distance. -> The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you a...'], 'judge_verdict': '{"consistent": true, "reason": "The content is consistent with established world, lore, and character logic. The scene accurately reflects the Shieldbearer\'s state of exhaustion and the atmospheric conditions.", "coherence": 100, "integrity": 100, "tone_alignment": 100, "penalty_applied": "none", "penalty_magnitude": {}, "feedback": {}}', 'judge_feedback': {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene accurately reflects the Shieldbearer's state of exhaustion and the atmospheric conditions.", 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'continuity_weight': 0.0, 'skip_major': False}
2025-10-30 00:45:57,174 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. 'What brings you here so early?' he asks.", 'options': [{'id': 'ask_about_drums', 'text': 'Ask him about the drums you hear in the distance.', 'action_type': 'dialog'}, {'id': 'offer_help', 'text': 'Offer to help with the watch, suggesting that your presence might provide some relief.', 'action_type': 'dialog'}, {'id': 'inquire_about_mystery', 'text': 'Inquire about any mysterious figures or events he may have noticed recently.', 'action_type': 'dialog'}], 'major_event': False, 'safe_functions': []}
2025-10-30 00:45:57,174 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. 'What brings you here so early?' he asks.", 'options': [{'id': 'ask_about_drums', 'text': 'Ask him about the drums you hear in the distance.', 'action_type': 'dialog'}, {'id': 'offer_help', 'text': 'Offer to help with the watch, suggesting that your presence might provide some relief.', 'action_type': 'dialog'}, {'id': 'inquire_about_mystery', 'text': 'Inquire about any mysterious figures or events he may have noticed recently.', 'action_type': 'dialog'}], 'major_event': False, 'safe_functions': []}
2025-10-30 00:45:57,174 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-30 00:45:57,174 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialog", "id": "ask_about_drums", "text": "Ask him about the drums you hear in the distance."}, {"action_type": "dialog", "id": "offer_help", "text": "Offer to help with the watch, suggesting that your presence might provide some relief."}, {"action_type": "dialog", "id": "inquire_about_mystery", "text": "Inquire about any mysterious figures or events he may have noticed recently."}], "safe_functions": [], "scene": "The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect ...
2025-10-30 00:45:57,174 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 00:46:03,965 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The Shieldbearer's curiosity about the drums in the distance aligns with his role as a defender."}
2025-10-30 00:46:03,965 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The Shieldbearer's curiosity about the drums in the distance aligns with his role as a defender."}
2025-10-30 00:46:03,966 [INFO] fortress_director.orchestrator.orchestrator: Added motif-based option: diplomacy_approach (motif active)
2025-10-30 00:46:03,966 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-30 00:46:03,966 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'ask_about_drums', 'text': 'Ask him about the drums you hear in the distance.', 'action_type': 'dialog'}
2025-10-30 00:46:03,966 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialog", "id": "ask_about_drums", "text": "Ask him about the drums you hear in the distance."}
2025-10-30 00:46:03,966 [DEBUG] fortress_director.orchestrator.orchestrator: No dynamic metrics for action_type 'dialog'
2025-10-30 00:46:03,966 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 2 | Day 1 | Time afternoon\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Morning mist veils battlements, a time of soft light.\", \"sensory_details\": \"The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically.\"}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an ...
2025-10-30 00:46:03,966 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-30 00:46:03,966 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 2 | Day 1 | Time afternoon\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Morning mist veils battlements, a time of soft light.", "sensory_details": "The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically."}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon...; The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. \'What brings you here so early?\'... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 52, "morale": 54, "resources": 42, "knowledge": 47, "corruption": 10, "glitch": 18, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': "The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. 'What brings you here so early?' he asks.", 'player_choice': 'Ask him about the drums you hear in the distance.', 'atmosphere': 'Afternoon haze envelops stone ramparts, a time of warm light.', 'sensory_details': 'The air is filled with the metallic tang and earthiness as one can feel the cool breeze against skin. Distant drums beat rhythmically.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player', 'player_inventory_brief': 'oil lamp, patched shield', 'memory_layers': ['Turn 1: Approach the Shieldbearer and ask about the drums you hear. -> The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The l...', 'Turn 2: Ask him about the drums you hear in the distance. -> The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you a...'], 'recent_events': "The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon...; The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. 'What brings you here so early?'...", 'last_major_event': False}
2025-10-30 00:46:12,723 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'I stand vigilant. The morning mist paints the ramparts in a soft glow, a stark contrast to the usual midday gloom.'}
2025-10-30 00:46:12,723 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'I stand vigilant. The morning mist paints the ramparts in a soft glow, a stark contrast to the usual midday gloom.', 'effects': {}, 'safe_functions': []}]
2025-10-30 00:46:12,724 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-30 00:46:12,724 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "stand_vigilance", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "I stand vigilant. The morning mist paints the ramparts in a soft glow, a stark contrast to the usual midday gloom."}]
2025-10-30 00:46:12,724 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-30 00:46:12,724 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-30 00:46:12,725 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-30 00:46:12,725 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "stand_vigilance", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "I stand vigilant. The morning mist paints the ramparts in a soft glow, a stark contrast to the usual midday gloom."}]
2025-10-30 00:46:12,725 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-30 00:46:12,725 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 2, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['recent_events'], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 2, 'day': 1, 'time': 'afternoon', 'current_room': 'entrance', 'recent_events': ['The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon...', "The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. 'What brings you here so early?'..."], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'Morning mist veils battlements, a time of soft light.', 'sensory_details': 'The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player', 'metrics': {'order': 52, 'morale': 54, 'resources': 42, 'knowledge': 47, 'corruption': 10, 'glitch': 18, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {'Rhea': 1}, 'previous_judge_verdict': {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The Shieldbearer's curiosity about the drums in the distance aligns with his role as a defender.", 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['dialogue', 'dialog'], 'summary_text': 'The day passes quietly.', 'memory_short': ['Turn 1: Approach the Shieldbearer and ask about the drums you hear. -> The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The l...', 'Turn 2: Ask him about the drums you hear in the distance. -> The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you a...'], 'memory_long': [], 'status_effects': []}
2025-10-30 00:46:12,726 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'I stand vigilant. The morning mist paints the ramparts in a soft glow, a stark contrast to the usual midday gloom.', 'effects': {}, 'safe_functions': []}]
2025-10-30 00:46:12,726 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 2 | Day 1 | Time afternoon
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Morning mist veils battlements, a time of soft light.", "sensory_details": "The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically."}
Recent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon...; The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. 'What brings you here so early?'... Recent motifs: communication
Recent major events: none
Relationship summary: Rhea trusts the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 52, "morale": 54, "resources": 42, "knowledge": 47, "corruption": 10, "glitch": 18, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: The Shieldbearer, still gazing at the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. 'What brings you here so early?' he asks., player_choice: {'id': 'ask_about_drums', 'text': 'Ask him about the drums you hear in the distance.', 'action_type': 'dialog'}
2025-10-30 00:46:12,726 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-30 00:46:12,726 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'I stand vigilant. The morning mist paints the ramparts in a soft glow, a stark contrast to the usual midday gloom.', 'effects': {}, 'safe_functions': []}
2025-10-30 00:46:12,726 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-30 00:46:12,726 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-30 00:46:19,373 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for the context.'}
2025-10-30 00:46:19,374 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for the context.'}
2025-10-30 00:46:19,374 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for the context.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-30 00:46:19,374 [INFO] fortress_director.rules.rules_engine: Tier two validation passed with penalties: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-30 00:46:19,374 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-10-30 00:46:19,374 [INFO] fortress_director.rules.rules_engine: Relationship summary updated: Rhea trusts the player
2025-10-30 00:46:19,375 [INFO] fortress_director.rules.rules_engine: Judge penalties applied: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-30 00:46:19,375 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-30 00:46:19,375 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 2, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['recent_events'], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 2, 'day': 1, 'time': 'afternoon', 'current_room': 'entrance', 'recent_events': ['The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an eerie pallor on the landscape. The drums beyon...', "The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you as you approach. His eyes reflect a mix of exhaustion and curiosity. 'What brings you here so early?'..."], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'Morning mist veils battlements, a time of soft light.', 'sensory_details': 'The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player', 'metrics': {'order': 52, 'morale': 54, 'resources': 42, 'knowledge': 47, 'corruption': 10, 'glitch': 18, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {'Rhea': 1}, 'previous_judge_verdict': {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The Shieldbearer's curiosity about the drums in the distance aligns with his role as a defender.", 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['dialogue', 'dialog', 'dialog'], 'summary_text': 'The day passes quietly.', 'memory_short': ['Turn 1: Approach the Shieldbearer and ask about the drums you hear. -> The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The l...', 'Turn 2: Ask him about the drums you hear in the distance. -> The Shieldbearer, his gaze still fixed on the distant horizon where the drums echoed, turns to you a...'], 'memory_long': [], 'status_effects': []}
2025-10-30 00:46:19,375 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=3)
2025-10-30 00:46:19,376 [INFO] fortress_director.orchestrator.orchestrator: Applying 2 autonomous actions
2025-10-30 00:46:19,376 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=52, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-10-30 00:46:19,376 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': 1, 'value': 53, 'cause': 'autonomous_Rhea'}
2025-10-30 00:46:19,376 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 52 to 53 (cause=autonomous_Rhea)
2025-10-30 00:46:19,376 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=54, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-10-30 00:46:19,376 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 55, 'cause': 'autonomous_Rhea'}
2025-10-30 00:46:19,376 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 54 to 55 (cause=autonomous_Rhea)
2025-10-30 00:46:19,377 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'resources': current=42, delta=1, limits=(0, 120) (cause=autonomous_Boris)
2025-10-30 00:46:19,377 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'resources', 'delta': 1, 'value': 43, 'cause': 'autonomous_Boris'}
2025-10-30 00:46:19,377 [INFO] fortress_director.utils.metrics_manager: Metric 'resources' updated from 42 to 43 (cause=autonomous_Boris)
2025-10-30 00:46:19,377 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=55, delta=1, limits=(0, 100) (cause=autonomous_Boris)
2025-10-30 00:46:19,377 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 56, 'cause': 'autonomous_Boris'}
2025-10-30 00:46:19,377 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 55 to 56 (cause=autonomous_Boris)
2025-10-30 00:46:19,377 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-30 00:46:19,378 [INFO] fortress_director.orchestrator.orchestrator: Advanced time to evening
2025-10-30 00:46:19,378 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: []
2025-10-30 00:46:19,378 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-10-30 00:46:19,378 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 3, "day": 1, "flags": ["recent_events"], "inventory": [], "lore": {}, "memory_layers": [], "memory_long": [], "memory_short": ["Turn 1: Approach the Shieldbearer and ask about the drums you hear. -> The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The l...", "Turn 2: Ask him about the drums you hear in the distance. -> The Shieldbearer, his gaze still fixed o...
2025-10-30 00:46:19,379 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=3)
2025-10-30 00:46:19,379 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-30 00:46:19,380 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-30 00:46:19,380 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=3)
2025-10-30 00:46:19,381 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=3)
2025-10-30 00:46:19,381 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=3)
2025-10-30 00:46:19,381 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 53, 'morale': 56, 'resources': 43, 'knowledge': 47, 'corruption': 10, 'glitch': 18, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:46:19,381 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 53, 'morale': 56, 'resources': 43, 'knowledge': 47, 'corruption': 10, 'glitch': 18, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-30 00:46:19,381 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'conditions_not_met', 'description': 'Oyun devam ediyor...'}
2025-10-30 00:46:19,381 [INFO] fortress_director.orchestrator.orchestrator: Turn summary: The day passes quietly.
2025-10-30 00:46:19,382 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-30 00:46:19,382 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 2 | Day 1 | Time afternoon\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Morning mist veils battlements, a time of soft light.\", \"sensory_details\": \"The air carries the sharp tang of metal and earth one can feel the cool breeze against skin as distant drums beat rhythmically.\"}\nRecent events: The Shieldbearer, weary from his watch, glances at you with a mix of exhaustion and curiosity. The low clouds hang heavy over the battlements, casting an ...
2025-10-30 00:46:19,382 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-30 00:46:19,382 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
