2025-10-26 02:31:39,901 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251025_233139.log)
2025-10-26 02:31:39,901 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251025_233139.log)
2025-10-26 02:31:39,901 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251025_233139.log
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-26 02:31:39,909 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-26 02:31:39,909 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-26 02:31:39,909 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=0)
2025-10-26 02:31:39,909 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=None)
2025-10-26 02:31:39,925 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-26 02:31:39,925 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=0)
2025-10-26 02:31:39,925 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 0, "day": 1, "flags": [], "inventory": [], "lore": {}, "memory_layers": [], "metrics": {"corruption": 10, "glitch": 12, "knowledge": 45, "major_event_last_turn": null, "major_events_triggered": 0, "major_flag_set": false, "morale": 50, "order": 50, "resources": 40, "risk_applied_total": 0}, "npc_fragments": {}, "npc_trust": {}, "player": {"inventory": ["oil lamp", "patched shield"], "name": "The Shieldbe...
2025-10-26 02:31:39,925 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:31:39,925 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:31:39,925 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=1, seed=12345, current_glitch=12)
2025-10-26 02:31:39,925 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:31:39,925 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=12, delta=1, limits=(0, 100) (cause=glitch:cosmetic_noise)
2025-10-26 02:31:39,925 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 13, 'cause': 'glitch:cosmetic_noise'}
2025-10-26 02:31:39,925 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 12 to 13 (cause=glitch:cosmetic_noise)
2025-10-26 02:31:39,925 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=7, triggered_loss=False
2025-10-26 02:31:39,925 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 13, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:31:39,925 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Minor static ripples along the parapets.']
2025-10-26 02:31:39,925 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=7, triggered_loss=False
2025-10-26 02:31:39,925 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 13, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:31:39,926 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=13, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-26 02:31:39,926 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 12, 'cause': 'turn_recovery'}
2025-10-26 02:31:39,926 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 13 to 12 (cause=turn_recovery)
2025-10-26 02:31:39,926 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:31:39,926 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-26 02:31:39,926 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 0 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}
Recent events: none
Recent motifs: none
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade.
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-26 02:31:39,926 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 0 in room entrance
2025-10-26 02:31:39,926 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {\"order\": 50, \"morale\": 50, ...
2025-10-26 02:31:39,926 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-26 02:31:39,926 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance'}
2025-10-26 02:31:46,538 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Dawn breaks, casting a pale light over damp battlements.', 'sensory_details': 'The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol.'}
2025-10-26 02:31:46,538 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Dawn breaks, casting a pale light over damp battlements.', 'sensory_details': 'The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol.'}
2025-10-26 02:31:46,538 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-26 02:31:46,538 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn breaks, casting a pale light over damp battlements.", "sensory_details": "The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol."}
2025-10-26 02:31:46,538 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {\"order\": 50, \"morale\": 50, ...
2025-10-26 02:31:46,538 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-26 02:31:46,538 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': 'none', 'world_constraint_from_prev_turn': '{"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}', 'recent_motifs': 'none', 'lore_continuity_weight': 0, 'memory_layers': []}
2025-10-26 02:32:08,735 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': 'The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.', 'options': [{'id': '1', 'text': 'Ask Rhea about the drums you hear in the distance.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Check your oil lamp for any signs of leakage.', 'action_type': 'item_check'}, {'id': '3', 'text': 'Approach the battlements to get a better view of the enemy.', 'action_type': 'movement'}], 'major_event': False, 'safe_functions': []}
2025-10-26 02:32:08,735 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': 'The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.', 'options': [{'id': '1', 'text': 'Ask Rhea about the drums you hear in the distance.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Check your oil lamp for any signs of leakage.', 'action_type': 'item_check'}, {'id': '3', 'text': 'Approach the battlements to get a better view of the enemy.', 'action_type': 'movement'}], 'major_event': False, 'safe_functions': []}
2025-10-26 02:32:08,735 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-26 02:32:08,735 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialogue", "id": "1", "text": "Ask Rhea about the drums you hear in the distance."}, {"action_type": "item_check", "id": "2", "text": "Check your oil lamp for any signs of leakage."}, {"action_type": "movement", "id": "3", "text": "Approach the battlements to get a better view of the enemy."}], "safe_functions": [], "scene": "The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit."}
2025-10-26 02:32:08,735 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-26 02:32:08,735 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': '1', 'text': 'Ask Rhea about the drums you hear in the distance.', 'action_type': 'dialogue'}
2025-10-26 02:32:08,735 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialogue", "id": "1", "text": "Ask Rhea about the drums you hear in the distance."}
2025-10-26 02:32:08,735 [INFO] fortress_director.orchestrator.orchestrator: Applying dynamic metrics for action_type 'dialogue': {'morale': 1, 'knowledge': 2}
2025-10-26 02:32:08,735 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=50, delta=1, limits=(0, 100) (cause=action_dialogue)
2025-10-26 02:32:08,735 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 51, 'cause': 'action_dialogue'}
2025-10-26 02:32:08,735 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 50 to 51 (cause=action_dialogue)
2025-10-26 02:32:08,736 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'knowledge': current=45, delta=2, limits=(0, 100) (cause=action_dialogue)
2025-10-26 02:32:08,736 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'knowledge', 'delta': 2, 'value': 47, 'cause': 'action_dialogue'}
2025-10-26 02:32:08,736 [INFO] fortress_director.utils.metrics_manager: Metric 'knowledge' updated from 45 to 47 (cause=action_dialogue)
2025-10-26 02:32:08,736 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after dynamic changes: {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:32:08,736 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {\"order\": 50, \"morale\": 50, ...
2025-10-26 02:32:08,736 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-26 02:32:08,736 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': 'The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.', 'player_choice': 'Ask Rhea about the drums you hear in the distance.', 'atmosphere': 'Dawn breaks, casting a pale light over damp battlements.', 'sensory_details': 'The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player; Boris weighs every trade.', 'player_inventory_brief': 'oil lamp, patched shield'}
2025-10-26 02:32:16,219 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Rhea', 'intent': 'observe', 'action': 'stand still and listen', 'speech': 'I stand vigilant, listening for any sign of danger.', 'effects': {'trust_delta': 100, 'flag_set': ['low_clouds_hug_battlements'], 'item_change': None, 'status_change': None}}
2025-10-26 02:32:16,219 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Rhea', 'intent': 'observe', 'action': 'stand still and listen', 'speech': 'I stand vigilant, listening for any sign of danger.', 'effects': {'flag_set': ['low_clouds_hug_battlements']}}]
2025-10-26 02:32:16,219 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-26 02:32:16,219 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "stand still and listen", "effects": {"flag_set": ["low_clouds_hug_battlements"]}, "intent": "observe", "name": "Rhea", "speech": "I stand vigilant, listening for any sign of danger."}]
2025-10-26 02:32:16,219 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-26 02:32:16,219 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-26 02:32:16,219 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-26 02:32:16,219 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "stand still and listen", "effects": {"flag_set": ["low_clouds_hug_battlements"]}, "intent": "observe", "name": "Rhea", "speech": "I stand vigilant, listening for any sign of danger."}]
2025-10-26 02:32:16,219 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-26 02:32:16,219 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 10, 'current_turn': 0, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': [], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 0, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': [], 'recent_motifs': [], 'world_constraint_from_prev_turn': {'atmosphere': 'low clouds hug the battlements', 'sensory_details': 'Drums thud beyond the walls while the wind carries grit.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}}
2025-10-26 02:32:16,219 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'observe', 'action': 'stand still and listen', 'speech': 'I stand vigilant, listening for any sign of danger.', 'effects': {'flag_set': ['low_clouds_hug_battlements']}}]
2025-10-26 02:32:16,219 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 0 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}
Recent events: none
Recent motifs: none
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade.
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit., player_choice: {'id': '1', 'text': 'Ask Rhea about the drums you hear in the distance.', 'action_type': 'dialogue'}
2025-10-26 02:32:16,219 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-26 02:32:16,219 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'observe', 'action': 'stand still and listen', 'speech': 'I stand vigilant, listening for any sign of danger.', 'effects': {'flag_set': ['low_clouds_hug_battlements']}}
2025-10-26 02:32:16,219 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-26 02:32:16,219 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-26 02:32:22,321 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene and player choice are in line with the established world and the characters' roles."}
2025-10-26 02:32:22,322 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene and player choice are in line with the established world and the characters' roles."}
2025-10-26 02:32:22,322 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene and player choice are in line with the established world and the characters' roles."}
2025-10-26 02:32:22,322 [INFO] fortress_director.rules.rules_engine: Tier two validation passed.
2025-10-26 02:32:22,322 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {'flag_set': ['low_clouds_hug_battlements']}
2025-10-26 02:32:22,322 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-26 02:32:22,322 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 10, 'current_turn': 0, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_clouds_hug_battlements'], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 0, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': [], 'recent_motifs': [], 'world_constraint_from_prev_turn': {'atmosphere': 'low clouds hug the battlements', 'sensory_details': 'Drums thud beyond the walls while the wind carries grit.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}}
2025-10-26 02:32:22,322 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=1)
2025-10-26 02:32:22,323 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-26 02:32:22,323 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 1, "day": 1, "flags": ["low_clouds_hug_battlements"], "inventory": [], "lore": {}, "memory_layers": ["Turn 1: Ask Rhea about the drums you hear in the distance. -> The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clou..."], "metrics": {"corruption": 10, "glitch": 12, "knowledge": 47, "major_event_last_turn": null, "major_events_triggered": 0, "major_flag_set...
2025-10-26 02:32:22,324 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=1)
2025-10-26 02:32:22,324 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-26 02:32:22,324 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-26 02:32:22,324 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=1)
2025-10-26 02:32:22,324 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:32:22,324 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:32:22,324 [DEBUG] fortress_director.agents.judge_agent: Evaluating win/loss (turn=1/10) with metrics={'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:32:22,324 [INFO] fortress_director.agents.judge_agent: Win/loss evaluation result: {'status': 'ongoing', 'reason': 'thresholds_not_met'}
2025-10-26 02:32:22,324 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'thresholds_not_met'}
2025-10-26 02:32:22,325 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-26 02:32:22,325 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {\"order\": 50, \"morale\": 50, ...
2025-10-26 02:32:22,325 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-26 02:32:22,325 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
2025-10-26 02:32:22,336 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-26 02:32:22,336 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-26 02:32:22,336 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-26 02:32:22,336 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-26 02:32:22,336 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-26 02:32:22,337 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-26 02:32:22,337 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-26 02:32:22,337 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-26 02:32:22,337 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-26 02:32:22,337 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-26 02:32:22,337 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-26 02:32:22,337 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-26 02:32:22,337 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-26 02:32:22,337 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-26 02:32:22,337 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-26 02:32:22,337 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-26 02:32:22,337 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-26 02:32:22,339 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-26 02:32:22,339 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-26 02:32:22,339 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-26 02:32:22,339 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-26 02:32:22,339 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-26 02:32:22,339 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=1)
2025-10-26 02:32:22,339 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=1, call=None)
2025-10-26 02:32:22,339 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-26 02:32:22,340 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=1)
2025-10-26 02:32:22,340 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 1, "day": 1, "flags": ["low_clouds_hug_battlements"], "inventory": [], "lore": {}, "memory_layers": ["Turn 1: Ask Rhea about the drums you hear in the distance. -> The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clou..."], "metrics": {"corruption": 10, "glitch": 12, "knowledge": 47, "major_event_last_turn": null, "major_events_triggered": 0, "major_flag_set...
2025-10-26 02:32:22,340 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:32:22,340 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:32:22,340 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=2, seed=12345, current_glitch=12)
2025-10-26 02:32:22,340 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:32:22,340 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=12, delta=15, limits=(0, 100) (cause=glitch:overload)
2025-10-26 02:32:22,340 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 15, 'value': 27, 'cause': 'glitch:overload'}
2025-10-26 02:32:22,340 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 12 to 27 (cause=glitch:overload)
2025-10-26 02:32:22,340 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=99, triggered_loss=True
2025-10-26 02:32:22,340 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 27, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:32:22,340 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Glitch cascade overwhelms containment protocols.']
2025-10-26 02:32:22,340 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=99, triggered_loss=True
2025-10-26 02:32:22,341 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 27, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:32:22,341 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=27, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-26 02:32:22,341 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 26, 'cause': 'turn_recovery'}
2025-10-26 02:32:22,341 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 27 to 26 (cause=turn_recovery)
2025-10-26 02:32:22,341 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-26 02:32:22,341 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-26 02:32:22,341 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 1 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn breaks, casting a pale light over damp battlements.", "sensory_details": "The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol."}
Recent events: The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.
Recent motifs: none
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade.
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 51, "resources": 40, "knowledge": 47, "corruption": 10, "glitch": 26, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-26 02:32:22,341 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 1 in room entrance
2025-10-26 02:32:22,341 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn breaks, casting a pale light over damp battlements.\", \"sensory_details\": \"The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol.\"}\nRecent events: The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.\nRecent moti...
2025-10-26 02:32:22,341 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-26 02:32:22,341 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 1 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn breaks, casting a pale light over damp battlements.", "sensory_details": "The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol."}\nRecent events: The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 51, "resources": 40, "knowledge": 47, "corruption": 10, "glitch": 26, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance'}
2025-10-26 02:32:28,782 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Dawn'thin light filters through, damp battlements whisper tales of impending day.", 'sensory_details': 'The cool morning breeze caresses the rough stone walls while a symphony of distant clashing metals and wood echoes.'}
2025-10-26 02:32:28,782 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': "Dawn'thin light filters through, damp battlements whisper tales of impending day.", 'sensory_details': 'The cool morning breeze caresses the rough stone walls while a symphony of distant clashing metals and wood echoes.'}
2025-10-26 02:32:28,782 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-26 02:32:28,782 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn'thin light filters through, damp battlements whisper tales of impending day.", "sensory_details": "The cool morning breeze caresses the rough stone walls while a symphony of distant clashing metals and wood echoes."}
2025-10-26 02:32:28,782 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn breaks, casting a pale light over damp battlements.\", \"sensory_details\": \"The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol.\"}\nRecent events: The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.\nRecent moti...
2025-10-26 02:32:28,782 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-26 02:32:28,782 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 1 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn breaks, casting a pale light over damp battlements.", "sensory_details": "The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol."}\nRecent events: The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 51, "resources": 40, "knowledge": 47, "corruption": 10, "glitch": 26, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': 'The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.', 'world_constraint_from_prev_turn': '{"atmosphere": "Dawn breaks, casting a pale light over damp battlements.", "sensory_details": "The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol."}', 'recent_motifs': 'none', 'lore_continuity_weight': 0, 'memory_layers': ['Turn 1: Ask Rhea about the drums you hear in the distance. -> The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clou...']}
2025-10-26 02:32:53,674 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': 'The Shieldbearer, gazing out into the distance, suddenly notices a figure lurking in the shadows beyond the walls. The figure seems to be watching Lornhaven intently.', 'options': [{'id': '1', 'text': 'Approach the Shieldbearer and ask about the mysterious figure.', 'action_type': 'dialog'}, {'id': '2', 'text': 'Stay hidden and observe the figure from a distance.', 'action_type': 'exploration'}, {'id': '3', 'text': 'Ignoring the figure, focus on your duties at the gate.', 'action_type': 'task'}], 'major_event': True, 'safe_functions': ["spawn_item('torch', 'lornhaven_wall')", "move_npc('Rhea', 'lornhaven_gate')"]}
2025-10-26 02:32:53,674 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': 'The Shieldbearer, gazing out into the distance, suddenly notices a figure lurking in the shadows beyond the walls. The figure seems to be watching Lornhaven intently.', 'options': [{'id': '1', 'text': 'Approach the Shieldbearer and ask about the mysterious figure.', 'action_type': 'dialog'}, {'id': '2', 'text': 'Stay hidden and observe the figure from a distance.', 'action_type': 'exploration'}, {'id': '3', 'text': 'Ignoring the figure, focus on your duties at the gate.', 'action_type': 'task'}], 'major_event': True, 'safe_functions': ["spawn_item('torch', 'lornhaven_wall')", "move_npc('Rhea', 'lornhaven_gate')"]}
2025-10-26 02:32:53,674 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-26 02:32:53,674 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": true, "options": [{"action_type": "dialog", "id": "1", "text": "Approach the Shieldbearer and ask about the mysterious figure."}, {"action_type": "exploration", "id": "2", "text": "Stay hidden and observe the figure from a distance."}, {"action_type": "task", "id": "3", "text": "Ignoring the figure, focus on your duties at the gate."}], "safe_functions": ["spawn_item('torch', 'lornhaven_wall')", "move_npc('Rhea', 'lornhaven_gate')"], "scene": "The Shieldbearer, gazing out into the distance, suddenly notices a figure lurking in the shadows beyond the walls. The figure seems t...
2025-10-26 02:32:53,674 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-26 02:32:53,674 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': '1', 'text': 'Approach the Shieldbearer and ask about the mysterious figure.', 'action_type': 'dialog'}
2025-10-26 02:32:53,674 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialog", "id": "1", "text": "Approach the Shieldbearer and ask about the mysterious figure."}
2025-10-26 02:32:53,674 [DEBUG] fortress_director.orchestrator.orchestrator: No dynamic metrics for action_type 'dialog'
2025-10-26 02:32:53,674 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn breaks, casting a pale light over damp battlements.\", \"sensory_details\": \"The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol.\"}\nRecent events: The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.\nRecent moti...
2025-10-26 02:32:53,674 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-26 02:32:53,674 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 1 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn breaks, casting a pale light over damp battlements.", "sensory_details": "The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol."}\nRecent events: The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 51, "resources": 40, "knowledge": 47, "corruption": 10, "glitch": 26, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': 'The Shieldbearer, gazing out into the distance, suddenly notices a figure lurking in the shadows beyond the walls. The figure seems to be watching Lornhaven intently.', 'player_choice': 'Approach the Shieldbearer and ask about the mysterious figure.', 'atmosphere': "Dawn'thin light filters through, damp battlements whisper tales of impending day.", 'sensory_details': 'The cool morning breeze caresses the rough stone walls while a symphony of distant clashing metals and wood echoes.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player; Boris weighs every trade.', 'player_inventory_brief': 'oil lamp, patched shield'}
2025-10-26 02:33:00,782 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilance', 'speech': 'I stand vigilant, ready to defend the western wall from any threat.', 'effects': {'trust_delta': 50, 'flag_set': ['world_watcher_active'], 'item_change': None, 'status_change': {'health': 100}}}
2025-10-26 02:33:00,782 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilance', 'speech': 'I stand vigilant, ready to defend the western wall from any threat.', 'effects': {'flag_set': ['world_watcher_active']}}]
2025-10-26 02:33:00,782 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-26 02:33:00,782 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "stand_vigilance", "effects": {"flag_set": ["world_watcher_active"]}, "intent": "vigilance", "name": "Shieldbearer", "speech": "I stand vigilant, ready to defend the western wall from any threat."}]
2025-10-26 02:33:00,782 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-26 02:33:00,782 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-26 02:33:00,782 [DEBUG] fortress_director.orchestrator.orchestrator: Major event effect applied: {"applied_flag": "major_wall_alert", "applied_to": "Shieldbearer", "status_change": {"duration": 3, "status": "tense_watch", "target": "Shieldbearer"}}
2025-10-26 02:33:00,782 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-26 02:33:00,782 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "stand_vigilance", "effects": {"flag_set": ["world_watcher_active", "major_wall_alert"], "status_change": {"duration": 3, "status": "tense_watch", "target": "Shieldbearer"}, "trust_delta": 0}, "intent": "vigilance", "name": "Shieldbearer", "speech": "I stand vigilant, ready to defend the western wall from any threat."}]
2025-10-26 02:33:00,782 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-26 02:33:00,782 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 10, 'current_turn': 1, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_clouds_hug_battlements'], 'memory_layers': ['Turn 1: Ask Rhea about the drums you hear in the distance. -> The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clou...'], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 1, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': ['The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.'], 'recent_motifs': [], 'world_constraint_from_prev_turn': {'atmosphere': 'Dawn breaks, casting a pale light over damp battlements.', 'sensory_details': 'The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}}
2025-10-26 02:33:00,782 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilance', 'speech': 'I stand vigilant, ready to defend the western wall from any threat.', 'effects': {'flag_set': ['world_watcher_active', 'major_wall_alert'], 'status_change': {'target': 'Shieldbearer', 'status': 'tense_watch', 'duration': 3}, 'trust_delta': 0}}]
2025-10-26 02:33:00,784 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 1 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn breaks, casting a pale light over damp battlements.", "sensory_details": "The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol."}
Recent events: The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.
Recent motifs: none
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade.
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 51, "resources": 40, "knowledge": 47, "corruption": 10, "glitch": 26, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: The Shieldbearer, gazing out into the distance, suddenly notices a figure lurking in the shadows beyond the walls. The figure seems to be watching Lornhaven intently., player_choice: {'id': '1', 'text': 'Approach the Shieldbearer and ask about the mysterious figure.', 'action_type': 'dialog'}
2025-10-26 02:33:00,784 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-26 02:33:00,784 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilance', 'speech': 'I stand vigilant, ready to defend the western wall from any threat.', 'effects': {'flag_set': ['world_watcher_active', 'major_wall_alert'], 'status_change': {'target': 'Shieldbearer', 'status': 'tense_watch', 'duration': 3}, 'trust_delta': 0}}
2025-10-26 02:33:00,784 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-26 02:33:00,784 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-26 02:33:05,915 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the established lore where a vigilant Shieldbearer notices an unknown figure beyond the walls.'}
2025-10-26 02:33:05,915 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the established lore where a vigilant Shieldbearer notices an unknown figure beyond the walls.'}
2025-10-26 02:33:05,916 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Shieldbearer: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the established lore where a vigilant Shieldbearer notices an unknown figure beyond the walls.'}
2025-10-26 02:33:05,916 [INFO] fortress_director.rules.rules_engine: Tier two validation passed.
2025-10-26 02:33:05,916 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Shieldbearer: {'flag_set': ['world_watcher_active', 'major_wall_alert'], 'status_change': {'target': 'Shieldbearer', 'status': 'tense_watch', 'duration': 3}, 'trust_delta': 0}
2025-10-26 02:33:05,916 [INFO] fortress_director.rules.rules_engine: Trust updated for Shieldbearer: 0 -> 0 (delta: 0)
2025-10-26 02:33:05,916 [INFO] fortress_director.rules.rules_engine: Relationship summary updated: Shieldbearer is neutral toward the player
2025-10-26 02:33:05,916 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-26 02:33:05,916 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 10, 'current_turn': 1, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_clouds_hug_battlements', 'world_watcher_active', 'major_wall_alert'], 'memory_layers': ['Turn 1: Ask Rhea about the drums you hear in the distance. -> The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clou...'], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 1, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': ['The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.'], 'recent_motifs': [], 'world_constraint_from_prev_turn': {'atmosphere': 'Dawn breaks, casting a pale light over damp battlements.', 'sensory_details': 'The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Shieldbearer is neutral toward the player', 'metrics': {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 1, 'major_event_last_turn': 1}, 'npc_trust': {'Shieldbearer': 0}, 'status_effects': [{'target': 'Shieldbearer', 'status': 'tense_watch', 'duration': 3}]}
2025-10-26 02:33:05,916 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=2)
2025-10-26 02:33:05,916 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-26 02:33:05,916 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 2, "day": 1, "flags": ["low_clouds_hug_battlements", "world_watcher_active", "major_wall_alert"], "inventory": [], "lore": {}, "major_event_last_turn": 2, "major_events_triggered": 1, "memory_layers": ["Turn 1: Ask Rhea about the drums you hear in the distance. -> The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clou...", "Turn 2: Approach the Shieldbearer a...
2025-10-26 02:33:05,916 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-26 02:33:05,916 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-26 02:33:05,916 [INFO] fortress_director.codeaware.function_registry: Validating function call: spawn_item
2025-10-26 02:33:05,916 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-26 02:33:05,916 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=2, call=spawn_item)
2025-10-26 02:33:05,919 [INFO] fortress_director.codeaware.function_registry: Getting registered function: spawn_item
2025-10-26 02:33:05,919 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'spawn_item'...
2025-10-26 02:33:05,919 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-26 02:33:05,919 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-26 02:33:05,919 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed successfully.
2025-10-26 02:33:05,919 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed (checkpoint turn=2)
2025-10-26 02:33:05,919 [INFO] fortress_director.codeaware.function_registry: Validating function call: move_npc
2025-10-26 02:33:05,919 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-26 02:33:05,919 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=2, call=move_npc)
2025-10-26 02:33:05,919 [INFO] fortress_director.codeaware.function_registry: Getting registered function: move_npc
2025-10-26 02:33:05,919 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'move_npc'...
2025-10-26 02:33:05,921 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-26 02:33:05,921 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-26 02:33:05,921 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_npc' executed successfully.
2025-10-26 02:33:05,921 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_npc' executed (checkpoint turn=2)
2025-10-26 02:33:05,921 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-26 02:33:05,921 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-26 02:33:05,921 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 1, 'major_event_last_turn': 1}
2025-10-26 02:33:05,921 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 1, 'major_event_last_turn': 1}
2025-10-26 02:33:05,921 [DEBUG] fortress_director.agents.judge_agent: Evaluating win/loss (turn=2/10) with metrics={'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 26, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 1, 'major_event_last_turn': 1}
2025-10-26 02:33:05,921 [INFO] fortress_director.agents.judge_agent: Win/loss evaluation result: {'status': 'loss', 'reason': 'glitch_overload'}
2025-10-26 02:33:05,922 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'loss', 'reason': 'glitch_overload'}
2025-10-26 02:33:05,922 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=2)
2025-10-26 02:33:05,922 [INFO] fortress_director.orchestrator.orchestrator: Game finalized, state persisted.
2025-10-26 02:33:05,922 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-26 02:33:05,923 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn breaks, casting a pale light over damp battlements.\", \"sensory_details\": \"The scent of wet stone mingles with the distant clangor of metal and wood as guards patrol.\"}\nRecent events: The Shieldbearer, standing at the entrance of Lornhaven, gazes out into the distance as the low clouds hug the battlements and drums thud beyond the walls. The wind carries grit.\nRecent moti...
2025-10-26 02:33:05,923 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-26 02:33:05,923 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
