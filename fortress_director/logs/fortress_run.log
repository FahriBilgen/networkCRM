2025-10-29 12:38:10,028 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-29 13:09:46,087 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-29 13:14:21,110 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-29 13:14:26,547 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-29 14:13:03,896 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-29 14:14:53,285 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-29 15:57:49,705 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-29 15:57:49,725 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-29 15:57:49,726 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-29 15:57:49,726 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-29 15:57:49,726 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-29 15:57:49,726 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-29 15:57:49,726 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-29 15:57:49,727 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-29 15:57:49,727 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-29 15:57:49,727 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-29 15:57:49,727 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-29 15:57:49,727 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-29 15:57:49,728 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-29 15:57:49,728 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-29 15:57:49,728 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-29 15:57:49,728 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-29 15:57:49,728 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-29 15:57:49,728 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-29 15:57:49,728 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-29 15:57:49,729 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-29 15:57:49,729 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-29 15:57:49,729 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-29 15:57:49,729 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-29 15:57:49,729 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=0)
2025-10-29 15:57:49,729 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=None)
2025-10-29 15:57:49,731 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-29 15:57:49,731 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=0)
2025-10-29 15:57:49,731 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 0, "day": 1, "flags": [], "inventory": [], "lore": {}, "memory_layers": [], "metrics": {"corruption": 10, "glitch": 12, "knowledge": 45, "major_event_last_turn": null, "major_events_triggered": 0, "major_flag_set": false, "morale": 50, "order": 50, "resources": 40, "risk_applied_total": 0}, "npc_fragments": {}, "npc_trust": {}, "player": {"inventory": ["oil lamp", "patched shield"], "name": "The Shieldbe...
2025-10-29 15:57:49,731 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:57:49,732 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:57:49,732 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=1, seed=12345, current_glitch=12)
2025-10-29 15:57:49,732 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:57:49,732 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=12, delta=1, limits=(0, 100) (cause=glitch:cosmetic_noise)
2025-10-29 15:57:49,732 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 13, 'cause': 'glitch:cosmetic_noise'}
2025-10-29 15:57:49,733 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 12 to 13 (cause=glitch:cosmetic_noise)
2025-10-29 15:57:49,733 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=7, triggered_loss=False
2025-10-29 15:57:49,733 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 13, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:57:49,733 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Minor static ripples along the parapets.']
2025-10-29 15:57:49,733 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=7, triggered_loss=False
2025-10-29 15:57:49,734 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 13, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:57:49,734 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=13, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-29 15:57:49,734 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 12, 'cause': 'turn_recovery'}
2025-10-29 15:57:49,734 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 13 to 12 (cause=turn_recovery)
2025-10-29 15:57:49,734 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:57:49,735 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=7, triggered_loss=False
2025-10-29 15:57:49,735 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:57:49,735 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-29 15:57:49,735 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 0 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}
Recent events: none
Recent motifs: none
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-29 15:57:49,736 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 0 in room entrance
2025-10-29 15:57:49,736 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {\"order\": 50, \"morale\": 50, \"r...
2025-10-29 15:57:49,736 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-29 15:57:49,737 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'dawn'}
2025-10-29 15:58:00,041 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Dawn'thin mist veils over stone and mortar.", 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}
2025-10-29 15:58:00,041 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}
2025-10-29 15:58:00,041 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-29 15:58:00,041 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}
2025-10-29 15:58:00,042 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {\"order\": 50, \"morale\": 50, \"r...
2025-10-29 15:58:00,042 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-29 15:58:00,042 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': 'none', 'world_constraint_from_prev_turn': '{"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}', 'recent_motifs': 'none', 'lore_continuity_weight': 0, 'memory_layers': [], 'judge_verdict': '{}', 'judge_feedback': {}, 'skip_major': False}
2025-10-29 15:58:37,569 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As dawn breaks, she glances towards you, a weary look in her eyes.', 'options': [{'id': '1', 'text': 'Approach Rhea and ask about the drums you hear beyond the walls.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Take a moment to study the low clouds, searching for any signs of an impending attack.', 'action_type': 'exploration'}, {'id': '3', 'text': 'Light your oil lamp and head towards the battlements to investigate the drums yourself.', 'action_type': 'action'}], 'major_event': False, 'safe_functions': []}
2025-10-29 15:58:37,569 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As dawn breaks, she glances towards you, a weary look in her eyes.', 'options': [{'id': '1', 'text': 'Approach Rhea and ask about the drums you hear beyond the walls.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Take a moment to study the low clouds, searching for any signs of an impending attack.', 'action_type': 'exploration'}, {'id': '3', 'text': 'Light your oil lamp and head towards the battlements to investigate the drums yourself.', 'action_type': 'action'}], 'major_event': False, 'safe_functions': []}
2025-10-29 15:58:37,569 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-29 15:58:37,570 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialogue", "id": "1", "text": "Approach Rhea and ask about the drums you hear beyond the walls."}, {"action_type": "exploration", "id": "2", "text": "Take a moment to study the low clouds, searching for any signs of an impending attack."}, {"action_type": "action", "id": "3", "text": "Light your oil lamp and head towards the battlements to investigate the drums yourself."}], "safe_functions": [], "scene": "The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements....
2025-10-29 15:58:37,570 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-29 15:58:44,864 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene sets up a tense situation for the player to investigate further.'}
2025-10-29 15:58:44,864 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene sets up a tense situation for the player to investigate further.'}
2025-10-29 15:58:44,864 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-29 15:58:44,864 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': '1', 'text': 'Approach Rhea and ask about the drums you hear beyond the walls.', 'action_type': 'dialogue'}
2025-10-29 15:58:44,865 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialogue", "id": "1", "text": "Approach Rhea and ask about the drums you hear beyond the walls."}
2025-10-29 15:58:44,865 [INFO] fortress_director.orchestrator.orchestrator: Added motif: communication
2025-10-29 15:58:44,866 [INFO] fortress_director.orchestrator.orchestrator: Applying dynamic metrics for action_type 'dialogue': {'morale': 1, 'knowledge': 2}
2025-10-29 15:58:44,866 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=50, delta=1, limits=(0, 100) (cause=action_dialogue)
2025-10-29 15:58:44,866 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 51, 'cause': 'action_dialogue'}
2025-10-29 15:58:44,866 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 50 to 51 (cause=action_dialogue)
2025-10-29 15:58:44,866 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'knowledge': current=45, delta=2, limits=(0, 100) (cause=action_dialogue)
2025-10-29 15:58:44,866 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'knowledge', 'delta': 2, 'value': 47, 'cause': 'action_dialogue'}
2025-10-29 15:58:44,866 [INFO] fortress_director.utils.metrics_manager: Metric 'knowledge' updated from 45 to 47 (cause=action_dialogue)
2025-10-29 15:58:44,866 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after dynamic changes: {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:58:44,866 [INFO] fortress_director.orchestrator.orchestrator: Action consequence: Your words strengthen village bonds and reveal useful information.
2025-10-29 15:58:44,866 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {\"order\": 50, \"morale\": 50, \"r...
2025-10-29 15:58:44,866 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-29 15:58:44,866 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As dawn breaks, she glances towards you, a weary look in her eyes.', 'player_choice': 'Approach Rhea and ask about the drums you hear beyond the walls.', 'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player; Boris weighs every trade.', 'player_inventory_brief': 'oil lamp, patched shield', 'memory_layers': [], 'recent_events': 'none', 'last_major_event': False}
2025-10-29 15:58:54,394 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Rhea', 'intent': 'observe', 'action': 'stand and watch the horizon', 'speech': 'The wind whispers secrets through the clouds, a symphony of anticipation. The dawn paints the sky in hues of hope and fear.'}
2025-10-29 15:58:54,394 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Rhea', 'intent': 'observe', 'action': 'stand and watch the horizon', 'speech': 'The wind whispers secrets through the clouds, a symphony of anticipation. The dawn paints the sky in hues of hope and fear.', 'effects': {}, 'safe_functions': []}]
2025-10-29 15:58:54,394 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-29 15:58:54,394 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "stand and watch the horizon", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "The wind whispers secrets through the clouds, a symphony of anticipation. The dawn paints the sky in hues of hope and fear."}]
2025-10-29 15:58:54,394 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-29 15:58:54,395 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-29 15:58:54,395 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-29 15:58:54,395 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "stand and watch the horizon", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "The wind whispers secrets through the clouds, a symphony of anticipation. The dawn paints the sky in hues of hope and fear."}]
2025-10-29 15:58:54,395 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-29 15:58:54,395 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 0, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': [], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 0, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': [], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'low clouds hug the battlements', 'sensory_details': 'Drums thud beyond the walls while the wind carries grit.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}, 'previous_judge_verdict': {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene sets up a tense situation for the player to investigate further.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}}
2025-10-29 15:58:54,396 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'observe', 'action': 'stand and watch the horizon', 'speech': 'The wind whispers secrets through the clouds, a symphony of anticipation. The dawn paints the sky in hues of hope and fear.', 'effects': {}, 'safe_functions': []}]
2025-10-29 15:58:54,396 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 0 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}
Recent events: none
Recent motifs: none
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As dawn breaks, she glances towards you, a weary look in her eyes., player_choice: {'id': '1', 'text': 'Approach Rhea and ask about the drums you hear beyond the walls.', 'action_type': 'dialogue'}
2025-10-29 15:58:54,396 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-29 15:58:54,396 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'observe', 'action': 'stand and watch the horizon', 'speech': 'The wind whispers secrets through the clouds, a symphony of anticipation. The dawn paints the sky in hues of hope and fear.', 'effects': {}, 'safe_functions': []}
2025-10-29 15:58:54,396 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-29 15:58:54,396 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-29 15:59:01,037 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene and player choice are appropriate for the context of the game.'}
2025-10-29 15:59:01,037 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene and player choice are appropriate for the context of the game.'}
2025-10-29 15:59:01,037 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene and player choice are appropriate for the context of the game.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-29 15:59:01,037 [INFO] fortress_director.rules.rules_engine: Tier two validation passed with penalties: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-29 15:59:01,037 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-10-29 15:59:01,038 [INFO] fortress_director.rules.rules_engine: Choice impact applied: knowledge +1 (action_type=dialogue)
2025-10-29 15:59:01,038 [INFO] fortress_director.rules.rules_engine: Judge penalties applied: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-29 15:59:01,039 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-29 15:59:01,039 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 0, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': [], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 0, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': [], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'low clouds hug the battlements', 'sensory_details': 'Drums thud beyond the walls while the wind carries grit.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 50, 'morale': 51, 'resources': 40, 'knowledge': 48, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}, 'previous_judge_verdict': {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene sets up a tense situation for the player to investigate further.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['dialogue'], 'summary_text': 'The day passes quietly.'}
2025-10-29 15:59:01,039 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=1)
2025-10-29 15:59:01,039 [INFO] fortress_director.orchestrator.orchestrator: Applying 2 autonomous actions
2025-10-29 15:59:01,039 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=50, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-10-29 15:59:01,039 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': 1, 'value': 51, 'cause': 'autonomous_Rhea'}
2025-10-29 15:59:01,039 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 50 to 51 (cause=autonomous_Rhea)
2025-10-29 15:59:01,039 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'resources': current=40, delta=1, limits=(0, 120) (cause=autonomous_Boris)
2025-10-29 15:59:01,039 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'resources', 'delta': 1, 'value': 41, 'cause': 'autonomous_Boris'}
2025-10-29 15:59:01,039 [INFO] fortress_director.utils.metrics_manager: Metric 'resources' updated from 40 to 41 (cause=autonomous_Boris)
2025-10-29 15:59:01,040 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-29 15:59:01,040 [INFO] fortress_director.orchestrator.orchestrator: Advanced time to morning
2025-10-29 15:59:01,040 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: []
2025-10-29 15:59:01,040 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-10-29 15:59:01,040 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 1, "day": 1, "flags": [], "inventory": [], "lore": {}, "memory_layers": [], "memory_long": [], "memory_short": ["Turn 1: Approach Rhea and ask about the drums you hear beyond the walls. -> The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the l..."], "metrics": {"corruption": 10, "glitch": 12, "knowledge": 48, "major_event_last_turn": null, "major_events_trigg...
2025-10-29 15:59:01,042 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=1)
2025-10-29 15:59:01,042 [INFO] fortress_director.orchestrator.orchestrator: Injected test safe function to trigger rollback: spawn_item('undefined')
2025-10-29 15:59:01,042 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-29 15:59:01,042 [WARNING] fortress_director.orchestrator.orchestrator: Failed to parse safe function call 'spawn_item('undefined')': spawn_item requires item_id and target
2025-10-29 15:59:01,042 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-29 15:59:01,042 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=1)
2025-10-29 15:59:01,042 [INFO] fortress_director.codeaware.function_registry: Validating function call: change_weather
2025-10-29 15:59:01,043 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=1)
2025-10-29 15:59:01,043 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=1, call=change_weather)
2025-10-29 15:59:01,043 [INFO] fortress_director.codeaware.function_registry: Getting registered function: change_weather
2025-10-29 15:59:01,043 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'change_weather'...
2025-10-29 15:59:01,043 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=1)
2025-10-29 15:59:01,044 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=1)
2025-10-29 15:59:01,044 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed successfully.
2025-10-29 15:59:01,044 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed (checkpoint turn=1)
2025-10-29 15:59:01,044 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=1)
2025-10-29 15:59:01,044 [INFO] fortress_director.orchestrator.orchestrator: Injected fallback safe function to ensure at least one execution
2025-10-29 15:59:01,044 [INFO] fortress_director.orchestrator.orchestrator: Weather changed via safe function, re-describing world...
2025-10-29 15:59:01,047 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}\nRecent events: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As d... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 50, "morale": 51, "resources": 40, "knowledge": 48, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'morning'}
2025-10-29 15:59:09,872 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Morning mist veils Lornhaven' end, chill pervades.", 'sensory_details': 'Cool air mingles with the earthy scent of rain; gritty whispers from wind-blown stones.'}
2025-10-29 15:59:09,872 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': "Morning mist veils Lornhaven' end, chill pervades.", 'sensory_details': 'Cool air mingles with the earthy scent of rain gritty whispers from windblown stones.'}
2025-10-29 15:59:09,872 [INFO] fortress_director.orchestrator.orchestrator: World re-described after safe function.
2025-10-29 15:59:09,872 [DEBUG] fortress_director.orchestrator.orchestrator: New world output: {"atmosphere": "Morning mist veils Lornhaven' end, chill pervades.", "sensory_details": "Cool air mingles with the earthy scent of rain gritty whispers from windblown stones."}
2025-10-29 15:59:09,872 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=1)
2025-10-29 15:59:09,872 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=1)
2025-10-29 15:59:09,872 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 51, 'morale': 51, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:59:09,876 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 51, 'morale': 51, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:59:09,876 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'conditions_not_met', 'description': 'Oyun devam ediyor...'}
2025-10-29 15:59:09,877 [INFO] fortress_director.orchestrator.orchestrator: Turn summary: The day passes quietly.
2025-10-29 15:59:09,877 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-29 15:59:09,877 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {\"order\": 50, \"morale\": 50, \"r...
2025-10-29 15:59:09,877 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-29 15:59:09,877 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
2025-10-29 15:59:09,889 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-29 15:59:09,889 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-29 15:59:09,889 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=1)
2025-10-29 15:59:09,889 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=1, call=None)
2025-10-29 15:59:09,889 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-29 15:59:09,889 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=1)
2025-10-29 15:59:09,889 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 1, "day": 1, "flags": [], "inventory": [], "lore": {}, "memory_layers": [], "memory_long": [], "memory_short": ["Turn 1: Approach Rhea and ask about the drums you hear beyond the walls. -> The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the l..."], "metrics": {"corruption": 10, "glitch": 12, "knowledge": 47, "major_event_last_turn": null, "major_events_trigg...
2025-10-29 15:59:09,889 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 51, 'morale': 51, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:59:09,889 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 51, 'morale': 51, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:59:09,889 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=2, seed=12345, current_glitch=12)
2025-10-29 15:59:09,889 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 51, 'morale': 51, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:59:09,889 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=12, delta=4, limits=(0, 100) (cause=glitch:overload)
2025-10-29 15:59:09,889 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 4, 'value': 16, 'cause': 'glitch:overload'}
2025-10-29 15:59:09,889 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 12 to 16 (cause=glitch:overload)
2025-10-29 15:59:09,889 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=99, triggered_loss=False
2025-10-29 15:59:09,889 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 51, 'morale': 51, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 16, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:59:09,889 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Glitch cascade overwhelms containment protocols.']
2025-10-29 15:59:09,889 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=99, triggered_loss=False
2025-10-29 15:59:09,889 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 51, 'morale': 51, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 16, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:59:09,889 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=16, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-29 15:59:09,889 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 15, 'cause': 'turn_recovery'}
2025-10-29 15:59:09,889 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 16 to 15 (cause=turn_recovery)
2025-10-29 15:59:09,889 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 51, 'morale': 51, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:59:09,889 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=99, triggered_loss=False
2025-10-29 15:59:09,889 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 51, 'morale': 51, 'resources': 41, 'knowledge': 47, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:59:09,889 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-29 15:59:09,889 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 1 | Day 1 | Time morning
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}
Recent events: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As d... Recent motifs: communication
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 51, "resources": 41, "knowledge": 47, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-29 15:59:09,889 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 1 in room entrance
2025-10-29 15:59:09,889 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously...
2025-10-29 15:59:09,889 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-29 15:59:09,889 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}\nRecent events: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As d... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 51, "resources": 41, "knowledge": 47, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'morning'}
2025-10-29 15:59:16,915 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Morning mist veils Lornhaven' end, a chill pervades.", 'sensory_details': 'The air is cool and damp; the scent of wet stone mingles with distant drumbeats. The touch of moisture lingers on skin as light filters through heavy clouds.'}
2025-10-29 15:59:16,916 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': "Morning mist veils Lornhaven' end, a chill pervades.", 'sensory_details': 'The air is cool and damp the scent of wet stone mingles with distant drumbeats. The touch of moisture lingers on skin as light filters through heavy clouds.'}
2025-10-29 15:59:16,916 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-29 15:59:16,916 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Morning mist veils Lornhaven' end, a chill pervades.", "sensory_details": "The air is cool and damp the scent of wet stone mingles with distant drumbeats. The touch of moisture lingers on skin as light filters through heavy clouds."}
2025-10-29 15:59:16,916 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously...
2025-10-29 15:59:16,916 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-29 15:59:16,916 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}\nRecent events: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As d... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 51, "resources": 41, "knowledge": 47, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 1, 'time': 'morning', 'room': 'entrance', 'recent_events': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As d...', 'world_constraint_from_prev_turn': '{"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}', 'recent_motifs': 'communication', 'lore_continuity_weight': 0, 'memory_layers': ['Turn 1: Approach Rhea and ask about the drums you hear beyond the walls. -> The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the l...'], 'judge_verdict': '{"consistent": true, "reason": "The content is consistent with the established world, lore, and character logic. The scene sets up a tense situation for the player to investigate further.", "coherence": 100, "integrity": 100, "tone_alignment": 100, "penalty_applied": "none", "penalty_magnitude": {}, "feedback": {}}', 'judge_feedback': {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene sets up a tense situation for the player to investigate further.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'skip_major': False}
2025-10-29 15:59:53,267 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As dawn breaks, she scans the horizon with a weary gaze.', 'options': [{'id': '1', 'text': 'Ask Rhea about the drums you hear beyond the walls.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Offer Rhea some oil from your lamp to help her stay warm.', 'action_type': 'interaction'}, {'id': '3', 'text': 'Inspect the horizon for any signs of the enemy.', 'action_type': 'exploration'}], 'major_event': False, 'safe_functions': []}
2025-10-29 15:59:53,267 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As dawn breaks, she scans the horizon with a weary gaze.', 'options': [{'id': '1', 'text': 'Ask Rhea about the drums you hear beyond the walls.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Offer Rhea some oil from your lamp to help her stay warm.', 'action_type': 'interaction'}, {'id': '3', 'text': 'Inspect the horizon for any signs of the enemy.', 'action_type': 'exploration'}], 'major_event': False, 'safe_functions': []}
2025-10-29 15:59:53,267 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-29 15:59:53,267 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialogue", "id": "1", "text": "Ask Rhea about the drums you hear beyond the walls."}, {"action_type": "interaction", "id": "2", "text": "Offer Rhea some oil from your lamp to help her stay warm."}, {"action_type": "exploration", "id": "3", "text": "Inspect the horizon for any signs of the enemy."}], "safe_functions": [], "scene": "The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As dawn breaks, ...
2025-10-29 15:59:53,267 [INFO] fortress_director.orchestrator.orchestrator: Using previous judge verdict (turn 1)
2025-10-29 15:59:53,267 [INFO] fortress_director.orchestrator.orchestrator: Added motif-based option: diplomacy_approach (motif active)
2025-10-29 15:59:53,268 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-29 15:59:53,268 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': '1', 'text': 'Ask Rhea about the drums you hear beyond the walls.', 'action_type': 'dialogue'}
2025-10-29 15:59:53,268 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialogue", "id": "1", "text": "Ask Rhea about the drums you hear beyond the walls."}
2025-10-29 15:59:53,268 [INFO] fortress_director.orchestrator.orchestrator: Applying dynamic metrics for action_type 'dialogue': {'morale': 1, 'knowledge': 2}
2025-10-29 15:59:53,268 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=51, delta=1, limits=(0, 100) (cause=action_dialogue)
2025-10-29 15:59:53,268 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 1, 'value': 52, 'cause': 'action_dialogue'}
2025-10-29 15:59:53,268 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 51 to 52 (cause=action_dialogue)
2025-10-29 15:59:53,268 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'knowledge': current=47, delta=2, limits=(0, 100) (cause=action_dialogue)
2025-10-29 15:59:53,268 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'knowledge', 'delta': 2, 'value': 49, 'cause': 'action_dialogue'}
2025-10-29 15:59:53,269 [INFO] fortress_director.utils.metrics_manager: Metric 'knowledge' updated from 47 to 49 (cause=action_dialogue)
2025-10-29 15:59:53,269 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after dynamic changes: {'order': 51, 'morale': 52, 'resources': 41, 'knowledge': 49, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 15:59:53,269 [INFO] fortress_director.orchestrator.orchestrator: Action consequence: Your words strengthen village bonds and reveal useful information.
2025-10-29 15:59:53,269 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously...
2025-10-29 15:59:53,269 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-29 15:59:53,269 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}\nRecent events: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As d... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 51, "resources": 41, "knowledge": 47, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As dawn breaks, she scans the horizon with a weary gaze.', 'player_choice': 'Ask Rhea about the drums you hear beyond the walls.', 'atmosphere': "Morning mist veils Lornhaven' end, a chill pervades.", 'sensory_details': 'The air is cool and damp the scent of wet stone mingles with distant drumbeats. The touch of moisture lingers on skin as light filters through heavy clouds.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player; Boris weighs every trade.', 'player_inventory_brief': 'oil lamp, patched shield', 'memory_layers': ['Turn 1: Approach Rhea and ask about the drums you hear beyond the walls. -> The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the l...'], 'recent_events': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As d...', 'last_major_event': False}
2025-10-29 16:00:02,210 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'The wind whispers secrets through the morning mist, carrying the faintest hint of rain.'}
2025-10-29 16:00:02,210 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'The wind whispers secrets through the morning mist, carrying the faintest hint of rain.', 'effects': {}, 'safe_functions': []}]
2025-10-29 16:00:02,210 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-29 16:00:02,210 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "stand_vigilance", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "The wind whispers secrets through the morning mist, carrying the faintest hint of rain."}]
2025-10-29 16:00:02,210 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-29 16:00:02,210 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-29 16:00:02,210 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-29 16:00:02,210 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "stand_vigilance", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "The wind whispers secrets through the morning mist, carrying the faintest hint of rain."}]
2025-10-29 16:00:02,210 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-29 16:00:02,210 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 1, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': [], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 1, 'day': 1, 'time': 'morning', 'current_room': 'entrance', 'recent_events': ['The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As d...'], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 51, 'morale': 52, 'resources': 41, 'knowledge': 49, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}, 'previous_judge_verdict': {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene sets up a tense situation for the player to investigate further.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['dialogue'], 'summary_text': 'The day passes quietly.', 'memory_short': ['Turn 1: Approach Rhea and ask about the drums you hear beyond the walls. -> The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the l...'], 'memory_long': [], 'status_effects': []}
2025-10-29 16:00:02,210 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'The wind whispers secrets through the morning mist, carrying the faintest hint of rain.', 'effects': {}, 'safe_functions': []}]
2025-10-29 16:00:02,210 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 1 | Day 1 | Time morning
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}
Recent events: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As d... Recent motifs: communication
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 51, "resources": 41, "knowledge": 47, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As dawn breaks, she scans the horizon with a weary gaze., player_choice: {'id': '1', 'text': 'Ask Rhea about the drums you hear beyond the walls.', 'action_type': 'dialogue'}
2025-10-29 16:00:02,210 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-29 16:00:02,210 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'observe', 'action': 'stand_vigilance', 'speech': 'The wind whispers secrets through the morning mist, carrying the faintest hint of rain.', 'effects': {}, 'safe_functions': []}
2025-10-29 16:00:02,210 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-29 16:00:02,210 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-29 16:00:08,831 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene description matches the established atmosphere and Rhea's duty as a defender."}
2025-10-29 16:00:08,832 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene description matches the established atmosphere and Rhea's duty as a defender."}
2025-10-29 16:00:08,832 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The scene description matches the established atmosphere and Rhea's duty as a defender.", 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}
2025-10-29 16:00:08,832 [INFO] fortress_director.rules.rules_engine: Tier two validation passed with penalties: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-29 16:00:08,832 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-10-29 16:00:08,832 [INFO] fortress_director.rules.rules_engine: Choice impact applied: knowledge +1 (action_type=dialogue)
2025-10-29 16:00:08,832 [INFO] fortress_director.rules.rules_engine: Judge penalties applied: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-10-29 16:00:08,833 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-29 16:00:08,833 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 1, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': [], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 1, 'day': 1, 'time': 'morning', 'current_room': 'entrance', 'recent_events': ['The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As d...'], 'recent_motifs': ['communication'], 'world_constraint_from_prev_turn': {'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 51, 'morale': 52, 'resources': 41, 'knowledge': 50, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}, 'previous_judge_verdict': {'consistent': True, 'reason': 'The content is consistent with the established world, lore, and character logic. The scene sets up a tense situation for the player to investigate further.', 'coherence': 100, 'integrity': 100, 'tone_alignment': 100, 'penalty_applied': 'none', 'penalty_magnitude': {}, 'feedback': {}}, 'player_choice_history': ['dialogue', 'dialogue'], 'summary_text': 'The day passes quietly.', 'memory_short': ['Turn 1: Approach Rhea and ask about the drums you hear beyond the walls. -> The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the l...'], 'memory_long': [], 'status_effects': []}
2025-10-29 16:00:08,833 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=2)
2025-10-29 16:00:08,833 [INFO] fortress_director.orchestrator.orchestrator: Applying 2 autonomous actions
2025-10-29 16:00:08,833 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=51, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-10-29 16:00:08,833 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': 1, 'value': 52, 'cause': 'autonomous_Rhea'}
2025-10-29 16:00:08,834 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 51 to 52 (cause=autonomous_Rhea)
2025-10-29 16:00:08,834 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'resources': current=41, delta=1, limits=(0, 120) (cause=autonomous_Boris)
2025-10-29 16:00:08,834 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'resources', 'delta': 1, 'value': 42, 'cause': 'autonomous_Boris'}
2025-10-29 16:00:08,834 [INFO] fortress_director.utils.metrics_manager: Metric 'resources' updated from 41 to 42 (cause=autonomous_Boris)
2025-10-29 16:00:08,834 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-29 16:00:08,834 [INFO] fortress_director.orchestrator.orchestrator: Advanced time to afternoon
2025-10-29 16:00:08,834 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: []
2025-10-29 16:00:08,835 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-10-29 16:00:08,835 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 2, "day": 1, "flags": [], "inventory": [], "lore": {}, "memory_layers": [], "memory_long": [], "memory_short": ["Turn 1: Approach Rhea and ask about the drums you hear beyond the walls. -> The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the l...", "Turn 2: Ask Rhea about the drums you hear beyond the walls. -> The Shieldbearer, Rhea, stands at the entrance o...
2025-10-29 16:00:08,836 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=2)
2025-10-29 16:00:08,836 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-29 16:00:08,836 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-29 16:00:08,836 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=2)
2025-10-29 16:00:08,836 [INFO] fortress_director.codeaware.function_registry: Validating function call: change_weather
2025-10-29 16:00:08,836 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=2)
2025-10-29 16:00:08,837 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=2, call=change_weather)
2025-10-29 16:00:08,837 [INFO] fortress_director.codeaware.function_registry: Getting registered function: change_weather
2025-10-29 16:00:08,837 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'change_weather'...
2025-10-29 16:00:08,837 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=2)
2025-10-29 16:00:08,838 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=2)
2025-10-29 16:00:08,838 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed successfully.
2025-10-29 16:00:08,838 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed (checkpoint turn=2)
2025-10-29 16:00:08,844 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=2)
2025-10-29 16:00:08,844 [INFO] fortress_director.orchestrator.orchestrator: Injected fallback safe function to ensure at least one execution
2025-10-29 16:00:08,844 [INFO] fortress_director.orchestrator.orchestrator: Weather changed via safe function, re-describing world...
2025-10-29 16:00:08,844 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 2 | Day 1 | Time afternoon\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Morning mist veils Lornhaven\' end, a chill pervades.", "sensory_details": "The air is cool and damp the scent of wet stone mingles with distant drumbeats. The touch of moisture lingers on skin as light filters through heavy clouds."}\nRecent events: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As d... Recent motifs: communication\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade. Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 52, "resources": 41, "knowledge": 50, "corruption": 10, "glitch": 15, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'afternoon'}
2025-10-29 16:00:17,953 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Afternoon haze shrouds Lornhaven's entrance, cool and damp.", 'sensory_details': 'The air carries a brisk chill with the scent of wet stone; fingers feel clammy as light struggles through heavy clouds.'}
2025-10-29 16:00:17,953 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': "Afternoon haze shrouds Lornhaven's entrance, cool and damp.", 'sensory_details': 'The air carries a brisk chill with the scent of wet stone fingers feel clammy as light struggles through heavy clouds.'}
2025-10-29 16:00:17,953 [INFO] fortress_director.orchestrator.orchestrator: World re-described after safe function.
2025-10-29 16:00:17,954 [DEBUG] fortress_director.orchestrator.orchestrator: New world output: {"atmosphere": "Afternoon haze shrouds Lornhaven's entrance, cool and damp.", "sensory_details": "The air carries a brisk chill with the scent of wet stone fingers feel clammy as light struggles through heavy clouds."}
2025-10-29 16:00:17,955 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=2)
2025-10-29 16:00:17,955 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-87\test_smoke_2turn_real_llm0\world_state.json (turn=2)
2025-10-29 16:00:17,955 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 52, 'morale': 52, 'resources': 42, 'knowledge': 49, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 16:00:17,955 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 52, 'morale': 52, 'resources': 42, 'knowledge': 49, 'corruption': 10, 'glitch': 15, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-29 16:00:17,956 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'conditions_not_met', 'description': 'Oyun devam ediyor...'}
2025-10-29 16:00:17,956 [INFO] fortress_director.orchestrator.orchestrator: Turn summary: The day passes quietly.
2025-10-29 16:00:17,956 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-29 16:00:17,957 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time morning\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously...
2025-10-29 16:00:17,957 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-29 16:00:17,957 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
2025-10-29 16:04:46,571 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-29 16:04:46,841 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
