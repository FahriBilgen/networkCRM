2025-10-27 23:07:56,447 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251027_200756.log)
2025-10-27 23:07:56,447 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251027_200756.log)
2025-10-27 23:07:56,448 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\logs\turn_20251027_200756.log
2025-10-27 23:07:56,449 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-27 23:07:56,449 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-27 23:07:56,450 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-27 23:07:56,450 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-27 23:07:56,450 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-27 23:07:56,450 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-27 23:07:56,450 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-27 23:07:56,450 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-27 23:07:56,450 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-27 23:07:56,450 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-27 23:07:56,450 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-27 23:07:56,452 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-27 23:07:56,452 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-27 23:07:56,452 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-27 23:07:56,452 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-27 23:07:56,452 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-27 23:07:56,452 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-27 23:07:56,453 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-27 23:07:56,453 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-27 23:07:56,453 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-27 23:07:56,453 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-27 23:07:56,453 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-27 23:07:56,453 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=1)
2025-10-27 23:07:56,453 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=1, call=None)
2025-10-27 23:07:56,454 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-27 23:07:56,454 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=1)
2025-10-27 23:07:56,454 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 1, "day": 1, "finalized": true, "flags": ["low_clouds_present", "atmosphere", "Dawn'thin Rain", "Dawn's Whispers"], "inventory": [], "lore": {}, "memory_layers": ["Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've...", "Turn 8: Ask the Shieldbearer if she needs assistance. -> The Shie...
2025-10-27 23:07:56,454 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 18, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:07:56,454 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 18, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:07:56,454 [INFO] fortress_director.utils.glitch_manager: Game finalized, skipping glitch resolution
2025-10-27 23:07:56,454 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=0, triggered_loss=False
2025-10-27 23:07:56,455 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 18, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:07:56,455 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=18, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-27 23:07:56,455 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 17, 'cause': 'turn_recovery'}
2025-10-27 23:07:56,455 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 18 to 17 (cause=turn_recovery)
2025-10-27 23:07:56,455 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 17, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:07:56,455 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-27 23:07:56,455 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 1 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}
Recent events: The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...
Recent motifs: none
Recent major events: none
Relationship summary: Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 17, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-27 23:07:56,455 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 1 in room entrance
2025-10-27 23:07:56,455 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn'thin rain, heavy clouds hang\", \"sensory_details\": \"Cool mist clings to stone drums beat steady rhythm\"}\nRecent events: The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the dist...
2025-10-27 23:07:56,455 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-27 23:07:56,456 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 1 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}\nRecent events: The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...\nRecent motifs: none\nRecent major events: none\nRelationship summary: Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 17, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance'}
2025-10-27 23:08:03,519 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm'}
2025-10-27 23:08:03,520 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm'}
2025-10-27 23:08:03,520 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-27 23:08:03,520 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}
2025-10-27 23:08:03,520 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn'thin rain, heavy clouds hang\", \"sensory_details\": \"Cool mist clings to stone drums beat steady rhythm\"}\nRecent events: The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the dist...
2025-10-27 23:08:03,520 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-27 23:08:03,520 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 1 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}\nRecent events: The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...\nRecent motifs: none\nRecent major events: none\nRelationship summary: Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 17, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': "The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...", 'world_constraint_from_prev_turn': '{"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}', 'recent_motifs': 'none', 'lore_continuity_weight': 0, 'memory_layers': ["Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've...", "Turn 8: Ask the Shieldbearer if she needs assistance. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've...", "Turn 9: You ask the Shieldbearer about the distant drums. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Memory summary: Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've... | Turn 8: Ask the Shieldb...", "Turn 10: You ask the Shieldbearer about her duty here at the entrance to Lornhaven. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b..."]}
2025-10-27 23:08:31,343 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. The cool mist clings to stone drums that beat a steady rhythm.", 'options': [{'id': '1', 'text': 'Ask the Shieldbearer about the drums.', 'action_type': 'dialog'}, {'id': '2', 'text': 'Offer the Shieldbearer some oil from your lamp to help her stay warm.', 'action_type': 'interaction'}, {'id': '3', 'text': 'Move closer to the drums, trying to discern their rhythm.', 'action_type': 'exploration'}], 'major_event': False, 'safe_functions': []}
2025-10-27 23:08:31,343 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. The cool mist clings to stone drums that beat a steady rhythm.", 'options': [{'id': '1', 'text': 'Ask the Shieldbearer about the drums.', 'action_type': 'dialog'}, {'id': '2', 'text': 'Offer the Shieldbearer some oil from your lamp to help her stay warm.', 'action_type': 'interaction'}, {'id': '3', 'text': 'Move closer to the drums, trying to discern their rhythm.', 'action_type': 'exploration'}], 'major_event': False, 'safe_functions': []}
2025-10-27 23:08:31,343 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-27 23:08:31,343 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialog", "id": "1", "text": "Ask the Shieldbearer about the drums."}, {"action_type": "interaction", "id": "2", "text": "Offer the Shieldbearer some oil from your lamp to help her stay warm."}, {"action_type": "exploration", "id": "3", "text": "Move closer to the drums, trying to discern their rhythm."}], "safe_functions": [], "scene": "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. T...
2025-10-27 23:08:31,343 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-27 23:08:31,343 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': '1', 'text': 'Ask the Shieldbearer about the drums.', 'action_type': 'dialog'}
2025-10-27 23:08:31,344 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialog", "id": "1", "text": "Ask the Shieldbearer about the drums."}
2025-10-27 23:08:31,344 [DEBUG] fortress_director.orchestrator.orchestrator: No dynamic metrics for action_type 'dialog'
2025-10-27 23:08:31,344 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 1 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn'thin rain, heavy clouds hang\", \"sensory_details\": \"Cool mist clings to stone drums beat steady rhythm\"}\nRecent events: The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the dist...
2025-10-27 23:08:31,344 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-27 23:08:31,344 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 1 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn\'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}\nRecent events: The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. \'I\'ve been standing here for hours, watching the clouds roll in.\', she says, a hint of exhaustion in her vo...\nRecent motifs: none\nRecent major events: none\nRelationship summary: Shieldbearer is neutral toward the player\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 17, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. The cool mist clings to stone drums that beat a steady rhythm.", 'player_choice': 'Ask the Shieldbearer about the drums.', 'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Shieldbearer is neutral toward the player', 'player_inventory_brief': 'oil lamp, patched shield'}
2025-10-27 23:08:39,033 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilance', 'speech': "I've been standing here for hours, watching the clouds roll in.", 'effects': {'trust_delta': 0, 'flag_set': False, 'item_change': None, 'status_change': None}}
2025-10-27 23:08:39,034 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilance', 'speech': "I've been standing here for hours, watching the clouds roll in.", 'effects': {'trust_delta': 0}}]
2025-10-27 23:08:39,034 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-27 23:08:39,034 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "stand_vigilance", "effects": {"trust_delta": 0}, "intent": "vigilance", "name": "Shieldbearer", "speech": "I've been standing here for hours, watching the clouds roll in."}]
2025-10-27 23:08:39,034 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-27 23:08:39,034 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-27 23:08:39,034 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-27 23:08:39,035 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "stand_vigilance", "effects": {"trust_delta": 0}, "intent": "vigilance", "name": "Shieldbearer", "speech": "I've been standing here for hours, watching the clouds roll in."}]
2025-10-27 23:08:39,035 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-27 23:08:39,035 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 10, 'current_turn': 1, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_clouds_present', 'atmosphere', "Dawn'thin Rain", "Dawn's Whispers"], 'memory_layers': ["Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've...", "Turn 8: Ask the Shieldbearer if she needs assistance. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've...", "Turn 9: You ask the Shieldbearer about the distant drums. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Memory summary: Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've... | Turn 8: Ask the Shieldb...", "Turn 10: You ask the Shieldbearer about her duty here at the entrance to Lornhaven. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b..."], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 1, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': ["The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her ...", "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...", "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo..."], 'recent_motifs': [], 'world_constraint_from_prev_turn': {'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Shieldbearer is neutral toward the player', 'metrics': {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 17, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}, 'npc_memory': {'Rhea': {'name': 'Scout Rhea', 'location': 'scout_post', 'personality': 'loyal but impulsive', 'trust': 50, 'last_action': 'monitoring perimeter'}, 'Boris': {'name': 'Merchant Boris', 'location': 'merchant_quarters', 'personality': 'cautious and calculating', 'trust': 45, 'last_action': 'inventory check'}}, 'status_effects': [], 'finalized': True}
2025-10-27 23:08:39,035 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilance', 'speech': "I've been standing here for hours, watching the clouds roll in.", 'effects': {'trust_delta': 0}}]
2025-10-27 23:08:39,035 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 1 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn'thin rain, heavy clouds hang", "sensory_details": "Cool mist clings to stone drums beat steady rhythm"}
Recent events: The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her ...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...; The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...
Recent motifs: none
Recent major events: none
Relationship summary: Shieldbearer is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 17, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her voice. The cool mist clings to stone drums that beat a steady rhythm., player_choice: {'id': '1', 'text': 'Ask the Shieldbearer about the drums.', 'action_type': 'dialog'}
2025-10-27 23:08:39,035 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-27 23:08:39,035 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Shieldbearer', 'intent': 'vigilance', 'action': 'stand_vigilance', 'speech': "I've been standing here for hours, watching the clouds roll in.", 'effects': {'trust_delta': 0}}
2025-10-27 23:08:39,035 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-27 23:08:39,035 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-27 23:08:44,890 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the established atmosphere and tone of the world.'}
2025-10-27 23:08:44,890 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the established atmosphere and tone of the world.'}
2025-10-27 23:08:44,890 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Shieldbearer: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene described by the player choice matches the established atmosphere and tone of the world.'}
2025-10-27 23:08:44,890 [INFO] fortress_director.rules.rules_engine: Tier two validation passed.
2025-10-27 23:08:44,890 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Shieldbearer: {'trust_delta': 0}
2025-10-27 23:08:44,890 [INFO] fortress_director.rules.rules_engine: Trust updated for Shieldbearer: 0 -> 0 (delta: 0)
2025-10-27 23:08:44,890 [INFO] fortress_director.rules.rules_engine: Relationship summary updated: Shieldbearer is neutral toward the player
2025-10-27 23:08:44,890 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-27 23:08:44,890 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 10, 'current_turn': 1, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_clouds_present', 'atmosphere', "Dawn'thin Rain", "Dawn's Whispers"], 'memory_layers': ["Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've...", "Turn 8: Ask the Shieldbearer if she needs assistance. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've...", "Turn 9: You ask the Shieldbearer about the distant drums. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b...", "Memory summary: Turn 7: You ask the Shieldbearer about the heavy clouds rolling in. -> The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've... | Turn 8: Ask the Shieldb...", "Turn 10: You ask the Shieldbearer about her duty here at the entrance to Lornhaven. -> The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've b..."], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 1, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': ["The Shieldbearer, her eyes still focused on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her ...", "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo...", "The Shieldbearer, her gaze still fixed on the distant drums, glances at you as you approach. 'I've been standing here for hours, watching the clouds roll in.', she says, a hint of exhaustion in her vo..."], 'recent_motifs': [], 'world_constraint_from_prev_turn': {'atmosphere': "Dawn'thin rain, heavy clouds hang", 'sensory_details': 'Cool mist clings to stone drums beat steady rhythm'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Shieldbearer is neutral toward the player', 'metrics': {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 17, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {'Shieldbearer': 0}, 'npc_memory': {'Rhea': {'name': 'Scout Rhea', 'location': 'scout_post', 'personality': 'loyal but impulsive', 'trust': 50, 'last_action': 'monitoring perimeter'}, 'Boris': {'name': 'Merchant Boris', 'location': 'merchant_quarters', 'personality': 'cautious and calculating', 'trust': 45, 'last_action': 'inventory check'}}, 'status_effects': [], 'finalized': True}
2025-10-27 23:08:44,892 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=2)
2025-10-27 23:08:44,892 [ERROR] fortress_director.orchestrator.orchestrator: Exception during turn: 'Orchestrator' object has no attribute '_generate_autonomous_actions'
Traceback (most recent call last):
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\orchestrator\orchestrator.py", line 651, in run_turn
    autonomous_actions = self._generate_autonomous_actions(state_snapshot)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Orchestrator' object has no attribute '_generate_autonomous_actions'
2025-10-27 23:08:44,895 [INFO] fortress_director.codeaware.rollback_system: Rollback requested (reason=Turn execution failed: AttributeError)
2025-10-27 23:08:44,896 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=1)
2025-10-27 23:08:44,896 [INFO] fortress_director.codeaware.rollback_system: Rollback applied (turn=1, reason=Turn execution failed: AttributeError)
2025-10-27 23:08:44,897 [INFO] fortress_director.orchestrator.orchestrator: Rollback performed after exception.
