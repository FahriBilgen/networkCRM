{
  "$schema": "./theme_schema.json",
  "id": "siege_default",
  "label": "Siege of Lornhaven",
  "description": "Curated Golden Path defense with deterministic branch control for the demo.",
  "version": 2,
  "tags": ["siege", "grimdark", "fortress", "demo"],
  "prompt_overrides": {
    "event": "prompts/event_prompt.txt",
    "world": "themes/siege_default/prompts/world_renderer_golden_path.txt",
    "character": "prompts/character_prompt.txt",
    "planner": "prompts/planner_prompt.txt",
    "creativity": "prompts/creativity_prompt.txt",
    "judge": "prompts/judge_prompt.txt",
    "director": "themes/siege_default/prompts/director_golden_path.txt"
  },
  "world_state_overrides": {
    "campaign_id": "siege_default",
    "scenario_id": "golden_path_demo",
    "rng_seed": 7717,
    "turn": 0,
    "current_turn": 0,
    "turn_limit": 10,
    "current_room": "western_wall",
    "recent_motifs": ["iron", "smoke", "belltone"],
    "world": {
      "stability": 62,
      "resources": 74,
      "threat_level": "escalating",
      "siege_clock": {
        "label": "False Calm",
        "value": 1,
        "max": 6
      }
    },
    "metrics": {
      "order": 64,
      "morale": 58,
      "resources": 74,
      "knowledge": 52,
      "glitch": 21
    },
    "player": {
      "name": "The Shieldbearer",
      "title": "Warden of the Western Rise",
      "inventory": [
        "oil lamp",
        "patched shield",
        "signal horn",
        "emberglass lens"
      ],
      "summary": "Steady tactician tasked with executing the 7-turn Golden Path ritual."
    },
    "player_position": {
      "x": 5,
      "y": 6,
      "room": "western_wall"
    },
    "npc_locations": [
      {
        "id": "rhea",
        "name": "Rhea Emberfall",
        "role": "scout",
        "stance": "bold",
        "room": "east_rampart",
        "x": 3,
        "y": 4,
        "hostile": false,
        "flags": ["branch_scout_ready"]
      },
      {
        "id": "boris",
        "name": "Boris Marrow",
        "role": "quartermaster",
        "stance": "cautious",
        "room": "granary",
        "x": 7,
        "y": 8,
        "hostile": false,
        "flags": ["supply_accord_pending"]
      },
      {
        "id": "marshal_edda",
        "name": "Marshal Edda Vayne",
        "role": "commander",
        "stance": "unyielding",
        "room": "inner_gate",
        "x": 6,
        "y": 5,
        "hostile": false,
        "flags": ["finale_anchor"]
      },
      {
        "id": "mireborn_envoy",
        "name": "Mireborn Envoy",
        "role": "neutral",
        "stance": "calculating",
        "room": "sally_port",
        "x": 2,
        "y": 7,
        "hostile": false,
        "flags": ["branch_trade"]
      }
    ],
    "structures": {
      "western_wall": {
        "durability": 78,
        "status": "bracing"
      },
      "inner_gate": {
        "durability": 65,
        "status": "reinforced"
      },
      "sally_port": {
        "durability": 55,
        "status": "sealed"
      },
      "signal_pyre": {
        "durability": 35,
        "status": "dormant"
      }
    },
    "flags": [
      "golden_path_mode",
      "demo_lock",
      "siege_alert_low",
      "quest_intro_active"
    ],
    "quest_log": [
      {
        "id": "gp_intro",
        "title": "Brace the Western Wall",
        "status": "active",
        "turn_window": [0, 2],
        "summary": "Stabilize the breach, light the parapet beacons, and log the state delta before the storm returns.",
        "success_condition": "flag:western_wall_bracing",
        "failure_condition": "stability < 45"
      },
      {
        "id": "gp_mid",
        "title": "Broker the Mireborn Accord",
        "status": "locked",
        "turn_window": [2, 4],
        "summary": "Trade intel for supplies or reject the envoy and lean on inner reserves.",
        "branch_points": ["supply_trade", "glitch_scout"],
        "success_condition": "resources >= 70",
        "failure_condition": "flag:envoy_offended"
      },
      {
        "id": "gp_finale",
        "title": "Ring the Skyfire Bell",
        "status": "locked",
        "turn_window": [5, 7],
        "summary": "Choose between the bell flare finale or the shadow breach counter-ambush.",
        "branch_points": ["finale_signal"],
        "success_condition": "flag:skyfire_ready",
        "failure_condition": "glitch >= 40"
      }
    ],
    "story_beats": [
      {
        "turn": 1,
        "label": "False Dawn",
        "expected_choice": "option_1",
        "notes": "Guide player toward reinforcing structures to set baselines."
      },
      {
        "turn": 3,
        "label": "Parley or Purge",
        "expected_choice": "option_2",
        "notes": "Branch between trade accord or supply lockdown."
      },
      {
        "turn": 5,
        "label": "Finale Preparation",
        "expected_choice": "option_3",
        "notes": "Queue finale event and lock demo-critical functions."
      }
    ],
    "branching_nodes": [
      {
        "id": "supply_trade",
        "turn_hint": 3,
        "options": [
          {
            "id": "accord",
            "summary": "Accept Mireborn aid for +8 resources but raise glitch risk.",
            "result_flags": ["mireborn_debt", "resources_spike"]
          },
          {
            "id": "refuse",
            "summary": "Decline aid to keep glitch stable but drain supplies.",
            "result_flags": ["zealot_support", "resources_dip"]
          }
        ]
      },
      {
        "id": "glitch_scout",
        "turn_hint": 4,
        "options": [
          {
            "id": "shadow_route",
            "summary": "Let Rhea scout glitch tunnels to unlock stealth bonuses.",
            "result_flags": ["scout_underway"]
          },
          {
            "id": "lockdown",
            "summary": "Keep scouts home and boost order by 4.",
            "result_flags": ["lockdown_order"]
          }
        ]
      },
      {
        "id": "finale_signal",
        "turn_hint": 6,
        "options": [
          {
            "id": "skyfire_bell",
            "summary": "Ring bell to trigger climax event and add morale spike.",
            "result_flags": ["skyfire_ready"]
          },
          {
            "id": "shadow_counter",
            "summary": "Ambush abyssal breach for stability gains; requires scout flag.",
            "result_flags": ["shadow_counter_ready"]
          }
        ]
      }
    ],
    "recent_events": [
      "A lull sweeps the parapets; emberglass lenses reveal faint glitch scars.",
      "Marshal Edda pins a 7-turn Golden Path diagram to the command board."
    ],
    "pinned_directive": "Maintain the Golden Path ritual: stabilize, broker accord, ring bell.",
    "demo_fail_safe": {
      "max_unstable_turns": 2,
      "lockdown_turn": 8
    }
  },
  "safe_function_overrides": {
    "enable": [
      "reinforce_structure",
      "repair_breach",
      "schedule_npc_activity",
      "adjust_stockpile",
      "queue_major_event",
      "lock_player_option",
      "set_flag"
    ],
    "disable": [
      "spawn_npc"
    ],
    "gas_budget_overrides": {
      "max_total_calls": 20,
      "max_calls_per_function": 5,
      "planner_min_calls_per_turn": 1
    }
  },
  "assets": {
    "motifs": ["ashes", "iron", "echoes", "embers", "sunflare"],
    "npc_roster": [
      {
        "id": "rhea",
        "name": "Rhea Emberfall",
        "summary": "Impulsive scout who reads the winds for incoming sieges.",
        "role": "scout"
      },
      {
        "id": "boris",
        "name": "Boris Marrow",
        "summary": "Logistician who barters with caravans for grain and pitch.",
        "role": "quartermaster"
      },
      {
        "id": "marshal_edda",
        "name": "Marshal Edda Vayne",
        "summary": "Stoic war-marshal choreographing the Golden Path finale.",
        "role": "commander"
      }
    ],
    "scene_overlays": [
      {
        "id": "siege_breach_warning",
        "bounds": [2, 6, 3, 2],
        "color": "#F97316",
        "alpha": 0.28,
        "pattern": "hatch",
        "detail": "Breach-prone parapet band"
      },
      {
        "id": "siege_supply_lane",
        "bounds": [7, 3, 2, 4],
        "color": "#FACC15",
        "alpha": 0.22,
        "pattern": "outline",
        "detail": "Supply lane prioritised by quartermasters"
      },
      {
        "id": "skyfire_pyre",
        "bounds": [4, 8, 2, 2],
        "color": "#FDBA74",
        "alpha": 0.3,
        "pattern": "pulse",
        "detail": "Signal pyre awaiting finale ignition"
      }
    ]
  },
  "notes": {
    "recommended_objective": "Complete the 7-turn Golden Path: stabilize walls, broker the accord, then fire the Skyfire Bell finale without crashing.",
    "ui_palette": {
      "primary": "#654321",
      "accent": "#AA8844"
    },
    "effects": [
      {
        "id": "siege_mist_brace",
        "effect_type": "fog",
        "intensity": "medium",
        "color": "#6B7280",
        "tile": [4, 6],
        "spread": 3
      },
      {
        "id": "siege_embers",
        "effect_type": "sandstorm",
        "intensity": "low",
        "color": "#D97706",
        "room": "courtyard",
        "seed": "embers_west"
      }
    ],
    "golden_path": {
      "turn_count": 7,
      "beats": [
        {
          "id": "beat_intro",
          "goal": "Establish bracing playbook and set stability >= 60 by turn 2."
        },
        {
          "id": "beat_mid",
          "goal": "Resolve Mireborn trade and glitch scout branches without diverging from demo rails."
        },
        {
          "id": "beat_finale",
          "goal": "Ring Skyfire Bell or execute shadow counter while keeping crash risk low."
        }
      ],
      "branch_points": [
        {
          "id": "supply_trade",
          "description": "Decide whether external aid offsets supply bleed."
        },
        {
          "id": "glitch_scout",
          "description": "Commit scout to tunnels or keep them on overwatch."
        },
        {
          "id": "finale_signal",
          "description": "Pick Skyfire Bell (cinematic) or Shadow Counter (tactical)."
        }
      ],
      "stability_bounds": {
        "floor": 45,
        "ceiling": 80
      }
    }
  }
}
