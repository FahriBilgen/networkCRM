2025-11-06 23:31:42,307 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\runs\profile_20251106_203142\profile_20251106_203142.log)
2025-11-06 23:31:42,322 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-11-06 23:31:42,322 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-11-06 23:31:42,323 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-11-06 23:31:42,324 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-11-06 23:31:42,324 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-11-06 23:31:42,324 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-11-06 23:31:42,324 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-11-06 23:31:42,326 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-11-06 23:31:42,326 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-11-06 23:31:42,326 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-11-06 23:31:42,326 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-11-06 23:31:42,326 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-11-06 23:31:42,326 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-11-06 23:31:42,327 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-11-06 23:31:42,328 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-11-06 23:31:42,328 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-11-06 23:31:42,328 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-11-06 23:31:42,329 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-11-06 23:31:42,329 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-11-06 23:31:42,329 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-11-06 23:31:42,329 [INFO] fortress_director.codeaware.function_registry: Registering safe function: set_flag
2025-11-06 23:31:42,330 [INFO] fortress_director.codeaware.function_registry: Safe function 'set_flag' registered successfully.
2025-11-06 23:31:42,330 [INFO] fortress_director.codeaware.function_registry: Registering safe function: clear_flag
2025-11-06 23:31:42,330 [INFO] fortress_director.codeaware.function_registry: Safe function 'clear_flag' registered successfully.
2025-11-06 23:31:42,331 [INFO] fortress_director.codeaware.function_registry: Registering safe function: set_trust
2025-11-06 23:31:42,331 [INFO] fortress_director.codeaware.function_registry: Safe function 'set_trust' registered successfully.
2025-11-06 23:31:42,332 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_trust
2025-11-06 23:31:42,332 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_trust' registered successfully.
2025-11-06 23:31:42,332 [INFO] fortress_director.codeaware.function_registry: Registering safe function: add_item_to_npc
2025-11-06 23:31:42,332 [INFO] fortress_director.codeaware.function_registry: Safe function 'add_item_to_npc' registered successfully.
2025-11-06 23:31:42,333 [INFO] fortress_director.codeaware.function_registry: Registering safe function: remove_item_from_npc
2025-11-06 23:31:42,333 [INFO] fortress_director.codeaware.function_registry: Safe function 'remove_item_from_npc' registered successfully.
2025-11-06 23:31:42,334 [INFO] fortress_director.codeaware.function_registry: Registering safe function: add_status
2025-11-06 23:31:42,334 [INFO] fortress_director.codeaware.function_registry: Safe function 'add_status' registered successfully.
2025-11-06 23:31:42,334 [INFO] fortress_director.codeaware.function_registry: Registering safe function: remove_status
2025-11-06 23:31:42,335 [INFO] fortress_director.codeaware.function_registry: Safe function 'remove_status' registered successfully.
2025-11-06 23:31:42,335 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_npc
2025-11-06 23:31:42,335 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_npc' registered successfully.
2025-11-06 23:31:42,335 [INFO] fortress_director.codeaware.function_registry: Registering safe function: despawn_npc
2025-11-06 23:31:42,336 [INFO] fortress_director.codeaware.function_registry: Safe function 'despawn_npc' registered successfully.
2025-11-06 23:31:42,336 [INFO] fortress_director.codeaware.function_registry: Registering safe function: set_time_of_day
2025-11-06 23:31:42,336 [INFO] fortress_director.codeaware.function_registry: Safe function 'set_time_of_day' registered successfully.
2025-11-06 23:31:42,337 [INFO] fortress_director.codeaware.function_registry: Registering safe function: set_weather_pattern
2025-11-06 23:31:42,337 [INFO] fortress_director.codeaware.function_registry: Safe function 'set_weather_pattern' registered successfully.
2025-11-06 23:31:42,337 [INFO] fortress_director.codeaware.function_registry: Registering safe function: trigger_environment_hazard
2025-11-06 23:31:42,338 [INFO] fortress_director.codeaware.function_registry: Safe function 'trigger_environment_hazard' registered successfully.
2025-11-06 23:31:42,338 [INFO] fortress_director.codeaware.function_registry: Registering safe function: reinforce_structure
2025-11-06 23:31:42,338 [INFO] fortress_director.codeaware.function_registry: Safe function 'reinforce_structure' registered successfully.
2025-11-06 23:31:42,338 [INFO] fortress_director.codeaware.function_registry: Registering safe function: repair_breach
2025-11-06 23:31:42,338 [INFO] fortress_director.codeaware.function_registry: Safe function 'repair_breach' registered successfully.
2025-11-06 23:31:42,339 [INFO] fortress_director.codeaware.function_registry: Registering safe function: set_watcher_route
2025-11-06 23:31:42,339 [INFO] fortress_director.codeaware.function_registry: Safe function 'set_watcher_route' registered successfully.
2025-11-06 23:31:42,339 [INFO] fortress_director.codeaware.function_registry: Registering safe function: schedule_npc_activity
2025-11-06 23:31:42,339 [INFO] fortress_director.codeaware.function_registry: Safe function 'schedule_npc_activity' registered successfully.
2025-11-06 23:31:42,341 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_patrol
2025-11-06 23:31:42,341 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_patrol' registered successfully.
2025-11-06 23:31:42,341 [INFO] fortress_director.codeaware.function_registry: Registering safe function: resolve_combat
2025-11-06 23:31:42,341 [INFO] fortress_director.codeaware.function_registry: Safe function 'resolve_combat' registered successfully.
2025-11-06 23:31:42,342 [INFO] fortress_director.codeaware.function_registry: Registering safe function: transfer_item
2025-11-06 23:31:42,342 [INFO] fortress_director.codeaware.function_registry: Safe function 'transfer_item' registered successfully.
2025-11-06 23:31:42,342 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_stockpile
2025-11-06 23:31:42,343 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_stockpile' registered successfully.
2025-11-06 23:31:42,343 [INFO] fortress_director.codeaware.function_registry: Registering safe function: open_trade_route
2025-11-06 23:31:42,343 [INFO] fortress_director.codeaware.function_registry: Safe function 'open_trade_route' registered successfully.
2025-11-06 23:31:42,343 [INFO] fortress_director.codeaware.function_registry: Registering safe function: close_trade_route
2025-11-06 23:31:42,345 [INFO] fortress_director.codeaware.function_registry: Safe function 'close_trade_route' registered successfully.
2025-11-06 23:31:42,345 [INFO] fortress_director.codeaware.function_registry: Registering safe function: queue_major_event
2025-11-06 23:31:42,345 [INFO] fortress_director.codeaware.function_registry: Safe function 'queue_major_event' registered successfully.
2025-11-06 23:31:42,345 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_story_act
2025-11-06 23:31:42,345 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_story_act' registered successfully.
2025-11-06 23:31:42,345 [INFO] fortress_director.codeaware.function_registry: Registering safe function: lock_player_option
2025-11-06 23:31:42,346 [INFO] fortress_director.codeaware.function_registry: Safe function 'lock_player_option' registered successfully.
2025-11-06 23:31:42,346 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_and_take_item
2025-11-06 23:31:42,346 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_and_take_item' registered successfully.
2025-11-06 23:31:42,346 [INFO] fortress_director.codeaware.function_registry: Registering safe function: patrol_and_report
2025-11-06 23:31:42,348 [INFO] fortress_director.codeaware.function_registry: Safe function 'patrol_and_report' registered successfully.
2025-11-06 23:31:42,349 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-06 23:31:42,350 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-11-06 23:31:42,350 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-11-06 23:31:42,352 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-06 23:31:42,354 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=5, call=None)
2025-11-06 23:31:42,354 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-11-06 23:31:42,356 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
2025-11-06 23:31:42,357 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"_anomaly_active_until": 7, "_director_guidance": {"flags_to_add": [], "flags_to_remove": [], "major_event": "force", "notes": "The campaign is progressing at a steady pace. No major events are needed for this turn.", "pacing": "steady", "risk_budget": 3}, "_director_notes": [{"note": "The campaign is progressing at a steady pace. No major events are needed for this turn.", "turn": 0}, {"note": "The campaign is moving at a steady pace. No major events are needed for this turn.", "turn": 1}, {"note": "The campaign is progressing at a steady pace. No major events are needed for this turn.", ...
2025-11-06 23:31:42,358 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 51, 'morale': 50, 'resources': 46, 'knowledge': 55, 'corruption': 10, 'glitch': 56, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-06 23:31:42,358 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=6, seed=12345, current_glitch=56)
2025-11-06 23:31:42,358 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 51, 'morale': 50, 'resources': 46, 'knowledge': 55, 'corruption': 10, 'glitch': 56, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-06 23:31:42,359 [INFO] fortress_director.utils.metrics_manager: Metric 'resources' updated from 46 to 43 (cause=glitch:major_anomaly)
2025-11-06 23:31:42,359 [INFO] fortress_director.utils.metrics_manager: Metric 'knowledge' updated from 55 to 53 (cause=glitch:major_anomaly)
2025-11-06 23:31:42,359 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 56 to 59 (cause=glitch:major_anomaly)
2025-11-06 23:31:42,360 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=62, triggered_loss=False
2025-11-06 23:31:42,360 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 51, 'morale': 50, 'resources': 43, 'knowledge': 53, 'corruption': 10, 'glitch': 59, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-06 23:31:42,360 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Major anomaly distorts the western wall segment.']
2025-11-06 23:31:42,361 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=62, triggered_loss=False
2025-11-06 23:31:42,361 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 51, 'morale': 50, 'resources': 43, 'knowledge': 53, 'corruption': 10, 'glitch': 59, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-06 23:31:42,361 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 59 to 58 (cause=turn_recovery)
2025-11-06 23:31:42,362 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 51, 'morale': 50, 'resources': 43, 'knowledge': 53, 'corruption': 10, 'glitch': 58, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-06 23:31:42,362 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=62, triggered_loss=False
2025-11-06 23:31:42,362 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 51, 'morale': 50, 'resources': 43, 'knowledge': 53, 'corruption': 10, 'glitch': 58, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-06 23:31:42,371 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-11-06 23:31:42,371 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 5 | Day 2 | Time dawn
Location: entrance
Objective: reinforce defenses
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}
Recent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger. As twilight deepens, he notices a faint glow in the distance. Suddenly, a discovery is made! (Moti...; The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squints to get a better look, you decide to approach the mysterious light. Suddenly, an inner gate buckles... Recent motifs: storm, loss, unknown_action
Recent major events: none
Relationship summary: Rhea trusts the player deeply
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 50, "resources": 43, "knowledge": 53, "corruption": 10, "glitch": 58, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-11-06 23:31:42,372 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 5 in room entrance
2025-11-06 23:31:42,372 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 5 | Day 2 | Time dawn\nLocation: entrance\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scannin...
2025-11-06 23:31:42,372 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-11-06 23:31:42,373 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-11-06 23:31:42,373 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}
2025-11-06 23:31:42,374 [DEBUG] fortress_director.orchestrator.orchestrator: Director agent input: {"WORLD_CONTEXT": "Turn 5 | Day 2 | Time dawn\nLocation: entrance\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scannin...
2025-11-06 23:31:42,375 [INFO] fortress_director.orchestrator.orchestrator: Director agent returned output.
2025-11-06 23:31:42,375 [DEBUG] fortress_director.orchestrator.orchestrator: Director agent output: {"response": "offline stub"}
2025-11-06 23:31:42,375 [INFO] fortress_director.orchestrator.orchestrator: Applied director guidance: pacing=steady, risk=3, major=delay
2025-11-06 23:31:42,379 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 5 | Day 2 | Time dawn\nLocation: entrance\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scannin...
2025-11-06 23:31:42,379 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-11-06 23:31:42,381 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-11-06 23:31:42,382 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "exploration", "id": "opt_1", "text": "Rally the nearby scouts to reinforce the gate. (focus: exploration)"}, {"action_type": "defense", "id": "opt_2", "text": "Signal the keep for additional lantern oil. (focus: defense)"}, {"action_type": "trade", "id": "opt_3", "text": "Quietly observe the storm's strange rhythm. (focus: trade)"}, {"action_type": "item_use", "id": "auto_item_use_1", "text": "Use an item from your inventory."}], "safe_functions": [{"kwargs": {"atmosphere": "electric storm", "sensory_details": "lightning traces the parapet...
2025-11-06 23:31:42,383 [WARNING] fortress_director.agents.creativity_agent: CreativityAgent LLM returned empty/invalid or meta-like string.
2025-11-06 23:31:42,384 [INFO] fortress_director.orchestrator.orchestrator: CreativityAgent enriched event: {'scene': '{"response": "offline stub"} (Motif: festival)', 'options': [{'id': 'opt_1', 'text': 'Rally the nearby scouts to reinforce the gate. (focus: exploration)', 'action_type': 'exploration'}, {'id': 'opt_2', 'text': 'Signal the keep for additional lantern oil. (focus: defense)', 'action_type': 'defense'}, {'id': 'opt_3', 'text': "Quietly observe the storm's strange rhythm. (focus: trade)", 'action_type': 'trade'}, {'id': 'auto_item_use_1', 'text': 'Use an item from your inventory.', 'action_type': 'item_use'}], 'major_event': False, 'safe_functions': [{'name': 'change_weather', 'kwargs': {'atmosphere': 'electric storm', 'sensory_details': 'lightning traces the parapets'}, 'metadata': {'origin': 'event_stub'}}, {'name': 'spawn_item', 'args': [], 'kwargs': {'item_id': 'fire_extinguisher', 'target': 'nearby'}, 'metadata': {'source': 'event_autoinject'}}], 'motif_injected': 'festival', 'creative_persist_for': 4, 'recent_motifs': ['festival'], 'motif_persist_for': 5}
2025-11-06 23:31:42,388 [INFO] fortress_director.orchestrator.orchestrator: Creative persist window extended to turn 9
2025-11-06 23:31:42,389 [INFO] fortress_director.orchestrator.orchestrator: Using previous judge verdict (turn 5)
2025-11-06 23:31:42,390 [INFO] fortress_director.orchestrator.orchestrator: World lock engaged until turn 8 with current constraint
2025-11-06 23:31:42,390 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-11-06 23:31:42,391 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'opt_1', 'text': 'Rally the nearby scouts to reinforce the gate. (focus: exploration)', 'action_type': 'exploration'}
2025-11-06 23:31:42,392 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "exploration", "id": "opt_1", "text": "Rally the nearby scouts to reinforce the gate. (focus: exploration)"}
2025-11-06 23:31:42,393 [INFO] fortress_director.orchestrator.orchestrator: Applying dynamic metrics for action_type 'exploration': {'knowledge': 2, 'resources': 1, 'morale': -1}
2025-11-06 23:31:42,393 [INFO] fortress_director.utils.metrics_manager: Metric 'knowledge' updated from 53 to 55 (cause=action_exploration)
2025-11-06 23:31:42,394 [INFO] fortress_director.utils.metrics_manager: Metric 'resources' updated from 43 to 44 (cause=action_exploration)
2025-11-06 23:31:42,394 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 50 to 49 (cause=action_exploration)
2025-11-06 23:31:42,395 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after dynamic changes: {'order': 51, 'morale': 49, 'resources': 44, 'knowledge': 55, 'corruption': 10, 'glitch': 58, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-06 23:31:42,395 [INFO] fortress_director.orchestrator.orchestrator: Action consequence: Your discovery brings new resources but tests village resolve.
2025-11-06 23:31:42,397 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 5 | Day 2 | Time dawn\nLocation: entrance\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scannin...
2025-11-06 23:31:42,397 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-11-06 23:31:42,400 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-11-06 23:31:42,400 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "brace_shield", "effects": {"flag_set": ["storm_vigil"], "trust_delta": 1}, "intent": "defend", "name": "Rhea", "safe_functions": [{"args": [], "kwargs": {"item_id": "lantern_oil", "target": "player"}, "metadata": {"origin": "character_stub"}, "name": "spawn_item"}], "speech": "I'll keep the storm off the wall while you plan our next move."}, {"action": "Autonomously performs observe action.", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "Rhea shifts tactics with a observe maneuver."}, {"action": "Autonomously performs assist action.", "eff...
2025-11-06 23:31:42,401 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-11-06 23:31:42,401 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-11-06 23:31:42,401 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-11-06 23:31:42,402 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "brace_shield", "effects": {"flag_set": ["storm_vigil"], "trust_delta": 1}, "intent": "defend", "name": "Rhea", "safe_functions": [{"args": [], "kwargs": {"item_id": "lantern_oil", "target": "player"}, "metadata": {"origin": "character_stub"}, "name": "spawn_item"}], "speech": "I'll keep the storm off the wall while you plan our next move."}, {"action": "Autonomously performs observe action.", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "Rhea shifts tactics with a observe maneuver."}, {"action": "Autonomously performs assist action.", "eff...
2025-11-06 23:31:42,403 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-11-06 23:31:42,403 [DEBUG] fortress_director.rules.rules_engine: Input state: {'schema_version': 2, 'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 5, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_cloud_presence', 'explore', 'major_wall_alert'], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 5, 'day': 2, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': ['The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.', 'The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger. As twilight deepens, he notices a faint glow in the distance. Suddenly, a discovery is made! (Moti...', 'The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squints to get a better look, you decide to approach the mysterious light. Suddenly, an inner gate buckles...'], 'recent_motifs': ['storm', 'loss', 'unknown_action', 'festival'], 'recent_world_atmospheres': [], 'world_constraint_from_prev_turn': {'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player deeply', 'metrics': {'order': 51, 'morale': 49, 'resources': 44, 'knowledge': 55, 'corruption': 10, 'glitch': 58, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {'Rhea': 2}, 'environment_hazards': [], 'weather_pattern': {'pattern': 'overcast', 'remaining': 0, 'lock_until': 0}, 'structures': {'western_wall': {'durability': 80, 'max_durability': 100, 'status': 'stable'}, 'inner_gate': {'durability': 70, 'max_durability': 100, 'status': 'stable'}, 'watchtower': {'durability': 60, 'max_durability': 80, 'status': 'stable'}, 'granary': {'durability': 55, 'max_durability': 70, 'status': 'stable'}}, 'npc_schedule': {}, 'patrols': {}, 'combat_log': [], 'item_transfers': [], 'stockpiles': {'food': 120, 'wood': 60, 'ore': 40}, 'stockpile_log': [], 'trade_routes': {}, 'trade_route_history': [], 'scheduled_events': [], 'story_progress': {'act': 'build_up', 'progress': 0.0, 'act_history': []}, 'timeline': [], 'hazard_cooldowns': {}, 'schema_notes': {}, 'locked_options': {}, '_drama_window': [[50, 49, 40, 45, 50], [49, 51, 41, 47, 51], [50, 52, 42, 49, 53], [51, 53, 43, 51, 55], [50, 51, 45, 53, 56], [51, 50, 43, 53, 58]], '_anomaly_active_until': 9, '_world_lock_until': 8, '_high_volatility_mode': True, 'last_weather_change_turn': None, '_glitch_buffer': 0, '_director_pacing': 'steady', '_director_notes': [{'turn': 0, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 1, 'note': 'The campaign is moving at a steady pace. No major events are needed for this turn.'}, {'turn': 2, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 3, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 4, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}], '_director_guidance': {'pacing': 'steady', 'risk_budget': 3, 'major_event': 'delay', 'notes': '', 'flags_to_add': [], 'flags_to_remove': []}, 'previous_judge_verdict': {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The Shieldbearer's actions align with his role as a defender at the entrance.", 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}, 'player_choice_history': ['dialogue', 'dialogue', 'dialogue', 'exploration'], 'summary_text': 'A major event shakes the village. Glitch level rises.', 'emotional_memory': [{'turn': 0, 'name': 'Rhea', 'intent': 'observe', 'speech': 'I stand vigilant, my senses alert for any sign of danger.'}, {'turn': 0, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 0, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 0, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 0, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 1, 'name': 'Rhea', 'intent': 'observe', 'speech': 'I stand vigilant, my senses alert for any sign of danger. The storm rages on, a symphony of wind and rain.'}, {'turn': 1, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 1, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 1, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 1, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 2, 'name': 'Rhea', 'intent': 'observe', 'speech': 'The shadows lengthen, whispering secrets I can barely decipher. I stand guard, waiting for any sign of movement.'}, {'turn': 2, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 2, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 2, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 2, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 3, 'name': 'Rhea', 'intent': 'defend', 'speech': 'Approach the glowing light and investigate its source.'}, {'turn': 4, 'name': 'Rhea', 'intent': 'observe', 'speech': "I notice a faint glow emanating from the distant light source. It's as if something is hidden there, waiting to be discovered."}, {'turn': 4, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 4, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 4, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 4, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}], 'memory_short': ["Turn 1: Ask the Shieldbearer about any recent threats to Lornhaven. -> ' the rewritten prompt: I find myself trapped within a labyrinthine mansion, its walls adorned with ...", 'Turn 2: Ask the Shieldbearer about any recent threats to Lornhaven. -> (Motif: storm)...', 'Turn 3: Ask the Shieldbearer about any recent threats to Lornhaven. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger...', "Memory summary: Turn 1: Ask the Shieldbearer about any recent threats to Lornhaven. -> ' the rewritten prompt: I find myself trapped within a labyrinthine mansion, its walls adorned with ... | Turn 2: Ask the Shieldb...", 'Turn 4: Approach the glowing light and investigate its source. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger...', 'Turn 5: Approach the glowing light and investigate its source. -> The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squint...'], 'memory_long': ['Turn 5: Major event triggered (major_wall_alert)'], 'status_effects': [{'target': 'Rhea', 'status': 'tense_watch', 'duration': 2}], 'persistent_motif': {'motif': 'festival', 'remaining': 5}, 'last_major_event_turn': 4, 'world_constraint': {'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}, 'major_events_triggered': 1, 'major_event_last_turn': 5}
2025-11-06 23:31:42,405 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'defend', 'action': 'brace_shield', 'speech': "I'll keep the storm off the wall while you plan our next move.", 'effects': {'trust_delta': 1, 'flag_set': ['storm_vigil']}, 'safe_functions': [{'name': 'spawn_item', 'args': [], 'kwargs': {'item_id': 'lantern_oil', 'target': 'player'}, 'metadata': {'origin': 'character_stub'}}]}, {'name': 'Rhea', 'intent': 'observe', 'action': 'Autonomously performs observe action.', 'speech': 'Rhea shifts tactics with a observe maneuver.', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': 'Boris shifts tactics with a assist maneuver.', 'effects': {}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': 'Rhea shifts tactics with a command maneuver.', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': 'Boris shifts tactics with a plan maneuver.', 'effects': {}, 'safe_functions': []}]
2025-11-06 23:31:42,406 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 5 | Day 2 | Time dawn
Location: entrance
Objective: reinforce defenses
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}
Recent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger. As twilight deepens, he notices a faint glow in the distance. Suddenly, a discovery is made! (Moti...; The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squints to get a better look, you decide to approach the mysterious light. Suddenly, an inner gate buckles... Recent motifs: storm, loss, unknown_action
Recent major events: none
Relationship summary: Rhea trusts the player deeply
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 50, "resources": 43, "knowledge": 53, "corruption": 10, "glitch": 58, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: {"response": "offline stub"} (Motif: festival), player_choice: {'id': 'opt_1', 'text': 'Rally the nearby scouts to reinforce the gate. (focus: exploration)', 'action_type': 'exploration'}
2025-11-06 23:31:42,406 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-11-06 23:31:42,407 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'defend', 'action': 'brace_shield', 'speech': "I'll keep the storm off the wall while you plan our next move.", 'effects': {'trust_delta': 1, 'flag_set': ['storm_vigil']}, 'safe_functions': [{'name': 'spawn_item', 'args': [], 'kwargs': {'item_id': 'lantern_oil', 'target': 'player'}, 'metadata': {'origin': 'character_stub'}}]}
2025-11-06 23:31:42,408 [DEBUG] fortress_director.rules.rules_engine: Validating character event 1: {'name': 'Rhea', 'intent': 'observe', 'action': 'Autonomously performs observe action.', 'speech': 'Rhea shifts tactics with a observe maneuver.', 'effects': {}, 'safe_functions': []}
2025-11-06 23:31:42,408 [DEBUG] fortress_director.rules.rules_engine: Validating character event 2: {'name': 'Boris', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': 'Boris shifts tactics with a assist maneuver.', 'effects': {}, 'safe_functions': []}
2025-11-06 23:31:42,408 [DEBUG] fortress_director.rules.rules_engine: Validating character event 3: {'name': 'Rhea', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': 'Rhea shifts tactics with a command maneuver.', 'effects': {}, 'safe_functions': []}
2025-11-06 23:31:42,409 [DEBUG] fortress_director.rules.rules_engine: Validating character event 4: {'name': 'Boris', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': 'Boris shifts tactics with a plan maneuver.', 'effects': {}, 'safe_functions': []}
2025-11-06 23:31:42,413 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-11-06 23:31:42,414 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'offline stub', 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}
2025-11-06 23:31:42,416 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'offline stub', 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}
2025-11-06 23:31:42,417 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Boris: {'consistent': True, 'reason': 'offline stub', 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}
2025-11-06 23:31:42,417 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': 'offline stub', 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}
2025-11-06 23:31:42,418 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Boris: {'consistent': True, 'reason': 'offline stub', 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}
2025-11-06 23:31:42,418 [INFO] fortress_director.rules.rules_engine: Tier two validation passed with penalties: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-11-06 23:31:42,421 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {'trust_delta': 1, 'flag_set': ['storm_vigil']}
2025-11-06 23:31:42,421 [INFO] fortress_director.rules.rules_engine: Trust updated for Rhea: 2 -> 3 (delta: 1)
2025-11-06 23:31:42,422 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-11-06 23:31:42,422 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Boris: {}
2025-11-06 23:31:42,423 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-11-06 23:31:42,424 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Boris: {}
2025-11-06 23:31:42,425 [INFO] fortress_director.rules.rules_engine: Choice impact applied: knowledge +1 (action_type=exploration)
2025-11-06 23:31:42,425 [INFO] fortress_director.rules.rules_engine: Choice impact applied: resources +1 (action_type=exploration)
2025-11-06 23:31:42,426 [INFO] fortress_director.rules.rules_engine: Relationship summary updated: Rhea trusts the player deeply
2025-11-06 23:31:42,426 [INFO] fortress_director.rules.rules_engine: Judge penalties applied: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-11-06 23:31:42,427 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-11-06 23:31:42,427 [DEBUG] fortress_director.rules.rules_engine: Output state: {'schema_version': 2, 'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 5, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_cloud_presence', 'explore', 'major_wall_alert', 'storm_vigil'], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 5, 'day': 2, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': ['The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.', 'The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger. As twilight deepens, he notices a faint glow in the distance. Suddenly, a discovery is made! (Moti...', 'The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squints to get a better look, you decide to approach the mysterious light. Suddenly, an inner gate buckles...'], 'recent_motifs': ['storm', 'loss', 'unknown_action', 'festival'], 'recent_world_atmospheres': [], 'world_constraint_from_prev_turn': {'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player deeply', 'metrics': {'order': 51, 'morale': 49, 'resources': 45, 'knowledge': 56, 'corruption': 10, 'glitch': 58, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {'Rhea': 3}, 'environment_hazards': [], 'weather_pattern': {'pattern': 'overcast', 'remaining': 0, 'lock_until': 0}, 'structures': {'western_wall': {'durability': 80, 'max_durability': 100, 'status': 'stable'}, 'inner_gate': {'durability': 70, 'max_durability': 100, 'status': 'stable'}, 'watchtower': {'durability': 60, 'max_durability': 80, 'status': 'stable'}, 'granary': {'durability': 55, 'max_durability': 70, 'status': 'stable'}}, 'npc_schedule': {}, 'patrols': {}, 'combat_log': [], 'item_transfers': [], 'stockpiles': {'food': 120, 'wood': 60, 'ore': 40}, 'stockpile_log': [], 'trade_routes': {}, 'trade_route_history': [], 'scheduled_events': [], 'story_progress': {'act': 'build_up', 'progress': 0.0, 'act_history': []}, 'timeline': [], 'hazard_cooldowns': {}, 'schema_notes': {}, 'locked_options': {}, '_drama_window': [[50, 49, 40, 45, 50], [49, 51, 41, 47, 51], [50, 52, 42, 49, 53], [51, 53, 43, 51, 55], [50, 51, 45, 53, 56], [51, 50, 43, 53, 58]], '_anomaly_active_until': 9, '_world_lock_until': 8, '_high_volatility_mode': True, 'last_weather_change_turn': None, '_glitch_buffer': 0, '_director_pacing': 'steady', '_director_notes': [{'turn': 0, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 1, 'note': 'The campaign is moving at a steady pace. No major events are needed for this turn.'}, {'turn': 2, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 3, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 4, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}], '_director_guidance': {'pacing': 'steady', 'risk_budget': 3, 'major_event': 'delay', 'notes': '', 'flags_to_add': [], 'flags_to_remove': []}, 'previous_judge_verdict': {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The Shieldbearer's actions align with his role as a defender at the entrance.", 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}, 'player_choice_history': ['dialogue', 'dialogue', 'dialogue', 'exploration', 'exploration'], 'summary_text': 'A routine day settles over Lornhaven.', 'emotional_memory': [{'turn': 0, 'name': 'Rhea', 'intent': 'observe', 'speech': 'I stand vigilant, my senses alert for any sign of danger.'}, {'turn': 0, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 0, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 0, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 0, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 1, 'name': 'Rhea', 'intent': 'observe', 'speech': 'I stand vigilant, my senses alert for any sign of danger. The storm rages on, a symphony of wind and rain.'}, {'turn': 1, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 1, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 1, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 1, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 2, 'name': 'Rhea', 'intent': 'observe', 'speech': 'The shadows lengthen, whispering secrets I can barely decipher. I stand guard, waiting for any sign of movement.'}, {'turn': 2, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 2, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 2, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 2, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 3, 'name': 'Rhea', 'intent': 'defend', 'speech': 'Approach the glowing light and investigate its source.'}, {'turn': 4, 'name': 'Rhea', 'intent': 'observe', 'speech': "I notice a faint glow emanating from the distant light source. It's as if something is hidden there, waiting to be discovered."}, {'turn': 4, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 4, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 4, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 4, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}], 'memory_short': ["Turn 1: Ask the Shieldbearer about any recent threats to Lornhaven. -> ' the rewritten prompt: I find myself trapped within a labyrinthine mansion, its walls adorned with ...", 'Turn 2: Ask the Shieldbearer about any recent threats to Lornhaven. -> (Motif: storm)...', 'Turn 3: Ask the Shieldbearer about any recent threats to Lornhaven. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger...', "Memory summary: Turn 1: Ask the Shieldbearer about any recent threats to Lornhaven. -> ' the rewritten prompt: I find myself trapped within a labyrinthine mansion, its walls adorned with ... | Turn 2: Ask the Shieldb...", 'Turn 4: Approach the glowing light and investigate its source. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger...', 'Turn 5: Approach the glowing light and investigate its source. -> The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squint...'], 'memory_long': ['Turn 5: Major event triggered (major_wall_alert)'], 'status_effects': [{'target': 'Rhea', 'status': 'tense_watch', 'duration': 2}], 'persistent_motif': {'motif': 'festival', 'remaining': 5}, 'last_major_event_turn': 4, 'world_constraint': {'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}, 'major_events_triggered': 1, 'major_event_last_turn': 5}
2025-11-06 23:31:42,430 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=6)
2025-11-06 23:31:42,431 [INFO] fortress_director.orchestrator.orchestrator: Applying 2 autonomous actions
2025-11-06 23:31:42,433 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 51 to 52 (cause=autonomous_Rhea)
2025-11-06 23:31:42,434 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 49 to 51 (cause=autonomous_Boris)
2025-11-06 23:31:42,434 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-11-06 23:31:42,435 [INFO] fortress_director.orchestrator.orchestrator: Advanced time to morning
2025-11-06 23:31:42,435 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: [{'target': 'Rhea', 'status': 'tense_watch', 'duration': 1}]
2025-11-06 23:31:42,435 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-11-06 23:31:42,437 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"_anomaly_active_until": 9, "_director_guidance": {"flags_to_add": [], "flags_to_remove": [], "major_event": "delay", "notes": "", "pacing": "steady", "risk_budget": 3}, "_director_notes": [{"note": "The campaign is progressing at a steady pace. No major events are needed for this turn.", "turn": 0}, {"note": "The campaign is moving at a steady pace. No major events are needed for this turn.", "turn": 1}, {"note": "The campaign is progressing at a steady pace. No major events are needed for this turn.", "turn": 2}, {"note": "The campaign is progressing at a steady pace. No major events are...
2025-11-06 23:31:42,483 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,487 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-11-06 23:31:42,492 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,494 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,497 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,499 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,501 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,502 [INFO] fortress_director.codeaware.function_validator: Validating function call payload: {'name': 'change_weather', 'kwargs': {'atmosphere': 'electric storm', 'sensory_details': 'lightning traces the parapets'}, 'metadata': {'origin': 'event_stub'}}
2025-11-06 23:31:42,504 [INFO] fortress_director.codeaware.function_registry: Validating function call: change_weather
2025-11-06 23:31:42,506 [INFO] fortress_director.codeaware.function_validator: Function call 'change_weather' validated successfully.
2025-11-06 23:31:42,511 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,515 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=6, call=change_weather)
2025-11-06 23:31:42,515 [INFO] fortress_director.codeaware.function_registry: Getting registered function: change_weather
2025-11-06 23:31:42,516 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'change_weather'...
2025-11-06 23:31:42,518 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,539 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,539 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed successfully.
2025-11-06 23:31:42,539 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed (checkpoint turn=6)
2025-11-06 23:31:42,542 [INFO] fortress_director.codeaware.function_validator: Validating function call payload: {'name': 'spawn_item', 'args': [], 'kwargs': {'item_id': 'fire_extinguisher', 'target': 'nearby'}, 'metadata': {'source': 'event_autoinject'}}
2025-11-06 23:31:42,543 [INFO] fortress_director.codeaware.function_registry: Validating function call: spawn_item
2025-11-06 23:31:42,543 [INFO] fortress_director.codeaware.function_validator: Function call 'spawn_item' validated successfully.
2025-11-06 23:31:42,544 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,546 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=6, call=spawn_item)
2025-11-06 23:31:42,547 [INFO] fortress_director.codeaware.function_registry: Getting registered function: spawn_item
2025-11-06 23:31:42,547 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'spawn_item'...
2025-11-06 23:31:42,549 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,565 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,566 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed successfully.
2025-11-06 23:31:42,567 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed (checkpoint turn=6)
2025-11-06 23:31:42,568 [INFO] fortress_director.codeaware.function_validator: Validating function call payload: {'name': 'spawn_item', 'args': [], 'kwargs': {'item_id': 'lantern_oil', 'target': 'player'}, 'metadata': {'origin': 'character_stub'}}
2025-11-06 23:31:42,569 [INFO] fortress_director.codeaware.function_registry: Validating function call: spawn_item
2025-11-06 23:31:42,569 [INFO] fortress_director.codeaware.function_validator: Function call 'spawn_item' validated successfully.
2025-11-06 23:31:42,570 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,571 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=6, call=spawn_item)
2025-11-06 23:31:42,571 [INFO] fortress_director.codeaware.function_registry: Getting registered function: spawn_item
2025-11-06 23:31:42,571 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'spawn_item'...
2025-11-06 23:31:42,573 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,587 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,588 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed successfully.
2025-11-06 23:31:42,588 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed (checkpoint turn=6)
2025-11-06 23:31:42,590 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-11-06 23:31:42,592 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,592 [INFO] fortress_director.orchestrator.orchestrator: Weather changed via safe function, re-describing world...
2025-11-06 23:31:42,594 [INFO] fortress_director.orchestrator.orchestrator: World re-described after safe function.
2025-11-06 23:31:42,595 [DEBUG] fortress_director.orchestrator.orchestrator: New world output: {"atmosphere": "storm glare", "sensory_details": "hail rattles the stones"}
2025-11-06 23:31:42,612 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,613 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,614 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 52, 'morale': 51, 'resources': 44, 'knowledge': 55, 'corruption': 10, 'glitch': 58, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-06 23:31:42,614 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'conditions_not_met', 'description': 'Oyun devam ediyor...'}
2025-11-06 23:31:42,615 [INFO] fortress_director.orchestrator.orchestrator: Turn summary: A routine day settles over Lornhaven.
2025-11-06 23:31:42,618 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-11-06 23:31:42,620 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 5 | Day 2 | Time dawn\nLocation: entrance\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scannin...
2025-11-06 23:31:42,620 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-11-06 23:31:42,620 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
2025-11-06 23:31:42,622 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6)
2025-11-06 23:31:42,685 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5)
