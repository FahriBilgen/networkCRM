2025-11-07 21:21:36,687 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\runs\profile_20251107_182136\profile_20251107_182136.log)
2025-11-07 21:21:36,698 [INFO] fortress_functions.function_registry: Registering safe function: change_weather
2025-11-07 21:21:36,699 [INFO] fortress_functions.function_registry: Safe function 'change_weather' registered successfully.
2025-11-07 21:21:36,699 [INFO] fortress_functions.function_registry: Registering safe function: spawn_item
2025-11-07 21:21:36,699 [INFO] fortress_functions.function_registry: Safe function 'spawn_item' registered successfully.
2025-11-07 21:21:36,699 [INFO] fortress_functions.function_registry: Registering safe function: move_npc
2025-11-07 21:21:36,699 [INFO] fortress_functions.function_registry: Safe function 'move_npc' registered successfully.
2025-11-07 21:21:36,699 [INFO] fortress_functions.function_registry: Registering safe function: adjust_logic
2025-11-07 21:21:36,699 [INFO] fortress_functions.function_registry: Safe function 'adjust_logic' registered successfully.
2025-11-07 21:21:36,701 [INFO] fortress_functions.function_registry: Registering safe function: adjust_emotion
2025-11-07 21:21:36,701 [INFO] fortress_functions.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-11-07 21:21:36,701 [INFO] fortress_functions.function_registry: Registering safe function: raise_corruption
2025-11-07 21:21:36,701 [INFO] fortress_functions.function_registry: Safe function 'raise_corruption' registered successfully.
2025-11-07 21:21:36,701 [INFO] fortress_functions.function_registry: Registering safe function: advance_turn
2025-11-07 21:21:36,701 [INFO] fortress_functions.function_registry: Safe function 'advance_turn' registered successfully.
2025-11-07 21:21:36,701 [INFO] fortress_functions.function_registry: Registering safe function: modify_resources
2025-11-07 21:21:36,701 [INFO] fortress_functions.function_registry: Safe function 'modify_resources' registered successfully.
2025-11-07 21:21:36,701 [INFO] fortress_functions.function_registry: Registering safe function: adjust_metric
2025-11-07 21:21:36,701 [INFO] fortress_functions.function_registry: Safe function 'adjust_metric' registered successfully.
2025-11-07 21:21:36,701 [INFO] fortress_functions.function_registry: Registering safe function: move_room
2025-11-07 21:21:36,702 [INFO] fortress_functions.function_registry: Safe function 'move_room' registered successfully.
2025-11-07 21:21:36,702 [INFO] fortress_functions.function_registry: Registering safe function: set_flag
2025-11-07 21:21:36,702 [INFO] fortress_functions.function_registry: Safe function 'set_flag' registered successfully.
2025-11-07 21:21:36,702 [INFO] fortress_functions.function_registry: Registering safe function: clear_flag
2025-11-07 21:21:36,702 [INFO] fortress_functions.function_registry: Safe function 'clear_flag' registered successfully.
2025-11-07 21:21:36,702 [INFO] fortress_functions.function_registry: Registering safe function: set_trust
2025-11-07 21:21:36,702 [INFO] fortress_functions.function_registry: Safe function 'set_trust' registered successfully.
2025-11-07 21:21:36,702 [INFO] fortress_functions.function_registry: Registering safe function: adjust_trust
2025-11-07 21:21:36,703 [INFO] fortress_functions.function_registry: Safe function 'adjust_trust' registered successfully.
2025-11-07 21:21:36,703 [INFO] fortress_functions.function_registry: Registering safe function: add_item_to_npc
2025-11-07 21:21:36,703 [INFO] fortress_functions.function_registry: Safe function 'add_item_to_npc' registered successfully.
2025-11-07 21:21:36,703 [INFO] fortress_functions.function_registry: Registering safe function: remove_item_from_npc
2025-11-07 21:21:36,703 [INFO] fortress_functions.function_registry: Safe function 'remove_item_from_npc' registered successfully.
2025-11-07 21:21:36,703 [INFO] fortress_functions.function_registry: Registering safe function: add_status
2025-11-07 21:21:36,703 [INFO] fortress_functions.function_registry: Safe function 'add_status' registered successfully.
2025-11-07 21:21:36,704 [INFO] fortress_functions.function_registry: Registering safe function: remove_status
2025-11-07 21:21:36,704 [INFO] fortress_functions.function_registry: Safe function 'remove_status' registered successfully.
2025-11-07 21:21:36,704 [INFO] fortress_functions.function_registry: Registering safe function: spawn_npc
2025-11-07 21:21:36,704 [INFO] fortress_functions.function_registry: Safe function 'spawn_npc' registered successfully.
2025-11-07 21:21:36,704 [INFO] fortress_functions.function_registry: Registering safe function: despawn_npc
2025-11-07 21:21:36,704 [INFO] fortress_functions.function_registry: Safe function 'despawn_npc' registered successfully.
2025-11-07 21:21:36,704 [INFO] fortress_functions.function_registry: Registering safe function: set_time_of_day
2025-11-07 21:21:36,704 [INFO] fortress_functions.function_registry: Safe function 'set_time_of_day' registered successfully.
2025-11-07 21:21:36,705 [INFO] fortress_functions.function_registry: Registering safe function: set_weather_pattern
2025-11-07 21:21:36,705 [INFO] fortress_functions.function_registry: Safe function 'set_weather_pattern' registered successfully.
2025-11-07 21:21:36,705 [INFO] fortress_functions.function_registry: Registering safe function: trigger_environment_hazard
2025-11-07 21:21:36,705 [INFO] fortress_functions.function_registry: Safe function 'trigger_environment_hazard' registered successfully.
2025-11-07 21:21:36,705 [INFO] fortress_functions.function_registry: Registering safe function: reinforce_structure
2025-11-07 21:21:36,705 [INFO] fortress_functions.function_registry: Safe function 'reinforce_structure' registered successfully.
2025-11-07 21:21:36,705 [INFO] fortress_functions.function_registry: Registering safe function: repair_breach
2025-11-07 21:21:36,705 [INFO] fortress_functions.function_registry: Safe function 'repair_breach' registered successfully.
2025-11-07 21:21:36,705 [INFO] fortress_functions.function_registry: Registering safe function: set_watcher_route
2025-11-07 21:21:36,705 [INFO] fortress_functions.function_registry: Safe function 'set_watcher_route' registered successfully.
2025-11-07 21:21:36,707 [INFO] fortress_functions.function_registry: Registering safe function: schedule_npc_activity
2025-11-07 21:21:36,707 [INFO] fortress_functions.function_registry: Safe function 'schedule_npc_activity' registered successfully.
2025-11-07 21:21:36,707 [INFO] fortress_functions.function_registry: Registering safe function: spawn_patrol
2025-11-07 21:21:36,707 [INFO] fortress_functions.function_registry: Safe function 'spawn_patrol' registered successfully.
2025-11-07 21:21:36,707 [INFO] fortress_functions.function_registry: Registering safe function: resolve_combat
2025-11-07 21:21:36,707 [INFO] fortress_functions.function_registry: Safe function 'resolve_combat' registered successfully.
2025-11-07 21:21:36,707 [INFO] fortress_functions.function_registry: Registering safe function: transfer_item
2025-11-07 21:21:36,707 [INFO] fortress_functions.function_registry: Safe function 'transfer_item' registered successfully.
2025-11-07 21:21:36,708 [INFO] fortress_functions.function_registry: Registering safe function: adjust_stockpile
2025-11-07 21:21:36,708 [INFO] fortress_functions.function_registry: Safe function 'adjust_stockpile' registered successfully.
2025-11-07 21:21:36,708 [INFO] fortress_functions.function_registry: Registering safe function: open_trade_route
2025-11-07 21:21:36,708 [INFO] fortress_functions.function_registry: Safe function 'open_trade_route' registered successfully.
2025-11-07 21:21:36,708 [INFO] fortress_functions.function_registry: Registering safe function: close_trade_route
2025-11-07 21:21:36,708 [INFO] fortress_functions.function_registry: Safe function 'close_trade_route' registered successfully.
2025-11-07 21:21:36,708 [INFO] fortress_functions.function_registry: Registering safe function: queue_major_event
2025-11-07 21:21:36,708 [INFO] fortress_functions.function_registry: Safe function 'queue_major_event' registered successfully.
2025-11-07 21:21:36,709 [INFO] fortress_functions.function_registry: Registering safe function: advance_story_act
2025-11-07 21:21:36,709 [INFO] fortress_functions.function_registry: Safe function 'advance_story_act' registered successfully.
2025-11-07 21:21:36,709 [INFO] fortress_functions.function_registry: Registering safe function: lock_player_option
2025-11-07 21:21:36,709 [INFO] fortress_functions.function_registry: Safe function 'lock_player_option' registered successfully.
2025-11-07 21:21:36,709 [INFO] fortress_functions.function_registry: Registering safe function: move_and_take_item
2025-11-07 21:21:36,709 [INFO] fortress_functions.function_registry: Safe function 'move_and_take_item' registered successfully.
2025-11-07 21:21:36,709 [INFO] fortress_functions.function_registry: Registering safe function: patrol_and_report
2025-11-07 21:21:36,709 [INFO] fortress_functions.function_registry: Safe function 'patrol_and_report' registered successfully.
2025-11-07 21:21:36,711 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=8)
2025-11-07 21:21:36,711 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-11-07 21:21:36,711 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-11-07 21:21:36,712 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=8)
2025-11-07 21:21:36,713 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=8, call=None)
2025-11-07 21:21:36,713 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-11-07 21:21:36,715 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=8)
2025-11-07 21:21:36,716 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"_anomaly_active_until": 11, "_director_guidance": {"flags_to_add": [], "flags_to_remove": [], "major_event": "force", "notes": "The campaign is moving at a steady pace. No major events are needed for this turn.", "pacing": "steady", "risk_budget": 3}, "_director_notes": [{"note": "The campaign is progressing at a steady pace. No major events are needed for this turn.", "turn": 0}, {"note": "The campaign is moving at a steady pace. No major events are needed for this turn.", "turn": 1}, {"note": "The campaign is progressing at a steady pace. No major events are needed for this turn.", "tur...
2025-11-07 21:21:36,716 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 55, 'morale': 47, 'resources': 36, 'knowledge': 51, 'corruption': 10, 'glitch': 61, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 21:21:36,716 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=9, seed=12345, current_glitch=61)
2025-11-07 21:21:36,716 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 55, 'morale': 47, 'resources': 36, 'knowledge': 51, 'corruption': 10, 'glitch': 61, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 21:21:36,717 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 55 to 53 (cause=glitch:medium_anomaly)
2025-11-07 21:21:36,717 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 47 to 46 (cause=glitch:medium_anomaly)
2025-11-07 21:21:36,717 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 61 to 63 (cause=glitch:medium_anomaly)
2025-11-07 21:21:36,717 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=43, triggered_loss=False
2025-11-07 21:21:36,717 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 53, 'morale': 46, 'resources': 36, 'knowledge': 51, 'corruption': 10, 'glitch': 63, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 21:21:36,717 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Pathfinding errors unsettle the patrol routes.']
2025-11-07 21:21:36,717 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=43, triggered_loss=False
2025-11-07 21:21:36,718 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 53, 'morale': 46, 'resources': 36, 'knowledge': 51, 'corruption': 10, 'glitch': 63, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 21:21:36,718 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 63 to 62 (cause=turn_recovery)
2025-11-07 21:21:36,718 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 53, 'morale': 46, 'resources': 36, 'knowledge': 51, 'corruption': 10, 'glitch': 62, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 21:21:36,718 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=43, triggered_loss=False
2025-11-07 21:21:36,718 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 53, 'morale': 46, 'resources': 36, 'knowledge': 51, 'corruption': 10, 'glitch': 62, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 21:21:36,722 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-11-07 21:21:36,722 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 8 | Day 2 | Time evening
Location: courtyard
Objective: reinforce defenses
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}
Recent events: The Shieldbearer' eyes narrowed as the shimmering light pulsed with an unsettling energy. The shadowed gateway, once steadfast, hung precariously over the chasm, its hinges twisted and distorted. A si...; The shimmering tendrils of the corrupted gate writhed and strained, their hinges groaning like an ancient beast. A sudden cascade of supplies tumbled down the chasm, the metal glinting with an unsettl...; The Shieldbearer' heart hammered against their ribs like a frantic bird trapped in a cage. The writhing gate, their once pristine obsidian expanse now coated in a sickly green, churned and groaned wit... Recent motifs: mystery, mystery, mystery
Recent major events: none
Relationship summary: Rhea is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 53, "morale": 46, "resources": 36, "knowledge": 51, "corruption": 10, "glitch": 62, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-11-07 21:21:36,722 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 8 in room courtyard
2025-11-07 21:21:36,722 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 8 | Day 2 | Time evening\nLocation: courtyard\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer' eyes narrowed as the shimmering light pulsed with an unsettling energy. The shadowed gateway, once steadfast, hung precariously over the chasm, ...
2025-11-07 21:21:36,723 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-11-07 21:21:36,723 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-11-07 21:21:36,723 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}
2025-11-07 21:21:36,724 [DEBUG] fortress_director.orchestrator.orchestrator: Director agent input: {"WORLD_CONTEXT": "Turn 8 | Day 2 | Time evening\nLocation: courtyard\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer' eyes narrowed as the shimmering light pulsed with an unsettling energy. The shadowed gateway, once steadfast, hung precariously over the chasm, ...
2025-11-07 21:21:36,725 [WARNING] fortress_director.orchestrator.orchestrator: Director agent failed; continuing with governor defaults: Missing prompt variable: 'pacing'
2025-11-07 21:21:36,725 [INFO] fortress_director.orchestrator.orchestrator: Applied director guidance: pacing=steady, risk=3, major=allow
2025-11-07 21:21:36,725 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 8 | Day 2 | Time evening\nLocation: courtyard\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer' eyes narrowed as the shimmering light pulsed with an unsettling energy. The shadowed gateway, once steadfast, hung precariously over the chasm, ...
2025-11-07 21:21:36,726 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-11-07 21:21:36,726 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-11-07 21:21:36,727 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": true, "options": [{"action_type": "exploration", "id": "opt_1", "text": "Rally the nearby scouts to reinforce the gate. (focus: exploration)"}, {"action_type": "defense", "id": "opt_2", "text": "Signal the keep for additional lantern oil. (focus: defense)"}, {"action_type": "trade", "id": "opt_3", "text": "Quietly observe the storm's strange rhythm. (focus: trade)"}, {"action_type": "item_use", "id": "auto_item_use_1", "text": "Use an item from your inventory."}], "safe_functions": [{"kwargs": {"atmosphere": "electric storm", "sensory_details": "lightning traces the parapets...
2025-11-07 21:21:36,727 [WARNING] fortress_director.agents.creativity_agent: CreativityAgent LLM returned empty/invalid or meta-like string.
2025-11-07 21:21:36,727 [INFO] fortress_director.orchestrator.orchestrator: CreativityAgent enriched event: {'scene': '{"response": "offline stub"} (Motif: betrayal)', 'options': [{'id': 'opt_1', 'text': 'Rally the nearby scouts to reinforce the gate. (focus: exploration)', 'action_type': 'exploration'}, {'id': 'opt_2', 'text': 'Signal the keep for additional lantern oil. (focus: defense)', 'action_type': 'defense'}, {'id': 'opt_3', 'text': "Quietly observe the storm's strange rhythm. (focus: trade)", 'action_type': 'trade'}, {'id': 'auto_item_use_1', 'text': 'Use an item from your inventory.', 'action_type': 'item_use'}], 'major_event': True, 'safe_functions': [{'name': 'change_weather', 'kwargs': {'atmosphere': 'electric storm', 'sensory_details': 'lightning traces the parapets'}, 'metadata': {'origin': 'event_stub'}}, {'name': 'spawn_item', 'args': [], 'kwargs': {'item_id': 'fire_extinguisher', 'target': 'nearby'}, 'metadata': {'source': 'event_autoinject'}}], 'story_rupture': {'cause': 'drama_valve', 'glitch': 62, 'risk_budget_used': 3}, 'motif_injected': 'betrayal', 'creative_persist_for': 4, 'recent_motifs': ['betrayal'], 'motif_persist_for': 5}
2025-11-07 21:21:36,729 [INFO] fortress_director.orchestrator.orchestrator: Creative persist window extended to turn 12
2025-11-07 21:21:36,730 [INFO] fortress_director.orchestrator.orchestrator: World lock engaged until turn 11 with current constraint
2025-11-07 21:21:36,730 [INFO] fortress_director.orchestrator.orchestrator: Added NPC fallback: {'name': 'move_npc', 'args': [], 'kwargs': {'npc_id': 'Boris', 'location': 'courtyard'}, 'metadata': {'source': 'orchestrator:fallback'}}
2025-11-07 21:21:36,731 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-11-07 21:21:36,731 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'opt_1', 'text': 'Rally the nearby scouts to reinforce the gate. (focus: exploration)', 'action_type': 'exploration'}
2025-11-07 21:21:36,731 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "exploration", "id": "opt_1", "text": "Rally the nearby scouts to reinforce the gate. (focus: exploration)"}
2025-11-07 21:21:36,731 [INFO] fortress_director.orchestrator.orchestrator: Applying dynamic metrics for action_type 'exploration': {'knowledge': 2, 'resources': 1, 'morale': -1}
2025-11-07 21:21:36,731 [INFO] fortress_director.utils.metrics_manager: Metric 'knowledge' updated from 51 to 53 (cause=action_exploration)
2025-11-07 21:21:36,732 [INFO] fortress_director.utils.metrics_manager: Metric 'resources' updated from 36 to 37 (cause=action_exploration)
2025-11-07 21:21:36,732 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 46 to 45 (cause=action_exploration)
2025-11-07 21:21:36,732 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after dynamic changes: {'order': 53, 'morale': 45, 'resources': 37, 'knowledge': 53, 'corruption': 10, 'glitch': 62, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 21:21:36,732 [INFO] fortress_director.orchestrator.orchestrator: Action consequence: Your discovery brings new resources but tests village resolve.
2025-11-07 21:21:36,733 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 8 | Day 2 | Time evening\nLocation: courtyard\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer' eyes narrowed as the shimmering light pulsed with an unsettling energy. The shadowed gateway, once steadfast, hung precariously over the chasm, ...
2025-11-07 21:21:36,733 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-11-07 21:21:36,733 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-11-07 21:21:36,735 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "brace_shield", "effects": {"flag_set": ["storm_vigil"], "trust_delta": 1}, "intent": "defend", "name": "Rhea", "safe_functions": [{"args": [], "kwargs": {"item_id": "lantern_oil", "target": "player"}, "metadata": {"origin": "character_stub"}, "name": "spawn_item"}], "speech": "I'll keep the storm off the wall while you plan our next move."}, {"action": "Autonomously performs observe action.", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "Rhea shifts tactics with a observe maneuver."}, {"action": "Autonomously performs assist action.", "eff...
2025-11-07 21:21:36,735 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-11-07 21:21:36,735 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-11-07 21:21:36,735 [DEBUG] fortress_director.orchestrator.orchestrator: Major event effect applied: {"applied_flag": "major_wall_alert", "applied_to": "Rhea", "status_change": {"duration": 3, "status": "tense_watch", "target": "Rhea"}}
2025-11-07 21:21:36,735 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-11-07 21:21:36,736 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "brace_shield", "effects": {"flag_set": ["storm_vigil", "major_wall_alert"], "status_change": {"duration": 3, "status": "tense_watch", "target": "Rhea"}, "trust_delta": 1}, "intent": "defend", "name": "Rhea", "safe_functions": [{"args": [], "kwargs": {"item_id": "lantern_oil", "target": "player"}, "metadata": {"origin": "character_stub"}, "name": "spawn_item"}], "speech": "I'll keep the storm off the wall while you plan our next move."}, {"action": "Autonomously performs observe action.", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "Rhea s...
2025-11-07 21:21:36,736 [INFO] fortress_rules.rules_engine: RulesEngine.process called.
2025-11-07 21:21:36,736 [DEBUG] fortress_rules.rules_engine: Input state: {'schema_version': 2, 'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 8, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_cloud_presence', 'explore', 'major_wall_alert', 'stage_escalation'], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 8, 'day': 2, 'time': 'evening', 'current_room': 'courtyard', 'recent_events': ["The Shieldbearer' eyes narrowed as the shimmering light pulsed with an unsettling energy. The shadowed gateway, once steadfast, hung precariously over the chasm, its hinges twisted and distorted. A si...", 'The shimmering tendrils of the corrupted gate writhed and strained, their hinges groaning like an ancient beast. A sudden cascade of supplies tumbled down the chasm, the metal glinting with an unsettl...', "The Shieldbearer' heart hammered against their ribs like a frantic bird trapped in a cage. The writhing gate, their once pristine obsidian expanse now coated in a sickly green, churned and groaned wit..."], 'recent_motifs': ['loss', 'unknown_action', 'memory', 'memory', 'memory', 'unknown_action', 'unknown_action', 'mystery', 'mystery', 'mystery'], 'recent_world_atmospheres': [], 'world_constraint_from_prev_turn': {'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea is neutral toward the player', 'metrics': {'order': 53, 'morale': 45, 'resources': 37, 'knowledge': 53, 'corruption': 10, 'glitch': 62, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {'Rhea': 0}, 'environment_hazards': [], 'weather_pattern': {'pattern': 'overcast', 'remaining': 0, 'lock_until': 0}, 'structures': {'western_wall': {'durability': 80, 'max_durability': 100, 'status': 'stable'}, 'inner_gate': {'durability': 70, 'max_durability': 100, 'status': 'stable'}, 'watchtower': {'durability': 60, 'max_durability': 80, 'status': 'stable'}, 'granary': {'durability': 55, 'max_durability': 70, 'status': 'stable'}}, 'npc_schedule': {}, 'patrols': {}, 'combat_log': [], 'item_transfers': [], 'stockpiles': {'food': 120, 'wood': 60, 'ore': 40}, 'stockpile_log': [], 'trade_routes': {}, 'trade_route_history': [], 'scheduled_events': [], 'story_progress': {'act': 'build_up', 'progress': 0.0, 'act_history': []}, 'timeline': [{'turn': 6, 'scene': "The Shieldbearer' eyes narrowed as the shimmering light pulsed with an unsettling energy. The shadowed gateway, once steadfast, hung precariously over the chasm, its hinges twisted and distorted. A si...", 'choice_id': 'option3', 'action_type': 'trade', 'motif': 'memory', 'major_event': True}, {'turn': 7, 'scene': 'The shimmering tendrils of the corrupted gate writhed and strained, their hinges groaning like an ancient beast. A sudden cascade of supplies tumbled down the chasm, the metal glinting with an unsettl...', 'choice_id': 'option2', 'action_type': 'defense', 'motif': 'unknown_action', 'major_event': True}, {'turn': 8, 'scene': "The Shieldbearer' heart hammered against their ribs like a frantic bird trapped in a cage. The writhing gate, their once pristine obsidian expanse now coated in a sickly green, churned and groaned wit...", 'choice_id': 'option3', 'action_type': 'trade', 'motif': 'mystery', 'major_event': False}], 'hazard_cooldowns': {}, 'schema_notes': {}, 'locked_options': {}, '_drama_window': [[49, 51, 41, 47, 51], [50, 52, 42, 49, 53], [51, 53, 43, 51, 55], [50, 51, 45, 53, 56], [51, 50, 43, 53, 58], [50, 50, 47, 53, 59], [54, 51, 43, 51, 61], [53, 46, 36, 51, 62]], '_anomaly_active_until': 12, '_world_lock_until': 11, '_high_volatility_mode': True, 'last_weather_change_turn': None, '_glitch_buffer': 0, '_director_pacing': 'steady', '_director_notes': [{'turn': 0, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 1, 'note': 'The campaign is moving at a steady pace. No major events are needed for this turn.'}, {'turn': 2, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 3, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 4, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 5, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 6, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 7, 'note': 'The campaign is moving at a steady pace. No major events are needed for this turn.'}], '_director_guidance': {'pacing': 'steady', 'risk_budget': 3, 'major_event': 'allow', 'notes': '', 'flags_to_add': [], 'flags_to_remove': []}, 'previous_judge_verdict': {'consistent': True, 'reason': 'offline stub', 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}, 'player_choice_history': ['dialogue', 'dialogue', 'dialogue', 'exploration', 'trade', 'trade'], 'summary_text': 'Whispers fade and the walls hold steady.', 'emotional_memory': [{'turn': 0, 'name': 'Rhea', 'intent': 'observe', 'speech': 'I stand vigilant, my senses alert for any sign of danger.'}, {'turn': 0, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 0, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 0, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 0, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 1, 'name': 'Rhea', 'intent': 'observe', 'speech': 'I stand vigilant, my senses alert for any sign of danger. The storm rages on, a symphony of wind and rain.'}, {'turn': 1, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 1, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 1, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 1, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 2, 'name': 'Rhea', 'intent': 'observe', 'speech': 'The shadows lengthen, whispering secrets I can barely decipher. I stand guard, waiting for any sign of movement.'}, {'turn': 2, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 2, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 2, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 2, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 3, 'name': 'Rhea', 'intent': 'defend', 'speech': 'Approach the glowing light and investigate its source.'}, {'turn': 4, 'name': 'Rhea', 'intent': 'observe', 'speech': "I notice a faint glow emanating from the distant light source. It's as if something is hidden there, waiting to be discovered."}, {'turn': 4, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 4, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 4, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 4, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 5, 'name': 'Rhea', 'intent': 'single_word_motivation', 'speech': 'I stand watch, my vigilance heightened. The air is thick with the scent of danger, a stark contrast to the usual morning freshness.'}, {'turn': 5, 'name': 'Rhea', 'intent': 'observe', 'speech': 'Rhea shifts tactics with a observe maneuver.'}, {'turn': 5, 'name': 'Boris', 'intent': 'assist', 'speech': 'Boris shifts tactics with a assist maneuver.'}, {'turn': 5, 'name': 'Rhea', 'intent': 'command', 'speech': 'Rhea shifts tactics with a command maneuver.'}, {'turn': 5, 'name': 'Boris', 'intent': 'plan', 'speech': 'Boris shifts tactics with a plan maneuver.'}, {'turn': 6, 'name': 'Rhea', 'intent': 'defend', 'speech': 'Call out to Boris, requesting his assistance in assessing the situation and devising a plan to secure the gateway. (focu'}, {'turn': 7, 'name': 'Rhea', 'intent': 'single_word_motivation', 'speech': 'I stand watch, my vigilance never falters. Keep your distance, for the shadows are my only allies.'}, {'turn': 7, 'name': 'Rhea', 'intent': 'observe', 'speech': 'Rhea shifts tactics with a observe maneuver.'}, {'turn': 7, 'name': 'Boris', 'intent': 'assist', 'speech': 'Boris shifts tactics with a assist maneuver.'}, {'turn': 7, 'name': 'Rhea', 'intent': 'command', 'speech': 'Rhea shifts tactics with a command maneuver.'}, {'turn': 7, 'name': 'Boris', 'intent': 'plan', 'speech': 'Boris shifts tactics with a plan maneuver.'}], 'memory_short': ["Turn 1: Ask the Shieldbearer about any recent threats to Lornhaven. -> ' the rewritten prompt: I find myself trapped within a labyrinthine mansion, its walls adorned with ...", 'Turn 2: Ask the Shieldbearer about any recent threats to Lornhaven. -> (Motif: storm)...', 'Turn 3: Ask the Shieldbearer about any recent threats to Lornhaven. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger...', "Memory summary: Turn 1: Ask the Shieldbearer about any recent threats to Lornhaven. -> ' the rewritten prompt: I find myself trapped within a labyrinthine mansion, its walls adorned with ... | Turn 2: Ask the Shieldb...", 'Turn 4: Approach the glowing light and investigate its source. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger...', 'Turn 5: Approach the glowing light and investigate its source. -> The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squint...', "Turn 6: Ignite your patched shield with the remaining oil from your lamp, creating a makeshift torch to better illuminate the entrance. (focus: trade) -> The Shieldbearer' eyes narrowed as the shimmering light pulsed with an unsettling energy. The shadow...", 'Memory summary: Turn 4: Approach the glowing light and investigate its source. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger... | Turn 5: Approach the glowing...', 'Turn 7: Call out to Boris, requesting his assistance in assessing the situation and devising a plan to secure the gateway. (focus: defense) -> The shimmering tendrils of the corrupted gate writhed and strained, their hinges groaning like an an...', "Turn 8: Light your oil lamp and signal for help, hoping that someone from the village below might have supplies or knowledge to aid in this crisis. (focus: trade) -> The Shieldbearer' heart hammered against their ribs like a frantic bird trapped in a cage. The writh..."], 'memory_long': ['Turn 5: Major event triggered (major_wall_alert)', 'Turn 6: Major event triggered (major_wall_alert)', 'Turn 7: Major event triggered (major_wall_alert)', 'Turn 8: Major event triggered (major_wall_alert, major_starvation_hint)'], 'status_effects': [], 'persistent_motif': {'motif': 'betrayal', 'remaining': 5}, 'last_major_event_turn': 8, 'world_constraint': {'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}, 'major_events_triggered': 3, 'major_event_last_turn': 7, '_dramaturgy_state': {'stage': 'escalation', 'history': [{'stage': 'build_up', 'turn': 5}, {'stage': 'escalation', 'turn': 6}], 'last_turn': 7, 'major_events': 0, 'last_major_turn': 7, 'risk_delta': 1, 'allow_major': True, 'force_major': False, 'directives': ['stage_major_event', 'pressure_player_choices'], 'finale_hint': None}, '_dramaturgy_directives': ['stage_major_event', 'pressure_player_choices'], 'npc_journal': [{'turn': 6, 'name': 'Rhea', 'intent': 'single_word_motivation', 'entry': 'I stand watch, my vigilance heightened. The air is thick with the scent of danger, a stark contrast to the usual morning freshness.'}, {'turn': 6, 'name': 'Rhea', 'intent': 'observe', 'entry': 'Rhea shifts tactics with a observe maneuver.'}, {'turn': 6, 'name': 'Boris', 'intent': 'assist', 'entry': 'Boris shifts tactics with a assist maneuver.'}, {'turn': 6, 'name': 'Rhea', 'intent': 'command', 'entry': 'Rhea shifts tactics with a command maneuver.'}, {'turn': 6, 'name': 'Boris', 'intent': 'plan', 'entry': 'Boris shifts tactics with a plan maneuver.'}, {'turn': 7, 'name': 'Rhea', 'intent': 'defend', 'entry': 'Call out to Boris, requesting his assistance in assessing the situation and devising a plan to secure the gateway. (focu'}, {'turn': 8, 'name': 'Rhea', 'intent': 'single_word_motivation', 'entry': 'I stand watch, my vigilance never falters. Keep your distance, for the shadows are my only allies.'}, {'turn': 8, 'name': 'Rhea', 'intent': 'observe', 'entry': 'Rhea shifts tactics with a observe maneuver.'}, {'turn': 8, 'name': 'Boris', 'intent': 'assist', 'entry': 'Boris shifts tactics with a assist maneuver.'}, {'turn': 8, 'name': 'Rhea', 'intent': 'command', 'entry': 'Rhea shifts tactics with a command maneuver.'}, {'turn': 8, 'name': 'Boris', 'intent': 'plan', 'entry': 'Boris shifts tactics with a plan maneuver.'}], '_last_journal_entries': [{'turn': 8, 'name': 'Rhea', 'intent': 'single_word_motivation', 'entry': 'I stand watch, my vigilance never falters. Keep your distance, for the shadows are my only allies.'}, {'turn': 8, 'name': 'Rhea', 'intent': 'observe', 'entry': 'Rhea shifts tactics with a observe maneuver.'}, {'turn': 8, 'name': 'Boris', 'intent': 'assist', 'entry': 'Boris shifts tactics with a assist maneuver.'}, {'turn': 8, 'name': 'Rhea', 'intent': 'command', 'entry': 'Rhea shifts tactics with a command maneuver.'}, {'turn': 8, 'name': 'Boris', 'intent': 'plan', 'entry': 'Boris shifts tactics with a plan maneuver.'}], '_fallback_strategy_index': 1, '_turn_history': [{'turn': 7, 'choice': {'id': 'option2', 'text': 'Call out to Boris, requesting his assistance in assessing the situation and devising a plan to secure the gateway. (focus: defense)', 'action_type': 'defense'}, 'options': [{'id': 'option1', 'text': 'Approach cautiously, scanning for any signs of danger as you move towards the mysterious light.', 'action_type': 'exploration'}, {'id': 'option2', 'text': 'Call out to Boris, requesting his assistance in assessing the situation and devising a plan to secure the gateway. (focus: defense)', 'action_type': 'defense'}, {'id': 'option3', 'text': 'Ignite your oil lamp, using its light to signal for help from any nearby allies who might be able to reinforce the defenses. (focus: trade)', 'action_type': 'trade'}], 'safe_functions': [{'name': 'change_weather', 'source': 'event_agent', 'success': True}, {'name': 'move_npc', 'source': 'orchestrator:fallback', 'success': True}], 'judge': {'consistent': True, 'penalty': 'none', 'reason': 'The content follows established world physics, character logic, and narrative consistency. The scene is coherent with the previous events and motifs. The tone matches the established atmosphere and emotional register.'}}]}
2025-11-07 21:21:36,737 [DEBUG] fortress_rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'defend', 'action': 'brace_shield', 'speech': "I'll keep the storm off the wall while you plan our next move.", 'effects': {'trust_delta': 1, 'flag_set': ['storm_vigil', 'major_wall_alert'], 'status_change': {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}}, 'safe_functions': [{'name': 'spawn_item', 'args': [], 'kwargs': {'item_id': 'lantern_oil', 'target': 'player'}, 'metadata': {'origin': 'character_stub'}}]}, {'name': 'Rhea', 'intent': 'observe', 'action': 'Autonomously performs observe action.', 'speech': 'Rhea shifts tactics with a observe maneuver.', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': 'Boris shifts tactics with a assist maneuver.', 'effects': {}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': 'Rhea shifts tactics with a command maneuver.', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': 'Boris shifts tactics with a plan maneuver.', 'effects': {}, 'safe_functions': []}]
2025-11-07 21:21:36,738 [DEBUG] fortress_rules.rules_engine: World context: Turn 8 | Day 2 | Time evening
Location: courtyard
Objective: reinforce defenses
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}
Recent events: The Shieldbearer' eyes narrowed as the shimmering light pulsed with an unsettling energy. The shadowed gateway, once steadfast, hung precariously over the chasm, its hinges twisted and distorted. A si...; The shimmering tendrils of the corrupted gate writhed and strained, their hinges groaning like an ancient beast. A sudden cascade of supplies tumbled down the chasm, the metal glinting with an unsettl...; The Shieldbearer' heart hammered against their ribs like a frantic bird trapped in a cage. The writhing gate, their once pristine obsidian expanse now coated in a sickly green, churned and groaned wit... Recent motifs: mystery, mystery, mystery
Recent major events: none
Relationship summary: Rhea is neutral toward the player
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 53, "morale": 46, "resources": 36, "knowledge": 51, "corruption": 10, "glitch": 62, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: {"response": "offline stub"} (Motif: betrayal), player_choice: {'id': 'opt_1', 'text': 'Rally the nearby scouts to reinforce the gate. (focus: exploration)', 'action_type': 'exploration'}
2025-11-07 21:21:36,738 [INFO] fortress_rules.rules_engine: RulesEngine._validate_tier_one called.
2025-11-07 21:21:36,738 [DEBUG] fortress_rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'defend', 'action': 'brace_shield', 'speech': "I'll keep the storm off the wall while you plan our next move.", 'effects': {'trust_delta': 1, 'flag_set': ['storm_vigil', 'major_wall_alert'], 'status_change': {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}}, 'safe_functions': [{'name': 'spawn_item', 'args': [], 'kwargs': {'item_id': 'lantern_oil', 'target': 'player'}, 'metadata': {'origin': 'character_stub'}}]}
2025-11-07 21:21:36,738 [DEBUG] fortress_rules.rules_engine: Validating character event 1: {'name': 'Rhea', 'intent': 'observe', 'action': 'Autonomously performs observe action.', 'speech': 'Rhea shifts tactics with a observe maneuver.', 'effects': {}, 'safe_functions': []}
2025-11-07 21:21:36,738 [DEBUG] fortress_rules.rules_engine: Validating character event 2: {'name': 'Boris', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': 'Boris shifts tactics with a assist maneuver.', 'effects': {}, 'safe_functions': []}
2025-11-07 21:21:36,738 [DEBUG] fortress_rules.rules_engine: Validating character event 3: {'name': 'Rhea', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': 'Rhea shifts tactics with a command maneuver.', 'effects': {}, 'safe_functions': []}
2025-11-07 21:21:36,739 [DEBUG] fortress_rules.rules_engine: Validating character event 4: {'name': 'Boris', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': 'Boris shifts tactics with a plan maneuver.', 'effects': {}, 'safe_functions': []}
2025-11-07 21:21:36,739 [INFO] fortress_rules.rules_engine: Tier one validation passed.
2025-11-07 21:21:36,740 [INFO] fortress_rules.rules_engine: Detected repetition (scene: 0, motif: True, intent: False) - informing Judge
2025-11-07 21:21:36,740 [DEBUG] fortress_rules.rules_engine: Judge verdict for Rhea: {'consistent': False, 'reason': 'Character loyalty conflict: betrayal contradicts established traits', 'penalty': 'mild', 'penalty_magnitude': {'morale': -1, 'glitch': 1}}
2025-11-07 21:21:36,741 [ERROR] fortress_rules.rules_engine: Exception in RulesEngine.process: Judge rejected update for 'Rhea': Character loyalty conflict: betrayal contradicts established traits
Traceback (most recent call last):
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_rules\rules_engine.py", line 78, in process
    judge_penalties = self._validate_tier_two(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_rules\rules_engine.py", line 390, in _validate_tier_two
    raise TierTwoValidationError(
fortress_rules.rules_engine.TierTwoValidationError: Judge rejected update for 'Rhea': Character loyalty conflict: betrayal contradicts established traits
2025-11-07 21:21:36,744 [WARNING] fortress_director.orchestrator.orchestrator: Judge vetoed character updates: Judge rejected update for 'Rhea': Character loyalty conflict: betrayal contradicts established traits
2025-11-07 21:21:36,744 [INFO] fortress_director.orchestrator.orchestrator: Applied fallback defensive stance for primary NPC.
2025-11-07 21:21:36,744 [DEBUG] fortress_director.orchestrator.orchestrator: Major event effect after fallback: {"applied_flag": "major_wall_alert", "applied_to": "Rhea", "status_change": {"duration": 3, "status": "tense_watch", "target": "Rhea"}}
2025-11-07 21:21:36,744 [INFO] fortress_director.orchestrator.orchestrator: Applying 1 autonomous actions
2025-11-07 21:21:36,745 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 53 to 54 (cause=autonomous_Rhea)
2025-11-07 21:21:36,745 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-11-07 21:21:36,745 [INFO] fortress_director.orchestrator.orchestrator: Added motif: unknown_action
2025-11-07 21:21:36,745 [INFO] fortress_director.orchestrator.orchestrator: Advanced time to night
2025-11-07 21:21:36,746 [DEBUG] fortress_rules.rules_engine: Status effects ticked: []
2025-11-07 21:21:36,746 [INFO] fortress_rules.rules_engine: Environmental effects applied with seed 12345
2025-11-07 21:21:36,747 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"_anomaly_active_until": 12, "_director_guidance": {"flags_to_add": [], "flags_to_remove": [], "major_event": "allow", "notes": "", "pacing": "steady", "risk_budget": 3}, "_director_notes": [{"note": "The campaign is progressing at a steady pace. No major events are needed for this turn.", "turn": 0}, {"note": "The campaign is moving at a steady pace. No major events are needed for this turn.", "turn": 1}, {"note": "The campaign is progressing at a steady pace. No major events are needed for this turn.", "turn": 2}, {"note": "The campaign is progressing at a steady pace. No major events ar...
2025-11-07 21:21:36,763 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,764 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-11-07 21:21:36,765 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,766 [INFO] fortress_director.codeaware.function_validator: Validating function call payload: {'name': 'change_weather', 'kwargs': {'atmosphere': 'electric storm', 'sensory_details': 'lightning traces the parapets'}, 'metadata': {'origin': 'event_stub'}}
2025-11-07 21:21:36,766 [INFO] fortress_functions.function_registry: Validating function call: change_weather
2025-11-07 21:21:36,766 [INFO] fortress_director.codeaware.function_validator: Function call 'change_weather' validated successfully.
2025-11-07 21:21:36,768 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,769 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=9, call=change_weather)
2025-11-07 21:21:36,769 [INFO] fortress_functions.function_registry: Getting registered function: change_weather
2025-11-07 21:21:36,769 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'change_weather'...
2025-11-07 21:21:36,771 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,784 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,784 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed successfully.
2025-11-07 21:21:36,784 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed (checkpoint turn=9)
2025-11-07 21:21:36,786 [INFO] fortress_director.codeaware.function_validator: Validating function call payload: {'name': 'spawn_item', 'args': [], 'kwargs': {'item_id': 'fire_extinguisher', 'target': 'nearby'}, 'metadata': {'source': 'event_autoinject'}}
2025-11-07 21:21:36,788 [INFO] fortress_functions.function_registry: Validating function call: spawn_item
2025-11-07 21:21:36,788 [INFO] fortress_director.codeaware.function_validator: Function call 'spawn_item' validated successfully.
2025-11-07 21:21:36,789 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,790 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=9, call=spawn_item)
2025-11-07 21:21:36,790 [INFO] fortress_functions.function_registry: Getting registered function: spawn_item
2025-11-07 21:21:36,790 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'spawn_item'...
2025-11-07 21:21:36,792 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,805 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,805 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed successfully.
2025-11-07 21:21:36,805 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed (checkpoint turn=9)
2025-11-07 21:21:36,807 [INFO] fortress_director.codeaware.function_validator: Validating function call payload: {'name': 'move_npc', 'args': [], 'kwargs': {'npc_id': 'Boris', 'location': 'courtyard'}, 'metadata': {'source': 'orchestrator:fallback'}}
2025-11-07 21:21:36,807 [INFO] fortress_functions.function_registry: Validating function call: move_npc
2025-11-07 21:21:36,807 [INFO] fortress_director.codeaware.function_validator: Function call 'move_npc' validated successfully.
2025-11-07 21:21:36,808 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,809 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=9, call=move_npc)
2025-11-07 21:21:36,809 [INFO] fortress_functions.function_registry: Getting registered function: move_npc
2025-11-07 21:21:36,810 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'move_npc'...
2025-11-07 21:21:36,811 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,823 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,823 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_npc' executed successfully.
2025-11-07 21:21:36,824 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_npc' executed (checkpoint turn=9)
2025-11-07 21:21:36,825 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-11-07 21:21:36,826 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,826 [INFO] fortress_director.orchestrator.orchestrator: Weather changed via safe function, re-describing world...
2025-11-07 21:21:36,828 [INFO] fortress_director.orchestrator.orchestrator: World re-described after safe function.
2025-11-07 21:21:36,828 [DEBUG] fortress_director.orchestrator.orchestrator: New world output: {"atmosphere": "storm glare", "sensory_details": "hail rattles the stones"}
2025-11-07 21:21:36,841 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,842 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,843 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 54, 'morale': 45, 'resources': 37, 'knowledge': 53, 'corruption': 10, 'glitch': 62, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 21:21:36,843 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'conditions_not_met', 'description': 'Oyun devam ediyor...'}
2025-11-07 21:21:36,857 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,857 [INFO] fortress_director.orchestrator.orchestrator: Turn summary: Whispers fade and the walls hold steady.
2025-11-07 21:21:36,858 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-11-07 21:21:36,859 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 8 | Day 2 | Time evening\nLocation: courtyard\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer' eyes narrowed as the shimmering light pulsed with an unsettling energy. The shadowed gateway, once steadfast, hung precariously over the chasm, ...
2025-11-07 21:21:36,860 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-11-07 21:21:36,860 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
2025-11-07 21:21:36,862 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=9)
2025-11-07 21:21:36,906 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=8)
