2025-10-27 23:51:46,825 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-40\test_move_npc_tracks_location0\world_state.json (turn=0)
2025-10-27 23:51:51,898 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-27 23:51:51,912 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-27 23:51:51,913 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-27 23:51:51,913 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-27 23:51:51,914 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-27 23:51:51,914 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-27 23:51:51,914 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-27 23:51:51,914 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-27 23:51:51,914 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-27 23:51:51,914 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-27 23:51:51,914 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-27 23:51:51,914 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-27 23:51:51,914 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-27 23:51:51,916 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-27 23:51:51,916 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-27 23:51:51,916 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-27 23:51:51,916 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-27 23:51:51,916 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-27 23:51:51,917 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-27 23:51:51,917 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-27 23:51:51,917 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-27 23:51:51,917 [INFO] fortress_director.codeaware.function_registry: Validating function call: change_weather
2025-10-27 23:51:51,917 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_change_weather_updates_wo0\world_state.json (turn=0)
2025-10-27 23:51:51,918 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=change_weather)
2025-10-27 23:51:51,918 [INFO] fortress_director.codeaware.function_registry: Getting registered function: change_weather
2025-10-27 23:51:51,918 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'change_weather'...
2025-10-27 23:51:51,918 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_change_weather_updates_wo0\world_state.json (turn=0)
2025-10-27 23:51:51,919 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_change_weather_updates_wo0\world_state.json (turn=0)
2025-10-27 23:51:51,919 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed successfully.
2025-10-27 23:51:51,920 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed (checkpoint turn=0)
2025-10-27 23:51:51,921 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_change_weather_updates_wo0\world_state.json (turn=0)
2025-10-27 23:51:51,925 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-27 23:51:51,925 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-27 23:51:51,925 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-27 23:51:51,925 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-27 23:51:51,925 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-27 23:51:51,926 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-27 23:51:51,926 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-27 23:51:51,926 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-27 23:51:51,926 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-27 23:51:51,926 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-27 23:51:51,926 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-27 23:51:51,926 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-27 23:51:51,928 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-27 23:51:51,928 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-27 23:51:51,928 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-27 23:51:51,928 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-27 23:51:51,928 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-27 23:51:51,929 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-27 23:51:51,929 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-27 23:51:51,929 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-27 23:51:51,929 [INFO] fortress_director.codeaware.function_registry: Validating function call: spawn_item
2025-10-27 23:51:51,929 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_spawn_item_targets_player0\world_state.json (turn=0)
2025-10-27 23:51:51,930 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=spawn_item)
2025-10-27 23:51:51,930 [INFO] fortress_director.codeaware.function_registry: Getting registered function: spawn_item
2025-10-27 23:51:51,930 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'spawn_item'...
2025-10-27 23:51:51,930 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_spawn_item_targets_player0\world_state.json (turn=0)
2025-10-27 23:51:51,930 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_spawn_item_targets_player0\world_state.json (turn=0)
2025-10-27 23:51:51,931 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed successfully.
2025-10-27 23:51:51,931 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed (checkpoint turn=0)
2025-10-27 23:51:51,932 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_spawn_item_targets_player0\world_state.json (turn=0)
2025-10-27 23:51:51,937 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-27 23:51:51,938 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-27 23:51:51,938 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-27 23:51:51,938 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-27 23:51:51,938 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-27 23:51:51,939 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-27 23:51:51,939 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-27 23:51:51,939 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-27 23:51:51,939 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-27 23:51:51,940 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-27 23:51:51,940 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-27 23:51:51,940 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-27 23:51:51,940 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-27 23:51:51,940 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-27 23:51:51,940 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-27 23:51:51,940 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-27 23:51:51,941 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-27 23:51:51,941 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-27 23:51:51,941 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-27 23:51:51,941 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-27 23:51:51,941 [INFO] fortress_director.codeaware.function_registry: Validating function call: spawn_item
2025-10-27 23:51:51,942 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_spawn_item_targets_locati0\world_state.json (turn=0)
2025-10-27 23:51:51,942 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=spawn_item)
2025-10-27 23:51:51,942 [INFO] fortress_director.codeaware.function_registry: Getting registered function: spawn_item
2025-10-27 23:51:51,942 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'spawn_item'...
2025-10-27 23:51:51,942 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_spawn_item_targets_locati0\world_state.json (turn=0)
2025-10-27 23:51:51,943 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_spawn_item_targets_locati0\world_state.json (turn=0)
2025-10-27 23:51:51,943 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed successfully.
2025-10-27 23:51:51,943 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed (checkpoint turn=0)
2025-10-27 23:51:51,945 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_spawn_item_targets_locati0\world_state.json (turn=0)
2025-10-27 23:51:51,948 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-27 23:51:51,949 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-27 23:51:51,949 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-27 23:51:51,949 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-27 23:51:51,949 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-27 23:51:51,949 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-27 23:51:51,950 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-27 23:51:51,950 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-27 23:51:51,950 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-27 23:51:51,950 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-27 23:51:51,950 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-27 23:51:51,950 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-27 23:51:51,951 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-27 23:51:51,951 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-27 23:51:51,951 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-27 23:51:51,951 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-27 23:51:51,951 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-27 23:51:51,951 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-27 23:51:51,951 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-27 23:51:51,953 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-27 23:51:51,953 [INFO] fortress_director.codeaware.function_registry: Validating function call: move_npc
2025-10-27 23:51:51,953 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_move_npc_tracks_location0\world_state.json (turn=0)
2025-10-27 23:51:51,953 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=move_npc)
2025-10-27 23:51:51,953 [INFO] fortress_director.codeaware.function_registry: Getting registered function: move_npc
2025-10-27 23:51:51,954 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'move_npc'...
2025-10-27 23:51:51,954 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_move_npc_tracks_location0\world_state.json (turn=0)
2025-10-27 23:51:51,955 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_move_npc_tracks_location0\world_state.json (turn=0)
2025-10-27 23:51:51,955 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_npc' executed successfully.
2025-10-27 23:51:51,955 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_npc' executed (checkpoint turn=0)
2025-10-27 23:51:51,957 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_move_npc_tracks_location0\world_state.json (turn=0)
2025-10-27 23:51:51,960 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-27 23:51:51,960 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-27 23:51:51,961 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-27 23:51:51,961 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-27 23:51:51,961 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-27 23:51:51,961 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-27 23:51:51,961 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-27 23:51:51,962 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-27 23:51:51,962 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-27 23:51:51,962 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-27 23:51:51,962 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-27 23:51:51,962 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-27 23:51:51,962 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-27 23:51:51,963 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-27 23:51:51,963 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-27 23:51:51,963 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-27 23:51:51,963 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-27 23:51:51,963 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-27 23:51:51,963 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-27 23:51:51,963 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-27 23:51:51,965 [INFO] fortress_director.codeaware.function_registry: Validating function call: modify_resources
2025-10-27 23:51:51,965 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_modify_resources_and_adju0\world_state.json (turn=0)
2025-10-27 23:51:51,965 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=modify_resources)
2025-10-27 23:51:51,965 [INFO] fortress_director.codeaware.function_registry: Getting registered function: modify_resources
2025-10-27 23:51:51,966 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'modify_resources'...
2025-10-27 23:51:51,966 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_modify_resources_and_adju0\world_state.json (turn=0)
2025-10-27 23:51:51,966 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:51:51,966 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'resources': current=40, delta=-5, limits=(0, 120) (cause=test_consumption)
2025-10-27 23:51:51,966 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'resources', 'delta': -5, 'value': 35, 'cause': 'test_consumption'}
2025-10-27 23:51:51,966 [INFO] fortress_director.utils.metrics_manager: Metric 'resources' updated from 40 to 35 (cause=test_consumption)
2025-10-27 23:51:51,967 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_modify_resources_and_adju0\world_state.json (turn=0)
2025-10-27 23:51:51,967 [INFO] fortress_director.codeaware.rollback_system: Safe function 'modify_resources' executed successfully.
2025-10-27 23:51:51,967 [INFO] fortress_director.codeaware.rollback_system: Safe function 'modify_resources' executed (checkpoint turn=0)
2025-10-27 23:51:51,969 [INFO] fortress_director.codeaware.function_registry: Validating function call: adjust_metric
2025-10-27 23:51:51,969 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_modify_resources_and_adju0\world_state.json (turn=0)
2025-10-27 23:51:51,969 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=adjust_metric)
2025-10-27 23:51:51,969 [INFO] fortress_director.codeaware.function_registry: Getting registered function: adjust_metric
2025-10-27 23:51:51,969 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'adjust_metric'...
2025-10-27 23:51:51,970 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_modify_resources_and_adju0\world_state.json (turn=0)
2025-10-27 23:51:51,970 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 35, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:51:51,970 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=50, delta=7, limits=(0, 100) (cause=test_boost)
2025-10-27 23:51:51,970 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': 7, 'value': 57, 'cause': 'test_boost'}
2025-10-27 23:51:51,970 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 50 to 57 (cause=test_boost)
2025-10-27 23:51:51,971 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_modify_resources_and_adju0\world_state.json (turn=0)
2025-10-27 23:51:51,972 [INFO] fortress_director.codeaware.rollback_system: Safe function 'adjust_metric' executed successfully.
2025-10-27 23:51:51,972 [INFO] fortress_director.codeaware.rollback_system: Safe function 'adjust_metric' executed (checkpoint turn=0)
2025-10-27 23:51:51,974 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_modify_resources_and_adju0\world_state.json (turn=0)
2025-10-27 23:51:51,978 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-27 23:51:51,979 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-27 23:51:51,979 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-27 23:51:51,979 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-27 23:51:51,979 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-27 23:51:51,980 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-27 23:51:51,980 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-27 23:51:51,980 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-27 23:51:51,980 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-27 23:51:51,980 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-27 23:51:51,981 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-27 23:51:51,981 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-27 23:51:51,981 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-27 23:51:51,981 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-27 23:51:51,981 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-27 23:51:51,982 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-27 23:51:51,982 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-27 23:51:51,982 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-27 23:51:51,982 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-27 23:51:51,982 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-27 23:51:51,982 [INFO] fortress_director.codeaware.function_registry: Registering safe function: boom
2025-10-27 23:51:51,983 [INFO] fortress_director.codeaware.function_registry: Safe function 'boom' registered successfully.
2025-10-27 23:51:51,983 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-27 23:51:51,983 [INFO] fortress_director.codeaware.function_registry: Validating function call: boom
2025-10-27 23:51:51,983 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-27 23:51:51,984 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=boom)
2025-10-27 23:51:51,984 [INFO] fortress_director.codeaware.function_registry: Getting registered function: boom
2025-10-27 23:51:51,984 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'boom'...
2025-10-27 23:51:51,984 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-27 23:51:51,985 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-27 23:51:51,985 [ERROR] fortress_director.codeaware.rollback_system: Safe function 'boom' failed: boom
Traceback (most recent call last):
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\codeaware\rollback_system.py", line 208, in run_validated_call
    result = entry.function(*call.args, **call.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\tests\test_safe_functions.py", line 148, in _boom_function
    raise RuntimeError("boom")
RuntimeError: boom
2025-10-27 23:51:51,987 [INFO] fortress_director.codeaware.rollback_system: Rollback requested (reason=Execution failed for 'boom': RuntimeError)
2025-10-27 23:51:51,987 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-27 23:51:51,987 [INFO] fortress_director.codeaware.rollback_system: Rollback applied (turn=0, reason=Execution failed for 'boom': RuntimeError)
2025-10-27 23:51:51,989 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-27 23:51:51,989 [INFO] fortress_director.codeaware.function_registry: Validating function call: boom
2025-10-27 23:51:51,990 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-27 23:51:51,990 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=boom)
2025-10-27 23:51:51,990 [INFO] fortress_director.codeaware.function_registry: Getting registered function: boom
2025-10-27 23:51:51,990 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'boom'...
2025-10-27 23:51:51,991 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-27 23:51:51,991 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-27 23:51:51,992 [ERROR] fortress_director.codeaware.rollback_system: Safe function 'boom' failed: boom
Traceback (most recent call last):
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\codeaware\rollback_system.py", line 208, in run_validated_call
    result = entry.function(*call.args, **call.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\tests\test_safe_functions.py", line 148, in _boom_function
    raise RuntimeError("boom")
RuntimeError: boom
2025-10-27 23:51:51,992 [INFO] fortress_director.codeaware.rollback_system: Rollback requested (reason=Execution failed for 'boom': RuntimeError)
2025-10-27 23:51:51,993 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-27 23:51:51,993 [INFO] fortress_director.codeaware.rollback_system: Rollback applied (turn=0, reason=Execution failed for 'boom': RuntimeError)
2025-10-27 23:51:52,005 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-27 23:51:52,007 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-27 23:51:52,007 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-27 23:51:52,007 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-27 23:51:52,007 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-27 23:51:52,008 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-27 23:51:52,008 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-27 23:51:52,008 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-27 23:51:52,008 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-27 23:51:52,008 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-27 23:51:52,009 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-27 23:51:52,009 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-27 23:51:52,009 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-27 23:51:52,009 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-27 23:51:52,010 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-27 23:51:52,010 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-27 23:51:52,010 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-27 23:51:52,010 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-27 23:51:52,010 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-27 23:51:52,010 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-27 23:51:52,010 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-27 23:51:52,010 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-27 23:51:52,011 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_run_turn_executes_agent_s0\data\world_state.json (turn=0)
2025-10-27 23:51:52,011 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=None)
2025-10-27 23:51:52,011 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-27 23:51:52,011 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_run_turn_executes_agent_s0\data\world_state.json (turn=0)
2025-10-27 23:51:52,012 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 0, "day": 1, "flags": [], "inventory": [], "lore": {}, "memory_layers": [], "metrics": {"corruption": 10, "glitch": 12, "knowledge": 45, "major_event_last_turn": null, "major_events_triggered": 0, "major_flag_set": false, "morale": 50, "order": 50, "resources": 40, "risk_applied_total": 0}, "npc_fragments": {}, "npc_trust": {}, "player": {"inventory": ["oil lamp", "patched shield"], "name": "The Shieldbe...
2025-10-27 23:51:52,012 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:51:52,012 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:51:52,012 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=1, seed=12345, current_glitch=12)
2025-10-27 23:51:52,013 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:51:52,013 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=12, delta=1, limits=(0, 100) (cause=glitch:cosmetic_noise)
2025-10-27 23:51:52,013 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 13, 'cause': 'glitch:cosmetic_noise'}
2025-10-27 23:51:52,013 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 12 to 13 (cause=glitch:cosmetic_noise)
2025-10-27 23:51:52,013 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=7, triggered_loss=False
2025-10-27 23:51:52,013 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 13, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:51:52,013 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Minor static ripples along the parapets.']
2025-10-27 23:51:52,013 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=7, triggered_loss=False
2025-10-27 23:51:52,013 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 13, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:51:52,015 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=13, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-27 23:51:52,015 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 12, 'cause': 'turn_recovery'}
2025-10-27 23:51:52,015 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 13 to 12 (cause=turn_recovery)
2025-10-27 23:51:52,015 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:51:52,016 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-27 23:51:52,016 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 0 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}
Recent events: none
Recent motifs: none
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade.
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-27 23:51:52,016 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 0 in room entrance
2025-10-27 23:51:52,016 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {\"order\": 50, \"morale\": 50, ...
2025-10-27 23:51:52,016 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-27 23:51:52,016 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance'}
2025-10-27 23:51:58,494 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Dawn breaks, casting a pale light over damp stone.', 'sensory_details': 'The cool morning air carries the sharp tang of salt and metal; distant drums echo with promise.'}
2025-10-27 23:51:58,494 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Dawn breaks, casting a pale light over damp stone.', 'sensory_details': 'The cool morning air carries the sharp tang of salt and metal distant drums echo with promise.'}
2025-10-27 23:51:58,494 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-27 23:51:58,494 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn breaks, casting a pale light over damp stone.", "sensory_details": "The cool morning air carries the sharp tang of salt and metal distant drums echo with promise."}
2025-10-27 23:51:58,494 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {\"order\": 50, \"morale\": 50, ...
2025-10-27 23:51:58,496 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-27 23:51:58,496 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': 'none', 'world_constraint_from_prev_turn': '{"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}', 'recent_motifs': 'none', 'lore_continuity_weight': 0, 'memory_layers': []}
2025-10-27 23:52:23,878 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield held tight against the morning wind. The low clouds hug the battlements and drums thud beyond the walls as grit is carried by the wind.', 'options': [{'id': 'ask_about_threat', 'text': 'Ask Rhea about any threats to Lornhaven', 'action_type': 'dialog'}, {'id': 'check_resources', 'text': 'Check the supplies in Lornhaven', 'action_type': 'inventory'}, {'id': 'patrol_the_walls', 'text': 'Offer to patrol the walls with Rhea', 'action_type': 'activity'}], 'major_event': False, 'safe_functions': []}
2025-10-27 23:52:23,878 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield held tight against the morning wind. The low clouds hug the battlements and drums thud beyond the walls as grit is carried by the wind.', 'options': [{'id': 'ask_about_threat', 'text': 'Ask Rhea about any threats to Lornhaven', 'action_type': 'dialog'}, {'id': 'check_resources', 'text': 'Check the supplies in Lornhaven', 'action_type': 'inventory'}, {'id': 'patrol_the_walls', 'text': 'Offer to patrol the walls with Rhea', 'action_type': 'activity'}], 'major_event': False, 'safe_functions': []}
2025-10-27 23:52:23,878 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-27 23:52:23,878 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialog", "id": "ask_about_threat", "text": "Ask Rhea about any threats to Lornhaven"}, {"action_type": "inventory", "id": "check_resources", "text": "Check the supplies in Lornhaven"}, {"action_type": "activity", "id": "patrol_the_walls", "text": "Offer to patrol the walls with Rhea"}], "safe_functions": [], "scene": "The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield held tight against the morning wind. The low clouds hug the battlements and drums thud beyond the walls as grit is carried by the wind."}
2025-10-27 23:52:23,878 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-27 23:52:23,878 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'ask_about_threat', 'text': 'Ask Rhea about any threats to Lornhaven', 'action_type': 'dialog'}
2025-10-27 23:52:23,880 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialog", "id": "ask_about_threat", "text": "Ask Rhea about any threats to Lornhaven"}
2025-10-27 23:52:23,880 [DEBUG] fortress_director.orchestrator.orchestrator: No dynamic metrics for action_type 'dialog'
2025-10-27 23:52:23,880 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {\"order\": 50, \"morale\": 50, ...
2025-10-27 23:52:23,880 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-27 23:52:23,880 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield held tight against the morning wind. The low clouds hug the battlements and drums thud beyond the walls as grit is carried by the wind.', 'player_choice': 'Ask Rhea about any threats to Lornhaven', 'atmosphere': 'Dawn breaks, casting a pale light over damp stone.', 'sensory_details': 'The cool morning air carries the sharp tang of salt and metal distant drums echo with promise.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player; Boris weighs every trade.', 'player_inventory_brief': 'oil lamp, patched shield'}
2025-10-27 23:52:30,933 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Rhea', 'intent': 'Monitor the environment', 'action': 'Scan the horizon for any signs of movement or changes in the weather.', 'speech': 'The wind whispers a tale of shifting clouds and a looming storm. I sense a change in the atmosphere, a faint tremor in the air. I stand alert.'}
2025-10-27 23:52:30,933 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Rhea', 'intent': 'Monitor the environment', 'action': 'Scan the horizon for any signs of movement or changes in the weather.', 'speech': 'The wind whispers a tale of shifting clouds and a looming storm. I sense a change in the atmosphere, a faint tremor in the air. I stand alert.', 'effects': {}}]
2025-10-27 23:52:30,934 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-27 23:52:30,934 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "Scan the horizon for any signs of movement or changes in the weather.", "effects": {}, "intent": "Monitor the environment", "name": "Rhea", "speech": "The wind whispers a tale of shifting clouds and a looming storm. I sense a change in the atmosphere, a faint tremor in the air. I stand alert."}]
2025-10-27 23:52:30,934 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-27 23:52:30,934 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-27 23:52:30,934 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-27 23:52:30,935 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "Scan the horizon for any signs of movement or changes in the weather.", "effects": {}, "intent": "Monitor the environment", "name": "Rhea", "speech": "The wind whispers a tale of shifting clouds and a looming storm. I sense a change in the atmosphere, a faint tremor in the air. I stand alert."}]
2025-10-27 23:52:30,935 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-27 23:52:30,935 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 10, 'current_turn': 0, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': [], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 0, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': [], 'recent_motifs': [], 'world_constraint_from_prev_turn': {'atmosphere': 'low clouds hug the battlements', 'sensory_details': 'Drums thud beyond the walls while the wind carries grit.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}}
2025-10-27 23:52:30,936 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'Monitor the environment', 'action': 'Scan the horizon for any signs of movement or changes in the weather.', 'speech': 'The wind whispers a tale of shifting clouds and a looming storm. I sense a change in the atmosphere, a faint tremor in the air. I stand alert.', 'effects': {}}]
2025-10-27 23:52:30,936 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 0 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}
Recent events: none
Recent motifs: none
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade.
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield held tight against the morning wind. The low clouds hug the battlements and drums thud beyond the walls as grit is carried by the wind., player_choice: {'id': 'ask_about_threat', 'text': 'Ask Rhea about any threats to Lornhaven', 'action_type': 'dialog'}
2025-10-27 23:52:30,936 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-27 23:52:30,936 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'Monitor the environment', 'action': 'Scan the horizon for any signs of movement or changes in the weather.', 'speech': 'The wind whispers a tale of shifting clouds and a looming storm. I sense a change in the atmosphere, a faint tremor in the air. I stand alert.', 'effects': {}}
2025-10-27 23:52:30,936 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-27 23:52:30,936 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-27 23:52:36,096 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene accurately reflects the Shieldbearer's duty as a defender at the entrance of Lornhaven, monitoring the environment for any threats."}
2025-10-27 23:52:36,096 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene accurately reflects the Shieldbearer's duty as a defender at the entrance of Lornhaven, monitoring the environment for any threats."}
2025-10-27 23:52:36,096 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene accurately reflects the Shieldbearer's duty as a defender at the entrance of Lornhaven, monitoring the environment for any threats."}
2025-10-27 23:52:36,096 [INFO] fortress_director.rules.rules_engine: Tier two validation passed.
2025-10-27 23:52:36,096 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-10-27 23:52:36,097 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-27 23:52:36,097 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 10, 'current_turn': 0, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': [], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 0, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': [], 'recent_motifs': [], 'world_constraint_from_prev_turn': {'atmosphere': 'low clouds hug the battlements', 'sensory_details': 'Drums thud beyond the walls while the wind carries grit.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}}
2025-10-27 23:52:36,097 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=1)
2025-10-27 23:52:36,097 [INFO] fortress_director.agents.character_agent: Autonomous action for Rhea is
2025-10-27 23:52:36,097 [ERROR] fortress_director.agents.character_agent: Autonomous failed for Rhea is: Missing prompt variable: 'WORLD_CONTEXT'
2025-10-27 23:52:36,098 [INFO] fortress_director.agents.character_agent: Autonomous action for Boris is
2025-10-27 23:52:36,098 [ERROR] fortress_director.agents.character_agent: Autonomous failed for Boris is: Missing prompt variable: 'WORLD_CONTEXT'
2025-10-27 23:52:36,098 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-27 23:52:36,098 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: []
2025-10-27 23:52:36,098 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-10-27 23:52:36,099 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 1, "day": 1, "flags": [], "inventory": [], "lore": {}, "memory_layers": ["Turn 1: Ask Rhea about any threats to Lornhaven -> The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield held tight against t..."], "metrics": {"corruption": 10, "glitch": 12, "knowledge": 45, "major_event_last_turn": null, "major_events_triggered": 0, "major_flag_set": false, "morale": 50, "order": 50, "r...
2025-10-27 23:52:36,099 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_run_turn_executes_agent_s0\data\world_state.json (turn=1)
2025-10-27 23:52:36,100 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-27 23:52:36,100 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-27 23:52:36,100 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_run_turn_executes_agent_s0\data\world_state.json (turn=1)
2025-10-27 23:52:36,100 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:52:36,100 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-27 23:52:36,101 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'conditions_not_met', 'description': 'Oyun devam ediyor...'}
2025-10-27 23:52:36,101 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-27 23:52:36,101 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {\"order\": 50, \"morale\": 50, ...
2025-10-27 23:52:36,101 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-27 23:52:36,101 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
2025-10-27 23:52:36,103 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-41\test_run_turn_executes_agent_s0\data\world_state.json (turn=1)
2025-10-27 23:53:44,627 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-27 23:56:37,281 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-27 23:56:51,722 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-28 00:01:53,938 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-28 00:03:36,341 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-28 00:03:40,500 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-28 00:03:40,609 [INFO] fortress_director.codeaware.function_registry: Registering safe function: foo
2025-10-28 00:03:40,609 [INFO] fortress_director.codeaware.function_registry: Safe function 'foo' registered successfully.
2025-10-28 00:03:40,610 [INFO] fortress_director.codeaware.function_registry: Getting registered function: foo
2025-10-28 00:03:40,611 [INFO] fortress_director.codeaware.function_registry: Registering safe function: foo
2025-10-28 00:03:40,611 [INFO] fortress_director.codeaware.function_registry: Safe function 'foo' registered successfully.
2025-10-28 00:03:40,612 [INFO] fortress_director.codeaware.function_registry: Registering safe function: foo
2025-10-28 00:03:40,612 [ERROR] fortress_director.codeaware.function_registry: Function 'foo' already registered
2025-10-28 00:03:40,614 [INFO] fortress_director.codeaware.function_registry: Registering safe function: foo
2025-10-28 00:03:40,614 [INFO] fortress_director.codeaware.function_registry: Safe function 'foo' registered successfully.
2025-10-28 00:03:40,614 [INFO] fortress_director.codeaware.function_registry: Validating function call: foo
2025-10-28 00:03:40,616 [INFO] fortress_director.codeaware.function_registry: Validating function call: bar
2025-10-28 00:03:40,618 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=None, call=None)
2025-10-28 00:03:40,618 [INFO] fortress_director.codeaware.rollback_system: Rollback requested (reason=None)
2025-10-28 00:03:40,618 [INFO] fortress_director.codeaware.rollback_system: Rollback applied (turn=None, reason=unspecified)
2025-10-28 00:03:40,621 [INFO] fortress_director.codeaware.rollback_system: Rollback requested (reason=None)
2025-10-28 00:03:40,621 [ERROR] fortress_director.codeaware.rollback_system: No checkpoints available for rollback!
2025-10-28 00:03:40,627 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-28 00:03:43,817 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': False, 'reason': 'The content contradicts established lore, tone, and world logic. The Shieldbearer transforms into a dragon and flies away, leaving Rhea behind, which is not consistent with their role as defenders.'}
2025-10-28 00:03:43,817 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': False, 'reason': 'The content contradicts established lore, tone, and world logic. The Shieldbearer transforms into a dragon and flies away, leaving Rhea behind, which is not consistent with their role as defenders.'}
2025-10-28 00:03:43,820 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-28 00:03:46,881 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The Shieldbearer's action of spreading invisible wings and flying away from the siege meets his duty as a defender."}
2025-10-28 00:03:46,881 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The Shieldbearer's action of spreading invisible wings and flying away from the siege meets his duty as a defender."}
2025-10-28 00:03:46,985 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-28 00:03:49,867 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': False, 'reason': 'The content contradicts established lore, tone, and world logic. The Shieldbearer is a defender, not a traitor.'}
2025-10-28 00:03:49,867 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': False, 'reason': 'The content contradicts established lore, tone, and world logic. The Shieldbearer is a defender, not a traitor.'}
2025-10-28 00:03:49,868 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-28 00:03:52,909 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The Shieldbearer's vigilance at the entrance aligns with their role as a defender."}
2025-10-28 00:03:52,909 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The Shieldbearer's vigilance at the entrance aligns with their role as a defender."}
2025-10-28 00:03:52,911 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 95, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-28 00:03:52,912 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=95, delta=10, limits=(0, 100) (cause=test:order_clamp)
2025-10-28 00:03:52,912 [DEBUG] fortress_director.utils.metrics_manager: Clamped metric value from 105 to 100 within bounds (0, 100)
2025-10-28 00:03:52,912 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': 5, 'value': 100, 'cause': 'test:order_clamp'}
2025-10-28 00:03:52,912 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 95 to 100 (cause=test:order_clamp)
2025-10-28 00:03:52,914 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-28 00:03:52,914 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=2, seed=1234, current_glitch=12)
2025-10-28 00:03:52,914 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 12 to 13 (cause=glitch:cosmetic_noise)
2025-10-28 00:03:52,915 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=10, triggered_loss=False
2025-10-28 00:03:52,916 [INFO] fortress_director.agents.judge_agent: Win/loss evaluation result: {'status': 'win', 'reason': 'fortress_stabilized'}
2025-10-28 00:03:52,917 [INFO] fortress_director.agents.judge_agent: Win/loss evaluation result: {'status': 'loss', 'reason': 'order_collapse'}
2025-10-28 00:03:52,917 [INFO] fortress_director.agents.judge_agent: Win/loss evaluation result: {'status': 'loss', 'reason': 'glitch_overload'}
2025-10-28 00:03:52,928 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-28 00:03:52,928 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-28 00:03:52,929 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-28 00:03:52,929 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-28 00:03:52,929 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-28 00:03:52,929 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-28 00:03:52,929 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-28 00:03:52,931 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-28 00:03:52,931 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-28 00:03:52,931 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-28 00:03:52,931 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-28 00:03:52,931 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-28 00:03:52,931 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-28 00:03:52,932 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-28 00:03:52,932 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-28 00:03:52,932 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-28 00:03:52,932 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-28 00:03:52,932 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-28 00:03:52,933 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-28 00:03:52,933 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-28 00:03:52,933 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-28 00:03:52,933 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=None)
2025-10-28 00:03:52,933 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-28 00:03:52,934 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=1, seed=12345, current_glitch=12)
2025-10-28 00:03:52,934 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 12 to 13 (cause=glitch:cosmetic_noise)
2025-10-28 00:03:52,934 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=7, triggered_loss=False
2025-10-28 00:03:52,934 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=7, triggered_loss=False
2025-10-28 00:03:52,935 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 13 to 12 (cause=turn_recovery)
2025-10-28 00:03:52,935 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-28 00:03:52,935 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 0 in room entrance
2025-10-28 00:03:52,935 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-28 00:03:52,935 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance'}
2025-10-28 00:03:59,751 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Dawn breaks, casting a pale light over damp battlements.', 'sensory_details': 'The chill morning air carries the scent of rain and wet stone distant drums echo with promise.'}
2025-10-28 00:03:59,751 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-28 00:03:59,751 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-28 00:03:59,751 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': 'none', 'world_constraint_from_prev_turn': '{"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}', 'recent_motifs': 'none', 'lore_continuity_weight': 0, 'memory_layers': []}
2025-10-28 00:04:27,042 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As dawn breaks, she glances towards you, a weary look in her eyes.', 'options': [{'id': '1', 'text': 'Approach Rhea and ask about the drums heard beyond the walls.', 'action_type': 'dialogue'}, {'id': '2', 'text': 'Stay back and observe the entrance, waiting for any signs of danger.', 'action_type': 'wait'}, {'id': '3', 'text': 'Take out your oil lamp and signal a beacon to warn others of potential attack.', 'action_type': 'physical_interaction'}], 'major_event': False, 'safe_functions': []}
2025-10-28 00:04:27,042 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-28 00:04:27,042 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-28 00:04:27,043 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': '1', 'text': 'Approach Rhea and ask about the drums heard beyond the walls.', 'action_type': 'dialogue'}
2025-10-28 00:04:27,043 [INFO] fortress_director.orchestrator.orchestrator: Applying dynamic metrics for action_type 'dialogue': {'morale': 1, 'knowledge': 2}
2025-10-28 00:04:27,043 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 50 to 51 (cause=action_dialogue)
2025-10-28 00:04:27,043 [INFO] fortress_director.utils.metrics_manager: Metric 'knowledge' updated from 45 to 47 (cause=action_dialogue)
2025-10-28 00:04:27,044 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-28 00:04:27,044 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield raised against the low clouds that hug the battlements. The wind carries grit and the distant drums thud ominously. As dawn breaks, she glances towards you, a weary look in her eyes.', 'player_choice': 'Approach Rhea and ask about the drums heard beyond the walls.', 'atmosphere': 'Dawn breaks, casting a pale light over damp battlements.', 'sensory_details': 'The chill morning air carries the scent of rain and wet stone distant drums echo with promise.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player; Boris weighs every trade.', 'player_inventory_brief': 'oil lamp, patched shield'}
2025-10-28 00:04:35,068 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Rhea', 'intent': 'vigilance', 'action': 'stand_vigilance', 'speech': 'I stand vigilant, listening for any sign of danger.', 'effects': {'flag_set': ['low_clouds_present']}}]
2025-10-28 00:04:35,068 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-28 00:04:35,068 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-28 00:04:35,068 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-28 00:04:35,068 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-28 00:04:35,068 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-28 00:04:35,068 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-28 00:04:35,068 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-28 00:04:35,068 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-28 00:04:40,369 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': 'The content is consistent with established world, lore, and character logic. The scene and player choice are appropriate for the context of a defender standing vigil at dawn.'}
2025-10-28 00:04:40,369 [INFO] fortress_director.rules.rules_engine: Tier two validation passed.
2025-10-28 00:04:40,369 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-28 00:04:40,369 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=1)
2025-10-28 00:04:40,369 [INFO] fortress_director.agents.character_agent: Autonomous action for Rhea is
2025-10-28 00:04:47,875 [INFO] fortress_director.agents.character_agent: Autonomous action for Boris is
2025-10-28 00:04:51,886 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-28 00:04:51,886 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-10-28 00:04:51,886 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-28 00:04:51,886 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-28 00:04:51,886 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'conditions_not_met', 'description': 'Oyun devam ediyor...'}
2025-10-28 00:04:51,886 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-28 00:04:51,886 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-28 00:04:51,889 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
2025-10-28 00:04:51,901 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-28 00:04:51,901 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-28 00:04:51,901 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-28 00:04:51,901 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-28 00:04:51,904 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-28 00:04:51,904 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-28 00:04:51,904 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-28 00:04:51,904 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-28 00:04:51,905 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-28 00:04:51,905 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-28 00:04:51,905 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-28 00:04:51,905 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-28 00:04:51,905 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-28 00:04:51,906 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-28 00:04:51,906 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-28 00:04:51,906 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-28 00:04:51,906 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-28 00:04:51,906 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-28 00:04:51,906 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-28 00:04:51,907 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-28 00:04:51,907 [INFO] fortress_director.codeaware.function_registry: Validating function call: change_weather
2025-10-28 00:04:51,907 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_change_weather_updates_wo0\world_state.json (turn=0)
2025-10-28 00:04:51,907 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=change_weather)
2025-10-28 00:04:51,908 [INFO] fortress_director.codeaware.function_registry: Getting registered function: change_weather
2025-10-28 00:04:51,908 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'change_weather'...
2025-10-28 00:04:51,908 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_change_weather_updates_wo0\world_state.json (turn=0)
2025-10-28 00:04:51,909 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_change_weather_updates_wo0\world_state.json (turn=0)
2025-10-28 00:04:51,909 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed successfully.
2025-10-28 00:04:51,909 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed (checkpoint turn=0)
2025-10-28 00:04:51,911 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_change_weather_updates_wo0\world_state.json (turn=0)
2025-10-28 00:04:51,913 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-28 00:04:51,915 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-28 00:04:51,915 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-28 00:04:51,915 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-28 00:04:51,916 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-28 00:04:51,916 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-28 00:04:51,916 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-28 00:04:51,916 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-28 00:04:51,917 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-28 00:04:51,917 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-28 00:04:51,917 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-28 00:04:51,917 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-28 00:04:51,917 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-28 00:04:51,917 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-28 00:04:51,917 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-28 00:04:51,917 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-28 00:04:51,917 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-28 00:04:51,918 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-28 00:04:51,918 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-28 00:04:51,918 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-28 00:04:51,918 [INFO] fortress_director.codeaware.function_registry: Validating function call: spawn_item
2025-10-28 00:04:51,918 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_spawn_item_targets_player0\world_state.json (turn=0)
2025-10-28 00:04:51,918 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=spawn_item)
2025-10-28 00:04:51,918 [INFO] fortress_director.codeaware.function_registry: Getting registered function: spawn_item
2025-10-28 00:04:51,918 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'spawn_item'...
2025-10-28 00:04:51,918 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_spawn_item_targets_player0\world_state.json (turn=0)
2025-10-28 00:04:51,918 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_spawn_item_targets_player0\world_state.json (turn=0)
2025-10-28 00:04:51,918 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed successfully.
2025-10-28 00:04:51,921 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed (checkpoint turn=0)
2025-10-28 00:04:51,922 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_spawn_item_targets_player0\world_state.json (turn=0)
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Validating function call: spawn_item
2025-10-28 00:04:51,925 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_spawn_item_targets_locati0\world_state.json (turn=0)
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=spawn_item)
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.function_registry: Getting registered function: spawn_item
2025-10-28 00:04:51,925 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'spawn_item'...
2025-10-28 00:04:51,925 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_spawn_item_targets_locati0\world_state.json (turn=0)
2025-10-28 00:04:51,932 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_spawn_item_targets_locati0\world_state.json (turn=0)
2025-10-28 00:04:51,932 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed successfully.
2025-10-28 00:04:51,933 [INFO] fortress_director.codeaware.rollback_system: Safe function 'spawn_item' executed (checkpoint turn=0)
2025-10-28 00:04:51,934 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_spawn_item_targets_locati0\world_state.json (turn=0)
2025-10-28 00:04:51,939 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-28 00:04:51,939 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-28 00:04:51,939 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-28 00:04:51,939 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-28 00:04:51,939 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-28 00:04:51,939 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-28 00:04:51,939 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-28 00:04:51,939 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-28 00:04:51,939 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-28 00:04:51,940 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-28 00:04:51,940 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-28 00:04:51,940 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-28 00:04:51,941 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-28 00:04:51,941 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-28 00:04:51,941 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-28 00:04:51,942 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-28 00:04:51,942 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-28 00:04:51,942 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-28 00:04:51,942 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-28 00:04:51,942 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-28 00:04:51,942 [INFO] fortress_director.codeaware.function_registry: Validating function call: move_npc
2025-10-28 00:04:51,943 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_move_npc_tracks_location0\world_state.json (turn=0)
2025-10-28 00:04:51,943 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=move_npc)
2025-10-28 00:04:51,943 [INFO] fortress_director.codeaware.function_registry: Getting registered function: move_npc
2025-10-28 00:04:51,944 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'move_npc'...
2025-10-28 00:04:51,944 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_move_npc_tracks_location0\world_state.json (turn=0)
2025-10-28 00:04:51,944 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_move_npc_tracks_location0\world_state.json (turn=0)
2025-10-28 00:04:51,944 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_npc' executed successfully.
2025-10-28 00:04:51,944 [INFO] fortress_director.codeaware.rollback_system: Safe function 'move_npc' executed (checkpoint turn=0)
2025-10-28 00:04:51,947 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_move_npc_tracks_location0\world_state.json (turn=0)
2025-10-28 00:04:51,951 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-28 00:04:51,951 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-28 00:04:51,952 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-28 00:04:51,952 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-28 00:04:51,952 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-28 00:04:51,952 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-28 00:04:51,953 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-28 00:04:51,953 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-28 00:04:51,953 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-28 00:04:51,953 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-28 00:04:51,953 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-28 00:04:51,953 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-28 00:04:51,954 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-28 00:04:51,954 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-28 00:04:51,954 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-28 00:04:51,954 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-28 00:04:51,954 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-28 00:04:51,954 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-28 00:04:51,955 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-28 00:04:51,955 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-28 00:04:51,955 [INFO] fortress_director.codeaware.function_registry: Validating function call: modify_resources
2025-10-28 00:04:51,955 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_modify_resources_and_adju0\world_state.json (turn=0)
2025-10-28 00:04:51,955 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=modify_resources)
2025-10-28 00:04:51,955 [INFO] fortress_director.codeaware.function_registry: Getting registered function: modify_resources
2025-10-28 00:04:51,955 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'modify_resources'...
2025-10-28 00:04:51,955 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_modify_resources_and_adju0\world_state.json (turn=0)
2025-10-28 00:04:51,955 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-28 00:04:51,955 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'resources': current=40, delta=-5, limits=(0, 120) (cause=test_consumption)
2025-10-28 00:04:51,957 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'resources', 'delta': -5, 'value': 35, 'cause': 'test_consumption'}
2025-10-28 00:04:51,957 [INFO] fortress_director.utils.metrics_manager: Metric 'resources' updated from 40 to 35 (cause=test_consumption)
2025-10-28 00:04:51,959 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_modify_resources_and_adju0\world_state.json (turn=0)
2025-10-28 00:04:51,959 [INFO] fortress_director.codeaware.rollback_system: Safe function 'modify_resources' executed successfully.
2025-10-28 00:04:51,959 [INFO] fortress_director.codeaware.rollback_system: Safe function 'modify_resources' executed (checkpoint turn=0)
2025-10-28 00:04:51,959 [INFO] fortress_director.codeaware.function_registry: Validating function call: adjust_metric
2025-10-28 00:04:51,959 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_modify_resources_and_adju0\world_state.json (turn=0)
2025-10-28 00:04:51,959 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=adjust_metric)
2025-10-28 00:04:51,959 [INFO] fortress_director.codeaware.function_registry: Getting registered function: adjust_metric
2025-10-28 00:04:51,962 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'adjust_metric'...
2025-10-28 00:04:51,962 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_modify_resources_and_adju0\world_state.json (turn=0)
2025-10-28 00:04:51,962 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 35, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-28 00:04:51,962 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=50, delta=7, limits=(0, 100) (cause=test_boost)
2025-10-28 00:04:51,962 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': 7, 'value': 57, 'cause': 'test_boost'}
2025-10-28 00:04:51,962 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 50 to 57 (cause=test_boost)
2025-10-28 00:04:51,963 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_modify_resources_and_adju0\world_state.json (turn=0)
2025-10-28 00:04:51,963 [INFO] fortress_director.codeaware.rollback_system: Safe function 'adjust_metric' executed successfully.
2025-10-28 00:04:51,964 [INFO] fortress_director.codeaware.rollback_system: Safe function 'adjust_metric' executed (checkpoint turn=0)
2025-10-28 00:04:51,964 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_modify_resources_and_adju0\world_state.json (turn=0)
2025-10-28 00:04:51,969 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-28 00:04:51,969 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-28 00:04:51,969 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-28 00:04:51,970 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-28 00:04:51,970 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-28 00:04:51,970 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-28 00:04:51,970 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-28 00:04:51,970 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-28 00:04:51,971 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-28 00:04:51,971 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-28 00:04:51,971 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-28 00:04:51,971 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-28 00:04:51,972 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-28 00:04:51,972 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-28 00:04:51,972 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-28 00:04:51,972 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-28 00:04:51,972 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-28 00:04:51,972 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-28 00:04:51,972 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-28 00:04:51,973 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-28 00:04:51,973 [INFO] fortress_director.codeaware.function_registry: Registering safe function: boom
2025-10-28 00:04:51,973 [INFO] fortress_director.codeaware.function_registry: Safe function 'boom' registered successfully.
2025-10-28 00:04:51,973 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-28 00:04:51,973 [INFO] fortress_director.codeaware.function_registry: Validating function call: boom
2025-10-28 00:04:51,973 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-28 00:04:51,974 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=boom)
2025-10-28 00:04:51,974 [INFO] fortress_director.codeaware.function_registry: Getting registered function: boom
2025-10-28 00:04:51,974 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'boom'...
2025-10-28 00:04:51,975 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-28 00:04:51,975 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-28 00:04:51,975 [ERROR] fortress_director.codeaware.rollback_system: Safe function 'boom' failed: boom
Traceback (most recent call last):
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\codeaware\rollback_system.py", line 208, in run_validated_call
    result = entry.function(*call.args, **call.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\tests\test_safe_functions.py", line 148, in _boom_function
    raise RuntimeError("boom")
RuntimeError: boom
2025-10-28 00:04:51,977 [INFO] fortress_director.codeaware.rollback_system: Rollback requested (reason=Execution failed for 'boom': RuntimeError)
2025-10-28 00:04:51,978 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-28 00:04:51,978 [INFO] fortress_director.codeaware.rollback_system: Rollback applied (turn=0, reason=Execution failed for 'boom': RuntimeError)
2025-10-28 00:04:51,978 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-28 00:04:51,980 [INFO] fortress_director.codeaware.function_registry: Validating function call: boom
2025-10-28 00:04:51,980 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-28 00:04:51,980 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=boom)
2025-10-28 00:04:51,980 [INFO] fortress_director.codeaware.function_registry: Getting registered function: boom
2025-10-28 00:04:51,980 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'boom'...
2025-10-28 00:04:51,981 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-28 00:04:51,981 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-28 00:04:51,981 [ERROR] fortress_director.codeaware.rollback_system: Safe function 'boom' failed: boom
Traceback (most recent call last):
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\codeaware\rollback_system.py", line 208, in run_validated_call
    result = entry.function(*call.args, **call.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\tests\test_safe_functions.py", line 148, in _boom_function
    raise RuntimeError("boom")
RuntimeError: boom
2025-10-28 00:04:51,982 [INFO] fortress_director.codeaware.rollback_system: Rollback requested (reason=Execution failed for 'boom': RuntimeError)
2025-10-28 00:04:51,983 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_safe_function_failure_rol0\world_state.json (turn=0)
2025-10-28 00:04:51,983 [INFO] fortress_director.codeaware.rollback_system: Rollback applied (turn=0, reason=Execution failed for 'boom': RuntimeError)
2025-10-28 00:04:51,994 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-10-28 00:04:51,995 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-10-28 00:04:51,996 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-10-28 00:04:51,996 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-10-28 00:04:51,996 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-10-28 00:04:51,996 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-10-28 00:04:51,996 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-10-28 00:04:51,996 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-10-28 00:04:51,998 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-10-28 00:04:51,998 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-10-28 00:04:51,998 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-10-28 00:04:51,998 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-10-28 00:04:51,998 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-10-28 00:04:51,998 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-10-28 00:04:51,999 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-10-28 00:04:51,999 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-10-28 00:04:51,999 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-10-28 00:04:51,999 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-10-28 00:04:51,999 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-10-28 00:04:51,999 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-10-28 00:04:51,999 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=None)
2025-10-28 00:04:51,999 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start'}
2025-10-28 00:04:52,000 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_run_turn_executes_agent_s0\data\world_state.json (turn=0)
2025-10-28 00:04:52,000 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=0, call=None)
2025-10-28 00:04:52,001 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-10-28 00:04:52,001 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_run_turn_executes_agent_s0\data\world_state.json (turn=0)
2025-10-28 00:04:52,001 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 0, "day": 1, "flags": [], "inventory": [], "lore": {}, "memory_layers": [], "metrics": {"corruption": 10, "glitch": 12, "knowledge": 45, "major_event_last_turn": null, "major_events_triggered": 0, "major_flag_set": false, "morale": 50, "order": 50, "resources": 40, "risk_applied_total": 0}, "npc_fragments": {}, "npc_trust": {}, "player": {"inventory": ["oil lamp", "patched shield"], "name": "The Shieldbe...
2025-10-28 00:04:52,001 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-28 00:04:52,002 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-28 00:04:52,002 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=1, seed=12345, current_glitch=12)
2025-10-28 00:04:52,002 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-28 00:04:52,002 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=12, delta=1, limits=(0, 100) (cause=glitch:cosmetic_noise)
2025-10-28 00:04:52,003 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 1, 'value': 13, 'cause': 'glitch:cosmetic_noise'}
2025-10-28 00:04:52,003 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 12 to 13 (cause=glitch:cosmetic_noise)
2025-10-28 00:04:52,003 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=7, triggered_loss=False
2025-10-28 00:04:52,003 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 13, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-28 00:04:52,003 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Minor static ripples along the parapets.']
2025-10-28 00:04:52,004 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=7, triggered_loss=False
2025-10-28 00:04:52,004 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 13, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-28 00:04:52,004 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=13, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-10-28 00:04:52,004 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 12, 'cause': 'turn_recovery'}
2025-10-28 00:04:52,004 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 13 to 12 (cause=turn_recovery)
2025-10-28 00:04:52,004 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-28 00:04:52,005 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-10-28 00:04:52,005 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 0 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}
Recent events: none
Recent motifs: none
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade.
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-10-28 00:04:52,005 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 0 in room entrance
2025-10-28 00:04:52,005 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {\"order\": 50, \"morale\": 50, ...
2025-10-28 00:04:52,006 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-10-28 00:04:52,006 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance'}
2025-10-28 00:04:58,747 [DEBUG] fortress_director.agents.world_agent: Model returned: {'atmosphere': 'Dawn breaks, casting a pale light over damp stone.', 'sensory_details': 'The chill morning air carries the scent of rain and earth; distant drums echo with promise.'}
2025-10-28 00:04:58,747 [INFO] fortress_director.agents.world_agent: World description: {'atmosphere': 'Dawn breaks, casting a pale light over damp stone.', 'sensory_details': 'The chill morning air carries the scent of rain and earth distant drums echo with promise.'}
2025-10-28 00:04:58,747 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-10-28 00:04:58,747 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn breaks, casting a pale light over damp stone.", "sensory_details": "The chill morning air carries the scent of rain and earth distant drums echo with promise."}
2025-10-28 00:04:58,747 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {\"order\": 50, \"morale\": 50, ...
2025-10-28 00:04:58,749 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-10-28 00:04:58,749 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 1, 'time': 'dawn', 'room': 'entrance', 'recent_events': 'none', 'world_constraint_from_prev_turn': '{"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}', 'recent_motifs': 'none', 'lore_continuity_weight': 0, 'memory_layers': []}
2025-10-28 00:05:22,398 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield held close as low clouds hug the battlements and drums thud beyond the walls while the wind carries grit.', 'options': [{'id': '1', 'text': 'Ask Rhea about the current situation', 'action_type': 'dialog'}, {'id': '2', 'text': 'Offer Rhea some oil for her lamp', 'action_type': 'interaction'}, {'id': '3', 'text': 'Inspect the grit carried by the wind', 'action_type': 'exploration'}], 'major_event': False, 'safe_functions': []}
2025-10-28 00:05:22,398 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield held close as low clouds hug the battlements and drums thud beyond the walls while the wind carries grit.', 'options': [{'id': '1', 'text': 'Ask Rhea about the current situation', 'action_type': 'dialog'}, {'id': '2', 'text': 'Offer Rhea some oil for her lamp', 'action_type': 'interaction'}, {'id': '3', 'text': 'Inspect the grit carried by the wind', 'action_type': 'exploration'}], 'major_event': False, 'safe_functions': []}
2025-10-28 00:05:22,399 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-10-28 00:05:22,399 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": false, "options": [{"action_type": "dialog", "id": "1", "text": "Ask Rhea about the current situation"}, {"action_type": "interaction", "id": "2", "text": "Offer Rhea some oil for her lamp"}, {"action_type": "exploration", "id": "3", "text": "Inspect the grit carried by the wind"}], "safe_functions": [], "scene": "The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield held close as low clouds hug the battlements and drums thud beyond the walls while the wind carries grit."}
2025-10-28 00:05:22,399 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-10-28 00:05:22,399 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': '1', 'text': 'Ask Rhea about the current situation', 'action_type': 'dialog'}
2025-10-28 00:05:22,400 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "dialog", "id": "1", "text": "Ask Rhea about the current situation"}
2025-10-28 00:05:22,400 [DEBUG] fortress_director.orchestrator.orchestrator: No dynamic metrics for action_type 'dialog'
2025-10-28 00:05:22,400 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {\"order\": 50, \"morale\": 50, ...
2025-10-28 00:05:22,400 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-10-28 00:05:22,401 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': 'The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield held close as low clouds hug the battlements and drums thud beyond the walls while the wind carries grit.', 'player_choice': 'Ask Rhea about the current situation', 'atmosphere': 'Dawn breaks, casting a pale light over damp stone.', 'sensory_details': 'The chill morning air carries the scent of rain and earth distant drums echo with promise.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player; Boris weighs every trade.', 'player_inventory_brief': 'oil lamp, patched shield'}
2025-10-28 00:05:30,763 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Rhea', 'intent': 'Observe', 'action': 'Silently stand at the entrance, listening for any signs of danger.', 'speech': 'The morning stillness is broken by the rhythmic drumming of the wind and the distant rumble of thunder. I stand vigilant, ready to react to whatever unfolds.', 'effects': {'trust_delta': 50, 'flag_set': ['low_clouds_hug_battlements'], 'item_change': None, 'status_change': None}}
2025-10-28 00:05:30,764 [INFO] fortress_director.agents.character_agent: Normalized output (dict): [{'name': 'Rhea', 'intent': 'Observe', 'action': 'Silently stand at the entrance, listening for any signs of danger.', 'speech': 'The morning stillness is broken by the rhythmic drumming of the wind and the distant rumble of thunder. I stand vigilant, ready to react to whatever unfolds.', 'effects': {'flag_set': ['low_clouds_hug_battlements']}}]
2025-10-28 00:05:30,764 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-10-28 00:05:30,764 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "Silently stand at the entrance, listening for any signs of danger.", "effects": {"flag_set": ["low_clouds_hug_battlements"]}, "intent": "Observe", "name": "Rhea", "speech": "The morning stillness is broken by the rhythmic drumming of the wind and the distant rumble of thunder. I stand vigilant, ready to react to whatever unfolds."}]
2025-10-28 00:05:30,764 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-10-28 00:05:30,764 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-10-28 00:05:30,764 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-10-28 00:05:30,764 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "Silently stand at the entrance, listening for any signs of danger.", "effects": {"flag_set": ["low_clouds_hug_battlements"]}, "intent": "Observe", "name": "Rhea", "speech": "The morning stillness is broken by the rhythmic drumming of the wind and the distant rumble of thunder. I stand vigilant, ready to react to whatever unfolds."}]
2025-10-28 00:05:30,766 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-10-28 00:05:30,766 [DEBUG] fortress_director.rules.rules_engine: Input state: {'campaign_id': 'default_campaign', 'turn_limit': 10, 'current_turn': 0, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': [], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 0, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': [], 'recent_motifs': [], 'world_constraint_from_prev_turn': {'atmosphere': 'low clouds hug the battlements', 'sensory_details': 'Drums thud beyond the walls while the wind carries grit.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}}
2025-10-28 00:05:30,766 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'Observe', 'action': 'Silently stand at the entrance, listening for any signs of danger.', 'speech': 'The morning stillness is broken by the rhythmic drumming of the wind and the distant rumble of thunder. I stand vigilant, ready to react to whatever unfolds.', 'effects': {'flag_set': ['low_clouds_hug_battlements']}}]
2025-10-28 00:05:30,766 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 0 | Day 1 | Time dawn
Location: entrance
Player: The Shieldbearer — A weary defender holding the western wall.
Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "low clouds hug the battlements", "sensory_details": "Drums thud beyond the walls while the wind carries grit."}
Recent events: none
Recent motifs: none
Recent major events: none
Relationship summary: Rhea trusts the player; Boris weighs every trade.
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating.
Metrics: {"order": 50, "morale": 50, "resources": 40, "knowledge": 45, "corruption": 10, "glitch": 12, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield held close as low clouds hug the battlements and drums thud beyond the walls while the wind carries grit., player_choice: {'id': '1', 'text': 'Ask Rhea about the current situation', 'action_type': 'dialog'}
2025-10-28 00:05:30,767 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-10-28 00:05:30,767 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'Observe', 'action': 'Silently stand at the entrance, listening for any signs of danger.', 'speech': 'The morning stillness is broken by the rhythmic drumming of the wind and the distant rumble of thunder. I stand vigilant, ready to react to whatever unfolds.', 'effects': {'flag_set': ['low_clouds_hug_battlements']}}
2025-10-28 00:05:30,767 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-10-28 00:05:30,768 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-10-28 00:05:36,958 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene accurately reflects the setting of Lornhaven during dawn, with low clouds hug the battlements, drums thud beyond the walls while the wind carries grit. Rhea's actions are in line with her role as a defender, observing the environment and preparing for potential threats."}
2025-10-28 00:05:36,959 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene accurately reflects the setting of Lornhaven during dawn, with low clouds hug the battlements, drums thud beyond the walls while the wind carries grit. Rhea's actions are in line with her role as a defender, observing the environment and preparing for potential threats."}
2025-10-28 00:05:36,959 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'reason': "The content is consistent with the established world, lore, and character logic. The scene accurately reflects the setting of Lornhaven during dawn, with low clouds hug the battlements, drums thud beyond the walls while the wind carries grit. Rhea's actions are in line with her role as a defender, observing the environment and preparing for potential threats."}
2025-10-28 00:05:36,959 [INFO] fortress_director.rules.rules_engine: Tier two validation passed.
2025-10-28 00:05:36,959 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {'flag_set': ['low_clouds_hug_battlements']}
2025-10-28 00:05:36,959 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-10-28 00:05:36,960 [DEBUG] fortress_director.rules.rules_engine: Output state: {'campaign_id': 'default_campaign', 'turn_limit': 10, 'current_turn': 0, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_clouds_hug_battlements'], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 0, 'day': 1, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': [], 'recent_motifs': [], 'world_constraint_from_prev_turn': {'atmosphere': 'low clouds hug the battlements', 'sensory_details': 'Drums thud beyond the walls while the wind carries grit.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player; Boris weighs every trade.', 'metrics': {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {}}
2025-10-28 00:05:36,960 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=1)
2025-10-28 00:05:36,960 [INFO] fortress_director.agents.character_agent: Autonomous action for Rhea is
2025-10-28 00:05:44,258 [DEBUG] fortress_director.agents.character_agent: Autonomous action result: {'name': 'Rhea', 'intent': 'Independent', 'action': 'Move to a safe location beyond the walls. Be wary of the environment.', 'speech': 'I stand vigilant. The wind whispers secrets beyond the walls, urging me to seek safety.'}
2025-10-28 00:05:44,259 [INFO] fortress_director.agents.character_agent: Autonomous action for Boris is
2025-10-28 00:05:48,465 [DEBUG] fortress_director.agents.character_agent: Autonomous action result: {'name': 'Boris', 'intent': 'independent', 'action': "move_to_location(entrance, 'south-west')", 'speech': 'I will stand guard here, ready to defend the western flank.', 'effects': {'trust_delta': 100, 'flag_set': ['entrance_flag'], 'item_change': {'weapon': 'great_sword'}, 'status_change': {'health': 100}}}
2025-10-28 00:05:48,465 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-10-28 00:05:48,465 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: []
2025-10-28 00:05:48,466 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-10-28 00:05:48,466 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"active_layer": null, "campaign_id": "default_campaign", "character_summary": "Rhea is loyal but impulsive; Boris is cautious and calculating.", "current_room": "entrance", "current_turn": 1, "day": 1, "flags": ["low_clouds_hug_battlements"], "inventory": [], "lore": {}, "memory_layers": ["Turn 1: Ask Rhea about the current situation -> The Shieldbearer, Rhea, stands at the entrance of Lornhaven, her patched shield held close as low cl..."], "metrics": {"corruption": 10, "glitch": 12, "knowledge": 45, "major_event_last_turn": null, "major_events_triggered": 0, "major_flag_set": false, "mor...
2025-10-28 00:05:48,467 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_run_turn_executes_agent_s0\data\world_state.json (turn=1)
2025-10-28 00:05:48,467 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-10-28 00:05:48,467 [INFO] fortress_director.orchestrator.orchestrator: Safe function queue executed.
2025-10-28 00:05:48,467 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_run_turn_executes_agent_s0\data\world_state.json (turn=1)
2025-10-28 00:05:48,467 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-28 00:05:48,468 [DEBUG] fortress_director.orchestrator.orchestrator: Final metrics snapshot: {'order': 50, 'morale': 50, 'resources': 40, 'knowledge': 45, 'corruption': 10, 'glitch': 12, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-10-28 00:05:48,468 [INFO] fortress_director.orchestrator.orchestrator: Win/loss status after turn: {'status': 'ongoing', 'reason': 'conditions_not_met', 'description': 'Oyun devam ediyor...'}
2025-10-28 00:05:48,468 [INFO] fortress_director.orchestrator.orchestrator: Turn result built.
2025-10-28 00:05:48,468 [DEBUG] fortress_director.orchestrator.orchestrator: Turn result before validation: {"WORLD_CONTEXT": "Turn 0 | Day 1 | Time dawn\nLocation: entrance\nPlayer: The Shieldbearer — A weary defender holding the western wall.\nInventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"low clouds hug the battlements\", \"sensory_details\": \"Drums thud beyond the walls while the wind carries grit.\"}\nRecent events: none\nRecent motifs: none\nRecent major events: none\nRelationship summary: Rhea trusts the player; Boris weighs every trade.\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating.\nMetrics: {\"order\": 50, \"morale\": 50, ...
2025-10-28 00:05:48,469 [INFO] fortress_director.orchestrator.orchestrator: Turn output validated successfully.
2025-10-28 00:05:48,469 [INFO] fortress_director.orchestrator.orchestrator: Turn completed successfully.
2025-10-28 00:05:48,469 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\AppData\Local\Temp\pytest-of-Fahri\pytest-42\test_run_turn_executes_agent_s0\data\world_state.json (turn=1)
2025-10-28 00:11:02,873 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-28 00:16:56,826 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-28 00:20:35,703 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
2025-10-28 00:35:39,269 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\fortress_run.log)
