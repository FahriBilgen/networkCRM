{
  "turn": 20,
  "player_choice": "option_1",
  "projected_state": {
    "turn": 19,
    "world": {
      "stability": 58,
      "resources": 48,
      "threat_level": "volatile"
    },
    "metrics": {
      "order": 60,
      "morale": 64,
      "resources": 82,
      "knowledge": 48,
      "glitch": 42
    },
    "nearby_grid": [
      {
        "id": "player",
        "x": 3,
        "y": 11,
        "room": null,
        "hostile": false,
        "entity_type": "player"
      },
      {
        "id": "scout_ila",
        "x": 8,
        "y": 4,
        "room": "north_wall",
        "hostile": false,
        "entity_type": "npc"
      },
      {
        "id": "engineer_tomas",
        "x": 3,
        "y": 0,
        "room": "workshop",
        "hostile": false,
        "entity_type": "npc"
      },
      {
        "id": "raider_probe",
        "x": 2,
        "y": 0,
        "room": "east_rampart",
        "hostile": true,
        "entity_type": "npc_hostile"
      },
      {
        "id": "supply_cache",
        "x": 2,
        "y": 9,
        "room": "hangar",
        "hostile": false,
        "entity_type": "item"
      },
      {
        "id": "breach_warning",
        "x": 10,
        "y": 3,
        "room": "east_wall",
        "hostile": false,
        "entity_type": "marker"
      }
    ],
    "npc_focus": [
      {
        "id": "raider_probe",
        "name": "Raider Probe",
        "room": "east_rampart",
        "role": null,
        "stance": null,
        "hostile": true
      }
    ],
    "recent_events": [
      "lock_player_option executed with minimal impact.",
      "move_npc executed with minimal impact.",
      "lock_player_option executed with minimal impact.",
      "move_npc executed with minimal impact.",
      "lock_player_option executed with minimal impact."
    ]
  },
  "director_output": {
    "scene_intent": {
      "focus": "stabilize",
      "turn": 19,
      "player_choice": "option_1",
      "summary": "Turn 19 directive: stabilize."
    },
    "player_options": [
      {
        "id": "option_1",
        "label": "Reinforce defenses",
        "type": "defense"
      },
      {
        "id": "option_2",
        "label": "Scout the perimeter",
        "type": "recon"
      },
      {
        "id": "option_4",
        "label": "Conserve supplies",
        "type": "logistics"
      }
    ]
  },
  "planner_output": {
    "prompt": "You are a deterministic planner focused on safe function calls.\nRespond with JSON that satisfies OUTPUT_SCHEMA. Do not add narration.\nPROJECTED_STATE:\n{\"turn\": 19, \"world\": {\"stability\": 58, \"resources\": 48, \"threat_level\": \"volatile\"}, \"metrics\": {\"order\": 60, \"morale\": 64, \"resources\": 82, \"knowledge\": 48, \"glitch\": 42}, \"nearby_grid\": [{\"id\": \"player\", \"x\": 3, \"y\": 11, \"room\": null, \"hostile\": false, \"entity_type\": \"player\"}, {\"id\": \"scout_ila\", \"x\": 8, \"y\": 4, \"room\": \"north_wall\", \"hostile\": false, \"entity_type\": \"npc\"}, {\"id\": \"engineer_tomas\", \"x\": 3, \"y\": 0, \"room\": \"workshop\", \"hostile\": false, \"entity_type\": \"npc\"}, {\"id\": \"raider_probe\", \"x\": 2, \"y\": 0, \"room\": \"east_rampart\", \"hostile\": true, \"entity_type\": \"npc_hostile\"}, {\"id\": \"supply_cache\", \"x\": 2, \"y\": 9, \"room\": \"hangar\", \"hostile\": false, \"entity_type\": \"item\"}, {\"id\": \"breach_warning\", \"x\": 10, \"y\": 3, \"room\": \"east_wall\", \"hostile\": false, \"entity_type\": \"marker\"}], \"npc_focus\": [{\"id\": \"raider_probe\", \"name\": \"Raider Probe\", \"room\": \"east_rampart\", \"role\": null, \"stance\": null, \"hostile\": true}], \"recent_events\": [\"lock_player_option executed with minimal impact.\", \"move_npc executed with minimal impact.\", \"lock_player_option executed with minimal impact.\", \"move_npc executed with minimal impact.\", \"lock_player_option executed with minimal impact.\"]}\nSTATE_DELTA:\n{}\nSCENE_INTENT:\n{\"focus\": \"stabilize\", \"turn\": 19, \"player_choice\": \"option_1\", \"summary\": \"Turn 19 directive: stabilize.\"}\nAVAILABLE_FUNCTIONS:\n- resolve_combat [combat] Args: {\"attacker\": str, \"defender\": str, \"outcome\": str} | Tags: combat, npc, risk | Resolve a scripted combat encounter between two forces.\n- move_npc [npc_control] Args: {\"npc_id\": str, \"location\": str, \"x?\": int, \"y?\": int} | Tags: npc, movement, map | Reposition an NPC toward a specific room or coordinate.\n- spawn_patrol [planning] Args: {\"patrol_id\": str, \"members\": [str], \"path\": [str]} | Tags: npc, combat, patrol | Create a patrol unit with a set path for scouting or defense.\n- schedule_npc_activity [planning] Args: {\"npc_id\": str, \"activity\": str, \"duration\": int} | Tags: npc, planning, logistics | Queue deterministic NPC activities with durations.\n- adjust_npc_role [npc_control] Args: {\"npc_id\": str, \"role\": str, \"stance?\": str, \"location?\": str} | Tags: npc, role, logistics | Reassign an NPC's operational role, stance, or location.\n- set_watcher_route [structures] Args: {\"route_id\": str, \"npc_ids\": [str]} | Tags: npc, structure, patrol | Assign watchers or scouts to cycle along a named patrol route.\n- patrol_and_report [planning] Args: {\"npc_id\": str} | Tags: npc, patrol, intel | Macro to send an NPC on patrol and report intel afterwards.\n- interact_npc [npc_control] Args: {\"npc_id\": str, \"action\": str, \"message?\": str} | Tags: npc, dialogue, diplomacy | Trigger a structured NPC interaction such as talk, trade, or assist.\n- move_and_take_item [npc_control] Args: {\"npc_id\": str, \"item_id\": str, \"location\": str} | Tags: npc, inventory, movement | Macro to move an NPC and collect an item in one call.\n- add_status [status_effects] Args: {\"npc_id\": str, \"status\": str} | Tags: npc, status, buff | Apply a named status effect or condition to an NPC.\n- despawn_npc [npc_roster] Args: {\"npc_id\": str} | Tags: npc, roster, story | Remove an NPC from the world roster in a deterministic way.\n- remove_status [status_effects] Args: {\"npc_id\": str, \"status\": str} | Tags: npc, status, buff | Clear a named status effect from an NPC.\nFEW-SHOT EXAMPLES:\nExample 1 - Reinforce the wall during a storm alert:\n{\"gas\": 1, \"calls\": [{\"name\": \"reinforce_structure\", \"kwargs\": {\"structure_id\": \"western_wall\", \"amount\": 2}}, {\"name\": \"spawn_event_marker\", \"kwargs\": {\"marker_id\": \"storm_watch\", \"room\": \"battlements\", \"marker_type\": \"alert\", \"summary\": \"Storm front bearing down on western wall.\"}}]}\nExample 2 - Scout for intel and tighten order:\n{\"gas\": 1, \"calls\": [{\"name\": \"patrol_and_report\", \"kwargs\": {\"npc_id\": \"rhea\"}}, {\"name\": \"adjust_metric\", \"kwargs\": {\"metric\": \"order\", \"delta\": 1, \"cause\": \"patrol_visibility\"}}]}\nExample 3 - Boost resources via trade:\n{\"gas\": 1, \"calls\": [{\"name\": \"open_trade_route\", \"kwargs\": {\"route_id\": \"ember_pass\", \"risk\": 2, \"reward\": 3}}, {\"name\": \"adjust_stockpile\", \"kwargs\": {\"resource_id\": \"food\", \"delta\": 2, \"cause\": \"caravan_support\"}}]}\nOUTPUT_SCHEMA:\n{\"$schema\": \"https://json-schema.org/draft/2020-12/schema\", \"type\": \"object\", \"required\": [\"gas\", \"calls\"], \"properties\": {\"gas\": {\"type\": \"integer\", \"minimum\": 1, \"maximum\": 5}, \"calls\": {\"type\": \"array\", \"minItems\": 1, \"maxItems\": 5, \"items\": {\"type\": \"object\", \"required\": [\"name\"], \"properties\": {\"name\": {\"type\": \"string\", \"minLength\": 1}, \"kwargs\": {\"type\": \"object\"}, \"args\": {\"type\": \"array\"}, \"metadata\": {\"type\": \"object\"}}, \"additionalProperties\": false}}}, \"additionalProperties\": false}",
    "raw_plan": {
      "gas": 2,
      "calls": [
        {
          "name": "move_npc",
          "kwargs": {
            "npc_id": "raider_probe",
            "location": "battlements"
          }
        },
        {
          "name": "lock_player_option",
          "kwargs": {
            "option_id": "option_1",
            "reason": "planner_reserve"
          }
        }
      ]
    },
    "planned_actions": [
      {
        "function": "move_npc",
        "args": {
          "npc_id": "raider_probe",
          "location": "battlements"
        }
      },
      {
        "function": "lock_player_option",
        "args": {
          "option_id": "option_1",
          "reason": "planner_reserve"
        }
      }
    ]
  },
  "executed_actions": [
    {
      "function": "move_npc",
      "args": {
        "npc_id": "raider_probe",
        "location": "battlements"
      },
      "status": "applied",
      "metrics": {
        "stability": 0,
        "resources": -1,
        "description": "move_npc executed with minimal impact."
      }
    },
    {
      "function": "lock_player_option",
      "args": {
        "option_id": "option_1",
        "reason": "planner_reserve"
      },
      "status": "applied",
      "metrics": {
        "stability": 0,
        "resources": -1,
        "description": "lock_player_option executed with minimal impact."
      }
    }
  ],
  "state_delta": {
    "turn_advanced": true,
    "resource_delta": -2,
    "stability_delta": 0,
    "log_entries": [
      "move_npc executed with minimal impact.",
      "lock_player_option executed with minimal impact."
    ]
  },
  "render_payload": {
    "narrative_block": "Turn 20 concludes with stability at 58 and resources at 46. 1. move_npc succeeded. 2. lock_player_option succeeded.",
    "npc_dialogues": [
      {
        "speaker": "Quartermaster Lysa",
        "line": "Stockpiles are running low."
      },
      {
        "speaker": "Watcher Bren",
        "line": "Stability is still fragile."
      }
    ],
    "atmosphere": {
      "mood": "tense",
      "visuals": "Beacon lights flicker."
    }
  }
}