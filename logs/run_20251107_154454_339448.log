2025-11-07 18:44:54,339 [DEBUG] root: Logging configured (console=INFO, file=DEBUG, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\run_20251107_154454_339448.log)
2025-11-07 18:44:54,339 [DEBUG] __main__: Logging configured via CLI (console level=INFO, path=C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\run_20251107_154454_339448.log)
2025-11-07 18:44:54,341 [INFO] __main__: Detailed logs written to C:\Users\Fahri\OneDrive\Masaüstü\oyun\logs\run_20251107_154454_339448.log
2025-11-07 18:44:54,343 [INFO] fortress_director.codeaware.function_registry: Registering safe function: change_weather
2025-11-07 18:44:54,354 [INFO] fortress_director.codeaware.function_registry: Safe function 'change_weather' registered successfully.
2025-11-07 18:44:54,354 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_item
2025-11-07 18:44:54,354 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_item' registered successfully.
2025-11-07 18:44:54,354 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_npc
2025-11-07 18:44:54,354 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_npc' registered successfully.
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_logic
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_logic' registered successfully.
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_emotion
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_emotion' registered successfully.
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Registering safe function: raise_corruption
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Safe function 'raise_corruption' registered successfully.
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_turn
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_turn' registered successfully.
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Registering safe function: modify_resources
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Safe function 'modify_resources' registered successfully.
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_metric
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_metric' registered successfully.
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_room
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_room' registered successfully.
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Registering safe function: set_flag
2025-11-07 18:44:54,356 [INFO] fortress_director.codeaware.function_registry: Safe function 'set_flag' registered successfully.
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Registering safe function: clear_flag
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Safe function 'clear_flag' registered successfully.
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Registering safe function: set_trust
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Safe function 'set_trust' registered successfully.
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_trust
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_trust' registered successfully.
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Registering safe function: add_item_to_npc
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Safe function 'add_item_to_npc' registered successfully.
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Registering safe function: remove_item_from_npc
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Safe function 'remove_item_from_npc' registered successfully.
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Registering safe function: add_status
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Safe function 'add_status' registered successfully.
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Registering safe function: remove_status
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Safe function 'remove_status' registered successfully.
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_npc
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_npc' registered successfully.
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Registering safe function: despawn_npc
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Safe function 'despawn_npc' registered successfully.
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Registering safe function: set_time_of_day
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Safe function 'set_time_of_day' registered successfully.
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Registering safe function: set_weather_pattern
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Safe function 'set_weather_pattern' registered successfully.
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Registering safe function: trigger_environment_hazard
2025-11-07 18:44:54,358 [INFO] fortress_director.codeaware.function_registry: Safe function 'trigger_environment_hazard' registered successfully.
2025-11-07 18:44:54,359 [INFO] fortress_director.codeaware.function_registry: Registering safe function: reinforce_structure
2025-11-07 18:44:54,359 [INFO] fortress_director.codeaware.function_registry: Safe function 'reinforce_structure' registered successfully.
2025-11-07 18:44:54,359 [INFO] fortress_director.codeaware.function_registry: Registering safe function: repair_breach
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Safe function 'repair_breach' registered successfully.
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Registering safe function: set_watcher_route
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Safe function 'set_watcher_route' registered successfully.
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Registering safe function: schedule_npc_activity
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Safe function 'schedule_npc_activity' registered successfully.
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Registering safe function: spawn_patrol
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Safe function 'spawn_patrol' registered successfully.
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Registering safe function: resolve_combat
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Safe function 'resolve_combat' registered successfully.
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Registering safe function: transfer_item
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Safe function 'transfer_item' registered successfully.
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Registering safe function: adjust_stockpile
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Safe function 'adjust_stockpile' registered successfully.
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Registering safe function: open_trade_route
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Safe function 'open_trade_route' registered successfully.
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Registering safe function: close_trade_route
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Safe function 'close_trade_route' registered successfully.
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Registering safe function: queue_major_event
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Safe function 'queue_major_event' registered successfully.
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Registering safe function: advance_story_act
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Safe function 'advance_story_act' registered successfully.
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Registering safe function: lock_player_option
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Safe function 'lock_player_option' registered successfully.
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Registering safe function: move_and_take_item
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Safe function 'move_and_take_item' registered successfully.
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Registering safe function: patrol_and_report
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Safe function 'patrol_and_report' registered successfully.
2025-11-07 18:44:54,360 [INFO] fortress_director.codeaware.function_registry: Removing safe function: spawn_npc
2025-11-07 18:44:54,360 [INFO] fortress_director.orchestrator.orchestrator: Theme 'siege_default' disabled safe function 'spawn_npc'
2025-11-07 18:44:54,362 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5, 0.22 ms)
2025-11-07 18:44:54,362 [INFO] fortress_director.orchestrator.orchestrator: run_turn called (player_choice_id=__random__)
2025-11-07 18:44:54,362 [DEBUG] fortress_director.orchestrator.orchestrator: Resetting function validator and creating checkpoint: {'phase': 'turn_start', 'player_choice_id': '__random__'}
2025-11-07 18:44:54,362 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5, 0.21 ms)
2025-11-07 18:44:54,362 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=5, call=None)
2025-11-07 18:44:54,362 [INFO] fortress_director.orchestrator.orchestrator: Turn execution started.
2025-11-07 18:44:54,363 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5, 0.19 ms)
2025-11-07 18:44:54,363 [DEBUG] fortress_director.orchestrator.orchestrator: Pre-turn state snapshot: {"_anomaly_active_until": 7, "_director_guidance": {"flags_to_add": [], "flags_to_remove": [], "major_event": "force", "notes": "The campaign is progressing at a steady pace. No major events are needed for this turn.", "pacing": "steady", "risk_budget": 3}, "_director_notes": [{"note": "The campaign is progressing at a steady pace. No major events are needed for this turn.", "turn": 0}, {"note": "The campaign is moving at a steady pace. No major events are needed for this turn.", "turn": 1}, {"note": "The campaign is progressing at a steady pace. No major events are needed for this turn.", ...
2025-11-07 18:44:54,363 [DEBUG] fortress_director.utils.metrics_manager: MetricManager initialised with metrics: {'order': 51, 'morale': 50, 'resources': 46, 'knowledge': 55, 'corruption': 10, 'glitch': 56, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 18:44:54,363 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics at turn start: {'order': 51, 'morale': 50, 'resources': 46, 'knowledge': 55, 'corruption': 10, 'glitch': 56, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 18:44:54,363 [INFO] fortress_director.utils.glitch_manager: Resolving glitch (turn=6, seed=12345, current_glitch=56)
2025-11-07 18:44:54,363 [DEBUG] fortress_director.utils.glitch_manager: Metrics before glitch resolution: {'order': 51, 'morale': 50, 'resources': 46, 'knowledge': 55, 'corruption': 10, 'glitch': 56, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 18:44:54,363 [DEBUG] fortress_director.utils.metrics_manager: Applying bulk metric change: metric=resources, delta=-3, cause=glitch:major_anomaly
2025-11-07 18:44:54,363 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'resources': current=46, delta=-3, limits=(0, 120) (cause=glitch:major_anomaly)
2025-11-07 18:44:54,363 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'resources', 'delta': -3, 'value': 43, 'cause': 'glitch:major_anomaly'}
2025-11-07 18:44:54,363 [INFO] fortress_director.utils.metrics_manager: Metric 'resources' updated from 46 to 43 (cause=glitch:major_anomaly)
2025-11-07 18:44:54,363 [DEBUG] fortress_director.utils.metrics_manager: Applying bulk metric change: metric=knowledge, delta=-2, cause=glitch:major_anomaly
2025-11-07 18:44:54,363 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'knowledge': current=55, delta=-2, limits=(0, 100) (cause=glitch:major_anomaly)
2025-11-07 18:44:54,363 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'knowledge', 'delta': -2, 'value': 53, 'cause': 'glitch:major_anomaly'}
2025-11-07 18:44:54,363 [INFO] fortress_director.utils.metrics_manager: Metric 'knowledge' updated from 55 to 53 (cause=glitch:major_anomaly)
2025-11-07 18:44:54,363 [DEBUG] fortress_director.utils.metrics_manager: Applying bulk metric change: metric=glitch, delta=3, cause=glitch:major_anomaly
2025-11-07 18:44:54,363 [DEBUG] fortress_director.utils.metrics_manager: Glitch smoothing: requested delta=3, buffer=0, applied=3, leftover=0
2025-11-07 18:44:54,363 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=56, delta=3, limits=(0, 100) (cause=glitch:major_anomaly)
2025-11-07 18:44:54,363 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': 3, 'value': 59, 'cause': 'glitch:major_anomaly'}
2025-11-07 18:44:54,363 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 56 to 59 (cause=glitch:major_anomaly)
2025-11-07 18:44:54,363 [INFO] fortress_director.utils.glitch_manager: Glitch roll complete: roll=62, triggered_loss=False
2025-11-07 18:44:54,363 [DEBUG] fortress_director.utils.glitch_manager: Metrics after glitch resolution: {'order': 51, 'morale': 50, 'resources': 43, 'knowledge': 53, 'corruption': 10, 'glitch': 59, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 18:44:54,363 [DEBUG] fortress_director.utils.glitch_manager: Glitch effects applied: ['Major anomaly distorts the western wall segment.']
2025-11-07 18:44:54,365 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=62, triggered_loss=False
2025-11-07 18:44:54,365 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 51, 'morale': 50, 'resources': 43, 'knowledge': 53, 'corruption': 10, 'glitch': 59, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 18:44:54,365 [DEBUG] fortress_director.utils.metrics_manager: Glitch smoothing: requested delta=-1, buffer=0, applied=-1, leftover=0
2025-11-07 18:44:54,365 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'glitch': current=59, delta=-1, limits=(0, 100) (cause=turn_recovery)
2025-11-07 18:44:54,365 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'glitch', 'delta': -1, 'value': 58, 'cause': 'turn_recovery'}
2025-11-07 18:44:54,365 [INFO] fortress_director.utils.metrics_manager: Metric 'glitch' updated from 59 to 58 (cause=turn_recovery)
2025-11-07 18:44:54,365 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch recovery: {'order': 51, 'morale': 50, 'resources': 43, 'knowledge': 53, 'corruption': 10, 'glitch': 58, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 18:44:54,365 [INFO] fortress_director.orchestrator.orchestrator: Glitch resolution outcome: roll=62, triggered_loss=False
2025-11-07 18:44:54,365 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after glitch resolution: {'order': 51, 'morale': 50, 'resources': 43, 'knowledge': 53, 'corruption': 10, 'glitch': 58, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 18:44:54,366 [INFO] fortress_director.orchestrator.orchestrator: World context built.
2025-11-07 18:44:54,366 [DEBUG] fortress_director.orchestrator.orchestrator: World context payload: Turn 5 | Day 2 | Time dawn
Location: entrance
Objective: reinforce defenses
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}
Recent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger. As twilight deepens, he notices a faint glow in the distance. Suddenly, a discovery is made! (Moti...; The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squints to get a better look, you decide to approach the mysterious light. Suddenly, an inner gate buckles... Recent motifs: storm, loss, unknown_action
Recent major events: none
Relationship summary: Rhea trusts the player deeply
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 50, "resources": 43, "knowledge": 53, "corruption": 10, "glitch": 58, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}
2025-11-07 18:44:54,366 [INFO] fortress_director.orchestrator.orchestrator: Starting turn 5 in room entrance
2025-11-07 18:44:54,367 [DEBUG] fortress_director.orchestrator.orchestrator: World agent input: {"WORLD_CONTEXT": "Turn 5 | Day 2 | Time dawn\nLocation: entrance\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scannin...
2025-11-07 18:44:54,367 [INFO] fortress_director.orchestrator.orchestrator: Calling world_agent.describe...
2025-11-07 18:44:54,367 [INFO] fortress_director.agents.world_agent: WorldAgent.describe called with variables: {'WORLD_CONTEXT': 'Turn 5 | Day 2 | Time dawn\nLocation: entrance\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}\nRecent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger. As twilight deepens, he notices a faint glow in the distance. Suddenly, a discovery is made! (Moti...; The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squints to get a better look, you decide to approach the mysterious light. Suddenly, an inner gate buckles... Recent motifs: storm, loss, unknown_action\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 50, "resources": 43, "knowledge": 53, "corruption": 10, "glitch": 58, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'room': 'entrance', 'time': 'dawn', 'previous_atmosphere': 'Dawn hin mist veils over stone and mortar.', 'previous_sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.', 'world_lock_active': True, 'locked_constraint': {'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}, 'objective': 'reinforce defenses', 'available_functions': '["add_item_to_npc", "add_status", "adjust_emotion", "adjust_logic", "adjust_metric", "adjust_stockpile", "adjust_trust", "advance_story_act", "advance_turn", "change_weather", "clear_flag", "close_trade_route", "despawn_npc", "lock_player_option", "modify_resources", "move_and_take_item", "move_npc", "move_room", "open_trade_route", "patrol_and_report", "queue_major_event", "raise_corruption", "reinforce_structure", "remove_item_from_npc", "remove_status", "repair_breach", "resolve_combat", "schedule_npc_activity", "set_flag", "set_time_of_day", "set_trust", "set_watcher_route", "set_weather_pattern", "spawn_item", "spawn_patrol", "transfer_item", "trigger_environment_hazard"]'}
2025-11-07 18:44:54,368 [INFO] fortress_director.agents.world_agent: World lock active; preserving prior constraint with minor variation
2025-11-07 18:44:54,368 [INFO] fortress_director.orchestrator.orchestrator: World agent returned output.
2025-11-07 18:44:54,368 [DEBUG] fortress_director.orchestrator.orchestrator: World agent output: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}
2025-11-07 18:44:54,368 [DEBUG] fortress_director.orchestrator.orchestrator: Dramaturgy stage=build_up risk_delta=0 allow_major=False force_major=False
2025-11-07 18:44:54,368 [DEBUG] fortress_director.orchestrator.orchestrator: Director agent input: {"WORLD_CONTEXT": "Turn 5 | Day 2 | Time dawn\nLocation: entrance\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scannin...
2025-11-07 18:45:04,063 [INFO] fortress_director.orchestrator.orchestrator: Director agent returned output.
2025-11-07 18:45:04,063 [DEBUG] fortress_director.orchestrator.orchestrator: Director agent output: {"flags_to_add": [], "flags_to_remove": [], "major_event": "force", "notes": "The campaign is moving at a steady pace. No major events are needed for this turn.", "pacing": "steady", "risk_budget": 3}
2025-11-07 18:45:04,063 [INFO] fortress_director.orchestrator.orchestrator: Applied director guidance: pacing=steady, risk=3, major=force
2025-11-07 18:45:04,063 [DEBUG] fortress_director.orchestrator.orchestrator: Director note: The campaign is moving at a steady pace. No major events are needed for this turn.
2025-11-07 18:45:04,063 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent input: {"WORLD_CONTEXT": "Turn 5 | Day 2 | Time dawn\nLocation: entrance\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scannin...
2025-11-07 18:45:04,063 [INFO] fortress_director.orchestrator.orchestrator: Calling event_agent.generate...
2025-11-07 18:45:04,064 [INFO] fortress_director.agents.event_agent: EventAgent.generate called with variables: {'WORLD_CONTEXT': 'Turn 5 | Day 2 | Time dawn\nLocation: entrance\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}\nRecent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger. As twilight deepens, he notices a faint glow in the distance. Suddenly, a discovery is made! (Moti...; The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squints to get a better look, you decide to approach the mysterious light. Suddenly, an inner gate buckles... Recent motifs: storm, loss, unknown_action\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 50, "resources": 43, "knowledge": 53, "corruption": 10, "glitch": 58, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'day': 2, 'time': 'dawn', 'room': 'entrance', 'turn_index': 5, 'recent_events': 'The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger. As twilight deepens, he notices a faint glow in the distance. Suddenly, a discovery is made! (Moti...; The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squints to get a better look, you decide to approach the mysterious light. Suddenly, an inner gate buckles...', 'world_constraint_from_prev_turn': '{"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}', 'recent_motifs': 'storm, loss, unknown_action', 'lore_continuity_weight': 0, 'memory_layers': ["Turn 1: Ask the Shieldbearer about any recent threats to Lornhaven. -> ' the rewritten prompt: I find myself trapped within a labyrinthine mansion, its walls adorned with ...", 'Turn 2: Ask the Shieldbearer about any recent threats to Lornhaven. -> (Motif: storm)...', 'Turn 3: Ask the Shieldbearer about any recent threats to Lornhaven. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger...', "Memory summary: Turn 1: Ask the Shieldbearer about any recent threats to Lornhaven. -> ' the rewritten prompt: I find myself trapped within a labyrinthine mansion, its walls adorned with ... | Turn 2: Ask the Shieldb...", 'Turn 4: Approach the glowing light and investigate its source. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger...', 'Turn 5: Approach the glowing light and investigate its source. -> The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squint...'], 'judge_verdict': '{"consistent": true, "reason": "The content is consistent with established world, lore, and character logic. The Shieldbearer\'s actions align with his role as a defender at the entrance.", "soft_edit_policy": {"max_correction_per_turn": 0.15, "persist_window": 4}, "penalty_applied": "none"}', 'judge_feedback': {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The Shieldbearer's actions align with his role as a defender at the entrance.", 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}, 'continuity_weight': 0.0, 'skip_major': False, 'allow_major': True, 'metrics_snapshot': {'order': 51, 'morale': 50, 'resources': 43, 'knowledge': 53, 'corruption': 10, 'glitch': 58}, 'drama_mode': True, 'risk_budget': 3, 'flags': ['low_cloud_presence', 'explore', 'major_wall_alert', 'stage_build_up'], 'dramaturgy_stage': 'build_up', 'finale_stage_hint': None, 'director_guidance': {'pacing': 'steady', 'risk_budget': 3, 'major_event': 'force', 'notes': 'The campaign is moving at a steady pace. No major events are needed for this turn.', 'flags_to_add': [], 'flags_to_remove': []}, 'dramaturgy_directives': ['prioritise_structure_repairs', 'surface_npc_trust'], 'objective': 'reinforce defenses', 'available_functions': '["add_item_to_npc", "add_status", "adjust_emotion", "adjust_logic", "adjust_metric", "adjust_stockpile", "adjust_trust", "advance_story_act", "advance_turn", "change_weather", "clear_flag", "close_trade_route", "despawn_npc", "lock_player_option", "modify_resources", "move_and_take_item", "move_npc", "move_room", "open_trade_route", "patrol_and_report", "queue_major_event", "raise_corruption", "reinforce_structure", "remove_item_from_npc", "remove_status", "repair_breach", "resolve_combat", "schedule_npc_activity", "set_flag", "set_time_of_day", "set_trust", "set_watcher_route", "set_weather_pattern", "spawn_item", "spawn_patrol", "transfer_item", "trigger_environment_hazard"]', 'persistent_motif': 'loss'}
2025-11-07 18:45:04,064 [INFO] fortress_director.agents.event_agent: Injecting forced novelty/rare incident for turn 5
2025-11-07 18:45:51,225 [DEBUG] fortress_director.agents.event_agent: Model returned: {'scene': 'The Shieldbearer, squinting through the mist, watches as the mysterious light grows brighter. The once-solid inner gate now hangs precariously, its hinges twisted and broken.', 'options': [{'id': 'option1', 'text': 'Approach the damaged gate cautiously, searching for any signs of what caused it to buckle.', 'action_type': 'exploration'}, {'id': 'option2', 'text': 'Call out to Boris, requesting his assistance in reinforcing the weakened gate.', 'action_type': 'dialog/interaction'}, {'id': 'option3', 'text': 'Ignite your oil lamp and signal for help by waving it high above the entrance, hoping to attract any nearby patrols or guards.', 'action_type': 'defense'}], 'major_event': False, 'safe_functions': [{'name': 'change_weather', 'kwargs': {'atmosphere': 'mist thickens', 'sensory_details': 'The chill air carries the scent of rain on dry earth'}}], 'metric_delta': {}}
2025-11-07 18:45:51,225 [INFO] fortress_director.agents.event_agent: Forcing incident flag for turn 5
2025-11-07 18:45:51,225 [INFO] fortress_director.agents.event_agent: Normalized event output: {'scene': 'The Shieldbearer, squinting through the mist, watches as the mysterious light grows brighter. The once-solid inner gate now hangs precariously, its hinges twisted and broken. Suddenly, a trusted officer goes missing!', 'options': [{'id': 'option1', 'text': 'Approach the damaged gate cautiously, searching for any signs of what caused it to buckle.', 'action_type': 'exploration'}, {'id': 'option2', 'text': 'Call out to Boris, requesting his assistance in reinforcing the weakened gate. (focus: defense)', 'action_type': 'defense'}, {'id': 'option3', 'text': 'Ignite your oil lamp and signal for help by waving it high above the entrance, hoping to attract any nearby patrols or guards. (focus: trade)', 'action_type': 'trade'}, {'id': 'auto_item_use_1', 'text': 'Use an item from your inventory.', 'action_type': 'item_use'}], 'major_event': True, 'safe_functions': [{'name': 'change_weather', 'kwargs': {'atmosphere': 'mist thickens', 'sensory_details': 'The chill air carries the scent of rain on dry earth'}}], 'metric_delta': {}}
2025-11-07 18:45:51,225 [INFO] fortress_director.orchestrator.orchestrator: Event agent returned output.
2025-11-07 18:45:51,227 [DEBUG] fortress_director.orchestrator.orchestrator: Event agent output: {"major_event": true, "metric_delta": {}, "options": [{"action_type": "exploration", "id": "option1", "text": "Approach the damaged gate cautiously, searching for any signs of what caused it to buckle."}, {"action_type": "defense", "id": "option2", "text": "Call out to Boris, requesting his assistance in reinforcing the weakened gate. (focus: defense)"}, {"action_type": "trade", "id": "option3", "text": "Ignite your oil lamp and signal for help by waving it high above the entrance, hoping to attract any nearby patrols or guards. (focus: trade)"}, {"action_type": "item_use", "id": "auto_item...
2025-11-07 18:45:51,227 [INFO] fortress_director.agents.creativity_agent: CreativityAgent.enrich_event called (turn=6)
2025-11-07 18:45:51,227 [DEBUG] fortress_director.agents.creativity_agent: CreativityAgent LLM prompt_vars: {'scene': 'The Shieldbearer, squinting through the mist, watches as the mysterious light grows brighter. The once-solid inner gate now hangs precariously, its hinges twisted and broken. Suddenly, a trusted officer goes missing!', 'options': "[{'id': 'option1', 'text': 'Approach the damaged gate cautiously, searching for any signs of what caused it to buckle.', 'action_type': 'exploration'}, {'id': 'option2', 'text': 'Call out to Boris, requesting his assistance in reinforcing the weakened gate. (focus: defense)', 'action_type': 'defense'}, {'id': 'option3', 'text': 'Ignite your oil lamp and signal for help by waving it high above the entrance, hoping to attract any nearby patrols or guards. (focus: trade)', 'action_type': 'trade'}, {'id': 'auto_item_use_1', 'text': 'Use an item from your inventory.', 'action_type': 'item_use'}]", 'turn': 6}
2025-11-07 18:46:01,364 [INFO] fortress_director.agents.creativity_agent: CreativityAgent LLM event rewrite applied.
2025-11-07 18:46:01,364 [WARNING] fortress_director.agents.creativity_agent: CreativityAgent LLM returned empty/invalid or meta-like string.
2025-11-07 18:46:01,364 [DEBUG] fortress_director.agents.creativity_agent: CreativityAgent motif decision interval=True force_sandbox=False roll=0.450 prob=0.350 inject=True
2025-11-07 18:46:01,364 [INFO] fortress_director.agents.creativity_agent: CreativityAgent injected motif: shadows
2025-11-07 18:46:01,364 [INFO] fortress_director.orchestrator.orchestrator: CreativityAgent enriched event: {'scene': "The Shieldbearer’s eyes flickered with an unsettling intensity as the light's tendrils snaked through the mist. It pulsed with a sickly glow, casting grotesque shadows upon the desolate cityscape. The gate, once steadfast and gleaming obsidian, hung limp and broken, its hinges twisted and contorted like a wounded creature. A shiver ran down the Shieldbearer’s spine, a mixture of primal fear and morbid curiosity pulsing through his veins. He knew that he had to investigate, that this anomaly demanded answers. (Motif: shadows)", 'options': [{'id': 'option1', 'text': 'Approach the damaged gate cautiously, searching for any signs of what caused it to buckle.', 'action_type': 'exploration'}, {'id': 'option2', 'text': 'Call out to Boris, requesting his assistance in reinforcing the weakened gate. (focus: defense)', 'action_type': 'defense'}, {'id': 'option3', 'text': 'Ignite your oil lamp and signal for help by waving it high above the entrance, hoping to attract any nearby patrols or guards. (focus: trade)', 'action_type': 'trade'}, {'id': 'auto_item_use_1', 'text': 'Use an item from your inventory.', 'action_type': 'item_use'}], 'major_event': True, 'safe_functions': [{'name': 'change_weather', 'kwargs': {'atmosphere': 'mist thickens', 'sensory_details': 'The chill air carries the scent of rain on dry earth'}}], 'metric_delta': {}, 'motif_injected': 'shadows', 'creative_persist_for': 4, 'recent_motifs': ['shadows'], 'motif_persist_for': 5}
2025-11-07 18:46:01,364 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-11-07 18:46:12,445 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'coherence': 95, 'integrity': 87, 'tone_alignment': 100, 'penalty': 'none', 'reason': 'The content follows established world physics, character logic, and narrative consistency. The scene is well-structured with a clear objective and logical progression of events.', 'suggested_safe_functions': [{'name': 'change_weather', 'kwargs': {'atmosphere': 'mist thickens', 'sensory_details': 'The chill air carries the scent of rain on dry earth'}}, {'name': 'move_npc', 'kwargs': {'npc_id': 'Boris', 'destination': 'east_wall'}}]}
2025-11-07 18:46:12,445 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'coherence': 95, 'integrity': 87, 'tone_alignment': 100, 'penalty': 'none', 'reason': 'The content follows established world physics, character logic, and narrative consistency. The scene is well-structured with a clear objective and logical progression of events.', 'suggested_safe_functions': [{'name': 'change_weather', 'kwargs': {'atmosphere': 'mist thickens', 'sensory_details': 'The chill air carries the scent of rain on dry earth'}}, {'name': 'move_npc', 'kwargs': {'npc_id': 'Boris', 'destination': 'east_wall'}}]}
2025-11-07 18:46:12,445 [INFO] fortress_director.orchestrator.orchestrator: Creative persist window extended to turn 9
2025-11-07 18:46:12,445 [INFO] fortress_director.orchestrator.orchestrator: Using previous judge verdict (turn 5)
2025-11-07 18:46:12,445 [INFO] fortress_director.orchestrator.orchestrator: World lock engaged until turn 8 with current constraint
2025-11-07 18:46:12,446 [INFO] fortress_director.orchestrator.orchestrator: Resolving player choice...
2025-11-07 18:46:12,446 [INFO] fortress_director.orchestrator.orchestrator: Player choice resolved: {'id': 'option1', 'text': 'Approach the damaged gate cautiously, searching for any signs of what caused it to buckle.', 'action_type': 'exploration'}
2025-11-07 18:46:12,446 [DEBUG] fortress_director.orchestrator.orchestrator: Player choice resolved: {"action_type": "exploration", "id": "option1", "text": "Approach the damaged gate cautiously, searching for any signs of what caused it to buckle."}
2025-11-07 18:46:12,446 [INFO] fortress_director.orchestrator.orchestrator: Applying dynamic metrics for action_type 'exploration': {'knowledge': 2, 'resources': 1, 'morale': -1}
2025-11-07 18:46:12,446 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'knowledge': current=53, delta=2, limits=(0, 100) (cause=action_exploration)
2025-11-07 18:46:12,446 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'knowledge', 'delta': 2, 'value': 55, 'cause': 'action_exploration'}
2025-11-07 18:46:12,446 [INFO] fortress_director.utils.metrics_manager: Metric 'knowledge' updated from 53 to 55 (cause=action_exploration)
2025-11-07 18:46:12,446 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'resources': current=43, delta=1, limits=(0, 120) (cause=action_exploration)
2025-11-07 18:46:12,446 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'resources', 'delta': 1, 'value': 44, 'cause': 'action_exploration'}
2025-11-07 18:46:12,447 [INFO] fortress_director.utils.metrics_manager: Metric 'resources' updated from 43 to 44 (cause=action_exploration)
2025-11-07 18:46:12,447 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=50, delta=-1, limits=(0, 100) (cause=action_exploration)
2025-11-07 18:46:12,447 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': -1, 'value': 49, 'cause': 'action_exploration'}
2025-11-07 18:46:12,447 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 50 to 49 (cause=action_exploration)
2025-11-07 18:46:12,447 [DEBUG] fortress_director.orchestrator.orchestrator: Metrics after dynamic changes: {'order': 51, 'morale': 49, 'resources': 44, 'knowledge': 55, 'corruption': 10, 'glitch': 58, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}
2025-11-07 18:46:12,447 [INFO] fortress_director.orchestrator.orchestrator: Action consequence: Your discovery brings new resources but tests village resolve.
2025-11-07 18:46:12,447 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent input: {"WORLD_CONTEXT": "Turn 5 | Day 2 | Time dawn\nLocation: entrance\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {\"atmosphere\": \"Dawn hin mist veils over stone and mortar.\", \"sensory_details\": \"The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.\"}\nRecent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scannin...
2025-11-07 18:46:12,447 [INFO] fortress_director.orchestrator.orchestrator: Calling character_agent.react...
2025-11-07 18:46:12,447 [INFO] fortress_director.agents.character_agent: CharacterAgent.react called with variables: {'WORLD_CONTEXT': 'Turn 5 | Day 2 | Time dawn\nLocation: entrance\nObjective: reinforce defenses\nPlayer: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield\nWorld constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}\nRecent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger. As twilight deepens, he notices a faint glow in the distance. Suddenly, a discovery is made! (Moti...; The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squints to get a better look, you decide to approach the mysterious light. Suddenly, an inner gate buckles... Recent motifs: storm, loss, unknown_action\nRecent major events: none\nRelationship summary: Rhea trusts the player deeply\nCharacter summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 50, "resources": 43, "knowledge": 53, "corruption": 10, "glitch": 58, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}', 'scene_short': "The Shieldbearer eyes flickered with an unsettling intensity as the light' tendrils snaked through the mist. It pulsed with a sickly glow, casting grotesque shadows upon the desolate cityscape. The gate, once steadfast and gleaming obsidian, hung limp and broken, its hinges twisted and contorted like a wounded creature. A shiver ran down the Shieldbearer spine, a mixture of primal fear and morbid curiosity pulsing through his veins. He knew that he had to investigate, that this anomaly demanded answers. (Motif: shadows)", 'player_choice': 'Approach the damaged gate cautiously, searching for any signs of what caused it to buckle.', 'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.', 'char_brief': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary_from_state': 'Rhea trusts the player deeply', 'player_inventory_brief': 'oil lamp, patched shield', 'memory_layers': ["Turn 1: Ask the Shieldbearer about any recent threats to Lornhaven. -> ' the rewritten prompt: I find myself trapped within a labyrinthine mansion, its walls adorned with ...", 'Turn 2: Ask the Shieldbearer about any recent threats to Lornhaven. -> (Motif: storm)...', 'Turn 3: Ask the Shieldbearer about any recent threats to Lornhaven. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger...', "Memory summary: Turn 1: Ask the Shieldbearer about any recent threats to Lornhaven. -> ' the rewritten prompt: I find myself trapped within a labyrinthine mansion, its walls adorned with ... | Turn 2: Ask the Shieldb...", 'Turn 4: Approach the glowing light and investigate its source. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger...', 'Turn 5: Approach the glowing light and investigate its source. -> The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squint...'], 'emotional_memory': [{'turn': 0, 'name': 'Rhea', 'intent': 'observe', 'speech': 'I stand vigilant, my senses alert for any sign of danger.'}, {'turn': 0, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 0, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 0, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 0, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 1, 'name': 'Rhea', 'intent': 'observe', 'speech': 'I stand vigilant, my senses alert for any sign of danger. The storm rages on, a symphony of wind and rain.'}, {'turn': 1, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 1, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 1, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 1, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 2, 'name': 'Rhea', 'intent': 'observe', 'speech': 'The shadows lengthen, whispering secrets I can barely decipher. I stand guard, waiting for any sign of movement.'}, {'turn': 2, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 2, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 2, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 2, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 3, 'name': 'Rhea', 'intent': 'defend', 'speech': 'Approach the glowing light and investigate its source.'}, {'turn': 4, 'name': 'Rhea', 'intent': 'observe', 'speech': "I notice a faint glow emanating from the distant light source. It's as if something is hidden there, waiting to be discovered."}, {'turn': 4, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 4, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 4, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 4, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}], 'recent_events': 'The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger. As twilight deepens, he notices a faint glow in the distance. Suddenly, a discovery is made! (Moti...; The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squints to get a better look, you decide to approach the mysterious light. Suddenly, an inner gate buckles...', 'last_major_event': "The Shieldbearer eyes flickered with an unsettling intensity as the light' tendrils snaked through the mist. It pulsed with a sickly glow, casting grotesque shadows upon the desolate cityscape. The gate, once steadfast and gleaming obsidian, hung limp and broken, its hinges twisted and contorted like a wounded creature. A shiver ran down the Shieldbearer spine, a mixture of primal fear and morbid curiosity pulsing through his veins. He knew that he had to investigate, that this anomaly demanded answers. (Motif: shadows)", 'metrics': {'order': 51, 'morale': 49, 'resources': 44, 'knowledge': 55, 'corruption': 10, 'glitch': 58}}
2025-11-07 18:46:21,863 [DEBUG] fortress_director.agents.character_agent: Model returned: {'name': 'Rhea', 'intent': 'vigilance', 'action': 'stand_watch', 'speech': 'I stand watch, my senses alert for any sign of danger.', 'effects': {'trust_delta': -1}}
2025-11-07 18:46:21,863 [INFO] fortress_director.agents.character_agent: Normalized output (list): [{'name': 'Rhea', 'intent': 'vigilance', 'action': 'stand_watch', 'speech': 'I stand watch, my senses alert for any sign of danger.', 'effects': {'trust_delta': -1}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'observe', 'action': 'Autonomously performs observe action.', 'speech': 'Rhea shifts tactics with a observe maneuver.', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': 'Boris shifts tactics with a assist maneuver.', 'effects': {}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': 'Rhea shifts tactics with a command maneuver.', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': 'Boris shifts tactics with a plan maneuver.', 'effects': {}, 'safe_functions': []}]
2025-11-07 18:46:21,864 [INFO] fortress_director.orchestrator.orchestrator: Character agent returned output.
2025-11-07 18:46:21,864 [DEBUG] fortress_director.orchestrator.orchestrator: Character agent output: [{"action": "stand_watch", "effects": {"trust_delta": -1}, "intent": "vigilance", "name": "Rhea", "safe_functions": [], "speech": "I stand watch, my senses alert for any sign of danger."}, {"action": "Autonomously performs observe action.", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "Rhea shifts tactics with a observe maneuver."}, {"action": "Autonomously performs assist action.", "effects": {}, "intent": "assist", "name": "Boris", "safe_functions": [], "speech": "Boris shifts tactics with a assist maneuver."}, {"action": "Autonomously performs comma...
2025-11-07 18:46:21,864 [INFO] fortress_director.orchestrator.orchestrator: Injecting major event effect...
2025-11-07 18:46:21,864 [INFO] fortress_director.orchestrator.orchestrator: Major event effect injected.
2025-11-07 18:46:21,864 [DEBUG] fortress_director.orchestrator.orchestrator: Major event effect applied: {"applied_flag": "major_wall_alert", "applied_to": "Rhea", "status_change": {"duration": 3, "status": "tense_watch", "target": "Rhea"}}
2025-11-07 18:46:21,864 [INFO] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine...
2025-11-07 18:46:21,864 [DEBUG] fortress_director.orchestrator.orchestrator: Submitting reactions to rules engine: [{"action": "stand_watch", "effects": {"flag_set": ["major_wall_alert"], "status_change": {"duration": 3, "status": "tense_watch", "target": "Rhea"}, "trust_delta": -1}, "intent": "vigilance", "name": "Rhea", "safe_functions": [], "speech": "I stand watch, my senses alert for any sign of danger."}, {"action": "Autonomously performs observe action.", "effects": {}, "intent": "observe", "name": "Rhea", "safe_functions": [], "speech": "Rhea shifts tactics with a observe maneuver."}, {"action": "Autonomously performs assist action.", "effects": {}, "intent": "assist", "name": "Boris", "safe_fun...
2025-11-07 18:46:21,864 [INFO] fortress_director.rules.rules_engine: RulesEngine.process called.
2025-11-07 18:46:21,864 [DEBUG] fortress_director.rules.rules_engine: Input state: {'schema_version': 2, 'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 5, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_cloud_presence', 'explore', 'major_wall_alert', 'stage_build_up'], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 5, 'day': 2, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': ['The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.', 'The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger. As twilight deepens, he notices a faint glow in the distance. Suddenly, a discovery is made! (Moti...', 'The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squints to get a better look, you decide to approach the mysterious light. Suddenly, an inner gate buckles...'], 'recent_motifs': ['storm', 'loss', 'unknown_action', 'shadows', 'shadows'], 'recent_world_atmospheres': [], 'world_constraint_from_prev_turn': {'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player deeply', 'metrics': {'order': 51, 'morale': 49, 'resources': 44, 'knowledge': 55, 'corruption': 10, 'glitch': 58, 'risk_applied_total': 0, 'major_flag_set': False, 'major_events_triggered': 0, 'major_event_last_turn': None}, 'npc_trust': {'Rhea': 2}, 'environment_hazards': [], 'weather_pattern': {'pattern': 'overcast', 'remaining': 0, 'lock_until': 0}, 'structures': {'western_wall': {'durability': 80, 'max_durability': 100, 'status': 'stable'}, 'inner_gate': {'durability': 70, 'max_durability': 100, 'status': 'stable'}, 'watchtower': {'durability': 60, 'max_durability': 80, 'status': 'stable'}, 'granary': {'durability': 55, 'max_durability': 70, 'status': 'stable'}}, 'npc_schedule': {}, 'patrols': {}, 'combat_log': [], 'item_transfers': [], 'stockpiles': {'food': 120, 'wood': 60, 'ore': 40}, 'stockpile_log': [], 'trade_routes': {}, 'trade_route_history': [], 'scheduled_events': [], 'story_progress': {'act': 'build_up', 'progress': 0.0, 'act_history': []}, 'timeline': [], 'hazard_cooldowns': {}, 'schema_notes': {}, 'locked_options': {}, '_drama_window': [[50, 49, 40, 45, 50], [49, 51, 41, 47, 51], [50, 52, 42, 49, 53], [51, 53, 43, 51, 55], [50, 51, 45, 53, 56], [51, 50, 43, 53, 58]], '_anomaly_active_until': 9, '_world_lock_until': 8, '_high_volatility_mode': True, 'last_weather_change_turn': None, '_glitch_buffer': 0, '_director_pacing': 'steady', '_director_notes': [{'turn': 0, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 1, 'note': 'The campaign is moving at a steady pace. No major events are needed for this turn.'}, {'turn': 2, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 3, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 4, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 5, 'note': 'The campaign is moving at a steady pace. No major events are needed for this turn.'}], '_director_guidance': {'pacing': 'steady', 'risk_budget': 3, 'major_event': 'force', 'notes': 'The campaign is moving at a steady pace. No major events are needed for this turn.', 'flags_to_add': [], 'flags_to_remove': []}, 'previous_judge_verdict': {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The Shieldbearer's actions align with his role as a defender at the entrance.", 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}, 'player_choice_history': ['dialogue', 'dialogue', 'dialogue', 'exploration'], 'summary_text': 'A major event shakes the village. Glitch level rises.', 'emotional_memory': [{'turn': 0, 'name': 'Rhea', 'intent': 'observe', 'speech': 'I stand vigilant, my senses alert for any sign of danger.'}, {'turn': 0, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 0, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 0, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 0, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 1, 'name': 'Rhea', 'intent': 'observe', 'speech': 'I stand vigilant, my senses alert for any sign of danger. The storm rages on, a symphony of wind and rain.'}, {'turn': 1, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 1, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 1, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 1, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 2, 'name': 'Rhea', 'intent': 'observe', 'speech': 'The shadows lengthen, whispering secrets I can barely decipher. I stand guard, waiting for any sign of movement.'}, {'turn': 2, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 2, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 2, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 2, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 3, 'name': 'Rhea', 'intent': 'defend', 'speech': 'Approach the glowing light and investigate its source.'}, {'turn': 4, 'name': 'Rhea', 'intent': 'observe', 'speech': "I notice a faint glow emanating from the distant light source. It's as if something is hidden there, waiting to be discovered."}, {'turn': 4, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 4, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 4, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 4, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}], 'memory_short': ["Turn 1: Ask the Shieldbearer about any recent threats to Lornhaven. -> ' the rewritten prompt: I find myself trapped within a labyrinthine mansion, its walls adorned with ...", 'Turn 2: Ask the Shieldbearer about any recent threats to Lornhaven. -> (Motif: storm)...', 'Turn 3: Ask the Shieldbearer about any recent threats to Lornhaven. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger...', "Memory summary: Turn 1: Ask the Shieldbearer about any recent threats to Lornhaven. -> ' the rewritten prompt: I find myself trapped within a labyrinthine mansion, its walls adorned with ... | Turn 2: Ask the Shieldb...", 'Turn 4: Approach the glowing light and investigate its source. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger...', 'Turn 5: Approach the glowing light and investigate its source. -> The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squint...'], 'memory_long': ['Turn 5: Major event triggered (major_wall_alert)'], 'status_effects': [{'target': 'Rhea', 'status': 'tense_watch', 'duration': 2}], 'persistent_motif': {'motif': 'shadows', 'remaining': 5}, 'last_major_event_turn': 5, 'world_constraint': {'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}, 'major_events_triggered': 1, 'major_event_last_turn': 5, '_dramaturgy_state': {'stage': 'build_up', 'history': [{'stage': 'build_up', 'turn': 5}], 'last_turn': 5, 'major_events': 0, 'last_major_turn': 5, 'risk_delta': 0, 'allow_major': False, 'force_major': False, 'directives': ['prioritise_structure_repairs', 'surface_npc_trust'], 'finale_hint': None}, '_dramaturgy_directives': ['prioritise_structure_repairs', 'surface_npc_trust']}
2025-11-07 18:46:21,864 [DEBUG] fortress_director.rules.rules_engine: Character events: [{'name': 'Rhea', 'intent': 'vigilance', 'action': 'stand_watch', 'speech': 'I stand watch, my senses alert for any sign of danger.', 'effects': {'trust_delta': -1, 'flag_set': ['major_wall_alert'], 'status_change': {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'observe', 'action': 'Autonomously performs observe action.', 'speech': 'Rhea shifts tactics with a observe maneuver.', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': 'Boris shifts tactics with a assist maneuver.', 'effects': {}, 'safe_functions': []}, {'name': 'Rhea', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': 'Rhea shifts tactics with a command maneuver.', 'effects': {}, 'safe_functions': []}, {'name': 'Boris', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': 'Boris shifts tactics with a plan maneuver.', 'effects': {}, 'safe_functions': []}]
2025-11-07 18:46:21,864 [DEBUG] fortress_director.rules.rules_engine: World context: Turn 5 | Day 2 | Time dawn
Location: entrance
Objective: reinforce defenses
Player: The Shieldbearer — A weary defender holding the western wall. Inventory: oil lamp, patched shield
World constraint: {"atmosphere": "Dawn hin mist veils over stone and mortar.", "sensory_details": "The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm."}
Recent events: The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.; The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger. As twilight deepens, he notices a faint glow in the distance. Suddenly, a discovery is made! (Moti...; The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squints to get a better look, you decide to approach the mysterious light. Suddenly, an inner gate buckles... Recent motifs: storm, loss, unknown_action
Recent major events: none
Relationship summary: Rhea trusts the player deeply
Character summary: Rhea is loyal but impulsive; Boris is cautious and calculating. Metrics: {"order": 51, "morale": 50, "resources": 43, "knowledge": 53, "corruption": 10, "glitch": 58, "risk_applied_total": 0, "major_flag_set": false, "major_events_triggered": 0, "major_event_last_turn": null}, scene: The Shieldbearer eyes flickered with an unsettling intensity as the light' tendrils snaked through the mist. It pulsed with a sickly glow, casting grotesque shadows upon the desolate cityscape. The gate, once steadfast and gleaming obsidian, hung limp and broken, its hinges twisted and contorted like a wounded creature. A shiver ran down the Shieldbearer spine, a mixture of primal fear and morbid curiosity pulsing through his veins. He knew that he had to investigate, that this anomaly demanded answers. (Motif: shadows), player_choice: {'id': 'option1', 'text': 'Approach the damaged gate cautiously, searching for any signs of what caused it to buckle.', 'action_type': 'exploration'}
2025-11-07 18:46:21,864 [INFO] fortress_director.rules.rules_engine: RulesEngine._validate_tier_one called.
2025-11-07 18:46:21,864 [DEBUG] fortress_director.rules.rules_engine: Validating character event 0: {'name': 'Rhea', 'intent': 'vigilance', 'action': 'stand_watch', 'speech': 'I stand watch, my senses alert for any sign of danger.', 'effects': {'trust_delta': -1, 'flag_set': ['major_wall_alert'], 'status_change': {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}}, 'safe_functions': []}
2025-11-07 18:46:21,864 [DEBUG] fortress_director.rules.rules_engine: Validating character event 1: {'name': 'Rhea', 'intent': 'observe', 'action': 'Autonomously performs observe action.', 'speech': 'Rhea shifts tactics with a observe maneuver.', 'effects': {}, 'safe_functions': []}
2025-11-07 18:46:21,864 [DEBUG] fortress_director.rules.rules_engine: Validating character event 2: {'name': 'Boris', 'intent': 'assist', 'action': 'Autonomously performs assist action.', 'speech': 'Boris shifts tactics with a assist maneuver.', 'effects': {}, 'safe_functions': []}
2025-11-07 18:46:21,864 [DEBUG] fortress_director.rules.rules_engine: Validating character event 3: {'name': 'Rhea', 'intent': 'command', 'action': 'Autonomously performs command action.', 'speech': 'Rhea shifts tactics with a command maneuver.', 'effects': {}, 'safe_functions': []}
2025-11-07 18:46:21,864 [DEBUG] fortress_director.rules.rules_engine: Validating character event 4: {'name': 'Boris', 'intent': 'plan', 'action': 'Autonomously performs plan action.', 'speech': 'Boris shifts tactics with a plan maneuver.', 'effects': {}, 'safe_functions': []}
2025-11-07 18:46:21,864 [INFO] fortress_director.rules.rules_engine: Tier one validation passed.
2025-11-07 18:46:21,864 [DEBUG] fortress_director.agents.judge_agent: Judge stochastic disagreement roll=0.102 vs prob=0.034 (rep=0, atmos=0, motif=False)
2025-11-07 18:46:21,864 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-11-07 18:46:31,330 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'coherence': 95, 'integrity': 87, 'tone_alignment': 90, 'penalty': 'none', 'reason': "The content follows established world physics, character logic, and narrative consistency. The scene is coherent with the previous events and motifs. The player's choice to approach the damaged gate cautiously aligns with the established atmosphere of twilight and danger. The tone matches the established atmosphere and emotional register.", 'suggested_safe_functions': []}
2025-11-07 18:46:31,330 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'coherence': 95, 'integrity': 87, 'tone_alignment': 90, 'penalty': 'none', 'reason': "The content follows established world physics, character logic, and narrative consistency. The scene is coherent with the previous events and motifs. The player's choice to approach the damaged gate cautiously aligns with the established atmosphere of twilight and danger. The tone matches the established atmosphere and emotional register.", 'suggested_safe_functions': []}
2025-11-07 18:46:31,330 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'coherence': 95, 'integrity': 87, 'tone_alignment': 90, 'penalty': 'none', 'reason': "The content follows established world physics, character logic, and narrative consistency. The scene is coherent with the previous events and motifs. The player's choice to approach the damaged gate cautiously aligns with the established atmosphere of twilight and danger. The tone matches the established atmosphere and emotional register.", 'suggested_safe_functions': [], 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}
2025-11-07 18:46:31,330 [DEBUG] fortress_director.agents.judge_agent: Judge stochastic disagreement roll=0.871 vs prob=0.034 (rep=0, atmos=0, motif=False)
2025-11-07 18:46:31,330 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-11-07 18:46:36,049 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'coherence': 95, 'integrity': 87, 'tone_alignment': 90, 'penalty': 'none', 'reason': "The content is consistent with established world physics, character logic, and narrative consistency. The scene and player choice are well-integrated into the story's environment and progression.", 'suggested_safe_functions': []}
2025-11-07 18:46:36,049 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'coherence': 95, 'integrity': 87, 'tone_alignment': 90, 'penalty': 'none', 'reason': "The content is consistent with established world physics, character logic, and narrative consistency. The scene and player choice are well-integrated into the story's environment and progression.", 'suggested_safe_functions': []}
2025-11-07 18:46:36,049 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'coherence': 95, 'integrity': 87, 'tone_alignment': 90, 'penalty': 'none', 'reason': "The content is consistent with established world physics, character logic, and narrative consistency. The scene and player choice are well-integrated into the story's environment and progression.", 'suggested_safe_functions': [], 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}
2025-11-07 18:46:36,049 [DEBUG] fortress_director.agents.judge_agent: Judge stochastic disagreement roll=0.561 vs prob=0.034 (rep=0, atmos=0, motif=False)
2025-11-07 18:46:36,049 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-11-07 18:46:42,216 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'coherence': 95, 'integrity': 85, 'tone_alignment': 100, 'penalty': 'none', 'reason': "The content follows established world physics, character logic, and narrative consistency. The scene is well-structured with a clear objective and a logical progression of events. The player's choice to approach the damaged gate cautiously aligns with the established atmosphere and tone.", 'suggested_safe_functions': []}
2025-11-07 18:46:42,216 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'coherence': 95, 'integrity': 85, 'tone_alignment': 100, 'penalty': 'none', 'reason': "The content follows established world physics, character logic, and narrative consistency. The scene is well-structured with a clear objective and a logical progression of events. The player's choice to approach the damaged gate cautiously aligns with the established atmosphere and tone.", 'suggested_safe_functions': []}
2025-11-07 18:46:42,216 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Boris: {'consistent': True, 'coherence': 95, 'integrity': 85, 'tone_alignment': 100, 'penalty': 'none', 'reason': "The content follows established world physics, character logic, and narrative consistency. The scene is well-structured with a clear objective and a logical progression of events. The player's choice to approach the damaged gate cautiously aligns with the established atmosphere and tone.", 'suggested_safe_functions': [], 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}
2025-11-07 18:46:42,216 [DEBUG] fortress_director.agents.judge_agent: Judge stochastic disagreement roll=0.249 vs prob=0.034 (rep=0, atmos=0, motif=False)
2025-11-07 18:46:42,216 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-11-07 18:46:47,453 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'coherence': 95, 'integrity': 87, 'tone_alignment': 100, 'penalty': 'none', 'reason': "The content follows established world physics, character logic, and narrative consistency. The scene is coherent with the previous events and motifs. The player's choice to explore the damaged gate is logical and maintains the story's momentum. The tone matches the established atmosphere and emotional register.", 'suggested_safe_functions': []}
2025-11-07 18:46:47,453 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'coherence': 95, 'integrity': 87, 'tone_alignment': 100, 'penalty': 'none', 'reason': "The content follows established world physics, character logic, and narrative consistency. The scene is coherent with the previous events and motifs. The player's choice to explore the damaged gate is logical and maintains the story's momentum. The tone matches the established atmosphere and emotional register.", 'suggested_safe_functions': []}
2025-11-07 18:46:47,453 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Rhea: {'consistent': True, 'coherence': 95, 'integrity': 87, 'tone_alignment': 100, 'penalty': 'none', 'reason': "The content follows established world physics, character logic, and narrative consistency. The scene is coherent with the previous events and motifs. The player's choice to explore the damaged gate is logical and maintains the story's momentum. The tone matches the established atmosphere and emotional register.", 'suggested_safe_functions': [], 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}
2025-11-07 18:46:47,453 [DEBUG] fortress_director.agents.judge_agent: Judge stochastic disagreement roll=0.077 vs prob=0.034 (rep=0, atmos=0, motif=False)
2025-11-07 18:46:47,453 [INFO] fortress_director.agents.judge_agent: JudgeAgent.evaluate called with variables
2025-11-07 18:46:54,383 [DEBUG] fortress_director.agents.judge_agent: Model returned: {'consistent': True, 'coherence': 95, 'integrity': 85, 'tone_alignment': 100, 'penalty': 'none', 'reason': "The content follows established world physics, character logic, and narrative consistency. The scene is coherent with the previous events and motifs. The player's choice to explore the damaged gate is logical and maintains the story's tone. No major violations or penalties detected.", 'suggested_safe_functions': []}
2025-11-07 18:46:54,383 [INFO] fortress_director.agents.judge_agent: Judge verdict: {'consistent': True, 'coherence': 95, 'integrity': 85, 'tone_alignment': 100, 'penalty': 'none', 'reason': "The content follows established world physics, character logic, and narrative consistency. The scene is coherent with the previous events and motifs. The player's choice to explore the damaged gate is logical and maintains the story's tone. No major violations or penalties detected.", 'suggested_safe_functions': []}
2025-11-07 18:46:54,383 [DEBUG] fortress_director.rules.rules_engine: Judge verdict for Boris: {'consistent': True, 'coherence': 95, 'integrity': 85, 'tone_alignment': 100, 'penalty': 'none', 'reason': "The content follows established world physics, character logic, and narrative consistency. The scene is coherent with the previous events and motifs. The player's choice to explore the damaged gate is logical and maintains the story's tone. No major violations or penalties detected.", 'suggested_safe_functions': [], 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}
2025-11-07 18:46:54,383 [INFO] fortress_director.rules.rules_engine: Tier two validation passed with penalties: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-11-07 18:46:54,383 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {'trust_delta': -1, 'flag_set': ['major_wall_alert'], 'status_change': {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}}
2025-11-07 18:46:54,384 [INFO] fortress_director.rules.rules_engine: Trust updated for Rhea: 2 -> 1 (delta: -1)
2025-11-07 18:46:54,384 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-11-07 18:46:54,384 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Boris: {}
2025-11-07 18:46:54,384 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Rhea: {}
2025-11-07 18:46:54,384 [DEBUG] fortress_director.rules.rules_engine: Applying effects for Boris: {}
2025-11-07 18:46:54,384 [INFO] fortress_director.rules.rules_engine: Choice impact applied: knowledge +1 (action_type=exploration)
2025-11-07 18:46:54,384 [INFO] fortress_director.rules.rules_engine: Choice impact applied: resources +1 (action_type=exploration)
2025-11-07 18:46:54,384 [INFO] fortress_director.rules.rules_engine: Major event: glitch increased by 2
2025-11-07 18:46:54,384 [INFO] fortress_director.rules.rules_engine: Relationship summary updated: Rhea trusts the player
2025-11-07 18:46:54,385 [INFO] fortress_director.rules.rules_engine: Judge penalties applied: {'glitch_penalty': 0, 'morale_penalty': 0, 'resources_penalty': 0, 'corruption_penalty': 0, 'order_penalty': 0}
2025-11-07 18:46:54,385 [INFO] fortress_director.rules.rules_engine: State updated by rules engine.
2025-11-07 18:46:54,385 [DEBUG] fortress_director.rules.rules_engine: Output state: {'schema_version': 2, 'campaign_id': 'default_campaign', 'turn_limit': 30, 'current_turn': 5, 'rng_seed': 12345, 'scores': {'logic_score': 0, 'emotion_score': 0, 'corruption': 0}, 'flags': ['low_cloud_presence', 'explore', 'major_wall_alert', 'stage_build_up'], 'memory_layers': [], 'active_layer': None, 'npc_fragments': {}, 'inventory': [], 'lore': {}, 'turn': 5, 'day': 2, 'time': 'dawn', 'current_room': 'entrance', 'recent_events': ['The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger.', 'The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger. As twilight deepens, he notices a faint glow in the distance. Suddenly, a discovery is made! (Moti...', 'The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squints to get a better look, you decide to approach the mysterious light. Suddenly, an inner gate buckles...'], 'recent_motifs': ['storm', 'loss', 'unknown_action', 'shadows', 'shadows'], 'recent_world_atmospheres': [], 'world_constraint_from_prev_turn': {'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}, 'player': {'name': 'The Shieldbearer', 'inventory': ['oil lamp', 'patched shield'], 'stats': {'resolve': 3, 'empathy': 2}, 'summary': 'A weary defender holding the western wall.'}, 'character_summary': 'Rhea is loyal but impulsive; Boris is cautious and calculating.', 'relationship_summary': 'Rhea trusts the player', 'metrics': {'order': 51, 'morale': 49, 'resources': 45, 'knowledge': 56, 'corruption': 10, 'glitch': 60, 'risk_applied_total': 0, 'major_flag_set': True, 'major_events_triggered': 1, 'major_event_last_turn': 5}, 'npc_trust': {'Rhea': 1}, 'environment_hazards': [], 'weather_pattern': {'pattern': 'overcast', 'remaining': 0, 'lock_until': 0}, 'structures': {'western_wall': {'durability': 80, 'max_durability': 100, 'status': 'stable'}, 'inner_gate': {'durability': 70, 'max_durability': 100, 'status': 'stable'}, 'watchtower': {'durability': 60, 'max_durability': 80, 'status': 'stable'}, 'granary': {'durability': 55, 'max_durability': 70, 'status': 'stable'}}, 'npc_schedule': {}, 'patrols': {}, 'combat_log': [], 'item_transfers': [], 'stockpiles': {'food': 120, 'wood': 60, 'ore': 40}, 'stockpile_log': [], 'trade_routes': {}, 'trade_route_history': [], 'scheduled_events': [], 'story_progress': {'act': 'build_up', 'progress': 0.0, 'act_history': []}, 'timeline': [], 'hazard_cooldowns': {}, 'schema_notes': {}, 'locked_options': {}, '_drama_window': [[50, 49, 40, 45, 50], [49, 51, 41, 47, 51], [50, 52, 42, 49, 53], [51, 53, 43, 51, 55], [50, 51, 45, 53, 56], [51, 50, 43, 53, 58]], '_anomaly_active_until': 9, '_world_lock_until': 8, '_high_volatility_mode': True, 'last_weather_change_turn': None, '_glitch_buffer': 0, '_director_pacing': 'steady', '_director_notes': [{'turn': 0, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 1, 'note': 'The campaign is moving at a steady pace. No major events are needed for this turn.'}, {'turn': 2, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 3, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 4, 'note': 'The campaign is progressing at a steady pace. No major events are needed for this turn.'}, {'turn': 5, 'note': 'The campaign is moving at a steady pace. No major events are needed for this turn.'}], '_director_guidance': {'pacing': 'steady', 'risk_budget': 3, 'major_event': 'force', 'notes': 'The campaign is moving at a steady pace. No major events are needed for this turn.', 'flags_to_add': [], 'flags_to_remove': []}, 'previous_judge_verdict': {'consistent': True, 'reason': "The content is consistent with established world, lore, and character logic. The Shieldbearer's actions align with his role as a defender at the entrance.", 'soft_edit_policy': {'max_correction_per_turn': 0.15, 'persist_window': 4}, 'penalty_applied': 'none'}, 'player_choice_history': ['dialogue', 'dialogue', 'dialogue', 'exploration', 'exploration'], 'summary_text': 'A major event shakes the village. Glitch level rises.', 'emotional_memory': [{'turn': 0, 'name': 'Rhea', 'intent': 'observe', 'speech': 'I stand vigilant, my senses alert for any sign of danger.'}, {'turn': 0, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 0, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 0, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 0, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 1, 'name': 'Rhea', 'intent': 'observe', 'speech': 'I stand vigilant, my senses alert for any sign of danger. The storm rages on, a symphony of wind and rain.'}, {'turn': 1, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 1, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 1, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 1, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 2, 'name': 'Rhea', 'intent': 'observe', 'speech': 'The shadows lengthen, whispering secrets I can barely decipher. I stand guard, waiting for any sign of movement.'}, {'turn': 2, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 2, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 2, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 2, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}, {'turn': 3, 'name': 'Rhea', 'intent': 'defend', 'speech': 'Approach the glowing light and investigate its source.'}, {'turn': 4, 'name': 'Rhea', 'intent': 'observe', 'speech': "I notice a faint glow emanating from the distant light source. It's as if something is hidden there, waiting to be discovered."}, {'turn': 4, 'name': 'Rhea', 'intent': 'assist', 'speech': '(assist autonomous)'}, {'turn': 4, 'name': 'Boris', 'intent': 'command', 'speech': '(command autonomous)'}, {'turn': 4, 'name': 'Rhea', 'intent': 'plan', 'speech': '(plan autonomous)'}, {'turn': 4, 'name': 'Boris', 'intent': 'inquire', 'speech': '(inquire autonomous)'}], 'memory_short': ["Turn 1: Ask the Shieldbearer about any recent threats to Lornhaven. -> ' the rewritten prompt: I find myself trapped within a labyrinthine mansion, its walls adorned with ...", 'Turn 2: Ask the Shieldbearer about any recent threats to Lornhaven. -> (Motif: storm)...', 'Turn 3: Ask the Shieldbearer about any recent threats to Lornhaven. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger...', "Memory summary: Turn 1: Ask the Shieldbearer about any recent threats to Lornhaven. -> ' the rewritten prompt: I find myself trapped within a labyrinthine mansion, its walls adorned with ... | Turn 2: Ask the Shieldb...", 'Turn 4: Approach the glowing light and investigate its source. -> The Shieldbearer stands guard at the entrance, his eyes scanning the horizon for any signs of danger...', 'Turn 5: Approach the glowing light and investigate its source. -> The Shieldbearer, standing guard at the entrance, notices a faint glow in the distance. As he squint...'], 'memory_long': ['Turn 5: Major event triggered (major_wall_alert)'], 'status_effects': [{'target': 'Rhea', 'status': 'tense_watch', 'duration': 2}, {'target': 'Rhea', 'status': 'tense_watch', 'duration': 3}], 'persistent_motif': {'motif': 'shadows', 'remaining': 5}, 'last_major_event_turn': 5, 'world_constraint': {'atmosphere': 'Dawn hin mist veils over stone and mortar.', 'sensory_details': 'The chill air carries the scent of rain on dry earth, while distant drums echo with a somber rhythm.'}, 'major_events_triggered': 1, 'major_event_last_turn': 5, '_dramaturgy_state': {'stage': 'build_up', 'history': [{'stage': 'build_up', 'turn': 5}], 'last_turn': 5, 'major_events': 0, 'last_major_turn': 5, 'risk_delta': 0, 'allow_major': False, 'force_major': False, 'directives': ['prioritise_structure_repairs', 'surface_npc_trust'], 'finale_hint': None}, '_dramaturgy_directives': ['prioritise_structure_repairs', 'surface_npc_trust']}
2025-11-07 18:46:54,385 [INFO] fortress_director.orchestrator.orchestrator: Rules engine accepted updates (turn=6)
2025-11-07 18:46:54,385 [INFO] fortress_director.orchestrator.orchestrator: Applying 2 autonomous actions
2025-11-07 18:46:54,385 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'order': current=51, delta=1, limits=(0, 100) (cause=autonomous_Rhea)
2025-11-07 18:46:54,386 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'order', 'delta': 1, 'value': 52, 'cause': 'autonomous_Rhea'}
2025-11-07 18:46:54,386 [INFO] fortress_director.utils.metrics_manager: Metric 'order' updated from 51 to 52 (cause=autonomous_Rhea)
2025-11-07 18:46:54,386 [DEBUG] fortress_director.utils.metrics_manager: Adjusting metric 'morale': current=49, delta=2, limits=(0, 100) (cause=autonomous_Boris)
2025-11-07 18:46:54,386 [DEBUG] fortress_director.utils.metrics_manager: Metric change logged: {'metric': 'morale', 'delta': 2, 'value': 51, 'cause': 'autonomous_Boris'}
2025-11-07 18:46:54,386 [INFO] fortress_director.utils.metrics_manager: Metric 'morale' updated from 49 to 51 (cause=autonomous_Boris)
2025-11-07 18:46:54,386 [INFO] fortress_director.orchestrator.orchestrator: Updating state and persisting...
2025-11-07 18:46:54,386 [INFO] fortress_director.orchestrator.orchestrator: Advanced time to morning
2025-11-07 18:46:54,386 [DEBUG] fortress_director.rules.rules_engine: Status effects ticked: [{'target': 'Rhea', 'status': 'tense_watch', 'duration': 1}, {'target': 'Rhea', 'status': 'tense_watch', 'duration': 2}]
2025-11-07 18:46:54,386 [INFO] fortress_director.rules.rules_engine: Environmental effects applied with seed 12345
2025-11-07 18:46:54,387 [DEBUG] fortress_director.orchestrator.orchestrator: State after update: {"_anomaly_active_until": 9, "_director_guidance": {"flags_to_add": [], "flags_to_remove": [], "major_event": "force", "notes": "The campaign is moving at a steady pace. No major events are needed for this turn.", "pacing": "steady", "risk_budget": 3}, "_director_notes": [{"note": "The campaign is progressing at a steady pace. No major events are needed for this turn.", "turn": 0}, {"note": "The campaign is moving at a steady pace. No major events are needed for this turn.", "turn": 1}, {"note": "The campaign is progressing at a steady pace. No major events are needed for this turn.", "turn...
2025-11-07 18:46:54,411 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6, 24.36 ms)
2025-11-07 18:46:54,425 [INFO] fortress_director.orchestrator.orchestrator: Executing safe function queue...
2025-11-07 18:46:54,425 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6, 0.38 ms)
2025-11-07 18:46:54,426 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6, 0.41 ms)
2025-11-07 18:46:54,426 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6, 0.40 ms)
2025-11-07 18:46:54,427 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6, 0.39 ms)
2025-11-07 18:46:54,427 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6, 0.38 ms)
2025-11-07 18:46:54,428 [INFO] fortress_director.codeaware.function_validator: Validating function call payload: {'name': 'change_weather', 'kwargs': {'atmosphere': 'mist thickens', 'sensory_details': 'The chill air carries the scent of rain on dry earth'}}
2025-11-07 18:46:54,428 [DEBUG] fortress_director.codeaware.function_validator: Coercing function call from payload: {'name': 'change_weather', 'kwargs': {'atmosphere': 'mist thickens', 'sensory_details': 'The chill air carries the scent of rain on dry earth'}}
2025-11-07 18:46:54,428 [DEBUG] fortress_director.codeaware.function_validator: Coerced FunctionCall: FunctionCall(name='change_weather', args=(), kwargs={'atmosphere': 'mist thickens', 'sensory_details': 'The chill air carries the scent of rain on dry earth'}, metadata={})
2025-11-07 18:46:54,428 [DEBUG] fortress_director.codeaware.function_validator: Coerced call: FunctionCall(name='change_weather', args=(), kwargs={'atmosphere': 'mist thickens', 'sensory_details': 'The chill air carries the scent of rain on dry earth'}, metadata={})
2025-11-07 18:46:54,428 [DEBUG] fortress_director.codeaware.function_validator: Enforcing rate limits for function: change_weather
2025-11-07 18:46:54,428 [INFO] fortress_director.codeaware.function_registry: Validating function call: change_weather
2025-11-07 18:46:54,428 [DEBUG] fortress_director.codeaware.function_validator: Recorded success for function: change_weather (total_calls=1, per_function=1)
2025-11-07 18:46:54,428 [INFO] fortress_director.codeaware.function_validator: Function call 'change_weather' validated successfully.
2025-11-07 18:46:54,429 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6, 0.37 ms)
2025-11-07 18:46:54,429 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=6, call=change_weather)
2025-11-07 18:46:54,429 [INFO] fortress_director.codeaware.function_registry: Getting registered function: change_weather
2025-11-07 18:46:54,429 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'change_weather'...
2025-11-07 18:46:54,430 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6, 0.28 ms)
2025-11-07 18:46:54,443 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6, 13.08 ms)
2025-11-07 18:46:54,443 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed successfully.
2025-11-07 18:46:54,443 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed (checkpoint turn=6)
2025-11-07 18:46:54,444 [INFO] fortress_director.codeaware.function_validator: Validating function call payload: {'name': 'change_weather', 'kwargs': {'atmosphere': 'mist thickens', 'sensory_details': 'The chill air carries the scent of rain on dry earth'}}
2025-11-07 18:46:54,444 [DEBUG] fortress_director.codeaware.function_validator: Coercing function call from payload: {'name': 'change_weather', 'kwargs': {'atmosphere': 'mist thickens', 'sensory_details': 'The chill air carries the scent of rain on dry earth'}}
2025-11-07 18:46:54,445 [DEBUG] fortress_director.codeaware.function_validator: Coerced FunctionCall: FunctionCall(name='change_weather', args=(), kwargs={'atmosphere': 'mist thickens', 'sensory_details': 'The chill air carries the scent of rain on dry earth'}, metadata={})
2025-11-07 18:46:54,445 [DEBUG] fortress_director.codeaware.function_validator: Coerced call: FunctionCall(name='change_weather', args=(), kwargs={'atmosphere': 'mist thickens', 'sensory_details': 'The chill air carries the scent of rain on dry earth'}, metadata={})
2025-11-07 18:46:54,445 [DEBUG] fortress_director.codeaware.function_validator: Enforcing rate limits for function: change_weather
2025-11-07 18:46:54,445 [INFO] fortress_director.codeaware.function_registry: Validating function call: change_weather
2025-11-07 18:46:54,445 [DEBUG] fortress_director.codeaware.function_validator: Recorded success for function: change_weather (total_calls=2, per_function=2)
2025-11-07 18:46:54,445 [INFO] fortress_director.codeaware.function_validator: Function call 'change_weather' validated successfully.
2025-11-07 18:46:54,445 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6, 0.37 ms)
2025-11-07 18:46:54,447 [INFO] fortress_director.codeaware.rollback_system: Checkpoint created (turn=6, call=change_weather)
2025-11-07 18:46:54,447 [INFO] fortress_director.codeaware.function_registry: Getting registered function: change_weather
2025-11-07 18:46:54,447 [INFO] fortress_director.codeaware.rollback_system: Executing safe function 'change_weather'...
2025-11-07 18:46:54,447 [DEBUG] fortress_director.orchestrator.orchestrator: State snapshot loaded from C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6, 0.36 ms)
2025-11-07 18:46:54,460 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=6, 12.41 ms)
2025-11-07 18:46:54,460 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed successfully.
2025-11-07 18:46:54,460 [INFO] fortress_director.codeaware.rollback_system: Safe function 'change_weather' executed (checkpoint turn=6)
2025-11-07 18:46:54,461 [INFO] fortress_director.codeaware.function_validator: Validating function call payload: {'name': 'move_npc', 'kwargs': {'npc_id': 'Boris', 'destination': 'east_wall'}}
2025-11-07 18:46:54,461 [DEBUG] fortress_director.codeaware.function_validator: Coercing function call from payload: {'name': 'move_npc', 'kwargs': {'npc_id': 'Boris', 'destination': 'east_wall'}}
2025-11-07 18:46:54,461 [DEBUG] fortress_director.codeaware.function_validator: Coerced FunctionCall: FunctionCall(name='move_npc', args=(), kwargs={'npc_id': 'Boris', 'destination': 'east_wall'}, metadata={})
2025-11-07 18:46:54,461 [DEBUG] fortress_director.codeaware.function_validator: Coerced call: FunctionCall(name='move_npc', args=(), kwargs={'npc_id': 'Boris', 'destination': 'east_wall'}, metadata={})
2025-11-07 18:46:54,461 [DEBUG] fortress_director.codeaware.function_validator: Enforcing rate limits for function: move_npc
2025-11-07 18:46:54,461 [INFO] fortress_director.codeaware.function_registry: Validating function call: move_npc
2025-11-07 18:46:54,462 [WARNING] fortress_director.codeaware.function_validator: Function validation failed: move_npc requires a non-empty 'location' string
2025-11-07 18:46:54,462 [ERROR] root: Turn aborted due to safe function error: move_npc requires a non-empty 'location' string
2025-11-07 18:46:54,462 [ERROR] fortress_director.orchestrator.orchestrator: Exception during turn: move_npc requires a non-empty 'location' string
Traceback (most recent call last):
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\orchestrator\orchestrator.py", line 1769, in run_turn
    safe_function_results = self._execute_safe_function_queue(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\orchestrator\orchestrator.py", line 3848, in _execute_safe_function_queue
    outcome = self.run_safe_function(payload, metadata=metadata)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\orchestrator\orchestrator.py", line 2159, in run_safe_function
    outcome = self.rollback_system.run_validated_call(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\codeaware\rollback_system.py", line 197, in run_validated_call
    call = validator.validate(payload)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\codeaware\function_validator.py", line 69, in validate
    validated = self._registry.validate(call)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\codeaware\function_registry.py", line 127, in validate
    validated = entry.validator(call) or call
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\orchestrator\orchestrator.py", line 3073, in _validate_move_npc_call
    raise FunctionValidationError(
fortress_director.codeaware.function_registry.FunctionValidationError: move_npc requires a non-empty 'location' string
2025-11-07 18:46:54,520 [INFO] fortress_director.codeaware.rollback_system: Rollback requested (reason=Turn execution failed: FunctionValidationError)
2025-11-07 18:46:54,534 [DEBUG] fortress_director.orchestrator.orchestrator: State persisted to C:\Users\Fahri\OneDrive\Masaüstü\oyun\fortress_director\data\world_state.json (turn=5, 13.12 ms)
2025-11-07 18:46:54,534 [INFO] fortress_director.codeaware.rollback_system: Rollback applied (turn=5, reason=Turn execution failed: FunctionValidationError)
2025-11-07 18:46:54,534 [INFO] fortress_director.orchestrator.orchestrator: Rollback performed after exception.
